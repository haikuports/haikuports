SUMMARY="A lightweight QtWebKit browser"
DESCRIPTION="QupZilla is a free and open-source web browser, \
intended for general users. It allows seamless integration with \
users' desktop environments and has several distinguishing features \
positively received by reviewers:
 - A unified interface for bookmarks, history and RSS reading.
 - A themeable interface.
 - Integrated Adblock.
 - Speed dial."
HOMEPAGE="http://www.qupzilla.com"
COPYRIGHT="2010-2015 David Rosca"
LICENSE="GNU GPL v3"
REVISION="1"
SOURCE_URI="https://github.com/QupZilla/qupzilla/releases/download/v$portVersion/QupZilla-$portVersion.tar.xz"
CHECKSUM_SHA256="620ffb10a3f6b3f596c2c38a84d9c320cb66dd2d5e6701e8e31945e26308fcac"
SOURCE_DIR="QupZilla-$portVersion"
SOURCE_URI_2="https://github.com/miqlas/Qupzilla-Haiku/archive/0.0.1.tar.gz"
CHECKSUM_SHA256_2="2e8437c44c17f74d53ec26afc7535215e7aa337c7a994432d0e826ab9add8c80"
SOURCE_DIR_2="Qupzilla-Haiku-0.0.1"
PATCHES="qupzilla-$portVersion.patchset"

ARCHITECTURES="!x86_gcc2 x86 ?x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	qupzilla$secondaryArchSuffix = $portVersion
	app:QupZilla$secondaryArchSuffix = $portVersion
	"
# TODO: update requirements to be more specific about which Qt
# libraries are required.
REQUIRES="
	haiku${secondaryArchSuffix}
	qt5$secondaryArchSuffix
	lib:libexecinfo$secondaryArchSuffix
	"

BUILD_PREREQUIRES="
	cmd:qmake$secondaryArchSuffix
	cmd:make
	cmd:g++$secondaryArchSuffix
	cmd:pkg_config$secondaryArchSuffix
	coreutils
	"
BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	qt5${secondaryArchSuffix}_devel
	devel:libssl$secondaryArchSuffix
	devel:libcrypto$secondaryArchSuffix
	devel:libexecinfo$secondaryArchSuffix
	"

BUILD()
{
	cd $sourceDir
	pwd
	export QUPZILLA_PREFIX=$appsDir/QupZilla
	export DISABLE_UPDATES_CHECK="true"
	export NO_X11="true"
	qmake
	make $jobArgs
}

INSTALL()
{
	cd $sourceDir

	mkdir -p $appsDir/QupZilla/lib
	cd bin

	# Add Haiku resources
	rc -o ../haiku/QupZilla.rsrc ../haiku/QupZilla.rdef
	xres -o qupzilla ../haiku/QupZilla.rsrc
	mimeset -f qupzilla

	cp qupzilla $appsDir/QupZilla/QupZilla
	cp -R locale $appsDir/QupZilla
	cp -R plugins $appsDir/QupZilla
	cp -R themes $appsDir/QupZilla
	cp libQupZilla.* $appsDir/QupZilla/lib

	addAppDeskbarSymlink $appsDir/QupZilla/QupZilla "QupZilla"

	#Haiku theme
	mkdir -p $appsDir/QupZilla/themes
	cp -dR $sourceDir2/haiku $appsDir/QupZilla/themes
}
