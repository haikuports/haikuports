From 7dc010dc0a20bf9b6aa8e254d3bfc9f599d52049 Mon Sep 17 00:00:00 2001
From: Swangeon <swangeon@gmail.com>
Date: Fri, 18 Aug 2023 02:28:53 -0500
Subject: [PATCH] Adding ifconfig and configure command setup's.

---
 configure.ac      | 4 ++++
 src/openvpn/tun.c | 9 +++++++++
 2 files changed, 13 insertions(+)

diff --git a/configure.ac b/configure.ac
index 2f65cbd5..40e4f940 100644
--- a/configure.ac
+++ b/configure.ac
@@ -373,6 +373,10 @@ case "$host" in
 		have_tap_header="yes"
 		ac_cv_header_net_if_h="no"	# exists, but breaks things
 		;;
+	*-*-haiku*)
+		AC_DEFINE([TARGET_HAIKU], [1], [Are we running Haiku?])
+		AC_DEFINE_UNQUOTED([TARGET_PREFIX], ["H"], [Target prefix])
+		;;
 	*)
 		AC_DEFINE_UNQUOTED([TARGET_PREFIX], ["X"], [Target prefix])
 		have_tap_header="yes"
diff --git a/src/openvpn/tun.c b/src/openvpn/tun.c
index 26718498..494a9b74 100644
--- a/src/openvpn/tun.c
+++ b/src/openvpn/tun.c
@@ -1643,6 +1643,15 @@ do_ifconfig_ipv4(struct tuntap *tt, const char *ifname, int tun_mtu,
     {
         windows_set_mtu(tt->adapter_index, AF_INET, tun_mtu);
     }
+#elif defined (TARGET_HAIKU)
+    {
+        /* example: ifconfig tap inet 1.1.1.1 255.255.255.0 mtu 1450 up */
+        argv_printf(&argv, "%s %s inet %s 255.255.255.0 mtu %d up", IFCONFIG_PATH,
+            ifname, ifconfig_local, tun_mtu);
+
+        argv_msg(M_INFO, &argv);
+        openvpn_execve_check(&argv, es, S_FATAL, "Haiku ifconfig failed");
+    }
 
 #else  /* if defined(TARGET_LINUX) */
     msg(M_FATAL, "Sorry, but I don't know how to do 'ifconfig' commands on this operating system.  You should ifconfig your TUN/TAP device manually or use an --up script.");
-- 
2.34.1

