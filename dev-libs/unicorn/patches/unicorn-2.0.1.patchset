From a9106fa7fcf9a42c7995c0560fd72e0a0eb25571 Mon Sep 17 00:00:00 2001
From: Alexander von Gluck IV <kallisti5@unixzen.com>
Date: Wed, 22 Mar 2023 13:57:12 -0500
Subject: build: Fixes for Haiku

* Haiku is fully posix, so can be lumped together with most unix cases

diff --git a/glib_compat/grand.c b/glib_compat/grand.c
index b6e5764..0d3f95b 100644
--- a/glib_compat/grand.c
+++ b/glib_compat/grand.c
@@ -232,7 +232,7 @@ GRand *g_rand_new_with_seed_array (const guint32 *seed, guint seed_length)
 
 gint64 g_get_real_time (void)
 {
-#if defined(unix) || defined(__unix__) || defined(__unix) || defined (__MINGW32__) || defined(__APPLE__)
+#if defined(unix) || defined(__unix__) || defined(__unix) || defined (__MINGW32__) || defined(__APPLE__) || defined(__HAIKU__)
     struct timeval r;
 
     /* this is required on alpha, there the timeval structs are ints
@@ -271,7 +271,7 @@ gint64 g_get_real_time (void)
 GRand *g_rand_new (void)
 {
     guint32 seed[4];
-#if defined(unix) || defined(__unix__) || defined(__unix) || defined(__APPLE__)
+#if defined(unix) || defined(__unix__) || defined(__unix) || defined(__APPLE__) || defined(__HAIKU__)
     static gboolean dev_urandom_exists = TRUE;
 
     if (dev_urandom_exists)
diff --git a/tests/unit/acutest.h b/tests/unit/acutest.h
index 6b4d596..fbe55bc 100644
--- a/tests/unit/acutest.h
+++ b/tests/unit/acutest.h
@@ -270,7 +270,7 @@
 #include <string.h>
 #include <setjmp.h>
 
-#if defined(unix) || defined(__unix__) || defined(__unix) || defined(__APPLE__)
+#if defined(unix) || defined(__unix__) || defined(__unix) || defined(__APPLE__) || defined(__HAIKU__)
 #define ACUTEST_UNIX_ 1
 #include <errno.h>
 #include <libgen.h>
-- 
2.37.3


From 99ed7153b23241c782e47fe1e1956dc30093d462 Mon Sep 17 00:00:00 2001
From: Oscar Lesta <oscar.lesta@gmail.com>
Date: Sat, 25 Mar 2023 06:33:10 -0300
Subject: Use the correct library name under Haiku too.


diff --git a/bindings/python/unicorn/unicorn.py b/bindings/python/unicorn/unicorn.py
index 2e6a938..c0f8953 100644
--- a/bindings/python/unicorn/unicorn.py
+++ b/bindings/python/unicorn/unicorn.py
@@ -25,6 +25,7 @@ if _python2:
 _lib = { 'darwin': 'libunicorn.2.dylib',
          'win32': 'unicorn.dll',
          'cygwin': 'cygunicorn.dll',
+         'haiku1': 'libunicorn.so.2',
          'linux': 'libunicorn.so.2',
          'linux2': 'libunicorn.so.2' }
 
-- 
2.37.3

