SUMMARY="Tools and libraries to work with AppStream metadata"
DESCRIPTION="AppStream is a cross-distro effort for better app stores. \
It provides metadata for software components and makes it available to software \
centers like GNOME Software and KDE Discover."
HOMEPAGE="https://github.com/ximion/appstream"
COPYRIGHT="Matthias Klumpp"
LICENSE="GNU LGPL v2.1"
REVISION="1"

# Usando la última versión estable (1.0.3) como ejemplo.
portVersion="1.0.5"
SOURCE_URI="https://github.com/ximion/appstream/archive/refs/tags/v$portVersion/appstream-$portVersion.tar.gz"
CHECKSUM_SHA256="dd33b1375ba4221ffee060e2778c478e8150d7b1108c6309148f5fb1ca6e90c0"
SOURCE_DIR="appstream-$portVersion"
PATCHES="appstream-1.0.5-haiku.patchset"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

# La biblioteca es libappstream.so.5
libVersion="5"

PROVIDES="
	appstream$secondaryArchSuffix = $portVersion
	lib:libappstream$secondaryArchSuffix = $libVersion
	cmd:appstreamcli
	"

PROVIDES_devel="
	appstream${secondaryArchSuffix}_devel = $portVersion
	devel:libappstream$secondaryArchSuffix = $libVersion
	"

REQUIRES="
	haiku$secondaryArchSuffix
	lib:libglib_2.0$secondaryArchSuffix
	lib:libcurl$secondaryArchSuffix
	libyaml$secondaryArchSuffix
	lib:libxml2$secondaryArchSuffix
	lib:libgdk_pixbuf_2.0$secondaryArchSuffix
	lib:libjson_glib_1.0$secondaryArchSuffix
	snowball_stemmer$secondaryArchSuffix
	"

REQUIRES_devel="
	appstream$secondaryArchSuffix == $portVersion base
	devel:libglib_2.0$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libglib_2.0$secondaryArchSuffix
	devel:libcurl$secondaryArchSuffix
	devel:libyaml$secondaryArchSuffix
	devel:libxml2$secondaryArchSuffix
	devel:libgdk_pixbuf_2.0$secondaryArchSuffix
	devel:libjson_glib_1.0$secondaryArchSuffix
	gobject_introspection$secondaryArchSuffix
	devel:libxmlb$secondaryArchSuffix
	snowball_stemmer${secondaryArchSuffix}_devel
	cmd:xsltproc
	"

BUILD_PREREQUIRES="
        docbook_xsl_stylesheets$secondaryArchSuffix
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:meson
	cmd:sed
	cmd:cmake
	cmd:itstool
	cmd:ninja
	cmd:pkg_config$secondaryArchSuffix
	cmd:gperf
	cmd:msgfmt
	cmd:xsltproc
	"

#	sed -i "s|stemmer_inc_dirs = include_directories(\['/usr/include'\])|#&|" meson.build
BUILD()
{

	sed -i "s|stemmer_inc_dirs = include_directories(\['/usr/include'\])|#&|" meson.build
	meson setup Build \
		--buildtype=release \
		--prefix="$prefix" \
		--libdir="$libDir" \
		--includedir="$includeDir" \
		--datadir="$dataDir" \
		--localedir="$dataDir/locale" \
		--sysconfdir="$settingsDir" \
		-Dc_args="-I$includeDir" \
		-Dcpp_args="-I$includeDir" \
		-Dsystemd=false \
		-Dgir=true \
		-Dapidocs=false \
		-Dcompose=false

	ninja -C Build
}

INSTALL()
{
	ninja install -C Build

	prepareInstalledDevelLibs \
		libappstream

	fixPkgconfig

	packageEntries devel \
		$developDir
}

