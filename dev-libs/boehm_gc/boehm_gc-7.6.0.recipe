SUMMARY="The Boehm-Demers-Weiser conservative garbage collector"
DESCRIPTION="The Boehm-Demers-Weiser conservative garbage collector can be \
used as a garbage collecting replacement for C malloc or C++ new. It allows \
you to allocate memory basically as you normally would, without explicitly \
deallocating memory that is no longer useful. The collector automatically \
recycles memory when it determines that it can no longer be otherwise \
accessed."
HOMEPAGE="http://www.hboehm.info/gc/"
COPYRIGHT="1988, 1989 Hans-J. Boehm, Alan J. Demers
	1991-1996 Xerox Corporation.
	1996-1999 Silicon Graphics.
	1999-2011 Hewlett-Packard Development Company, L.P."
LICENSE="Boehm"
REVISION="3"
SOURCE_URI="http://www.hboehm.info/gc/gc_source/gc-$portVersion.tar.gz"
CHECKSUM_SHA256="a14a28b1129be90e55cd6f71127ffc5594e1091d5d54131528c24cd0c03b7d90"
SOURCE_DIR="gc-$portVersion"
PATCHES="boehm_gc-$portVersion.patchset"

ARCHITECTURES="?x86 ?x86_gcc2 x86_64"
SECONDARY_ARCHITECTURES="?x86 ?x86_gcc2"

PROVIDES="
	boehm_gc$secondaryArchSuffix = $portVersion compat >= 7
	lib:libgc$secondaryArchSuffix = $portVersion compat >= 7
	lib:libcord$secondaryArchSuffix = $portVersion compat >= 7
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libatomic_ops${secondaryArchSuffix}
	"

PROVIDES_devel="
	boehm_gc${secondaryArchSuffix}_devel = $portVersion compat >= 7
	devel:libgc${secondaryArchSuffix} = $portVersion compat >= 7
	devel:libcord${secondaryArchSuffix} = $portVersion compat >= 7
	"
REQUIRES_devel="
	boehm_gc${secondaryArchSuffix} == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libatomic_ops$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	haiku${secondaryArchSuffix}_devel
	cmd:libtoolize$secondaryArchSuffix
	cmd:autoconf
	cmd:make
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	libtoolize -fci
	autoconf -f
	runConfigure ./configure --enable-large-config \
				 --enable-threads=posix \
	 			 --enable-thread-local-alloc \
				 --enable-parallel-mark \
				 --disable-debug \
				 --disable-dependency-tracking
	make $jobArgs
}

INSTALL()
{
	make install
	prepareInstalledDevelLibs libgc libcord
	fixPkgconfig
	packageEntries devel $developDir
}

TEST()
{
	make check -e CFLAGS+="-fPIC"
}
