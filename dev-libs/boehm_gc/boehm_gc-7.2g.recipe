SUMMARY="The Boehm-Demers-Weiser conservative garbage collector"
DESCRIPTION="The Boehm-Demers-Weiser conservative garbage collector can be \
used as a garbage collecting replacement for C malloc or C++ new. It allows \
you to allocate memory basically as you normally would, without explicitly \
deallocating memory that is no longer useful. The collector automatically \
recycles memory when it determines that it can no longer be otherwise accessed."
HOMEPAGE="http://www.hboehm.info/gc/"
COPYRIGHT="1988, 1989 Hans-J. Boehm, Alan J. Demers
	1991-1996 Xerox Corporation.
	1996-1999 Silicon Graphics.
	1998 Fergus Henderson.
	2001 Red Hat Inc.
	1999-2011 Hewlett-Packard Development Company, L.P."
LICENSE="BOEHM"
REVISION="1"
SOURCE_URI="http://www.hboehm.info/gc/gc_source/gc-7.2g.tar.gz"
CHECKSUM_SHA256="584e29e2f1be4a389ca30f78dcd2c991031e7d1e1eb3d7ce2a0f975218337c2f"
SOURCE_DIR="gc-7.2"
PATCHES="boehm_gc-7.2d.patchset"

ARCHITECTURES="x86 x86_gcc2 x86_64"
SECONDARY_ARCHITECTURES="x86 x86_gcc2"

PROVIDES="
	boehm_gc$secondaryArchSuffix = $portVersion compat >= 7
	lib:libcord$secondaryArchSuffix = $portVersion compat >= 7
	lib:libgc$secondaryArchSuffix = $portVersion compat >= 7
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

PROVIDES_devel="
	boehm_gc${secondaryArchSuffix}_devel = $portVersion compat >= 7
	devel:libcord$secondaryArchSuffix = $portVersion compat >= 7
	devel:libgc$secondaryArchSuffix = $portVersion compat >= 7
	"
REQUIRES_devel="
	boehm_gc$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:autoconf
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	"

BUILD()
{
	libtoolize --force --copy --install
	autoconf -f
	runConfigure ./configure --enable-threads=posix \
		--enable-thread-local-alloc --enable-parallel-mark
	make $jobArgs
}

INSTALL()
{
	make install
	prepareInstalledDevelLibs libgc libcord
	fixPkgconfig
	packageEntries devel $developDir
}

TEST()
{
	make check
}
