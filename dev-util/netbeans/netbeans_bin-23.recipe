SUMMARY="An IDE for Java"
DESCRIPTION="NetBeans IDE lets you quickly and easily develop Java desktop, \
mobile, and web applications, as well as HTML5 applications with HTML, \
JavaScript, and CSS. The IDE also provides a great set of tools for PHP and \
C/C++ developers.
It is free and open source and has a large community of users and developers \
around the world."
HOMEPAGE="https://netbeans.org/"
COPYRIGHT="1997,2024 Oracle and/or its affiliates"
LICENSE="Apache v2"
REVISION="1"
SOURCE_URI="https://dlcdn.apache.org/netbeans/netbeans/$portVersion/netbeans-$portVersion-bin.zip#noarchive"
CHECKSUM_SHA256="50d4d6d0af09964c4e2b3f683b71d404f678c9963bb96064159776b9e9d7b590"
ADDITIONAL_FILES="netbeans-ide.rdef.in"

ARCHITECTURES="?all x86_64"
DISABLE_SOURCE_PACKAGE="true"

PROVIDES="
	netbeans_bin = $portVersion
	app:netbeans = $portVersion
	"
REQUIRES="
	haiku
	java:environment == 17
	"

BUILD_PREREQUIRES="
	cmd:find
	cmd:unzip
	cmd:xargs
	"

INSTALL()
{
	mkdir -p $appsDir
	cd $appsDir
	unzip $sourceDir/netbeans-$portVersion-bin.zip

	cd netbeans
	rm -rf profiler {cnd,dlight,ide}/bin \
		platform/modules/lib/{amd64,i386,x86}
	find . -name "*.dll" -o -name "*.exe" -o -name "*.cmd" \
		-o -name "*.bat" -o -name ".lastModified" | xargs rm

	sed -i 's,\${HOME}/.netbeans,\${HOME}/config/settings/netbeans,g' bin/netbeans
	sed -i 's,\${HOME}/.cache/netbeans,\${HOME}/config/settings/cache/netbeans,g' bin/netbeans

	cat << EOF > $appsDir/netbeans/netbeans.sh
#!/bin/sh -l
export PATH=\$JDK17_HOME/bin:\$PATH
exec $appsDir/netbeans/bin/netbeans
EOF
	chmod 755 $appsDir/netbeans/netbeans.sh

	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="0"
	local MINOR="0"
	local APP_NAME="NetBeans"
	local LONG_INFO="$SUMMARY"
	local APP_SIGNATURE="application/x-vnd.netbeans"
	sed \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@LONG_INFO@|$LONG_INFO|" \
		-e "s|@APP_NAME@|$APP_NAME|" \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		$portDir/additional-files/netbeans-ide.rdef.in > netbeans-ide.rdef

	rc netbeans-ide.rdef
	settype -t application/x-vnd.Be-elfexecutable "$appsDir/netbeans/netbeans.sh"
	resattr -o "$appsDir/netbeans/netbeans.sh" netbeans-ide.rsrc

	addAppDeskbarSymlink $appsDir/netbeans/netbeans.sh 'NetBeans'
}
