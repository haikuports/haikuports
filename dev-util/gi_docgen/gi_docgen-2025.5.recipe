SUMMARY="A documentation generator for GObject-based libraries"
DESCRIPTION="GI-DocGen is a document generator for GObject-based libraries. GObject is the base \
type system of the GNOME project. GI-Docgen reuses the introspection data generated by \
GObject-based libraries to generate the API reference of these libraries, as well as other \
ancillary documentation."
HOMEPAGE="https://gnome.pages.gitlab.gnome.org/gi-docgen/"
COPYRIGHT="2014 John Hawthorn"
LICENSE="GNU GPL v3"
REVISION="1"
SOURCE_URI="https://gitlab.gnome.org/GNOME/gi-docgen/-/archive/$portVersion/gi-docgen-$portVersion.tar.bz2"
CHECKSUM_SHA256="b501b7b548333e9b043ad75f85272b936727679ec639ae50054399909416c51d"
SOURCE_DIR="gi-docgen-$portVersion"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

# On x86_gcc2 we don't want to install the commands in bin/<arch>/, but in bin/.
commandSuffix=$secondaryArchSuffix
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
	commandSuffix=
	commandBinDir=$prefix/bin
fi

PYTHON_VERSIONS=(3.10)
for pythonVersion in ${PYTHON_VERSIONS[@]}; do
	pythonPackage=python${pythonVersion//.}
done

PROVIDES="
	$portName = $portVersion
	cmd:gi_docgen = $portVersion
	"
REQUIRES="
	haiku
	cmd:python$pythonVersion
	jinja2_$pythonPackage
	markdown_$pythonPackage
	pygments_$pythonPackage
	setuptools_$pythonPackage
	typogrify_$pythonPackage
	"

BUILD_REQUIRES="
	haiku_devel
	setuptools_$pythonPackage
	"
BUILD_PREREQUIRES="
	cmd:python$pythonVersion
	"

INSTALL()
{
	python=python$pythonVersion
	installLocation=$prefix/lib/$python/vendor-packages/
	export PYTHONPATH=$installLocation:$PYTHONPATH

	mkdir -p $installLocation
	rm -rf build

	$python setup.py build install \
		--root=/ --prefix=$prefix

	mkdir -p $developLibDir $manDir
	mv $prefix/share/pkgconfig $developLibDir
	mv $prefix/share/man/man1 $manDir
	rm -rf $prefix/share
}
