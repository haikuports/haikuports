SUMMARY="Deep ghidra decompiler integration for radare2 and iaito"
DESCRIPTION="This is an integration of the Ghidra decompiler for radare2 \
(https://github.com/radareorg/radare2).
It is solely based on the decompiler part of Ghidra, which is written entirely in C++, so Ghidra \
itself is not required at all and the plugin can be built self-contained.
This project was presented at r2con 2019 as part of the Cutter talk: \
https://youtu.be/eHtMiezr7l8?t=950](https://youtu.be/eHtMiezr7l8?t=950"
HOMEPAGE="https://radare.org/"
COPYRIGHT="2019-2023 thestr4ng3r
	2020-2024 FXTi
	2023 Florian MÃ¤rkl
	2019-2024 pancake
	2003 Kristen Wegner
	2006-2020 Arseny Kapoulkine"
LICENSE="Apache v2
	MIT
	GNU LGPL v3"
REVISION="1"
SOURCE_URI="https://github.com/radareorg/r2ghidra/archive/refs/tags/$portVersion.tar.gz"
CHECKSUM_SHA256="0482e12b0cf00f4ac942256bbf8090bf11c14e4c93ff6e0811e0924ba29ba6fb"
SOURCE_FILENAME="r2ghidra-$portVersion.tar.gz"
srcGitRev_2="4c3df61206ea0486cde4e8f4982606ace882714a" # 0.6.4+commits
SOURCE_URI_2="https://github.com/radareorg/ghidra-native/archive/$srcGitRev_2.tar.gz"
CHECKSUM_SHA256_2="053d865916cb49ab859d4b23c31827b9728473ea7e526c8db7ef6a230c5b4bd5"
SOURCE_FILENAME_2="ghidra-native-$$srcGitRev_2.tar.gz"
SOURCE_DIR_2="ghidra-native-$srcGitRev_2"
PATCHES_2="r2ghidra-$portVersion-source2.patchset"
srcGitRev_3="0e3f1699ffab5f820060fe99c61f0f9495c0c5b6"
SOURCE_URI_3="https://github.com/zeux/pugixml/archive/refs/tags/v1.15.tar.gz"
CHECKSUM_SHA256_3="b39647064d9e28297a34278bfb897092bf33b7c487906ddfc094c9e8868bddcb"
SOURCE_FILENAME_3="pugixml-v1.15.tar.gz"
SOURCE_DIR_3="pugixml-1.15"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="?x86"

commandBinDir=$binDir
commandSuffix=$secondaryArchSuffix
if [ "$targetArchitecture" = x86_gcc2 ]; then
	commandBinDir=$prefix/bin
	commandSuffix=
fi

PROVIDES="
	r2ghidra$secondaryArchSuffix = $portVersion
	cmd:sleighc$commandSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libr_core$secondaryArchSuffix # don't list all radare2 libraries
	lib:libz$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libr_anal$secondaryArchSuffix
	devel:libr_asm$secondaryArchSuffix
	devel:libr_core$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:bison
	cmd:flex
	cmd:gcc$secondaryArchSuffix
	cmd:git
	cmd:make
	cmd:patch
	cmd:pkg_config$secondaryArchSuffix
	cmd:r2
	"

BUILD()
{
	mkdir -p subprojects/{ghidra-native,pugixml}
	cp -R $sourceDir2/* subprojects/ghidra-native
	cp -R $sourceDir3/* subprojects/pugixml

	make -C subprojects/ghidra-native patch

	runConfigure --omit-dirs binDir ./configure \
		--bindir=$commandBinDir
	make $jobArgs
}

INSTALL()
{
	make install R2_LIBR_PLUGINS=$libDir/radare2/$portVersion
}

TEST()
{
	make check
}
