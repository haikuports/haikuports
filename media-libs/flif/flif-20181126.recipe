SUMMARY="Free Lossless Image Format"
DESCRIPTION="FLIF is a lossless image format based on MANIAC compression. \
MANIAC (Meta-Adaptive Near-zero Integer Arithmetic Coding) is a variant of \
CABAC (context-adaptive binary arithmetic coding), where the contexts are \
nodes of decision trees which are dynamically learned at encode time.

FLIF outperforms PNG, FFV1, lossless WebP, lossless BPG and lossless \
JPEG2000 in terms of compression ratio.

Moreover, FLIF supports a form of progressive interlacing (essentially a \
generalization/improvement of PNG's Adam7) which means that any prefix \
(e.g. partial download) of a compressed file can be used as a reasonable \
lossy encoding of the entire image."
HOMEPAGE="https://flif.info/"
COPYRIGHT="2016 Jon Sneyers
	Pieter Wuille"
LICENSE="Apache v2
	GNU GPL v3
	GNU LGPL v3"
REVISION="1"
srcGitRev="74ea92bf1ab2db18ae6d2a521dff946fcc679618"
SOURCE_URI="https://github.com/FLIF-hub/FLIF/archive/74ea92bf1ab2db18ae6d2a521dff946fcc679618.tar.gz"
CHECKSUM_SHA256="aeeb4d24f19204f2b0cecc41ee1ebdda1c1ae730f0c6fa4969f67aab7e5eccac"
SOURCE_DIR="FLIF-$srcGitRev"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	flif$secondaryArchSuffix = $portVersion
	cmd:apng2flif
	cmd:flif
	cmd:gif2flif
	lib:libflif$secondaryArchSuffix = 0
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

PROVIDES_devel="
	flif${secondaryArchSuffix}_devel = $portVersion
	devel:libflif$secondaryArchSuffix = 0
	"
REQUIRES_devel="
	flif$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libpng16$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:gcc$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	make PREFIX=$prefix
}

INSTALL()
{
	make install PREFIX=$prefix
	make install-dev PREFIX=$prefix

	# move headers
	mkdir -p $includeDir
	mv $prefix/include/* $includeDir
	rm -rf $prefix/include

	# move libs for secondaryArchSuffix
	if [ "$targetArchitecture" = x86_gcc2 ]; then
	mv $prefix/lib $prefix/lib2
	mkdir $(dirname $libDir)
	mv $prefix/lib2 $libDir
	fi

	# move manpage to $manDir
	mkdir -p $manDir
	mv $prefix/share/man/* $manDir
	rm -rf $prefix/share

	prepareInstalledDevelLibs libflif

	mkdir -p "$developLibDir"/pkgconfig
	cat > "$developLibDir"/pkgconfig/flif.pc << EOF
prefix=${prefix}
exec_prefix=${prefix}
libdir=${libDir}
includedir=${includeDir}

Name: flif
Description: Free Lossless Image Format
Version: ${portVersion}
Libs: -L${developLibDir} -lflif
Cflags: -I${includeDir}
EOF

	packageEntries devel \
		$developDir
}
