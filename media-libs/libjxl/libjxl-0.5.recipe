SUMMARY="Short description of ProjectX"
DESCRIPTION="Long ProjectX description.
Spanning several paragraphs, maybe
 - containing
 - bullet points etc.
You can also have really long lines that do not fit in 80 characters and use \
a forward-slash to wrap the line."
HOMEPAGE="https://jpeg.org/jpegxl/index.html"
COPYRIGHT="2021 the JPEG XL Project"
LICENSE="MIT
	GNU GPL v2"
REVISION="1"
SOURCE_URI="https://gitlab.com/wg1/jpeg-xl/-/archive/v$portVersion/jpeg-xl-v$portVersion.tar.bz2"
CHECKSUM_SHA256="43ae213b9ff28f672beb4f50dbee0834be2afe0015a62bf525d35ee2e7e89d6c"
SOURCE_DIR="jpeg-xl-v$portVersion"

ARCHITECTURES="!x86_gcc2 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	libjxl$secondaryArchSuffix = $portVersion
	lib:libjxl$secondaryArchSuffix = $portVersion
	lib:libjxl_dec$secondaryArchSuffix = $portVersion
	lib:libjxl_threads$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libavif$secondaryArchSuffix
	lib:libbrotlicommon$secondaryArchSuffix
	lib:libbrotlidec$secondaryArchSuffix
	lib:libbrotlienc$secondaryArchSuffix
	lib:libgif$secondaryArchSuffix
	lib:libGL$secondaryArchSuffix
	lib:libIex_3_0$secondaryArchSuffix
	lib:libIlmThread_3_0$secondaryArchSuffix
	lib:libImath_3_0$secondaryArchSuffix
	lib:libOpenEXR_3_0$secondaryArchSuffix
	lib:libOpenEXRUtil_3_0$secondaryArchSuffix
	lib:libjpeg$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
	lib:libwebp$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

PROVIDES_devel="
	libjxl${secondaryArchSuffix}_devel = $portVersion
	devel:libjxl$secondaryArchSuffix = $portVersion
	devel:libjxl_dec$secondaryArchSuffix = $portVersion
	devel:libjxl_threads$secondaryArchSuffix = $portVersion
	"
REQUIRES_devel="
	libjxl$secondaryArchSuffix == $portVersion base
	"

PROVIDES_tools="
	libjxl${secondaryArchSuffix}_tools = $portVersion
	cmd:benchmark_xl$secondaryArchSuffix
	cmd:cjxl$secondaryArchSuffix
	cmd:djxl$secondaryArchSuffix
	"
REQUIRES_tools="
	$REQUIRES
	libjxl$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libavif$secondaryArchSuffix
	devel:libbrotlicommon$secondaryArchSuffix
	devel:libbrotlidec$secondaryArchSuffix
	devel:libbrotlienc$secondaryArchSuffix
	devel:libgif$secondaryArchSuffix
	devel:libGL$secondaryArchSuffix
	devel:libhwy$secondaryArchSuffix
	devel:libhwy_contrib$secondaryArchSuffix
	devel:libIex_3_0$secondaryArchSuffix
	devel:libIlmThread_3_0$secondaryArchSuffix
	devel:libImath_3_0$secondaryArchSuffix
	devel:libOpenEXR_3_0$secondaryArchSuffix
	devel:libOpenEXRUtil_3_0$secondaryArchSuffix
	devel:libjpeg$secondaryArchSuffix
	devel:libpng16$secondaryArchSuffix
	devel:libwebp$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:git
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	cmd:python3
	"

BUILD()
{
	rm -rf .git
	mkdir -p build && cd build
	../deps.sh
	cmake .. $cmakeDirArgs \
		-DCMAKE_BUILD_TYPE=None \
		-DBUILD_TESTING=OFF \
		-DJPEGXL_FORCE_SYSTEM_BROTLI=true \
		-DJPEGXL_FORCE_SYSTEM_HWY=true \
		-DJPEGXL_WARNINGS_AS_ERRORS=false \
		-DJPEGXL_ENABLE_OPENEXR=true -L
	make $jobArgs
}

INSTALL()
{
	make -C build install

	prepareInstalledDevelLibs \
		libjxl libjxl_dec libjxl_threads
	fixPkgconfig

	packageEntries devel \
		$developDir
	packageEntries tools \
		$binDir
}

TEST()
{
	make -C build test
}
