SUMMARY="C library for reading and writing of sampled sound"
DESCRIPTION="libsndfile is a library of C routines for reading and writing \
files containing sampled audio data."
HOMEPAGE="http://www.mega-nerd.com/libsndfile"
COPYRIGHT="1999-2011 Erik de Castro Lopo"
LICENSE="GNU LGPL v2.1"
REVISION="1"
gitCommit="6b0df6060ca53575f3d1b7ba88950a54bc18a5b0"
SOURCE_URI="https://github.com/erikd/libsndfile/archive/$gitCommit.zip"
CHECKSUM_SHA256="3a784197562eb47ba6241544c1023b98fe5a8f87543336acd2559ee5f6b5dd8c"
SOURCE_DIR="libsndfile-$gitCommit"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="!x86_gcc2 x86"

PROVIDES="
	libsndfile$secondaryArchSuffix = $portVersion compat >= 1
	cmd:sndfile_cmp$secondaryArchSuffix
	cmd:sndfile_concat$secondaryArchSuffix
	cmd:sndfile_convert$secondaryArchSuffix
	cmd:sndfile_deinterleave$secondaryArchSuffix
	cmd:sndfile_info$secondaryArchSuffix
	cmd:sndfile_interleave$secondaryArchSuffix
	cmd:sndfile_metadata_get$secondaryArchSuffix
	cmd:sndfile_metadata_set$secondaryArchSuffix
	cmd:sndfile_play$secondaryArchSuffix
	cmd:sndfile_regtest$secondaryArchSuffix
	cmd:sndfile_salvage$secondaryArchSuffix
	lib:libsndfile$secondaryArchSuffix = $portVersion compat >= 1
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libflac$secondaryArchSuffix
	lib:libogg$secondaryArchSuffix
	lib:libsqlite3$secondaryArchSuffix
	lib:libvorbis$secondaryArchSuffix
	"

PROVIDES_devel="
	libsndfile${secondaryArchSuffix}_devel = $portVersion compat >= 1
	devel:libsndfile$secondaryArchSuffix = $portVersion compat >= 1
	"
REQUIRES_devel="
	libsndfile$secondaryArchSuffix == $portVersion base
	devel:libflac$secondaryArchSuffix
	devel:libvorbis$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libflac$secondaryArchSuffix
	devel:libogg$secondaryArchSuffix
	devel:libsqlite3$secondaryArchSuffix
	devel:libvorbis$secondaryArchSuffix
	# libsndfile requires flac 1.3.1 but the soname is the same as 1.3.0...
	flac${secondaryArchSuffix}_devel >= 1.3.1
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:g++$secondaryArchSuffix
	cmd:make
	cmd:python2
	"

BUILD()
{
	mkdir -p build
	cd build
	cmake .. \
		-DCMAKE_INSTALL_PREFIX=$prefix \
		-DCMAKE_INSTALL_BINDIR=$binDir \
		-DCMAKE_INSTALL_INCLUDEDIR=$includeDir \
		-DCMAKE_INSTALL_LIBDIR=$libDir \
		-DCMAKE_INSTALL_DOCDIR=$docDir \
		-DCMAKE_INSTALL_SHAREDIR=$dataDir
		make $jobArgs
}

INSTALL()
{
	cd build
	make install


	prepareInstalledDevelLibs libsndfile
	fixPkgconfig


	# devel package
	packageEntries devel \
		$developDir
}
