From 4c5ad48138c5133af1af448717ee2088cbb56302 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Joachim=20Mairb=C3=B6ck?= <j.mairboeck@gmail.com>
Date: Sun, 15 May 2022 15:27:10 +0200
Subject: fix build on Haiku


diff --git a/pm_test/CMakeLists.txt b/pm_test/CMakeLists.txt
index 5011311..bdbc03e 100644
--- a/pm_test/CMakeLists.txt
+++ b/pm_test/CMakeLists.txt
@@ -14,6 +14,10 @@ endif(APPLE)
 #   endif()
 # endif(WIN32)
 
+if(HAIKU)
+  add_compile_options(-fPIC)
+endif()
+
 macro(add_test name)
   add_executable(${name} ${name}.c)
   target_link_libraries(${name} PRIVATE portmidi)
@@ -38,5 +42,5 @@ add_test(recvvirtual)
 add_test(sendvirtual)
 add_test(multivirtual)
 add_test(virttest)
-add_test(pmlist)
+#add_test(pmlist)
 endif(WIN32)
diff --git a/porttime/ptlinux.c b/porttime/ptlinux.c
index 367bdd3..b977818 100755
--- a/porttime/ptlinux.c
+++ b/porttime/ptlinux.c
@@ -80,7 +80,7 @@ PtError Pt_Start(int resolution, PtCallback *callback, void *userData)
 {
     if (time_started_flag) return ptNoError;
     /* need this set before process runs: */
-    clock_gettime(CLOCK_MONOTONIC_RAW, &time_offset);
+    clock_gettime(CLOCK_MONOTONIC, &time_offset);
     if (callback) {
         int res;
         pt_callback_parameters *parms = (pt_callback_parameters *) 
@@ -123,7 +123,7 @@ PtTimestamp Pt_Time()
 {
     long seconds, ms;
     struct timespec now;
-    clock_gettime(CLOCK_MONOTONIC_RAW, &now);
+    clock_gettime(CLOCK_MONOTONIC, &now);
     seconds = now.tv_sec - time_offset.tv_sec;
     ms = (now.tv_nsec - time_offset.tv_nsec) / 1000000; /* round down */
     return seconds * 1000 + ms;
-- 
2.30.2

