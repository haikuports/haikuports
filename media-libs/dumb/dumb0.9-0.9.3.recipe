SUMMARY="A Dynamic Universal Music Library"
DESCRIPTION="DUMB is an IT, XM, S3M and MOD player library"
HOMEPAGE="http://dumb.sourceforge.net/"
COPYRIGHT="2001-2005 Ben Davis, Robert J Ohannessian and Julien Cugniere"
LICENSE="DUMB-0.9.3"
REVISION="2"
SOURCE_URI="http://downloads.sourceforge.net/project/dumb/dumb/$portVersion/dumb-$portVersion.tar.gz"
CHECKSUM_SHA256="8d44fbc9e57f3bac9f761c3b12ce102d47d717f0dd846657fb988e0bb5d1ea33"
SOURCE_URI_2="http://prdownloads.sourceforge.net/dumb/dumb-$portVersion-autotools.tar.gz"
CHECKSUM_SHA256_2="9e3fa1e0932e00e31f2314cefb3ea0343ee4f850b6a8e6a6a9627a35b2dc0dbd"
SOURCE_DIR="dumb-$portVersion"

ARCHITECTURES="!ALL x86_gcc2"
SECONDARY_ARCHITECTURES="!x86"

PROVIDES="
	dumb0.9$secondaryArchSuffix = $portVersion
	lib:libaldmb_0.9.3$secondaryArchSuffix = $portVersion compat >= 0.9
	lib:libdumb_0.9.3$secondaryArchSuffix = $portVersion compat >= 0.9
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:liballeg$secondaryArchSuffix
	"

PROVIDES_devel="
	dumb0.9${secondaryArchSuffix}_devel = $portVersion
	devel:libaldmb_0.9.3$secondaryArchSuffix = $portVersion compat >= 0.9
	devel:libdumb_0.9.3$secondaryArchSuffix = $portVersion compat >= 0.9
	"
REQUIRES_devel="
	dumb0.9$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:liballeg$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:aclocal
	cmd:autoconf
	cmd:gcc$secondaryArchSuffix
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	"

BUILD()
{
	mkdir -p m4
	cp -R ../../sources-2/dumb-0.9.3 ../
	echo 'AC_CONFIG_MACRO_DIR([m4])' >> configure.in
	echo "ACLOCAL_AMFLAGS = -I m4" >> Makefile.am
	libtoolize --force --copy --install
	aclocal -I m4 --warnings=none
	autoconf
	touch NEWS README ChangeLog AUTHORS
	automake --add-missing
	runConfigure --omit-dirs "dataRootDir" ./configure --disable-static
	make $jobArgs
}

INSTALL()
{
	make install

	# remove libtool file
	rm -f $libDir/*.la

	# Remove symlinks "libdumb.so" and "libaldmb.so" (conflict with dumb-2.x)
	rm -f $libDir/{libdumb,libaldmb}.so

	prepareInstalledDevelLibs libdumb-0.9.3 libaldmb-0.9.3


	# devel package
	packageEntries devel \
		$developDir

	# Newer dumb 2.x provids a _tools package, so no need for these:
	rm -rf $binDir
}
