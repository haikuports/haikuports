From c81b61d33b98312fd4e3e6443d88e47a21fa1b76 Mon Sep 17 00:00:00 2001
From: Ken Mays <kmays2000@gmail.com>
Date: Fri, 8 Oct 2021 06:21:06 +0100
Subject: Fix Alembic 1.8.3 build on HAIKU


diff --git a/lib/Alembic/AbcCoreOgawa/StreamManager.cpp b/lib/Alembic/AbcCoreOgawa/StreamManager.cpp
index 8cc1cc2..ab14368 100644
--- a/lib/Alembic/AbcCoreOgawa/StreamManager.cpp
+++ b/lib/Alembic/AbcCoreOgawa/StreamManager.cpp
@@ -48,14 +48,10 @@ namespace ALEMBIC_VERSION_NS {
 // Windows
 #elif defined( _MSC_VER )
 #define COMPARE_EXCHANGE( V, COMP, EXCH ) (InterlockedCompareExchange64( &V, EXCH, COMP ) == COMP)
+// HAIKU
 #elif defined( __HAIKU__ )
-
 #define COMPARE_EXCHANGE( V, COMP, EXCH ) __atomic_compare_exchange_n( &V, &COMP, EXCH, false, __ATOMIC_SEQ_CST, __ATOMIC_SEQ_CST )
 #include <strings.h>
-int ffsll(long long i)
-{
-	return (__builtin_ffsll(i));
-}
 
 #else
 #error Please contact alembic-discuss@googlegroups.com for support.
@@ -70,6 +66,13 @@ Alembic::Util::int64_t ffsll( Alembic::Util::int64_t iValue )
 }
 #endif
 
+#ifdef __HAIKU__
+int ffsll(long long i)
+{
+	return (__builtin_ffsll(i));
+}
+#endif
+
 StreamManager::StreamManager( std::size_t iNumStreams )
 {
 
-- 
2.30.2

