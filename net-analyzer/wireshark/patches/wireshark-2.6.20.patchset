From f5367bd9194891b76d91fcc9675f58866a3ab51b Mon Sep 17 00:00:00 2001
From: David Karoly <david.karoly@outlook.com>
Date: Tue, 2 Nov 2021 20:11:25 +0100
Subject: fix build with glib 2.68


diff --git a/caputils/capture_ifinfo.h b/caputils/capture_ifinfo.h
index 8e42b64..0e2c792 100644
--- a/caputils/capture_ifinfo.h
+++ b/caputils/capture_ifinfo.h
@@ -10,12 +10,12 @@
 #ifndef __CAPTURE_IFINFO_H__
 #define __CAPTURE_IFINFO_H__
 
+#include <glib.h>
+
 #ifdef __cplusplus
 extern "C" {
 #endif /* __cplusplus */
 
-#include <glib.h>
-
 typedef enum {
 	IF_WIRED,
 	IF_AIRPCAP,
diff --git a/epan/conversation.h b/epan/conversation.h
index cd8d416..cb7c62f 100644
--- a/epan/conversation.h
+++ b/epan/conversation.h
@@ -13,6 +13,8 @@
 
 #include "ws_symbol_export.h"
 
+#include "packet.h"		/* for conversation dissector type */
+
 #ifdef __cplusplus
 extern "C" {
 #endif /* __cplusplus */
@@ -46,8 +48,6 @@ extern "C" {
 /* Flags to handle endpoints */
 #define USE_LAST_ENDPOINT 0x08      /* Use last endpoint created, regardless of type */
 
-#include "packet.h"		/* for conversation dissector type */
-
 /* Types of port numbers Wireshark knows about. */
 typedef enum {
 	ENDPOINT_NONE,			/* no endpoint */
diff --git a/epan/epan.h b/epan/epan.h
index 67e54dc..95f47f8 100644
--- a/epan/epan.h
+++ b/epan/epan.h
@@ -10,11 +10,12 @@
 #ifndef __EPAN_H__
 #define __EPAN_H__
 
+#include <glib.h>
+
 #ifdef __cplusplus
 extern "C" {
 #endif /* __cplusplus */
 
-#include <glib.h>
 #include <epan/tvbuff.h>
 #include <epan/prefs.h>
 #include <epan/frame_data.h>
diff --git a/epan/epan_dissect.h b/epan/epan_dissect.h
index 956a147..9279892 100644
--- a/epan/epan_dissect.h
+++ b/epan/epan_dissect.h
@@ -10,11 +10,12 @@
 #ifndef EPAN_DISSECT_H
 #define EPAN_DISSECT_H
 
+#include "epan.h"
+
 #ifdef __cplusplus
 extern "C" {
 #endif /* __cplusplus */
 
-#include "epan.h"
 #include "tvbuff.h"
 #include "proto.h"
 #include "packet_info.h"
diff --git a/epan/prefs.h b/epan/prefs.h
index 2147a70..1a621d9 100644
--- a/epan/prefs.h
+++ b/epan/prefs.h
@@ -11,12 +11,12 @@
 #ifndef __PREFS_H__
 #define __PREFS_H__
 
+#include <glib.h>
+
 #ifdef __cplusplus
 extern "C" {
 #endif /* __cplusplus */
 
-#include <glib.h>
-
 #include <epan/params.h>
 #include <epan/range.h>
 
diff --git a/ui/recent.h b/ui/recent.h
index cfafcc6..a29b681 100644
--- a/ui/recent.h
+++ b/ui/recent.h
@@ -12,11 +12,12 @@
 #ifndef __RECENT_H__
 #define __RECENT_H__
 
+#include <glib.h>
+
 #ifdef __cplusplus
 extern "C" {
 #endif /* __cplusplus */
 
-#include <glib.h>
 #include <stdio.h>
 #include "epan/timestamp.h"
 #include "ui/ws_ui_util.h"
-- 
2.30.2


From b6c2f3657eb5e3fff7738a594285fcd526198fd3 Mon Sep 17 00:00:00 2001
From: David Karoly <david.karoly@outlook.com>
Date: Mon, 15 Nov 2021 10:26:33 +0000
Subject: use realpath in init_progfile_dir


diff --git a/wsutil/filesystem.c b/wsutil/filesystem.c
index 19ea4e4..ac9069f 100644
--- a/wsutil/filesystem.c
+++ b/wsutil/filesystem.c
@@ -630,6 +630,12 @@ init_progfile_dir(const char *arg0
         }
     }
 
+    static char buffer[PATH_MAX + 1];
+    char *res = realpath(prog_pathname, buffer);
+    if (res != NULL) {
+        prog_pathname = buffer;
+    }
+
     /*
      * OK, we have what we think is the pathname
      * of the program.
-- 
2.30.2

