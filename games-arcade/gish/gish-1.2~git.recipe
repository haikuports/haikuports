SUMMARY="An amorphous ball of tar that rolls and squishies around"
DESCRIPTION="Gish is a side-scrolling platformer video game with some physics puzzle elements \
developed by Cryptic Sea (pseudonym of Alex Austin), Edmund McMillen, Josiah Pisciotta and \
published by Chronic Logic in 2004. Cryptic Sea pledged Gish to go open source under the \
 GPLv2 on May 29, 2010."
HOMEPAGE="http://exlmoto.ru/gish-droid/"
COPYRIGHT="2004-2017 Cryptic Sea, 2017-2018 EXL"
LICENSE="GNU GPL v2"
REVISION="1"
srcGitRev="bd5a8e455ff57e60d65262c0e913253b80cf211c"
SOURCE_URI="https://github.com/EXL/Gish/archive/$srcGitRev.tar.gz"
CHECKSUM_SHA256="bf63177d8cb4bb11caa895671fad1d51a9954a815457f99807a0a0918f527ef7"
SOURCE_DIR="Gish-$srcGitRev"
srcGitRev2="84dcd3b7a6ab656574ad98516b01638a89104722"
SOURCE_URI_2="https://github.com/EXL/BeGameLauncher/archive/$srcGitRev2.tar.gz"
CHECKSUM_SHA256_2="b64297feb633681474cf8d6ec9088f5eded1d4c92fa8932edb170bf49fd8703a"
SOURCE_DIR_2="BeGameLauncher-$srcGitRev2"
ADDITIONAL_FILES="gish.rdef.in"

ARCHITECTURES="!x86_gcc2 x86_64 ?x86"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	gish$secondaryArchSuffix = $portVersion
	app:Gish$secondaryArchSuffix
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libGL$secondaryArchSuffix
	lib:libopenal$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
	lib:libSDL2_2.0$secondaryArchSuffix
	lib:libvorbis$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libGL$secondaryArchSuffix
	devel:libopenal$secondaryArchSuffix
	devel:libpng$secondaryArchSuffix
	devel:libSDL2_2.0$secondaryArchSuffix
	devel:libvorbis$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:make
	"

BUILD()
{
	mkdir -p build
	cd build
	cmake -DSDL2_INCLUDE_DIR=/system/$relativeIncludeDir \
		-DCMAKE_BUILD_TYPE=Release \
		-DGLES=off \
		-DANDROID=off \
		-DCMAKE_C_FLAGS="-D__linux__ -DHAIKU_PACKAGE=1" \
		../gish/src/main/cpp
	make $jobArgs

	cd $sourceDir2
	mkdir -p build
	cd build
	cmake .. -DCMAKE_BUILD_TYPE=Release \
		-DLAUNCHER=gish
	make $jobArgs
}

INSTALL()
{
	cd build
	mkdir -p $appsDir/Gish

	cp Release/Gish $appsDir/Gish/
	cp $sourceDir2/build/GishLauncher "$appsDir/Gish/Gish Launcher"

	local APP_SIGNATURE="application/x-vnd.gish"
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2 | cut -c 1-1`"
	local LONG_INFO="$SUMMARY"
	sed \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@LONG_INFO@|$LONG_INFO|" \
		$portDir/additional-files/gish.rdef.in > $sourceDir/gish.rdef

	addResourcesToBinaries $sourceDir/gish.rdef "$appsDir/Gish/Gish"
	addAppDeskbarSymlink "$appsDir/Gish/Gish Launcher"
}
