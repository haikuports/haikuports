From 04f498bbe356ceff603cd096eb3c87f29cf67e07 Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Mon, 31 Mar 2025 16:34:03 +0200
Subject: Define Haiku data paths


diff --git a/CMakeLists.txt b/CMakeLists.txt
index 3b6a0cc..d07721b 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -457,8 +457,8 @@ else()
     # On unixy systems, follow standard.
     install(TARGETS openomf RUNTIME DESTINATION bin COMPONENT Binaries)
     install(FILES resources/openomf.bk resources/gamecontrollerdb.txt resources/icons/openomf.png
-        DESTINATION share/games/openomf/
+        DESTINATION data/openomf
         COMPONENT Data
     )
-    install(DIRECTORY shaders/ DESTINATION share/games/openomf/shaders COMPONENT Data)
+    install(DIRECTORY shaders/ DESTINATION data/openomf/shaders COMPONENT Data)
 endif()
-- 
2.48.1


From 046bde3de306258eea1f9feec39b5004fd965c67 Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Mon, 31 Mar 2025 18:27:38 +0200
Subject: More Haiku path fixes


diff --git a/src/resources/pathmanager.c b/src/resources/pathmanager.c
index 4bc130b..98a5414 100644
--- a/src/resources/pathmanager.c
+++ b/src/resources/pathmanager.c
@@ -11,6 +11,11 @@
 #include <unistd.h>
 #endif
 
+#if defined(__HAIKU__)
+#include <FindDirectory.h>
+#include <fs_info.h>
+#endif
+
 #include "resources/pathmanager.h"
 #include "utils/allocator.h"
 #include "utils/c_string_util.h"
@@ -99,6 +104,7 @@ int pm_init(void) {
     memset(resource_paths, 0, sizeof(resource_paths));
 
     // Find local basedir
+    #if !defined(__HAIKU__)
     config_base_dir = pm_get_local_base_dir();
     if(config_base_dir == NULL) {
         goto error_0;
@@ -110,6 +116,13 @@ int pm_init(void) {
     } else {
         state_base_dir = config_base_dir;
     }
+    #else
+    	char buffer[B_PATH_NAME_LENGTH+10];
+		find_directory(B_USER_SETTINGS_DIRECTORY, dev_for_path("/boot"), false, buffer, B_PATH_NAME_LENGTH);
+		strcat(buffer, "/openomf/");
+		config_base_dir = strdup(buffer);
+		state_base_dir = config_base_dir;
+    #endif
 
     // Other paths
     local_path_build(LOG_PATH, state_base_dir, logfile_name);
@@ -145,6 +158,12 @@ int pm_init(void) {
                 local_path_build(RESOURCE_PATH, bin_base_dir, "");
                 local_path_build(SHADER_PATH, bin_base_dir, "shaders/");
                 m_ok = 1;
+            } else if(strcmp(SDL_GetPlatform(), "Haiku") == 0) {
+                char sysdata[B_PATH_NAME_LENGTH+10];
+                find_directory(B_SYSTEM_DATA_DIRECTORY, dev_for_path("/boot"), false, sysdata, B_PATH_NAME_LENGTH);
+                local_path_build(RESOURCE_PATH, sysdata, "openomf/");
+                local_path_build(SHADER_PATH, sysdata, "openomf/shaders/");
+                m_ok = 1;
             }
             // any other platform will look in ./resources
             SDL_free(bin_base_dir);
-- 
2.48.1

