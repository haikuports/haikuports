From 402e84e4d098ef44673c3a99a3ba61b998a9aa2b Mon Sep 17 00:00:00 2001
From: Owen <owenca@users.noreply.github.com>
Date: Wed, 20 Dec 2017 22:02:01 +0000
Subject: roadfighter: change settings directory to B_USER_SETTINGS_DIRECTORY

Fixes #1294

diff --git a/build/linux/Makefile b/build/linux/Makefile
index 064c63d..2c4e56b 100644
--- a/build/linux/Makefile
+++ b/build/linux/Makefile
@@ -38,7 +38,7 @@ OBJS = \
 
 CC = g++
 CFLAGS = -g3 -O3 `sdl-config --cflags` -I/usr/X11R6/include
-LDFLAGS = `sdl-config --libs` -L/usr/X11R6/lib/ -lSDL_image -lSDL_mixer -lSDL_sound -lSDL_ttf
+LDFLAGS = -lbe `sdl-config --libs` -L/usr/X11R6/lib/ -lSDL_image -lSDL_mixer -lSDL_sound -lSDL_ttf
 RM = rm -f
 CP = cp -r
 MD = mkdir -p
diff --git a/src/filehandling.cpp b/src/filehandling.cpp
index 5f5bfd8..65bb38f 100644
--- a/src/filehandling.cpp
+++ b/src/filehandling.cpp
@@ -1,5 +1,8 @@
 #include "filehandling.h"
 
+#include <FindDirectory.h>
+#include <Path.h>
+
 #ifndef _WIN32
 // make (sub)directories including multiple subdirs
 int mkdirp(const char *fqfn, mode_t mode) {
@@ -41,14 +44,17 @@ FILE *f1open(const char *f, const char *m, const enum filetype t) {
       return(fopen(f, m));
       break;
 
-    case USERDATA:
+    case USERDATA: {
       // userdata is put in $HOME/.GAMENAME/
-      snprintf(fname, STRLEN-1, "%s/.%s/%s", getenv("HOME"), GAMENAME, f);
+      BPath path;
+      find_directory(B_USER_SETTINGS_DIRECTORY, &path);
+      snprintf(fname, STRLEN-1, "%s/%s/%s", path.Path(), GAMENAME, f);
       // create subdirs if they don't exist
       mkdirp(fname, S_IRWXU | S_IRGRP|S_IXGRP | S_IROTH|S_IXOTH);
       // open file
       return(fopen(fname, m));
       break;
+    }
   }
 #endif
 
-- 
2.7.0

