From 4494b46da6fa1ed56f9381596945dc1f413c3420 Mon Sep 17 00:00:00 2001
From: Abdur-Raheem Idowu <abdurraheemidowu@gmail.com>
Date: Tue, 14 Jan 2020 23:08:41 +0000
Subject: Loads & saves settings in correct location now


diff --git a/Makefile b/Makefile
index a204483..0040033 100644
--- a/Makefile
+++ b/Makefile
@@ -8,7 +8,7 @@
 
 
 # User-definable stuff:
-
+CC=g++
 CFLAGS=-Wall -O2
 #DATA_PREFIX=$(PWD)/data/
 PREFIX=/usr/local
@@ -59,11 +59,11 @@ clean:
 # Main executable:
 
 defendguin:	obj/defendguin.o
-	$(CC) $(CFLAGS) obj/defendguin.o -o defendguin $(SDL_LIB) -lm
+	$(CC) $(CFLAGS) obj/defendguin.o -o defendguin $(SDL_LIB) -lm -lbe
 
 
 # Main object:
 
 obj/defendguin.o:	src/defendguin.c
-	$(CC) $(CFLAGS)	src/defendguin.c -c -o obj/defendguin.o
+	$(CC) $(CFLAGS)	src/defendguin.c -c -o obj/defendguin.o -lbe
 
diff --git a/src/defendguin.c b/src/defendguin.c
index 60f04e8..02771cf 100644
--- a/src/defendguin.c
+++ b/src/defendguin.c
@@ -33,6 +33,10 @@
 #define M_PI  3.14159265358979323846  /* mmm... pi... */
 #endif /* #ifndef M_PI */
 
+#ifdef __HAIKU__
+#include <Path.h>
+#include <FindDirectory.h>
+#endif
 
 /* Image enumerations: */
 
@@ -5884,7 +5888,13 @@ void load_options(void)
 
   if (getenv("HOME") != NULL)
     {
+#ifdef __HAIKU__
+      BPath* s_path = new BPath();
+      find_directory(B_USER_SETTINGS_DIRECTORY, s_path);
+      snprintf(fname, sizeof(fname), "%s/.defendguinrc", s_path->Path());
+#else
       snprintf(fname, sizeof(fname), "%s/.defendguinrc", getenv("HOME"));
+#endif
 
       fi = fopen(fname, "r");
 
@@ -5948,7 +5958,13 @@ void save_options(void)
   
   if (getenv("HOME") != NULL)
     {
+#ifdef __HAIKU__
+      BPath* s_path = new BPath();
+      find_directory(B_USER_SETTINGS_DIRECTORY, s_path);
+      snprintf(fname, sizeof(fname), "%s/.defendguinrc", s_path->Path());
+#else
       snprintf(fname, sizeof(fname), "%s/.defendguinrc", getenv("HOME"));
+#endif
 
       fi = fopen(fname, "w");
 
-- 
2.19.0

