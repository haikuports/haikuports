From 79367f74988b54f4c336c5eab288b163587f79a9 Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Fri, 27 Sep 2024 22:58:14 +0200
Subject: Brute force CMake and fix dirs


diff --git a/CMakeLists.txt b/CMakeLists.txt
index c64a55f..4fa44e7 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -52,13 +52,16 @@ endif()
 
 # Multiarch support
 if(UNIX AND NOT APPLE)
-	# We are in the games section
-	set(CMAKE_INSTALL_BINDIR "games")
+	# We are in the Haiku section
+	set(CMAKE_INSTALL_BINDIR "@APPSDIR@")
+		set(CMAKE_INSTALL_DATAROOTDIR "@DATADIR@")
+		set(CMAKE_INSTALL_MANDIR "@MANDIR@")
+		set(CMAKE_INSTALL_DATADIR "${CMAKE_INSTALL_DATAROOTDIR}")

-	include(GNUInstallDirs)
+	#include(GNUInstallDirs)
 	if(CPACK_PACKAGE_NAME)
 		# Match this to package name instead of project name
-		set(CMAKE_INSTALL_DOCDIR "${CMAKE_INSTALL_DATAROOTDIR}/doc/${CPACK_PACKAGE_NAME}")
+		set(CMAKE_INSTALL_DOCDIR "@DOCDIR@")
 	endif()
 	# GNUInstallDirs doesn't provide this, but we could use share/product_name
 	set(CMAKE_INSTALL_DATAPRODUCTDIR "${CMAKE_INSTALL_DATADIR}/${PRODUCT_DIRECTORY}")
@@ -233,11 +236,14 @@ if(USE_CPACK AND NOT APPLE)
 		install(FILES docs/ecwolf.6 DESTINATION "${CMAKE_INSTALL_MANDIR}/man6")
 
 		# Lintian requires that man pages in deb packages are compressed.
+		# But I don't care
+		if(NOT HAIKU)
 		find_program(GZIP_BINARY NAMES gzip DOC "gzip program for man page compression.")
 		if(GZIP_BINARY)
 			install(CODE "execute_process(COMMAND \"${GZIP_BINARY}\" -fn9 \"\$ENV{DESTDIR}\${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_DOCDIR}/changelog\")")
 			install(CODE "execute_process(COMMAND \"${GZIP_BINARY}\" -fn9 \"\$ENV{DESTDIR}\${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_MANDIR}/man6/ecwolf.6\")")
 		endif()
+		endif()
 	endif()
 endif()

diff --git a/src/filesys.cpp b/src/filesys.cpp
index ed83673..80c4983 100644
--- a/src/filesys.cpp
+++ b/src/filesys.cpp
@@ -217,11 +217,7 @@ void SetupPaths(int argc, const char * const *argv)
 			progDir = argv[0];
 	}
 #endif
-	int pos = progDir.LastIndexOfAny("/\\");
-	if(pos != -1)
-		progDir = progDir.Mid(0, pos);
-	else
-		progDir = ".";
+		progDir = "/boot/system/data/ecwolf";

 	// Configuration directory
 #if defined(_WIN32)
@@ -338,7 +338,7 @@ void SetupPaths(int argc, const char * const *argv)
 #elif defined(__APPLE__)
 	saveDir = documentsDir + "/Savegames";
 #else
-	saveDir = documentsDir + "/savegames";
+	saveDir = configDir + "/savegames";
 #endif

 	if(!CreateDirectoryIfNeeded(saveDir))
@@ -362,7 +362,7 @@ void SetupPaths(int argc, const char * const *argv)
 #elif defined(__APPLE__)
 	screenshotsDir = documentsDir + "/Screenshots";
 #else
-	screenshotsDir = documentsDir + "/screenshots";
+	screenshotsDir = configDir + "/screenshots";
 #endif

 	if(!CreateDirectoryIfNeeded(screenshotsDir))
-- 
2.45.2

