SUMMARY="Simulator Construction Gear"
DESCRIPTION="SimGear is a set of open-source libraries designed \
to be used as building blocks for quickly assembling 3D simulations, \
games, and visualization applications."
HOMEPAGE="https://www.flightgear.org/"
COPYRIGHT="2002-2018 Curtis Olsen and others"
LICENSE="GNU LGPL v2"
REVISION="1"
SOURCE_URI="https://downloads.sourceforge.net/flightgear/simgear-$portVersion.tar.bz2"
CHECKSUM_SHA256="f61576bc36aae36f350154749df1cee396763604c06b8a71c4b50452d9151ce5"
PATCHES="simgear-$portVersion.patchset"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	simgear$secondaryArchSuffix = $portVersion
	lib:libsimgear$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libGL$secondaryArchSuffix
	lib:libplib$secondaryArchSuffix
	lib:libopenscenegraph$secondaryArchSuffix
	lib:libjpeg$secondaryArchSuffix
	lib:libopenal$secondaryArchSuffix
	lib:libboost$secondaryArchSuffix
	"

PROVIDES_devel="
	simgear$secondaryArchSuffix = $portVersion
	devel:libsimgear$secondaryArchSuffix = $portVersion
	"
REQUIRES_devel="
	simgear$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libGL$secondaryArchSuffix
	devel:libplib$secondaryArchSuffix
	devel:libopenscenegraph$secondaryArchSuffix
	devel:libjpeg$secondaryArchSuffix
	devel:libopenal$secondaryArchSuffix
	devel:libboost$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	mkdir -p build && cd build
	cmake .. \
		-DSIMGEAR_SHARED:BOOL=ON \
		-DENABLE_TESTS:BOOL=OFF
	make $jobArgs
}

INSTALL()
{
	cd build
	make -C install
	rm $libDir/*.la
	mkdir -p `dirname $includeDir` $libDir
	mv $prefix/include $includeDir

	if [ -n "$secondaryArchSuffix" ]; then
		mv $prefix/lib/libSimGear* $prefix/lib/pkgconfig $libDir/
	fi

	prepareInstalledDevelLib libSimGear
	fixPkgconfig

	packageEntries devel \
		$developDir
}
