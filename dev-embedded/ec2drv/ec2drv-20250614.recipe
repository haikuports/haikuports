SUMMARY="Program Silicon Labs 8051 microcontrollers"
DESCRIPTION="Tools for SiLabs C8051 series of microcontrollers and the matching
EC2, EC3, EC5, EC6 debug adapters."
HOMEPAGE="https://github.com/paragonRobotics/ec2-new"
COPYRIGHT="2006 Ricky White"
LICENSE="GNU GPL v2"
REVISION="1"
srcGitRev="ae91fec64442fec9f2296bff6513a611433fa76f"
SOURCE_URI="https://github.com/paragonRobotics/ec2-new/archive/$srcGitRev.tar.gz"
CHECKSUM_SHA256="3c7683b4536e8dff06444da4a75a0c20165401a52f25b913aeb38f18dfcb28d3"
SOURCE_FILENAME="ec2-new-$portVersion-$srcGitRev.tar.gz"
SOURCE_DIR="ec2-new-$srcGitRev"
PATCHES="ec2drv-$portVersion.patchset"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

commandSuffix=$secondaryArchSuffix
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
	commandSuffix=
	commandBinDir=$prefix/bin
fi

PROVIDES="
	ec2drv$secondaryArchSuffix = $portVersion
	cmd:ec2_update_fw$commandSuffix
	cmd:ec2adapters$commandSuffix
	cmd:ec2device$commandSuffix
	cmd:ec2readflash$commandSuffix
	cmd:ec2readfw$commandSuffix
	cmd:ec2test_any$commandSuffix
	cmd:ec2writeflash$commandSuffix
	cmd:newcdb$commandSuffix
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libusb$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libusb$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:ninja
	cmd:python3
	"

BUILD()
{
	# none of $cmakeDirArgs gets actually used.
	cmake -B build -S . -G Ninja \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_POLICY_VERSION_MINIMUM=3.11
	ninja -C build
}

INSTALL()
{
	mkdir -p "$commandBinDir"
	cp build/bin/* "$commandBinDir"
}
