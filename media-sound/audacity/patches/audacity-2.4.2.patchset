From 3cd38dec6acc320d47361f78f9ec7ffa759689a9 Mon Sep 17 00:00:00 2001
From: Ken Mays <kmays2000@gmail.com>
Date: Sat, 25 Dec 2021 06:19:07 +0200
Subject: Fix OSS detect for Haiku


diff --git a/lib-src/portaudio-v19/configure b/lib-src/portaudio-v19/configure
index 9d32fcc..8a2b037 100755
--- a/lib-src/portaudio-v19/configure
+++ b/lib-src/portaudio-v19/configure
@@ -15373,7 +15373,7 @@ fi
 have_libossaudio=no
 have_oss=no
 if test "x$with_oss" != "xno"; then
-    for ac_header in sys/soundcard.h linux/soundcard.h machine/soundcard.h
+    for ac_header in private/audio/soundcard.h sys/soundcard.h linux/soundcard.h machine/soundcard.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
diff --git a/lib-src/portaudio-v19/configure.in b/lib-src/portaudio-v19/configure.in
index a3628bd..e15a8c5 100644
--- a/lib-src/portaudio-v19/configure.in
+++ b/lib-src/portaudio-v19/configure.in
@@ -127,7 +127,7 @@ fi
 have_libossaudio=no
 have_oss=no
 if test "x$with_oss" != "xno"; then
-    AC_CHECK_HEADERS([sys/soundcard.h linux/soundcard.h machine/soundcard.h], [have_oss=yes])
+    AC_CHECK_HEADERS([private/audio/soundcard.h sys/soundcard.h linux/soundcard.h machine/soundcard.h], [have_oss=yes])
     if test "x$have_oss" = "xyes"; then
         AC_CHECK_LIB(ossaudio, _oss_ioctl, have_libossaudio=yes, have_libossaudio=no)
     fi
-- 
2.37.3


From 9c3fa9c8469622f831072843499c49dccc0969fe Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fran=C3=A7ois=20Revol?= <revol@free.fr>
Date: Wed, 30 Jul 2014 01:38:19 +0200
Subject: Add a case for Haiku in configure.in


diff --git a/lib-src/portaudio-v19/configure b/lib-src/portaudio-v19/configure
index 8a2b037..5853485 100755
--- a/lib-src/portaudio-v19/configure
+++ b/lib-src/portaudio-v19/configure
@@ -16144,6 +16144,21 @@ fi
         SHARED_FLAGS=""
         ;;
 
+  haiku* )
+
+                printf "%s\n" "#define PA_USE_SKELETON 1" >>confdefs.h
+
+
+        CFLAGS="$CFLAGS -I\$(top_srcdir)/src/os/unix"
+        # -Werror
+        LIBS="-lmedia"
+
+        SHARED_FLAGS="$LIBS -shared"
+        #CFLAGS="$CFLAGS"
+        OTHER_OBJS="src/os/unix/pa_unix_hostapis.o src/os/unix/pa_unix_util.o"
+        PADLL="libportaudio.so"
+        ;;
+
   *)
 
         CFLAGS="$CFLAGS -I\$(top_srcdir)/src/os/unix"
diff --git a/lib-src/portaudio-v19/configure.in b/lib-src/portaudio-v19/configure.in
index e15a8c5..ceff5b2 100644
--- a/lib-src/portaudio-v19/configure.in
+++ b/lib-src/portaudio-v19/configure.in
@@ -393,6 +393,22 @@ case "${host_os}" in
         SHARED_FLAGS=""
         ;;
 
+  haiku* )
+        dnl Haiku configuration
+
+        dnl AC_DEFINE(PA_USE_HAIKU,1)
+        AC_DEFINE(PA_USE_SKELETON,1)
+
+        CFLAGS="$CFLAGS -I\$(top_srcdir)/src/os/unix"
+        # -Werror
+        LIBS="-lmedia"
+
+        SHARED_FLAGS="$LIBS -shared"
+        #CFLAGS="$CFLAGS"
+        OTHER_OBJS="src/os/unix/pa_unix_hostapis.o src/os/unix/pa_unix_util.o"
+        PADLL="libportaudio.so"
+        ;;
+
   *)
         dnl Unix configuration
 
-- 
2.37.3


From 2c8cae10a82d44f5dcc5c0ca21d91d310bac66b6 Mon Sep 17 00:00:00 2001
From: Ian McInerney <ian.s.mcinerney@ieee.org>
Date: Fri, 8 Apr 2022 01:08:12 +0100
Subject: Remove custom languages in wx 3.1.6 and above

Basque was added as a language with identifier "eu" into wx 3.1.6, so
there is no more need to provide custom languages. Additionally, this
struct changed formatting in 3.1.6, meaning it threw a compile error
when included (so it would have to be fixed if still needed).

diff --git a/src/AudacityApp.cpp b/src/AudacityApp.cpp
index 661ab7e..c5738eb 100644
--- a/src/AudacityApp.cpp
+++ b/src/AudacityApp.cpp
@@ -964,12 +964,10 @@ locations of the missing files.").Format( missingFileName ) ;
 #define WL(lang,sublang)
 #endif
 
-#if wxCHECK_VERSION(3, 0, 1)
+#if wxCHECK_VERSION(3, 0, 1) && !wxCHECK_VERSION(3, 1, 6)
 wxLanguageInfo userLangs[] =
 {
-   // Bosnian is defined in wxWidgets already
-//   { wxLANGUAGE_USER_DEFINED, wxT("bs"), WL(0, SUBLANG_DEFAULT) wxT("Bosnian"), wxLayout_LeftToRight },
-
+   // Included upstream in version 3.1.6
    { wxLANGUAGE_USER_DEFINED, wxT("eu"), WL(0, SUBLANG_DEFAULT) wxT("Basque"), wxLayout_LeftToRight },
 };
 #endif
@@ -1270,7 +1268,7 @@ bool AudacityApp::OnInit()
    //
    // TODO:  The whole Language initialization really need to be reworked.
    //        It's all over the place.
-#if wxCHECK_VERSION(3, 0, 1)
+#if wxCHECK_VERSION(3, 0, 1) && !wxCHECK_VERSION(3, 1, 6)
    for (size_t i = 0, cnt = WXSIZEOF(userLangs); i < cnt; i++)
    {
       wxLocale::AddLanguage(userLangs[i]);
-- 
2.37.3


From f645a5ac4bc6a95d8c3bff9441c0a4dc9f9fc04a Mon Sep 17 00:00:00 2001
From: Ian McInerney <ian.s.mcinerney@ieee.org>
Date: Fri, 8 Apr 2022 01:27:52 +0100
Subject: Call the proper wxBitmap constructor for XPM data

wxBitmap back to at least 3.0.0 did not have a constructor for an XPM
image that took a size parameter, it would only take the XPM data
itself.

I don't know how this compiled until now, but it doesn't anymore when
the size is included and built against wx 3.1.6 in Fedora.

diff --git a/src/MixerBoard.cpp b/src/MixerBoard.cpp
index be46e63..c6d0296 100644
--- a/src/MixerBoard.cpp
+++ b/src/MixerBoard.cpp
@@ -1304,7 +1304,7 @@ void MixerBoard::LoadMusicalInstruments()
    wxMemoryDC dc;
 
    for (const auto &data : table) {
-      auto bmp = std::make_unique<wxBitmap>(data.bitmap,24);
+      auto bmp = std::make_unique<wxBitmap>(data.bitmap);
       dc.SelectObject(*bmp);
       AColor::Bevel(dc, false, bev);
       mMusicalInstruments.push_back(std::make_unique<MusicalInstrument>(
-- 
2.37.3


From 691abd21f920d776dd75048aeb893517635863af Mon Sep 17 00:00:00 2001
From: Paul Licameli <paul.licameli@audacityteam.org>
Date: Fri, 14 May 2021 16:22:28 -0400
Subject: Add #include needed to build on Fedora 34, recommended by Be-ing


diff --git a/include/audacity/Types.h b/include/audacity/Types.h
index e137ea9..647c829 100644
--- a/include/audacity/Types.h
+++ b/include/audacity/Types.h
@@ -44,6 +44,7 @@
 
 #include <algorithm>
 #include <functional>
+#include <limits>
 #include <type_traits>
 #include <vector>
 #include <wx/debug.h> // for wxASSERT
-- 
2.37.3


From bf63b0cd604d836c09ec0202205c07a0a0c5f487 Mon Sep 17 00:00:00 2001
From: David Karoly <david.karoly@outlook.com>
Date: Sun, 6 Nov 2022 18:02:52 +0100
Subject: portaudio: fix build on Haiku


diff --git a/cmake-proxies/portaudio-v19/CMakeLists.txt b/cmake-proxies/portaudio-v19/CMakeLists.txt
index d46ae06..5f1aa7a 100644
--- a/cmake-proxies/portaudio-v19/CMakeLists.txt
+++ b/cmake-proxies/portaudio-v19/CMakeLists.txt
@@ -118,7 +118,7 @@ list( APPEND SOURCES
          ${TARGET_ROOT}/src/hostapi/coreaudio/pa_mac_core_utilities.c
       >
 
-      $<$<PLATFORM_ID:Darwin,Linux,FreeBSD,CYGWIN>:
+      $<$<PLATFORM_ID:Darwin,Linux,FreeBSD,CYGWIN,Haiku>:
          ${TARGET_ROOT}/src/os/unix/pa_unix_hostapis.c
          ${TARGET_ROOT}/src/os/unix/pa_unix_util.c
       >
-- 
2.37.3


From a8d2d4ad48cf78315dddc618d69f657ea926450e Mon Sep 17 00:00:00 2001
From: David Karoly <david.karoly@outlook.com>
Date: Sun, 6 Nov 2022 18:02:52 +0100
Subject: nyquist: fix build on Haiku


diff --git a/lib-src/libnyquist/nyquist/xlisp/xlisp.h b/lib-src/libnyquist/nyquist/xlisp/xlisp.h
index 6bbf324..1daa2c6 100644
--- a/lib-src/libnyquist/nyquist/xlisp/xlisp.h
+++ b/lib-src/libnyquist/nyquist/xlisp/xlisp.h
@@ -177,6 +177,10 @@ extern long ptrtoabs();
 #endif
 #endif
 
+#ifdef __HAIKU__
+#define XL_LITTLE_ENDIAN
+#endif
+
 /* default important definitions */
 #ifndef NNODES
 #define NNODES		1000
-- 
2.37.3


From 8117f0a0e28851e4a25f31f125d39391015c3e65 Mon Sep 17 00:00:00 2001
From: David Karoly <david.karoly@outlook.com>
Date: Sun, 6 Nov 2022 18:02:52 +0100
Subject: fix GTK include paths and libs


diff --git a/cmake-proxies/wxWidgets/CMakeLists.txt b/cmake-proxies/wxWidgets/CMakeLists.txt
index 94d19dd..6dcffc8 100644
--- a/cmake-proxies/wxWidgets/CMakeLists.txt
+++ b/cmake-proxies/wxWidgets/CMakeLists.txt
@@ -205,6 +205,10 @@ endif()
 if( "${wxTOOLKIT}" MATCHES "GTK." )
    pkg_check_modules( GTK REQUIRED IMPORTED_TARGET GLOBAL ${gtk} )
    pkg_check_modules( GLIB REQUIRED IMPORTED_TARGET GLOBAL ${glib} )
+
+   list( APPEND INCLUDES ${GTK_INCLUDE_DIRS} )
+   list( APPEND LINKDIRS ${GTK_LIB_DIR} )
+   list( APPEND LIBRARIES ${GTK_LIBRARIES} )
 endif()
 
 target_include_directories( ${TARGET} INTERFACE ${INCLUDES} )
-- 
2.37.3


From d31d3b29e8a77b1b703cc58ee867caf6e1b37651 Mon Sep 17 00:00:00 2001
From: David Karoly <david.karoly@outlook.com>
Date: Sun, 6 Nov 2022 18:02:52 +0100
Subject: fix build for AudioIO.cpp


diff --git a/src/AudioIO.cpp b/src/AudioIO.cpp
index 0187e39..feb62bf 100644
--- a/src/AudioIO.cpp
+++ b/src/AudioIO.cpp
@@ -821,7 +821,7 @@ static double SystemTime(bool usingAlsa)
    if (usingAlsa) {
       struct timespec now;
       // CLOCK_MONOTONIC_RAW is unaffected by NTP or adj-time
-      clock_gettime(CLOCK_MONOTONIC_RAW, &now);
+      clock_gettime(CLOCK_MONOTONIC, &now);
       //return now.tv_sec + now.tv_nsec * 0.000000001;
       return (now.tv_sec + now.tv_nsec * 0.000000001) - streamStartTime;
    }
-- 
2.37.3


From cffae938201f9bf330e38eba571e7207b4c35bbe Mon Sep 17 00:00:00 2001
From: David Karoly <david.karoly@outlook.com>
Date: Sun, 6 Nov 2022 18:02:52 +0100
Subject: add dummy RevisionIdent.h


diff --git a/include/RevisionIdent.h b/include/RevisionIdent.h
new file mode 100644
index 0000000..e69de29
-- 
2.37.3

