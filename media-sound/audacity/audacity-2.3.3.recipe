SUMMARY="Audio software for multi-track recording and editing"
DESCRIPTION="Audacity can be used to perform a number of audio editing and \
recording tasks such as making ringtones, mixing stero tracks, transferring \
tapes and records to computer or CD, splitting recordings into separate \
tracks and more."
HOMEPAGE="https://www.audacityteam.org"
COPYRIGHT="1999-2020 by Audacity Team"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://github.com/audacity/audacity/archive/refs/tags/Audacity-$portVersion.tar.gz"
CHECKSUM_SHA256="404e6c49693dedc94212fc5525974058d848536025e19da31359ae02babe8bd7"
SOURCE_DIR="audacity-Audacity-$portVersion"
PATCHES="audacity-$portVersion.patchset"

ARCHITECTURES="?all !x86_gcc2"
SECONDARY_ARCHITECTURES="?x86"

PROVIDES="
	audacity$secondaryArchSuffix = $portVersion
	app:Audacity$secondaryArchSuffix = $portVersion
	cmd:audacity$secondaryArchSuffix
	"
REQUIRES="
	haiku$secondaryArchSuffix
	wxgtk$secondaryArchSuffix
	lib:libatk_1.0$secondaryArchSuffix
	lib:libcairo$secondaryArchSuffix
	lib:libavcodec$secondaryArchSuffix
	lib:libavformat$secondaryArchSuffix
	lib:libavutil$secondaryArchSuffix
	lib:libexpat$secondaryArchSuffix
	lib:libflac$secondaryArchSuffix
	lib:libgdk_pixbuf_2.0$secondaryArchSuffix
	lib:libglib_2.0$secondaryArchSuffix
	lib:libgtk_3$secondaryArchSuffix
	lib:libharfbuzz$secondaryArchSuffix
	lib:libiconv$secondaryArchSuffix
#	lib:libid3tag$secondaryArchSuffix		-- missing pkgconfig
	lib:libintl$secondaryArchSuffix
#	lib:libmad$secondaryArchSuffix			-- missing pkgconfig
	lib:libogg$secondaryArchSuffix
	lib:libpango_1.0$secondaryArchSuffix
	lib:libsndfile$secondaryArchSuffix
	lib:libvorbis$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	wxgtk${secondaryArchSuffix}_devel
	devel:libavcodec$secondaryArchSuffix
	devel:libavformat$secondaryArchSuffix
	devel:libavutil$secondaryArchSuffix
	devel:libexpat$secondaryArchSuffix
	devel:libflac$secondaryArchSuffix
	devel:libglib_2.0$secondaryArchSuffix
	devel:libgtk_3$secondaryArchSuffix
	devel:libiconv$secondaryArchSuffix
#	devel:libid3tag$secondaryArchSuffix
	devel:libintl$secondaryArchSuffix
#	devel:libmad$secondaryArchSuffix
	devel:libsndfile$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:cmake
	cmd:diff
	cmd:find
	cmd:gcc$secondaryArchSuffix
	cmd:gettext$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	cmd:which
	cmd:wx_config$secondaryArchSuffix
	"

PATCH()
{
	# pthreads
	sed -i 's/-pthread/-lpthread/g' lib-src/portaudio-v19/configure
}

BUILD()
{
	mkdir -p build
	cd build
	runConfigure ../configure --without-lv2 --without-portmixer --disable-nyquist --without-portmidi --without-midi --without-ffmpeg
	make $jobArgs
}

INSTALL()
{
	make -C build install
}
