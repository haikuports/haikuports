SUMMARY="A toolkit for converting Haiku Vector Icon Format (HVIF) icons to SVG and back"
DESCRIPTION="A comprehensive set of command-line tools and extensions for working with \
Haiku Vector Icon Format (HVIF) and Icon-O-Matic (IOM) files.

icon2icon - A universal icon format converter

* Converts between HVIF, IOM, SVG and PNG.
* Full HVIF format support with coordinate transformation.
* Solid colors and gradients (linear, radial, diamond, conic, XY, sqrt-XY).
* Fill and stroke rendering via transformers.
* BMessage-based IOM format parsing.
* SVG parsing via NanoSVG library.
* Preserves named elements as SVG IDs with the --names flag.

img2svg - Advanced bitmap to SVG vectorization.

* Color quantization with adaptive palettes.
* Multiple simplification algorithms (Douglas-Peucker, Visvalingam-Whyatt).
* Geometric shape detection.
* Background removal with auto-detection.
* Gradient detection and region merging.

iom2hvif - Convert Icon-O-Matic files to HVIF format.

* Native Haiku implementation using Haiku API.
* Direct IOM to HVIF conversion without intermediate formats.
* Write icons to HVIF files or file/folder attributes.
* Batch processing support for multiple files.
* Based on Haiku Icon-O-Matic implementation.

Inkscape Extensions - Seamless HVIF/IOM import and export.

* Python-based extensions for Inkscape 1.0+.
* Requires the icon2icon CLI tool in PATH.
"
HOMEPAGE="https://github.com/threedeyes/hvif-tools/"
COPYRIGHT="2025 Gerasim Troeglazov"
LICENSE="MIT"
REVISION="1"
SOURCE_URI="https://github.com/threedeyes/hvif-tools/releases/download/$portVersion/hvif-tools-$portVersion.tar.gz"
CHECKSUM_SHA256="ae5240faa0d1e0c72d6befa2397bf90c62893bc95007e5a1129196aaa857bd29"
SOURCE_DIR="hvif-tools-$portVersion"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	hvif_tools = $portVersion
	cmd:icon2icon = $portVersion
	cmd:img2svg = $portVersion
	cmd:iom2hvif = $portVersion
	lib:libhviftools$secondaryArchSuffix
	lib:libimagetracer$secondaryArchSuffix
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libagg$secondaryArchSuffix
	"

PROVIDES_devel="
	${portName}_devel = $portVersion
	devel:libhviftools$secondaryArchSuffix
	devel:libimagetracer$secondaryArchSuffix
	"

REQUIRES_devel="
	$portName == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libagg$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	cmake -B build -S . $cmakeDirArgs \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_BINDIR=$prefix/bin \
		-DBUILD_SHARED_LIBS=ON \
		-DBUILD_IOM2HVIF=ON
	make -C build $jobArgs
}

INSTALL()
{
	make -C build install

	mkdir -p $dataDir/inkscape/extensions
	cp inkscape/*.{py,inx} $dataDir/inkscape/extensions

	prepareInstalledDevelLibs \
		libhviftools \
		libimagetracer

	packageEntries devel \
		$developDir \
		$libDir/cmake
}
