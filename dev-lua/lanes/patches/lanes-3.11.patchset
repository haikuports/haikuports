From b340f715d80b3000e1d8cf8cf0b9b6bbf13563b2 Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Sun, 3 Sep 2017 07:20:09 +0200
Subject: fix platform detection, gcc2 error, -werror


diff --git a/src/Makefile b/src/Makefile
index 7e45d2a..760fa00 100644
--- a/src/Makefile
+++ b/src/Makefile
@@ -92,7 +92,7 @@ ifeq "$(LUAROCKS)" ""
     LIBFLAG = -bundle -undefined dynamic_lookup
   endif
   
-  CFLAGS=-Wall -Werror $(OPT_FLAGS) $(LUA_FLAGS)
+  CFLAGS=-Wall $(OPT_FLAGS) $(LUA_FLAGS)
   LIBS=$(LUA_LIBS)
 endif
 
diff --git a/src/threading.c b/src/threading.c
index 0a4c62a..df772f6 100644
--- a/src/threading.c
+++ b/src/threading.c
@@ -702,7 +702,7 @@ static int const gs_prio_remap[] =
 #			define _PRIO_0  50
 #			define _PRIO_LO 1
 
-#		elif defined(PLATFORM_BSD)
+#		elif defined(PLATFORM_BSD) || defined(PLATFORM_HAIKU)
 			//
 			// <http://www.net.in.tum.de/~gregor/docs/pthread-scheduling.html>
 			//
diff --git a/src/threading.h b/src/threading.h
index bfa9ab8..3102113 100644
--- a/src/threading.h
+++ b/src/threading.h
@@ -25,6 +25,8 @@
   #define PLATFORM_QNX
 #elif (defined __CYGWIN__)
   #define PLATFORM_CYGWIN
+#elif (defined __HAIKU__)
+  #define PLATFORM_HAIKU
 #else
   #error "Unknown platform!"
 #endif
diff --git a/src/tools.c b/src/tools.c
index c2491ba..63b5e3d 100644
--- a/src/tools.c
+++ b/src/tools.c
@@ -859,6 +859,7 @@ static int table_lookup_sentinel( lua_State* L)
 static char const* find_lookup_name( lua_State* L, uint_t i, enum eLookupMode mode_, char const* upName_, size_t* len_)
 {
 	DEBUGSPEW_CODE( struct s_Universe* const U = get_universe( L));
+	{
 	char const* fqn;
 	ASSERT_L( lua_isfunction( L, i) || lua_istable( L, i));  // ... v ...
 	STACK_CHECK( L);
@@ -921,6 +922,7 @@ static char const* find_lookup_name( lua_State* L, uint_t i, enum eLookupMode mo
 	}
 	STACK_END( L, 0);
 	return fqn;
+	}
 }
 
 
-- 
2.7.0

