From 259fae2a1235103fd0ffd6d8dd0593a3be5c75b4 Mon Sep 17 00:00:00 2001
From: Schrijvers Luc <begasus@gmail.com>
Date: Sat, 8 Jun 2024 17:47:03 +0200
Subject: Set datarootdir + don't use hard links


diff --git a/GNUmakefile b/GNUmakefile
index c938756..26581c3 100644
--- a/GNUmakefile
+++ b/GNUmakefile
@@ -2,7 +2,7 @@ MAKEFLAGS += --jobs=1
 
 -include config.unix
 
-datarootdir = $(prefix)/share
+datarootdir = $(prefix)/data
 bindir = $(prefix)/bin
 INSTALL = install
 INSTALL_DATA = $(INSTALL) -m 644
diff --git a/src/luarocks/core/cfg.lua b/src/luarocks/core/cfg.lua
index 1c380e1..7dbdba6 100644
--- a/src/luarocks/core/cfg.lua
+++ b/src/luarocks/core/cfg.lua
@@ -242,7 +242,7 @@ local function make_defaults(lua_version, target_cpu, platforms, home)
          MKDIR = "mkdir",
          RMDIR = "rmdir",
          CP = "cp",
-         LN = "ln",
+         LN = "ln -s",
          LS = "ls",
          RM = "rm",
          FIND = "find",
-- 
2.52.0


From 9cfe3fad5f9f4d317846a2a67f478809d5406737 Mon Sep 17 00:00:00 2001
From: Schrijvers Luc <begasus@gmail.com>
Date: Fri, 28 Jun 2024 15:38:35 +0200
Subject: More fixes for share/data directory (found in check on 32bit)


diff --git a/spec/init_spec.lua b/spec/init_spec.lua
index 6cc0dd9..468aed3 100644
--- a/spec/init_spec.lua
+++ b/spec/init_spec.lua
@@ -212,7 +212,7 @@ describe("luarocks init #integration", function()
          write_file(tmpdir .. "/my_dependency.lua", "return {}", finally)
 
          assert.truthy(run.luarocks("build my_dependency-1.0-1.rockspec"))
-         assert.truthy(lfs.attributes(myproject .. "/lua_modules/share/lua/" .. test_env.lua_version .."/my_dependency.lua"))
+         assert.truthy(lfs.attributes(myproject .. "/lua_modules/data/lua/" .. test_env.lua_version .."/my_dependency.lua"))
 
          os.remove(rockspec_filename)
          os.remove("my_dependency-1.0-1.rockspec")
diff --git a/src/luarocks/core/cfg.lua b/src/luarocks/core/cfg.lua
index 7dbdba6..62c1561 100644
--- a/src/luarocks/core/cfg.lua
+++ b/src/luarocks/core/cfg.lua
@@ -67,7 +67,7 @@ local function detect_sysconfdir()
       return
    end
    -- If installed in a Unix-like tree, use a Unix-like sysconfdir
-   local installdir = basedir:match("^(.*)[\\/]share[\\/]lua[\\/][^/]*$")
+   local installdir = basedir:match("^(.*)[\\/]data[\\/]lua[\\/][^/]*$")
    if installdir then
       if installdir == "/usr" then
          return "/etc/luarocks"
@@ -191,7 +191,7 @@ local function make_defaults(lua_version, target_cpu, platforms, home)
       cache_timeout = 60,
       cache_fail_timeout = 86400,
 
-      lua_modules_path = dir.path("share", "lua", lua_version),
+      lua_modules_path = dir.path("data", "lua", lua_version),
       lib_modules_path = dir.path("lib", "lua", lua_version),
       rocks_subdir = dir.path("lib", "luarocks", "rocks-"..lua_version),
 
-- 
2.52.0


From f943285556cf9da1efa562bd241471e31ec8692b Mon Sep 17 00:00:00 2001
From: Schrijvers Luc <begasus@gmail.com>
Date: Mon, 8 Jul 2024 11:50:43 +0200
Subject: Adjust paths for headers search


diff --git a/src/luarocks/core/cfg.lua b/src/luarocks/core/cfg.lua
index 62c1561..3de0f00 100644
--- a/src/luarocks/core/cfg.lua
+++ b/src/luarocks/core/cfg.lua
@@ -272,12 +272,12 @@ local function make_defaults(lua_version, target_cpu, platforms, home)
       external_deps_subdirs = {
          bin = "bin",
          lib = "lib",
-         include = "include"
+         include = { "develop/headers" , "develop/headers/x86" }
       },
       runtime_external_deps_subdirs = {
          bin = "bin",
          lib = "lib",
-         include = "include"
+         include = { "develop/headers" , "develop/headers/x86" }
       },
    }
 
@@ -377,7 +377,7 @@ local function make_defaults(lua_version, target_cpu, platforms, home)
       defaults.static_lib_extension = "a"
       defaults.external_lib_extension = "so"
       defaults.obj_extension = "o"
-      defaults.external_deps_dirs = { "/usr/local", "/usr", "/" }
+      defaults.external_deps_dirs = { "/usr/local", "/usr", "/" , "/boot/system" }
 
       defaults.variables.CFLAGS = os.getenv("CFLAGS") or "-O2"
       -- we pass -fPIC via CFLAGS because of old Makefile-based Lua projects
-- 
2.52.0


From 0301731e0bcaa748bb8ea40674c804d824a77b93 Mon Sep 17 00:00:00 2001
From: Luc Schrijvers <begasus@gmail.com>
Date: Tue, 3 Feb 2026 08:05:29 +0100
Subject: v3.13.0 rockspec is broken

https://github.com/luarocks/luarocks/issues/1851

diff --git a/luarocks-3.13.0-1.rockspec b/luarocks-3.13.0-1.rockspec
index 012b1da..106eed9 100644
--- a/luarocks-3.13.0-1.rockspec
+++ b/luarocks-3.13.0-1.rockspec
@@ -3,8 +3,7 @@ package = "luarocks"
 version = "3.13.0-1"
 source = {
    url = "git+https://github.com/luarocks/luarocks",
-   tag = "v3.13.0"
-   tag = "v3.12.2",
+   tag = "v3.13.0",
 }
 description = {
    summary = "A package manager for Lua modules.",
-- 
2.52.0

