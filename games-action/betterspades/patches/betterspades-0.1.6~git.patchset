From 350472fcb3d7d959d679beb364e1e028c679badc Mon Sep 17 00:00:00 2001
From: "Julius C. Enriquez" <win8linux@gmail.com>
Date: Thu, 31 Mar 2022 21:30:39 +0800
Subject: Add Haiku support


diff --git a/src/common.h b/src/common.h
index 49f7419..ea4752b 100644
--- a/src/common.h
+++ b/src/common.h
@@ -59,6 +59,10 @@
 #define OS_APPLE
 #endif
 
+#ifdef __HAIKU__
+#define OS_HAIKU
+#endif
+
 #ifndef min
 #define min(a, b) ((a) < (b) ? (a) : (b))
 #endif
diff --git a/src/file.c b/src/file.c
index 7975a25..d6232f2 100644
--- a/src/file.c
+++ b/src/file.c
@@ -49,6 +49,10 @@ void file_url(char* url) {
 	sprintf(cmd, "xdg-open %s", url);
 	system(cmd);
 #endif
+#ifdef OS_HAIKU
+	sprintf(cmd, "open %s", url);
+	system(cmd);
+#endif
 }
 
 int file_dir_exists(const char* path) {
diff --git a/src/network.c b/src/network.c
index 3ccf37b..20a791d 100644
--- a/src/network.c
+++ b/src/network.c
@@ -843,6 +843,9 @@ void read_PacketVersionGet(void* data, int len) {
 #ifdef OS_APPLE
 	char* os = "BetterSpades (Apple) " GIT_COMMIT_HASH;
 #endif
+#ifdef OS_HAIKU
+	char* os = "BetterSpades (Haiku) " GIT_COMMIT_HASH;
+#endif
 #else
 #ifdef USE_TOUCH
 	char* os = "BetterSpades (Android) " GIT_COMMIT_HASH;
diff --git a/src/window.c b/src/window.c
index 1229aae..8de52d2 100644
--- a/src/window.c
+++ b/src/window.c
@@ -35,6 +35,10 @@
 #include <unistd.h>
 #endif
 
+#ifdef OS_HAIKU
+#include <kernel/OS.h>
+#endif
+
 #ifdef USE_GLFW
 
 static bool joystick_available = false;
@@ -600,5 +604,10 @@ int window_cpucores() {
 	GetSystemInfo(&info);
 	return info.dwNumberOfProcessors;
 #endif
-	return 1;
+#ifdef OS_HAIKU
+	system_info info;
+	get_system_info(&info);
+	return info.cpu_count;
+#endif
+return 1;
 }
-- 
2.30.2

