SUMMARY="Heart of Darkness (hode)"
DESCRIPTION="hode is a rewrite of the engine used in the game 'Heart of Darkness' made by Amazing Studio.
This program is designed as a cross-platform replacement for the original executable.

The game data files of the Windows release (Demo or CD) are required."
HOMEPAGE="http://cyxdown.free.fr/hode"
COPYRIGHT="2019-2023 Gregory Montoir"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://github.com/usineur/hode/archive/refs/tags/$portVersion.zip"
CHECKSUM_SHA256="6088462d4043bfe8e8f8077ff19e2dd3ae0b907bfa3dce653d928bdfccdc1995"
SOURCE_DIR="hode-$portVersion"
srcGitTag_2="r47"
SOURCE_URI_2="https://github.com/benhoyt/inih/archive/refs/tags/$srcGitTag_2.zip"
CHECKSUM_SHA256_2="ce7f98fe882b335b78dacbeabe8df6729712bfcbab56a759ccbd228a519c1b07"
SOURCE_FILENAME_2="inih-$srcGitTag_2.zip"
srcGitTag_3="3835e97d2f991b867a9764fa6ace730d25e4a19e"
SOURCE_URI_3="https://github.com/Treeki/libxbr-standalone/archive/$srcGitTag_3.zip"
CHECKSUM_SHA256_3="4c00adb1d5b9f85897c7202c3b8e766ced58e51efc461d413a8df301e8d2aeac"
SOURCE_FILENAME_3="libxbr-standalone-$srcGitTag_3.zip"
PATCHES="haiku.patch"
ADDITIONAL_FILES="heart_of_darkness.sh"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	heart_of_darkness$secondaryArchSuffix = $portVersion
	app:HeartOfDarkness = $portVersion
	cmd:heart_of_darkness
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libSDL2_2.0$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libSDL2_2.0$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	# link submodules
	rm -rf $sourceDir/3p/inih
	ln -sfn $sourceDir2/inih-$srcGitTag_2 $sourceDir/3p/inih
	rm -rf $sourceDir/3p/libxbr-standalone
	ln -sfn $sourceDir3/libxbr-standalone-$srcGitTag_3 $sourceDir/3p/libxbr-standalone
	cmake -Bbuild -S. -DCMAKE_BUILD_TYPE=Release
	make -C build
}

INSTALL()
{
	mkdir -p $binDir $appsDir
	cp build/hode "$appsDir/Heart of Darkness"
	cp $portDir/additional-files/heart_of_darkness.sh "$binDir/heart-of-darkness"
	chmod +x  "$binDir/heart-of-darkness"
	addAppDeskbarSymlink "$binDir/heart-of-darkness" "Heart of Darkness"
}
