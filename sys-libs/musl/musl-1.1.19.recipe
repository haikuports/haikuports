SUMMARY="Light, fast and simple C library"
DESCRIPTION="
musl, pronounced like the word "mussel", is an MIT-licensed
implementation of the standard C library targetting the Linux syscall
API, suitable for use in a wide range of deployment environments. musl
offers efficient static and dynamic linking support, lightweight code
and low runtime overhead, strong fail-safe guarantees under correct
usage, and correctness in the sense of standards conformance and
safety. musl is built on the principle that these goals are best
achieved through simple code that is easy to understand and maintain."
HOMEPAGE="https://www.musl-libc.org/"
COPYRIGHT="2005-2014 Rich Felker, et al."
LICENSE="MIT"
REVISION="1"
SOURCE_URI="https://www.musl-libc.org/releases/musl-$portVersion.tar.gz"
CHECKSUM_SHA256="db59a8578226b98373f5b27e61f0dd29ad2456f4aa9cec587ba8c24508e4c1d9"

ARCHITECTURES="x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	musl$secondaryArchSuffix = $portVersion
	lib:libc$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

PROVIDES_devel="
	musl${secondaryArchSuffix}_devel = $portVersion
	devel:libc$secondaryArchSuffix = $portVersion
	devel:libcrypt$secondaryArchSuffix = $portVersion
	devel:libdl$secondaryArchSuffix = $portVersion
	devel:libm$secondaryArchSuffix = $portVersion
	devel:libpthread$secondaryArchSuffix = $portVersion
	devel:libresolv$secondaryArchSuffix = $portVersion
	devel:librt$secondaryArchSuffix = $portVersion
	devel:libutil$secondaryArchSuffix = $portVersion
	devel:libxnet$secondaryArchSuffix = $portVersion
	devel:libc$secondaryArchSuffix = $portVersion
	"
REQUIRES_devel="
	musl$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:aclocal
	cmd:autoconf
	cmd:gcc$secondaryArchSuffix
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	"

defineDebugInfoPackage musl$secondaryArchSuffix  \
	$libDir/libc.so

BUILD()
{
	runConfigure ./configure
	make $jobArgs
}

INSTALL()
{
	make install

	mkdir -p $developLibDir
	mv $libDir/*.o $developLibDir/

	# prepare develop/lib
	prepareInstalledDevelLibs libc libcrypt libdl libm libpthread \
		libresolv librt libutil libxnet

	# devel package
	packageEntries devel \
		$developDir
}

TEST()
{
	make check
}
