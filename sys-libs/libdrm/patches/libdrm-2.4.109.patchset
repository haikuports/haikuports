From 13ef84b90884c06765eab06ec1edab3964fa13f0 Mon Sep 17 00:00:00 2001
From: Ken Mays <kmays2000@gmail.com>
Date: Fri, 26 Nov 2021 08:21:14 +1000
Subject: Fix MAKEDEV for Haiku


diff --git a/xf86drm.c b/xf86drm.c
index 5933e4b..9f25d3a 100644
--- a/xf86drm.c
+++ b/xf86drm.c
@@ -68,6 +68,13 @@
 #include <sys/pciio.h>
 #endif
 
+#if !defined(HAVE_MAJOR) && !defined(major)
+/* Replacement for major/minor/makedev. */
+#define	major(x) ((int)(0x00ff & ((x) >> 8)))
+#define	minor(x) ((int)(0xffff00ff & (x)))
+#define	makedev(maj,min) ((0xff00 & ((maj)<<8)) | (0xffff00ff & (min)))
+#endif
+
 #define ARRAY_SIZE(a) (sizeof(a) / sizeof((a)[0]))
 
 /* Not all systems have MAP_FAILED defined */
-- 
2.30.2


From dc8ac7a9fcf8073cb45ef790d8d98fa618e820b0 Mon Sep 17 00:00:00 2001
From: Ken Mays <kmays2000@gmail.com>
Date: Fri, 26 Nov 2021 08:21:14 +1000
Subject: Fix Nouveau IOCTL for Haiku


diff --git a/tests/nouveau/threaded.c b/tests/nouveau/threaded.c
index ddbac74..a4b54cd 100644
--- a/tests/nouveau/threaded.c
+++ b/tests/nouveau/threaded.c
@@ -38,6 +38,8 @@ static int import_fd;
 
 #if defined(__GLIBC__) || defined(__FreeBSD__)
 int ioctl(int fd, unsigned long request, ...)
+#elif defined(__HAIKU__)
+int fcntl(int fd, int request, ...)
 #else
 int ioctl(int fd, int request, ...)
 #endif
-- 
2.30.2

