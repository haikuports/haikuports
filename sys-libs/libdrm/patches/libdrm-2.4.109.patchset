From 8759acf44c921a5d98d978b02f557d7b6fc1807c Mon Sep 17 00:00:00 2001
From: Ken Mays <kmays2000@gmail.com>
Date: Fri, 26 Nov 2021 08:21:14 +1000
Subject: Fix MAKEDEV for Haiku


diff --git a/xf86drm.c b/xf86drm.c
index 5933e4b..9f25d3a 100644
--- a/xf86drm.c
+++ b/xf86drm.c
@@ -68,6 +68,13 @@
 #include <sys/pciio.h>
 #endif
 
+#if !defined(HAVE_MAJOR) && !defined(major)
+/* Replacement for major/minor/makedev. */
+#define	major(x) ((int)(0x00ff & ((x) >> 8)))
+#define	minor(x) ((int)(0xffff00ff & (x)))
+#define	makedev(maj,min) ((0xff00 & ((maj)<<8)) | (0xffff00ff & (min)))
+#endif
+
 #define ARRAY_SIZE(a) (sizeof(a) / sizeof((a)[0]))
 
 /* Not all systems have MAP_FAILED defined */
-- 
2.30.2


From 9a444283f2e9ecb67fb7c79a30c25a4e634a9952 Mon Sep 17 00:00:00 2001
From: Ken Mays <kmays2000@gmail.com>
Date: Fri, 26 Nov 2021 08:21:14 +1000
Subject: Fix Nouveau IOCTL for Haiku


diff --git a/tests/nouveau/threaded.c b/tests/nouveau/threaded.c
index ddbac74..bd36785 100644
--- a/tests/nouveau/threaded.c
+++ b/tests/nouveau/threaded.c
@@ -36,8 +36,11 @@ static int failed;
 
 static int import_fd;
 
-#if defined(__GLIBC__) || defined(__FreeBSD__)
+#if defined(__GLIBC__) || defined(__FreeBSD__)||defined(__HAIKU__)
+#if defined(__HAIKU__)
+#undef ioctl
 int ioctl(int fd, unsigned long request, ...)
+#endif
 #else
 int ioctl(int fd, int request, ...)
 #endif
-- 
2.30.2

