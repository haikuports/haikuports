SUMMARY="A password-hashing function"
DESCRIPTION="Argon2 is a password-hashing function that summarizes the state \
of the art in the design of memory-hard functions and can be used to hash \
passwords for credential storage, key derivation, or other applications."
HOMEPAGE="https://github.com/p-h-c/phc-winner-argon2"
COPYRIGHT="2015-2017 Daniel Dinu
	2013-2017 Samuel Neves
	2015-2017 Dmitry Khoravich
	2015-2017 Jean-Philippe Aumasson
	2015 Thomas Pornin"
LICENSE="Apache v2
	Public Domain"
REVISION="1"
SOURCE_URI="https://github.com/P-H-C/phc-winner-argon2/archive/$portVersion.tar.gz"
CHECKSUM_SHA256="eaea0172c1f4ee4550d1b6c9ce01aab8d1ab66b4207776aa67991eb5872fdcd8"
SOURCE_FILENAME="argon2-$portVersion.tar.gz"
SOURCE_DIR="phc-winner-argon2-$portVersion"
PATCHES="argon2-$portVersion.patchset"

ARCHITECTURES="x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	argon2$secondaryArchSuffix = $portVersion
	cmd:argon2$secondaryArchSuffix = $portVersion
	lib:libargon2$secondaryArchSuffix = 1
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

PROVIDES_devel="
	argon2${secondaryArchSuffix}_devel = $portVersion
	devel:libargon2$secondaryArchSuffix = 1
	"
REQUIRES_devel="
	argon2$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:gcc$secondaryArchSuffix
	cmd:make
	"

TEST_REQUIRES="
	cmd:diff
	"

defineDebugInfoPackage argon2$secondaryArchSuffix \
	$libDir/libargon2.so.1

BUILD()
{
	make PREFIX=$prefix
}

INSTALL()
{
	make install PREFIX=$prefix \
		INST_INCLUDE=$includeDir \
		INST_LIBRARY=$libDir \
		INST_BINARY=$binDir
	install -d -m 755 $manDir/man1
	install -m 644 -t $manDir/man1 ./man/argon2.1

	mkdir -p $developLibDir/pkgconfig

cat > $developLibDir/pkgconfig/libargon2.pc << EOF
bindir=$binDir
exec_prefix=$prefix
libdir=$libDir
includedir=$includeDir

Name: libargon2
Description: $SUMMARY
Version: $portVersion
Libs: -L$developLibDir -largon2
Cflags: -I$includeDir
EOF

	prepareInstalledDevelLibs libargon2
	fixPkgconfig

	packageEntries devel \
		$developDir
}

TEST()
{
	make OPTTARGET=none test
}
