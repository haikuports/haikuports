From 3945c2defe0a966c05a266aef937e899c42fd3af Mon Sep 17 00:00:00 2001
From: Ken Mays <kmays2000@gmail.com>
Date: Tue, 1 Mar 2022 01:07:14 +0000
Subject: Support PE/COFF on Haiku


diff --git a/bfd/config.bfd b/bfd/config.bfd
index cfe5824..62e9f42 100644
--- a/bfd/config.bfd
+++ b/bfd/config.bfd
@@ -693,7 +693,7 @@ case "${targ}" in
     ;;
   x86_64-*-haiku*)
     targ_defvec=x86_64_elf64_vec
-    targ_selvecs="i386_elf32_vec"
+    targ_selvecs="i386_elf32_vec iamcu_elf32_vec i386_coff_vec i386_pei_vec x86_64_pe_vec x86_64_pei_vec l1om_elf64_vec k1om_elf64_vec"
     want64=true
     ;;
   x86_64-*-netbsd* | x86_64-*-openbsd*)
@@ -748,6 +748,7 @@ case "${targ}" in
     ;;
   i[3-7]86-*-haiku*)
     targ_defvec=i386_elf32_vec
+    targ_selvecs="i386_pe_vec i386_pei_vec i386_elf32_vec iamcu_elf32_vec"
     ;;
   i[3-7]86-*-interix*)
     targ_defvec=i386_pei_vec
-- 
2.30.2


From f196ea36b9f2d0a8d2fe239f89f403c61b863519 Mon Sep 17 00:00:00 2001
From: Ken Mays <kmays2000@gmail.com>
Date: Tue, 1 Mar 2022 01:07:14 +0000
Subject: Fix Binutils 2.38.x testsuite for Haiku


diff --git a/libiberty/testsuite/test-pexecute.c b/libiberty/testsuite/test-pexecute.c
index 0929523..b1fe7f5 100644
--- a/libiberty/testsuite/test-pexecute.c
+++ b/libiberty/testsuite/test-pexecute.c
@@ -264,6 +264,7 @@ main (int argc, char **argv)
 
   /* We redirect stderr to a file to avoid an error message which is
      printed on mingw32 when the child calls abort.  */
+#ifndef __HAIKU__
   pex1 = TEST_PEX_INIT (PEX_USE_PIPES, NULL);
   subargv[1] = "abort";
   subargv[2] = NULL;
@@ -273,6 +274,7 @@ main (int argc, char **argv)
     ERROR ("abort failed");
   pex_free (pex1);
   remove ("temp.z");
+#endif
 
   pex1 = TEST_PEX_INIT (PEX_USE_PIPES, "temp");
   subargv[1] = "echo";
-- 
2.30.2

