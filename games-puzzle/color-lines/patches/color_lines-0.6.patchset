From a500213653497cb31dd4e2211bead59af8288a54 Mon Sep 17 00:00:00 2001
From: Ra-V2 <rav.bernacki@gmail.com>
Date: Tue, 10 Dec 2019 15:29:40 +0000
Subject: add new localization for saves


diff --git a/main.c b/main.c
index 392d09e..bfd6a3e 100644
--- a/main.c
+++ b/main.c
@@ -7,6 +7,14 @@
 #include <SDL_thread.h>
 // #include <pthread.h>
 
+#ifdef __HAIKU__
+#include <unistd.h>
+#include <libgen.h>
+#include <FindDirectory.h>
+#include <fs_info.h>
+#include <sys/stat.h>
+#endif
+
 #ifndef WINDOWS
 #include <unistd.h>
 #include <pwd.h>
@@ -1559,6 +1567,7 @@ int WINAPI WinMain (HINSTANCE hInstance,
 #ifdef MAEMO
 	putenv("SDL_VIDEO_X11_WMCLASS=lines");
 #endif
+	chdir(dirname(argv[0]));
 	game_mutex = SDL_CreateMutex();
 	if (gfx_init())
 		return 1;
@@ -1630,12 +1639,21 @@ char *get_path(int n)
 	static char path[255];
 
 #ifndef WINDOWS
+#ifdef __HAIKU__
+dev_t volume = dev_for_path("/boot");
+char buffer[B_PATH_NAME_LENGTH+B_FILE_NAME_LENGTH];
+find_directory(B_USER_SETTINGS_DIRECTORY, volume, true, buffer, sizeof(buffer));
+strcat(buffer, "/color_lines");
+mkdir(buffer, 0700);
+strcpy(path, buffer);
+#else
 	struct passwd *pw;
 	pw = getpwuid(getuid());
 	if (!pw) {
 		strcpy(path, "/tmp");
 	} else 
 		snprintf(path, sizeof(path) - 32, "%s", pw->pw_dir);
+#endif
 #else
 	static char appdir[MAX_PATH];
 
@@ -1657,13 +1675,13 @@ char *get_path(int n)
 
 	switch (n) {
 	case 0:
-		strcat(path,"/.lines-save");
+		strcat(path,"/lines-save");
 		break;
 	case 1:
-		strcat(path,"/.lines-scores");
+		strcat(path,"/lines-scores");
 		break;	
 	case 2:
-		strcat(path,"/.lines");
+		strcat(path,"/lines");
 		break;	
 	}
 	return path;
-- 
2.23.0

