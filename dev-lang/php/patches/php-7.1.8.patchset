From e02eced74e856ccbdca63ec8222702ebf428dc91 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zolt=C3=A1n=20Mizsei?= <zmizsei@extrowerk.com>
Date: Sat, 19 Aug 2017 09:23:42 +0200
Subject: [PATCH] Haiku supporting patches

---
 ext/bz2/config.m4        |  6 +++---
 ext/curl/config.m4       |  6 +++---
 ext/gd/config.m4         | 28 ++++++++++++++--------------
 ext/gettext/config.m4    |  6 +++---
 ext/gmp/config.m4        |  4 ++--
 ext/iconv/config.m4      | 14 +++++++-------
 ext/ldap/config.m4       |  6 +++++-
 ext/pdo_sqlite/config.m4 |  6 +++---
 ext/readline/config.m4   | 10 +++++-----
 ext/sqlite3/config0.m4   |  6 +++---
 ext/standard/microtime.c |  2 +-
 ext/xsl/config.m4        |  2 +-
 ext/zip/config.m4        | 23 +++++++++++++----------
 ext/zlib/config0.m4      | 10 +++++-----
 sapi/phpdbg/phpdbg.c     |  2 +-
 15 files changed, 69 insertions(+), 62 deletions(-)

diff --git a/ext/bz2/config.m4 b/ext/bz2/config.m4
index 55917c0..6385e4d 100644
--- a/ext/bz2/config.m4
+++ b/ext/bz2/config.m4
@@ -10,8 +10,8 @@ if test "$PHP_BZ2" != "no"; then
     BZIP_DIR=$PHP_BZ2
   else
     AC_MSG_CHECKING(for BZip2 in default path)
-    for i in /usr/local /usr; do
-      if test -r $i/include/bzlib.h; then
+    for i in /usr/local /usr /system; do
+      if test -r $i/develop/headers/bzlib.h; then
         BZIP_DIR=$i
         AC_MSG_RESULT(found in $i)
         break
@@ -26,7 +26,7 @@ if test "$PHP_BZ2" != "no"; then
 
   PHP_CHECK_LIBRARY(bz2, BZ2_bzerror, 
   [
-    PHP_ADD_INCLUDE($BZIP_DIR/include)
+    PHP_ADD_INCLUDE($BZIP_DIR/develop/headers)
     PHP_ADD_LIBRARY_WITH_PATH(bz2, $BZIP_DIR/$PHP_LIBDIR, BZ2_SHARED_LIBADD)
     AC_DEFINE(HAVE_BZ2,1,[ ])
   ], [
diff --git a/ext/curl/config.m4 b/ext/curl/config.m4
index 2f82c34..b6a09d9 100644
--- a/ext/curl/config.m4
+++ b/ext/curl/config.m4
@@ -10,8 +10,8 @@ if test "$PHP_CURL" != "no"; then
     CURL_DIR=$PHP_CURL
   else
     AC_MSG_CHECKING(for cURL in default path)
-    for i in /usr/local /usr; do
-      if test -r $i/include/curl/easy.h; then
+    for i in /usr/local /usr /system; do
+      if test -r $i/develop/headers/curl/easy.h; then
         CURL_DIR=$i
         AC_MSG_RESULT(found in $i)
         break
@@ -22,7 +22,7 @@ if test "$PHP_CURL" != "no"; then
   if test -z "$CURL_DIR"; then
     AC_MSG_RESULT(not found)
     AC_MSG_ERROR(Please reinstall the libcurl distribution -
-    easy.h should be in <curl-dir>/include/curl/)
+    easy.h should be in <curl-dir>/develop/headers/curl/)
   fi
 
   CURL_CONFIG="curl-config"
diff --git a/ext/gd/config.m4 b/ext/gd/config.m4
index 1bc5f98..46f9db2 100644
--- a/ext/gd/config.m4
+++ b/ext/gd/config.m4
@@ -47,12 +47,12 @@ dnl
 
 AC_DEFUN([PHP_GD_ZLIB],[
 	if test "$PHP_ZLIB_DIR" != "no" && test "$PHP_ZLIB_DIR" != "yes"; then
-		if test -f "$PHP_ZLIB_DIR/include/zlib/zlib.h"; then
+		if test -f "$PHP_ZLIB_DIR/develop/headers/zlib/zlib.h"; then
 			PHP_ZLIB_DIR="$PHP_ZLIB_DIR"
-			PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/include/zlib"
-		elif test -f "$PHP_ZLIB_DIR/include/zlib.h"; then
+			PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/develop/headers/zlib"
+		elif test -f "$PHP_ZLIB_DIR/develop/headers/zlib.h"; then
 			PHP_ZLIB_DIR="$PHP_ZLIB_DIR"
-			PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/include"
+			PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/develop/headers"
 		else
 			AC_MSG_ERROR([Can't find zlib headers under "$PHP_ZLIB_DIR"])
 		fi
@@ -72,16 +72,16 @@ AC_DEFUN([PHP_GD_ZLIB],[
 AC_DEFUN([PHP_GD_WEBP],[
   if test "$PHP_WEBP_DIR" != "no"; then
 
-    for i in $PHP_WEBP_DIR /usr/local /usr; do
-      test -f $i/include/webp/decode.h && GD_WEBP_DIR=$i && break
+    for i in $PHP_WEBP_DIR /usr/local /usr /system; do
+      test -f $i/develop/headers/webp/decode.h && GD_WEBP_DIR=$i && break
     done
 
     if test -z "$GD_WEBP_DIR"; then
       AC_MSG_ERROR([webp/decode.h not found.])
     fi
 
-    for i in $PHP_WEBP_DIR /usr/local /usr; do
-      test -f $i/include/webp/encode.h && GD_WEBP_DIR=$i && break
+    for i in $PHP_WEBP_DIR /usr/local /usr /system; do
+      test -f $i/develop/headers/webp/encode.h && GD_WEBP_DIR=$i && break
     done
 
     if test -z "$GD_WEBP_DIR"; then
@@ -90,7 +90,7 @@ AC_DEFUN([PHP_GD_WEBP],[
 
     PHP_CHECK_LIBRARY(webp,WebPGetInfo,
     [
-      PHP_ADD_INCLUDE($GD_WEBP_DIR/include)
+      PHP_ADD_INCLUDE($GD_WEBP_DIR/develop/headers)
       PHP_ADD_LIBRARY(pthread)
       PHP_ADD_LIBRARY_WITH_PATH(webp, $GD_WEBP_DIR/$PHP_LIBDIR, GD_SHARED_LIBADD)
     ],[
@@ -106,8 +106,8 @@ AC_DEFUN([PHP_GD_WEBP],[
 AC_DEFUN([PHP_GD_JPEG],[
   if test "$PHP_JPEG_DIR" != "no"; then
 
-    for i in $PHP_JPEG_DIR /usr/local /usr; do
-      test -f $i/include/jpeglib.h && GD_JPEG_DIR=$i && break
+    for i in $PHP_JPEG_DIR /usr/local /usr /system; do
+      test -f $i/develop/headers/jpeglib.h && GD_JPEG_DIR=$i && break
     done
 
     if test -z "$GD_JPEG_DIR"; then
@@ -116,7 +116,7 @@ AC_DEFUN([PHP_GD_JPEG],[
 
     PHP_CHECK_LIBRARY(jpeg,jpeg_read_header,
     [
-      PHP_ADD_INCLUDE($GD_JPEG_DIR/include)
+      PHP_ADD_INCLUDE($GD_JPEG_DIR/develop/headers)
       PHP_ADD_LIBRARY_WITH_PATH(jpeg, $GD_JPEG_DIR/$PHP_LIBDIR, GD_SHARED_LIBADD)
     ],[
       AC_MSG_ERROR([Problem with libjpeg.(a|so). Please check config.log for more information.])
@@ -132,7 +132,7 @@ AC_DEFUN([PHP_GD_PNG],[
   if test "$PHP_PNG_DIR" != "no"; then
 
     for i in $PHP_PNG_DIR /usr/local /usr; do
-      test -f $i/include/png.h && GD_PNG_DIR=$i && break
+      test -f $i/develop/headers/png.h && GD_PNG_DIR=$i && break
     done
 
     if test -z "$GD_PNG_DIR"; then
@@ -325,7 +325,7 @@ dnl Various checks for GD features
   PHP_GD_FREETYPE2
 
 dnl Header path
-  for i in include/gd include/gd2 include gd ""; do
+  for i in include/gd include/gd2 include gd /system /system/develop/headers ""; do
     test -f "$PHP_GD/$i/gd.h" && GD_INCLUDE="$PHP_GD/$i"
   done
 
diff --git a/ext/gettext/config.m4 b/ext/gettext/config.m4
index c82be9c..853413b 100644
--- a/ext/gettext/config.m4
+++ b/ext/gettext/config.m4
@@ -6,8 +6,8 @@ PHP_ARG_WITH(gettext,for GNU gettext support,
 [  --with-gettext[=DIR]      Include GNU gettext support])
 
 if test "$PHP_GETTEXT" != "no"; then
-  for i in $PHP_GETTEXT /usr/local /usr; do
-    test -r $i/include/libintl.h && GETTEXT_DIR=$i && break
+  for i in $PHP_GETTEXT /usr/local /usr /system; do
+    test -r $i/develop/headers/libintl.h && GETTEXT_DIR=$i && break
   done
 
   if test -z "$GETTEXT_DIR"; then
@@ -15,7 +15,7 @@ if test "$PHP_GETTEXT" != "no"; then
   fi
 
   GETTEXT_LIBDIR=$GETTEXT_DIR/$PHP_LIBDIR
-  GETTEXT_INCDIR=$GETTEXT_DIR/include
+  GETTEXT_INCDIR=$GETTEXT_DIR/develop/headers
   
   O_LDFLAGS=$LDFLAGS
   LDFLAGS="$LDFLAGS -L$GETTEXT_LIBDIR"
diff --git a/ext/gmp/config.m4 b/ext/gmp/config.m4
index 22cca7e..8590063 100644
--- a/ext/gmp/config.m4
+++ b/ext/gmp/config.m4
@@ -5,8 +5,8 @@ if test "$PHP_GMP" != "no"; then
 
   MACHINE_INCLUDES=$($CC -dumpmachine)
 
-  for i in $PHP_GMP /usr/local /usr; do
-    test -f $i/include/gmp.h && GMP_DIR=$i && break
+  for i in $PHP_GMP /usr/local /usr /system; do
+    test -f $i/develop/headers/gmp.h && GMP_DIR=$i && break
     test -f $i/include/$MACHINE_INCLUDES/gmp.h && GMP_DIR=$i && break
   done
 
diff --git a/ext/iconv/config.m4 b/ext/iconv/config.m4
index 6a05697..9052df4 100644
--- a/ext/iconv/config.m4
+++ b/ext/iconv/config.m4
@@ -15,26 +15,26 @@ if test "$PHP_ICONV" != "no"; then
 
   if test "$iconv_avail" != "no"; then
     if test -z "$ICONV_DIR"; then
-      for i in /usr/local /usr; do
-        if test -f "$i/include/iconv.h" || test -f "$i/include/giconv.h"; then
+      for i in /usr/local /usr /system; do
+        if test -f "$i/develop/headers/iconv.h" || test -f "$i/develop/headers/giconv.h"; then
           PHP_ICONV_PREFIX="$i"
           break
         fi
       done
       if test -z "$PHP_ICONV_PREFIX"; then
-        PHP_ICONV_PREFIX="/usr"
+        PHP_ICONV_PREFIX="/system"
       fi
     else
       PHP_ICONV_PREFIX="$ICONV_DIR"
     fi
 
-    CFLAGS="-I$PHP_ICONV_PREFIX/include $CFLAGS"
+    CFLAGS="-I$PHP_ICONV_PREFIX/develop/headers $CFLAGS"
     LDFLAGS="-L$PHP_ICONV_PREFIX/$PHP_LIBDIR $LDFLAGS"
 
-    if test -r "$PHP_ICONV_PREFIX/include/giconv.h"; then
-      PHP_ICONV_H_PATH="$PHP_ICONV_PREFIX/include/giconv.h"
+    if test -r "$PHP_ICONV_PREFIX/develop/headers/giconv.h"; then
+      PHP_ICONV_H_PATH="$PHP_ICONV_PREFIX/develop/headers/giconv.h"
     else
-      PHP_ICONV_H_PATH="$PHP_ICONV_PREFIX/include/iconv.h"
+      PHP_ICONV_H_PATH="$PHP_ICONV_PREFIX/develop/headers/iconv.h"
 	fi
 
     AC_MSG_CHECKING([if iconv is glibc's])
diff --git a/ext/ldap/config.m4 b/ext/ldap/config.m4
index 947cebc..eeaf86b 100644
--- a/ext/ldap/config.m4
+++ b/ext/ldap/config.m4
@@ -7,6 +7,10 @@ AC_DEFUN([PHP_LDAP_CHECKS], [
     LDAP_DIR=$1
     LDAP_INCDIR=$1/include
     LDAP_LIBDIR=$1/$PHP_LIBDIR
+  elif test -f $1/develop/headers/ldap.h; then
+    LDAP_DIR=$1
+    LDAP_INCDIR=$1/develop/headers
+    LDAP_LIBDIR=$1/$PHP_LIBDIR
   elif test -f $1/include/umich-ldap/ldap.h; then
     LDAP_DIR=$1
     LDAP_INCDIR=$1/include/umich-ldap
@@ -42,7 +46,7 @@ AC_DEFUN([PHP_LDAP_CHECKS], [
 
 AC_DEFUN([PHP_LDAP_SASL_CHECKS], [
   if test "$1" = "yes"; then
-    SEARCH_DIRS="/usr/local /usr"
+    SEARCH_DIRS="/usr/local /usr /system"
   else
     SEARCH_DIRS=$1
   fi
diff --git a/ext/pdo_sqlite/config.m4 b/ext/pdo_sqlite/config.m4
index 44b22b6..7ddad53 100644
--- a/ext/pdo_sqlite/config.m4
+++ b/ext/pdo_sqlite/config.m4
@@ -33,8 +33,8 @@ if test "$PHP_PDO_SQLITE" != "no"; then
   php_pdo_sqlite_sources_core="pdo_sqlite.c sqlite_driver.c sqlite_statement.c"
 
   if test "$PHP_PDO_SQLITE" != "yes"; then
-    SEARCH_PATH="$PHP_PDO_SQLITE /usr/local /usr"     # you might want to change this
-    SEARCH_FOR="/include/sqlite3.h"  # you most likely want to change this
+    SEARCH_PATH="$PHP_PDO_SQLITE /usr/local /usr /system"     # you might want to change this
+    SEARCH_FOR="/develop/headers/sqlite3.h"  # you most likely want to change this
     if test -r $PHP_PDO_SQLITE/$SEARCH_FOR; then # path given as parameter
       PDO_SQLITE_DIR=$PHP_PDO_SQLITE
     else # search default path list
@@ -51,7 +51,7 @@ if test "$PHP_PDO_SQLITE" != "no"; then
       AC_MSG_ERROR([Please reinstall the sqlite3 distribution])
     fi
 
-    PHP_ADD_INCLUDE($PDO_SQLITE_DIR/include)
+    PHP_ADD_INCLUDE($PDO_SQLITE_DIR/develop/headers)
 
     LIBNAME=sqlite3
     LIBSYMBOL=sqlite3_open
diff --git a/ext/readline/config.m4 b/ext/readline/config.m4
index 0a00370..15400ee 100644
--- a/ext/readline/config.m4
+++ b/ext/readline/config.m4
@@ -14,15 +14,15 @@ else
 fi
 
 if test "$PHP_READLINE" && test "$PHP_READLINE" != "no"; then
-  for i in $PHP_READLINE /usr/local /usr; do
-    test -f $i/include/readline/readline.h && READLINE_DIR=$i && break
+  for i in $PHP_READLINE /usr/local /usr /system; do
+    test -f $i/develop/headers/readline/readline.h && READLINE_DIR=$i && break
   done
 
   if test -z "$READLINE_DIR"; then
     AC_MSG_ERROR(Please reinstall readline - I cannot find readline.h)
   fi
 
-  PHP_ADD_INCLUDE($READLINE_DIR/include)
+  PHP_ADD_INCLUDE($READLINE_DIR/develop/headers)
 
   PHP_READLINE_LIBS=""
   AC_CHECK_LIB(ncurses, tgetent,
@@ -72,14 +72,14 @@ if test "$PHP_READLINE" && test "$PHP_READLINE" != "no"; then
 elif test "$PHP_LIBEDIT" != "no"; then
 
   for i in $PHP_LIBEDIT /usr/local /usr; do
-    test -f $i/include/editline/readline.h && LIBEDIT_DIR=$i && break
+    test -f $i/develop/headers/editline/readline.h && LIBEDIT_DIR=$i && break
   done
 
   if test -z "$LIBEDIT_DIR"; then
     AC_MSG_ERROR(Please reinstall libedit - I cannot find readline.h)
   fi
 
-  PHP_ADD_INCLUDE($LIBEDIT_DIR/include)
+  PHP_ADD_INCLUDE($LIBEDIT_DIR/develop/headers)
 
   AC_CHECK_LIB(ncurses, tgetent,
   [
diff --git a/ext/sqlite3/config0.m4 b/ext/sqlite3/config0.m4
index 3aa4492..be7e59f 100644
--- a/ext/sqlite3/config0.m4
+++ b/ext/sqlite3/config0.m4
@@ -22,8 +22,8 @@ if test $PHP_SQLITE3 != "no"; then
 
   if test $PHP_SQLITE3 != "yes"; then
     AC_MSG_CHECKING([for sqlite3 files in default path])
-    for i in $PHP_SQLITE3 /usr/local /usr; do
-      if test -r $i/include/sqlite3.h; then
+    for i in $PHP_SQLITE3 /usr/local /usr /system; do
+      if test -r $i/develop/headers/sqlite3.h; then
         SQLITE3_DIR=$i
         AC_MSG_RESULT(found in $i)
         break
@@ -39,7 +39,7 @@ if test $PHP_SQLITE3 != "no"; then
     PHP_CHECK_LIBRARY(sqlite3, sqlite3_prepare_v2, [
       AC_MSG_RESULT(found)
       PHP_ADD_LIBRARY_WITH_PATH(sqlite3, $SQLITE3_DIR/$PHP_LIBDIR, SQLITE3_SHARED_LIBADD)
-      PHP_ADD_INCLUDE($SQLITE3_DIR/include)
+      PHP_ADD_INCLUDE($SQLITE3_DIR/develop/headers)
     ],[
       AC_MSG_RESULT([not found])
       AC_MSG_ERROR([Please install SQLite 3.3.9 first or check libsqlite3 is present])
diff --git a/ext/standard/microtime.c b/ext/standard/microtime.c
index c6ec9ec..622a3a0 100644
--- a/ext/standard/microtime.c
+++ b/ext/standard/microtime.c
@@ -137,7 +137,7 @@ PHP_FUNCTION(getrusage)
 #ifdef PHP_WIN32 /* Windows only implements a limited amount of fields from the rusage struct */
 	PHP_RUSAGE_PARA(ru_majflt);
 	PHP_RUSAGE_PARA(ru_maxrss);
-#elif !defined( _OSD_POSIX) && !defined(__BEOS__) /* BS2000 has only a few fields in the rusage struct*/
+#elif !defined( _OSD_POSIX) && !defined(__BEOS__) && !defined(__HAIKU__) /* BS2000 has only a few fields in the rusage struct*/
 	PHP_RUSAGE_PARA(ru_oublock);
 	PHP_RUSAGE_PARA(ru_inblock);
 	PHP_RUSAGE_PARA(ru_msgsnd);
diff --git a/ext/xsl/config.m4 b/ext/xsl/config.m4
index 9b6f8aa..f614adb 100644
--- a/ext/xsl/config.m4
+++ b/ext/xsl/config.m4
@@ -16,7 +16,7 @@ if test "$PHP_XSL" != "no"; then
     AC_MSG_ERROR([XSL extension requires DOM extension, add --enable-dom])
   fi
 
-  for i in $PHP_XSL /usr/local /usr; do
+  for i in $PHP_XSL /usr/local /usr /system; do
     if test -x "$i/bin/xslt-config"; then
       XSLT_CONFIG=$i/bin/xslt-config
       break
diff --git a/ext/zip/config.m4 b/ext/zip/config.m4
index bb653c2..91f090e 100644
--- a/ext/zip/config.m4
+++ b/ext/zip/config.m4
@@ -20,23 +20,26 @@ if test "$PHP_ZIP" != "no"; then
 
   dnl libzip, depends on zlib
   if test "$PHP_ZLIB_DIR" != "no" && test "$PHP_ZLIB_DIR" != "yes"; then
-    if test -f "$PHP_ZLIB_DIR/include/zlib/zlib.h"; then
+    if test -f "$PHP_ZLIB_DIR/develop/headers/zlib/zlib.h"; then
       PHP_ZLIB_DIR="$PHP_ZLIB_DIR"
-      PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/include/zlib"
-    elif test -f "$PHP_ZLIB_DIR/include/zlib.h"; then
+      PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/develop/headers"
+    elif test -f "$PHP_ZLIB_DIR/develop/headers/zlib.h"; then
       PHP_ZLIB_DIR="$PHP_ZLIB_DIR"
-      PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/include"
+      PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/develop/headers"
     else
       AC_MSG_ERROR([Can not find zlib headers under "$PHP_ZLIB_DIR"])
     fi
   else
-    for i in /usr/local /usr; do
+    for i in /usr/local /usr /system; do
       if test -f "$i/include/zlib/zlib.h"; then
         PHP_ZLIB_DIR="$i"
         PHP_ZLIB_INCDIR="$i/include/zlib"
       elif test -f "$i/include/zlib.h"; then
         PHP_ZLIB_DIR="$i"
         PHP_ZLIB_INCDIR="$i/include"
+      elif test -f "$i/develop/headers/zlib.h"; then
+        PHP_ZLIB_DIR="$i"
+        PHP_ZLIB_INCDIR="$i/develop/headers"
       fi
     done
   fi
@@ -57,8 +60,8 @@ if test "$PHP_ZIP" != "no"; then
 
     dnl system libzip, depends on libzip
     AC_MSG_CHECKING(for libzip)
-    if test -r $PHP_LIBZIP/include/zip.h; then
-      LIBZIP_CFLAGS="-I$PHP_LIBZIP/include"
+    if test -r $PHP_LIBZIP/develop/headers/zip.h; then
+      LIBZIP_CFLAGS="-I$PHP_LIBZIP/develop/headers"
       LIBZIP_LIBDIR="$PHP_LIBZIP/$PHP_LIBDIR"
       AC_MSG_RESULT(from option: found in $PHP_LIBZIP)
 
@@ -73,9 +76,9 @@ if test "$PHP_ZIP" != "no"; then
       fi
 
     else
-      for i in /usr/local /usr; do
-        if test -r $i/include/zip.h; then
-          LIBZIP_CFLAGS="-I$i/include"
+      for i in /usr/local /usr /system; do
+        if test -r $i/develop/headers/zip.h; then
+          LIBZIP_CFLAGS="-I$i/develop/headers"
           LIBZIP_LIBDIR="$i/$PHP_LIBDIR"
           AC_MSG_RESULT(in default path: found in $i)
           break
diff --git a/ext/zlib/config0.m4 b/ext/zlib/config0.m4
index ab94c15..3d2ff1e 100644
--- a/ext/zlib/config0.m4
+++ b/ext/zlib/config0.m4
@@ -22,12 +22,12 @@ if test "$PHP_ZLIB" != "no" || test "$PHP_ZLIB_DIR" != "no"; then
     fi
   else 
     for i in /usr/local /usr $PHP_ZLIB_DIR; do
-      if test -f $i/include/zlib/zlib.h; then
+      if test -f $i/develop/headers/zlib/zlib.h; then
         ZLIB_DIR=$i
-        ZLIB_INCDIR=$i/include/zlib
-      elif test -f $i/include/zlib.h; then
+        ZLIB_INCDIR=$i/develop/headers/zlib
+      elif test -f $i/develop/headers/zlib.h; then
         ZLIB_DIR=$i
-        ZLIB_INCDIR=$i/include
+        ZLIB_INCDIR=$i/develop/headers
       fi
     done
   fi
@@ -42,7 +42,7 @@ if test "$PHP_ZLIB" != "no" || test "$PHP_ZLIB_DIR" != "no"; then
   esac
 
   AC_MSG_CHECKING([for zlib version >= 1.2.0.4])
-  ZLIB_VERSION=`$EGREP "define ZLIB_VERSION" $ZLIB_DIR/include/zlib.h | $SED -e 's/[[^0-9\.]]//g'`
+  ZLIB_VERSION=`$EGREP "define ZLIB_VERSION" $ZLIB_INCDIR/zlib.h | $SED -e 's/[[^0-9\.]]//g'`
   AC_MSG_RESULT([$ZLIB_VERSION])
   if test `echo $ZLIB_VERSION | $SED -e 's/[[^0-9]]/ /g' | $AWK '{print $1*1000000 + $2*10000 + $3*100 + $4}'` -lt 1020004; then
     AC_MSG_ERROR([libz version greater or equal to 1.2.0.4 required])
diff --git a/sapi/phpdbg/phpdbg.c b/sapi/phpdbg/phpdbg.c
index c7ee88b..a12ce6f 100644
--- a/sapi/phpdbg/phpdbg.c
+++ b/sapi/phpdbg/phpdbg.c
@@ -1740,7 +1740,7 @@ phpdbg_main:
 				exit(0);
 			}
 
-#ifndef _WIN32
+#if !defined(_WIN32) & !defined(__HAIKU__)
 			zend_sigaction(SIGIO, &sigio_struct, NULL);
 #endif
 
-- 
2.14.1

