SUMMARY="The VM used by Pharo"
DESCRIPTION="Pharo VM is the virtual machine used by Pharo. It started as a fork of opensmalltalk-vm."
HOMEPAGE="https://pharo.org/"
COPYRIGHT="2002-2025 Pharo developers"
LICENSE="MIT"
REVISION="1"
SOURCE_URI="https://files.pharo.org/vm/pharo-spur64-headless/Darwin-arm64/source/PharoVM-v10.3.5%2B19.5c892517d-Darwin-arm64-c-src.tar.gz"
CHECKSUM_SHA256="f608a8437bf50f447090022ef4f0aa01fade439efb8b17f10a4412d006562cda"
SOURCE_DIR="pharo-vm"

ARCHITECTURES="x86_64"

PROVIDES="
	pharo_vm = $portVersion
	cmd:pharo
	"
REQUIRES="
	haiku
	lib:libffi
	libgit2
	freetype
	openssl
	libsdl2
	libuuid
	pixman
	cairo
	libpng
	"

BUILD_REQUIRES="
	haiku_devel
	pkgconfig
	devel:libffi
	libgit2_devel
	freetype_devel
	openssl_devel
	libsdl2_devel
	libuuid_devel
	pixman_devel
	cairo_devel
	libpng_devel
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc
	cmd:make
	"

BUILD()
{
	cmake -B build -S . $cmakeDirArgs \
		-DGENERATED_SOURCE_DIR=. \
		-DALWAYS_INTERACTIVE=ON \
		-DBUILD_IS_RELEASE=ON \
		-DGENERATE_SOURCES=OFF \
		# Prevents CMake from trying to download stuff.
		-DBUILD_BUNDLE=OFF
	make -C build $jobArgs
}

INSTALL()
{
	make -C build install
}
