From 7fcc107a2be1d50fa86771738dd2cf56e89d19c5 Mon Sep 17 00:00:00 2001
From: miqlas <zmizsei@extrowerk.com>
Date: Sat, 30 Jul 2016 11:10:31 +0200
Subject: [PATCH] Haiku stack protector fix

---
 configure.in | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/configure.in b/configure.in
index 29b63c2..94065e7 100644
--- a/configure.in
+++ b/configure.in
@@ -873,7 +873,7 @@ if test "$GCC" = yes; then

     # -fstack-protector
     AS_CASE(["$target_os"],
-    [mingw*|nacl], [
+    [mingw*|nacl|haiku*], [
 	stack_protector=no
     ])
     if test -z "${stack_protector+set}"; then
--
2.7.0

From 43589bd3ac66d0511ac57c3451b0c793267f56a2 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zolt=C3=A1n=20Mizsei?= <zmizsei@extrowerk.com>
Date: Thu, 19 Jan 2017 19:04:45 +0100
Subject: [PATCH] Do not lock files, packageFS is RO.

---
 ruby.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/ruby.c b/ruby.c
index 80b965b..6f2a21f 100644
--- a/ruby.c
+++ b/ruby.c
@@ -1919,6 +1919,7 @@ open_load_file(VALUE fname_v, int *xflag)
 	}
 	rb_update_max_fd(fd);
 
+#ifndef __HAIKU__
 #if defined HAVE_FCNTL && MODE_TO_LOAD != O_RDONLY
 	/* disabling O_NONBLOCK */
 	if (fcntl(fd, F_SETFL, 0) < 0) {
@@ -1927,6 +1928,7 @@ open_load_file(VALUE fname_v, int *xflag)
 	    rb_load_fail(fname_v, strerror(e));
 	}
 #endif
+#endif
 
 	e = ruby_is_fd_loadable(fd);
 	if (!e) {
-- 
2.11.0

