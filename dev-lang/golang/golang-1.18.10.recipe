SUMMARY="Reference compiler for the Go programming language"
DESCRIPTION="The Go programming language is an open source project to make \
programmers more productive.

Go is expressive, concise, clean, and efficient. Its concurrency \
mechanisms make it easy to write programs that get the most out of multicore \
and networked machines, while its novel type system enables flexible and \
modular program construction. Go compiles quickly to machine code yet has the \
convenience of garbage collection and the power of run-time reflection. It's a \
fast, statically typed, compiled language that feels like a dynamically typed, \
interpreted language."
HOMEPAGE="https://github.com/korli/go/"
COPYRIGHT="2009-2022 The Go Authors"
LICENSE="BSD (3-clause)"
REVISION="1"
srcGitRev="07039ca6c88976bf30c747a857565bcd3d4cca25"
SOURCE_URI="https://github.com/korli/go/archive/$srcGitRev.tar.gz"
SOURCE_DIR="go-$srcGitRev"
SOURCE_FILENAME="golang-$portVersion-$srcGitRev.tar.gz"
CHECKSUM_SHA256="2bddac9b890da54bee0e3c9f886602186a50cebdd4a858301f9a11adbd891e03"
SOURCE_URI_2="https://github.com/korli/go/releases/download/go1.18.2-haiku1/go-1.18.2-haiku-amd64-bootstrap.tbz"
CHECKSUM_SHA256_2="cee202d243ae76905c5b8572bf422182619b2bedfe9c9a44f5f505248adf34cd"
SOURCE_DIR_2="go-haiku-amd64-bootstrap"

ARCHITECTURES="x86_64"

PROVIDES="
	golang = $portVersion
	cmd:go$secondaryArchSuffix = $portVersion
	cmd:gofmt$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"
BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:gcc$secondaryArchSuffix
	"

BUILD()
{
	export GOROOT_BOOTSTRAP=$sourceDir2
	export GOROOT_FINAL=$developLibDir/go
	export GOCACHE=/tmp
	cd src && ./make.bash
}

INSTALL()
{
	mkdir -p $binDir $developLibDir/go/
	cp -a bin src pkg lib misc api test doc $developLibDir/go/
	ln -sf $developLibDir/go/bin/go $binDir/
	ln -sf $developLibDir/go/bin/gofmt $binDir/
	install -Dm644 VERSION $developLibDir/go/
}

TEST()
{
	cd src && ./run.bash --no-rebuild -v -v -v
}
