From 81506e0b8db5023b5c4d00e0f9cb92966c2dcce5 Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Sun, 2 Nov 2025 19:05:29 +0100
Subject: Apply fixes taken from GZDoom patches


diff --git a/cmake/FindSDL2.cmake b/cmake/FindSDL2.cmake
index 02c6bba..f57538e 100644
--- a/cmake/FindSDL2.cmake
+++ b/cmake/FindSDL2.cmake
@@ -73,7 +73,8 @@ FIND_PATH(SDL2_INCLUDE_DIR SDL.h
   /opt/local # DarwinPorts
   /opt/csw # Blastwave
   /opt
-  /boot/system/develop/headers/SDL2 #Hiaku OS
+  /boot/system/develop/headers/SDL2 #Haiku
+  /boot/system/develop/headers/x86/SDL2 #Haiku x86
 )
 #MESSAGE("SDL2_INCLUDE_DIR is ${SDL2_INCLUDE_DIR}")
 
@@ -87,7 +88,8 @@ FIND_LIBRARY(SDL2_LIBRARY_TEMP
   /opt/local
   /opt/csw
   /opt
-  /system/lib #Hiaku OS
+  /system/lib #Haiku
+  /system/lib/x86 #Haiku x86
 )
 
 #MESSAGE("SDL2_LIBRARY_TEMP is ${SDL2_LIBRARY_TEMP}")
diff --git a/src/common/platform/posix/i_system.h b/src/common/platform/posix/i_system.h
index 02acf0e..d9a42cd 100644
--- a/src/common/platform/posix/i_system.h
+++ b/src/common/platform/posix/i_system.h
@@ -54,6 +54,7 @@ bool I_WriteIniFailed (const char* filename);
 class FGameTexture;
 bool I_SetCursor(FGameTexture *);
 
+#ifndef __HAIKU__
 static inline char *strlwr(char *str)
 {
 	char *ptr = str;
@@ -64,6 +65,7 @@ static inline char *strlwr(char *str)
 	}
 	return str;
 }
+#endif
 
 inline int I_GetNumaNodeCount() { return 1; }
 inline int I_GetNumaNodeThreadCount(int numaNode) { return std::max<int>(std::thread::hardware_concurrency(), 1); }
diff --git a/src/common/rendering/gl_load/gl_load.c b/src/common/rendering/gl_load/gl_load.c
index e29207f..9db3ed1 100644
--- a/src/common/rendering/gl_load/gl_load.c
+++ b/src/common/rendering/gl_load/gl_load.c
@@ -18,7 +18,7 @@ static void* AppleGLGetProcAddress (const char *name)
 #endif /* __APPLE__ */
 
 /* BEGINNING OF MANUAL CHANGES, DO NOT REMOVE! */
-#if defined(__sgi) || defined (__sun) || defined(__unix__)
+#if defined(__sgi) || defined (__sun) || defined(__unix__) || defined(__HAIKU__)
 #include <dlfcn.h>
 #include <stdio.h>
 
@@ -125,7 +125,7 @@ static PROC WinGetProcAddress(const char *name)
 	#if defined(__APPLE__)
 		#define IntGetProcAddress(name) AppleGLGetProcAddress(name)
 	#else
-		#if defined(__sgi) || defined(__sun) || defined(__unix__)
+		#if defined(__sgi) || defined(__sun) || defined(__unix__) || defined(__HAIKU__)
 			void* SDL_GL_GetProcAddress(const char* proc);
 			#define IntGetProcAddress(name) SDL_GL_GetProcAddress((const char*)name)
 			//#define IntGetProcAddress(name) PosixGetProcAddress((const GLubyte*)name)
diff --git a/src/common/utility/gitinfo.cpp b/src/common/utility/gitinfo.cpp
index 4ef00dc..111c05c 100644
--- a/src/common/utility/gitinfo.cpp
+++ b/src/common/utility/gitinfo.cpp
@@ -54,12 +54,12 @@ const char *GetGitTime()
 
 const char *GetVersionString()
 {
-	if (GetGitDescription()[0] == '\0')
+	//if (GetGitDescription()[0] == '\0')
 	{
 		return VERSIONSTR;
 	}
-	else
+	/*else
 	{
 		return GIT_DESCRIPTION;
-	}
+	}*/
 }
diff --git a/src/gameconfigfile.cpp b/src/gameconfigfile.cpp
index 15a03f8..5ab910f 100644
--- a/src/gameconfigfile.cpp
+++ b/src/gameconfigfile.cpp
@@ -107,6 +107,14 @@ FGameConfigFile::FGameConfigFile ()
 		SetSection ("IWADSearch.Directories", true);
 		SetValueForKey ("Path", ".", true);
 		SetValueForKey ("Path", "$DOOMWADDIR", true);
+		SetValueForKey ("Path", "$HOME/config/non-packaged/data/doomdata", true);
+		SetValueForKey ("Path", "$HOME/config/non-packaged/data/doom", true);
+		SetValueForKey ("Path", "$HOME/config/non-packaged/data/lzdoom", true);
+		SetValueForKey ("Path", "/boot/system/data/doomdata", true);
+		SetValueForKey ("Path", "/boot/system/data/lzdoom", true);
+		SetValueForKey ("Path", "/boot/system/non-packaged/data/doomdata", true);
+		SetValueForKey ("Path", "$HOME/config/data/doomdata", true);
+		SetValueForKey ("Path", "$HOME/config/data/lzdoom", true);
 #ifdef __APPLE__
 		SetValueForKey ("Path", user_docs.GetChars(), true);
 		SetValueForKey ("Path", user_app_support.GetChars(), true);
@@ -132,6 +141,14 @@ FGameConfigFile::FGameConfigFile ()
 	if (!SetSection ("FileSearch.Directories"))
 	{
 		SetSection ("FileSearch.Directories", true);
+		SetValueForKey ("Path", "$HOME/config/non-packaged/data/doomdata", true);
+		SetValueForKey ("Path", "$HOME/config/non-packaged/data/doom", true);
+		SetValueForKey ("Path", "$HOME/config/non-packaged/data/lzdoom", true);
+		SetValueForKey ("Path", "/boot/system/data/doomdata", true);
+		SetValueForKey ("Path", "/boot/system/data/lzdoom", true);
+		SetValueForKey ("Path", "/boot/system/non-packaged/data/doomdata", true);
+		SetValueForKey ("Path", "$HOME/config/data/doomdata", true);
+		SetValueForKey ("Path", "$HOME/config/data/lzdoom", true);
 #ifdef __APPLE__
 		SetValueForKey ("Path", user_docs.GetChars(), true);
 		SetValueForKey ("Path", user_app_support.GetChars(), true);
@@ -155,6 +173,10 @@ FGameConfigFile::FGameConfigFile ()
 	if (!SetSection("SoundfontSearch.Directories"))
 	{
 		SetSection("SoundfontSearch.Directories", true);
+		SetValueForKey ("Path", "/boot/system/data/lzdoom/soundfonts", true);
+		SetValueForKey ("Path", "/boot/system/data/lzdoom/fm_banks", true);
+		SetValueForKey ("Path", "$HOME/config/data/lzdoom/soundfonts", true);
+		SetValueForKey ("Path", "$HOME/config/data/lzdoom/fm_banks", true);
 #ifdef __APPLE__
 		SetValueForKey("Path", (user_docs + "/soundfonts").GetChars(), true);
 		SetValueForKey("Path", (user_docs + "/fm_banks").GetChars(), true);
diff --git a/src/version.h b/src/version.h
index 9f8326f..becd527 100644
--- a/src/version.h
+++ b/src/version.h
@@ -107,6 +107,8 @@ const char *GetVersionString();
 
 #if defined(__APPLE__) || defined(_WIN32)
 #define GAME_DIR GAMENAME
+#elif defined(__HAIKU__)
+#define GAME_DIR "config/settings/" GAMENAME
 #else
 #define GAME_DIR ".config/" GAMENAMELOWERCASE
 #endif
-- 
2.51.0


From 28ea63726322fa26c369ba4a2b01c286c2d27eb7 Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Sun, 2 Nov 2025 19:55:54 +0100
Subject: More patches ported from GZDoom


diff --git a/CMakeLists.txt b/CMakeLists.txt
index c074c4c..255096a 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -309,7 +309,7 @@ else()
 			# If we're compiling with a custom GCC on the Mac (which we know since g++-4.2 doesn't support C++11) statically link libgcc.
 			set( ALL_C_FLAGS "-static-libgcc" )
 		endif()
-	elseif( NOT MINGW )
+	elseif( NOT MINGW AND NOT HAIKU)
 		# Generic GCC/Clang requires position independent executable to be enabled explicitly
 		set( ALL_C_FLAGS "${ALL_C_FLAGS} -fPIE" )
 		set( CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -pie" )
diff --git a/libraries/ZVulkan/CMakeLists.txt b/libraries/ZVulkan/CMakeLists.txt
index 3b47b7b..4cd7133 100644
--- a/libraries/ZVulkan/CMakeLists.txt
+++ b/libraries/ZVulkan/CMakeLists.txt
@@ -188,7 +188,11 @@ if(WIN32)
 	add_definitions(-DUNICODE -D_UNICODE)
 else()
 	set(ZVULKAN_SOURCES ${ZVULKAN_SOURCES} ${ZVULKAN_UNIX_SOURCES})
-	set(ZVULKAN_LIBS ${CMAKE_DL_LIBS} -ldl)
+	if(NOT HAIKU)
+		set(ZVULKAN_LIBS ${CMAKE_DL_LIBS} -ldl)
+	else()
+		set(ZVULKAN_LIBS ${CMAKE_DL_LIBS})
+	endif()
 	add_definitions(-DUNIX -D_UNIX)
 	add_link_options(-pthread)
 endif()
diff --git a/src/common/engine/i_specialpaths.h b/src/common/engine/i_specialpaths.h
index 01710b6..fb75230 100644
--- a/src/common/engine/i_specialpaths.h
+++ b/src/common/engine/i_specialpaths.h
@@ -2,7 +2,7 @@
 
 #include "zstring.h"
 
-#ifdef __unix__
+#if defined(__unix__) || defined(__HAIKU__)
 FString GetUserFile (const char *path);
 #endif
 FString M_GetAppDataPath(bool create);
-- 
2.51.0


From 4048dc2916cbea65f5ed64236ac34d4804cfbb6b Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Mon, 3 Nov 2025 12:54:32 +0100
Subject: Replaxe xdg-open with open


diff --git a/src/common/platform/posix/sdl/i_system.cpp b/src/common/platform/posix/sdl/i_system.cpp
index 58a6a2f..dd2b659 100644
--- a/src/common/platform/posix/sdl/i_system.cpp
+++ b/src/common/platform/posix/sdl/i_system.cpp
@@ -452,7 +452,11 @@ void I_OpenShellFolder(const char* infolder)
 	if (!chdir(infolder))
 	{
 		Printf("Opening folder: %s\n", infolder);
-		std::system("xdg-open .");
+		#ifdef __HAIKU__
+			std::system("open .");
+		#else
+			std::system("xdg-open .");
+		#endif
 		chdir(curdir);
 	}
 	else
-- 
2.51.0

