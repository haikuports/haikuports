From fb045a3e74efb9c07dbb95bce7d9666433c646a4 Mon Sep 17 00:00:00 2001
From: Gerasim Troeglazov <3dEyes@gmail.com>
Date: Wed, 30 Oct 2019 21:24:04 +1000
Subject: Haiku fixes


diff --git a/source/common/rendering/gl_load/gl_load.c b/source/common/rendering/gl_load/gl_load.c
index d5ba4e4..bb2141e 100644
--- a/source/common/rendering/gl_load/gl_load.c
+++ b/source/common/rendering/gl_load/gl_load.c
@@ -134,7 +134,7 @@ static PROC WinGetProcAddress(const char *name)
 	#if defined(__APPLE__)
 		#define IntGetProcAddress(name) AppleGLGetProcAddress(name)
 	#else
-		#if defined(__sgi) || defined(__sun) || defined(__unix__)
+		#if defined(__sgi) || defined(__sun) || defined(__unix__) || defined(__HAIKU__)
 			void* SDL_GL_GetProcAddress(const char* proc);
 			#define IntGetProcAddress(name) SDL_GL_GetProcAddress((const char*)name)
 			//#define IntGetProcAddress(name) PosixGetProcAddress((const GLubyte*)name)
-- 
2.48.1


From 8a17230155066a51b7ffa2a16c42d521e46a56fd Mon Sep 17 00:00:00 2001
From: Gerasim Troeglazov <3dEyes@gmail.com>
Date: Thu, 31 Oct 2019 21:22:03 +1000
Subject: Fix GAME_DIR for Haiku


diff --git a/source/core/version.h b/source/core/version.h
index 3b81904..0e60791 100644
--- a/source/core/version.h
+++ b/source/core/version.h
@@ -86,6 +86,8 @@ const char *GetVersionString();
 
 #if defined(__APPLE__) || defined(_WIN32)
 #define GAME_DIR GAMENAMELOWERCASE
+#elif defined(__HAIKU__)
+#define GAME_DIR "config/settings/" GAMENAME
 #else
 #define GAME_DIR ".config/" GAMENAMELOWERCASE
 #endif
-- 
2.48.1


From 00cdae09045a2f4c74c72758b89773f685e9cbf6 Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Sat, 29 Mar 2025 04:16:15 +0100
Subject: More Haiku fixes


diff --git a/source/common/engine/i_specialpaths.h b/source/common/engine/i_specialpaths.h
index 01710b6..fb75230 100644
--- a/source/common/engine/i_specialpaths.h
+++ b/source/common/engine/i_specialpaths.h
@@ -2,7 +2,7 @@
 
 #include "zstring.h"
 
-#ifdef __unix__
+#if defined(__unix__) || defined(__HAIKU__)
 FString GetUserFile (const char *path);
 #endif
 FString M_GetAppDataPath(bool create);
-- 
2.48.1


From 4d151b828b85f296fec937ba03d65c30fb9177f6 Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Wed, 2 Apr 2025 16:31:04 +0200
Subject: Disable Git version string as it is incorrect


diff --git a/source/common/utility/gitinfo.cpp b/source/common/utility/gitinfo.cpp
index 4ef00dc..111c05c 100644
--- a/source/common/utility/gitinfo.cpp
+++ b/source/common/utility/gitinfo.cpp
@@ -54,12 +54,12 @@ const char *GetGitTime()
 
 const char *GetVersionString()
 {
-	if (GetGitDescription()[0] == '\0')
+	//if (GetGitDescription()[0] == '\0')
 	{
 		return VERSIONSTR;
 	}
-	else
+	/*else
 	{
 		return GIT_DESCRIPTION;
-	}
+	}*/
 }
-- 
2.48.1


From 298e1f1ff955c2c5539672449385505616a1c48e Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Thu, 3 Apr 2025 05:00:31 +0200
Subject: Better CMake patch


diff --git a/libraries/ZVulkan/CMakeLists.txt b/libraries/ZVulkan/CMakeLists.txt
index 3b47b7b..4cd7133 100644
--- a/libraries/ZVulkan/CMakeLists.txt
+++ b/libraries/ZVulkan/CMakeLists.txt
@@ -188,7 +188,11 @@ if(WIN32)
 	add_definitions(-DUNICODE -D_UNICODE)
 else()
 	set(ZVULKAN_SOURCES ${ZVULKAN_SOURCES} ${ZVULKAN_UNIX_SOURCES})
-	set(ZVULKAN_LIBS ${CMAKE_DL_LIBS} -ldl)
+	if(NOT HAIKU)
+		set(ZVULKAN_LIBS ${CMAKE_DL_LIBS} -ldl)
+	else()
+		set(ZVULKAN_LIBS ${CMAKE_DL_LIBS})
+	endif()
 	add_definitions(-DUNIX -D_UNIX)
 	add_link_options(-pthread)
 endif()
diff --git a/libraries/ZWidget/CMakeLists.txt b/libraries/ZWidget/CMakeLists.txt
index 68c048e..329caf9 100644
--- a/libraries/ZWidget/CMakeLists.txt
+++ b/libraries/ZWidget/CMakeLists.txt
@@ -130,7 +130,11 @@ elseif(APPLE)
 	add_link_options(-pthread)
 else()
 	set(ZWIDGET_SOURCES ${ZWIDGET_SOURCES} ${ZWIDGET_SDL2_SOURCES})
-	set(ZWIDGET_LIBS ${CMAKE_DL_LIBS} -ldl)
+	if(NOT HAIKU)
+		set(ZWIDGET_LIBS ${CMAKE_DL_LIBS} -ldl)
+	else()
+		set(ZWIDGET_LIBS ${CMAKE_DL_LIBS})
+	endif()
 	add_definitions(-DUNIX -D_UNIX)
 	add_link_options(-pthread)
 endif()
-- 
2.48.1


From 3a8bb765175794813bd04c965ff9ec7fb0da9478 Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Thu, 3 Apr 2025 15:10:35 +0200
Subject: Raze-specific patches


diff --git a/CMakeLists.txt b/CMakeLists.txt
index bc69823..0ddc6f2 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -321,7 +321,7 @@ else()
 
 	if ( UNIX )
 		include(CheckSymbolExists)
-		check_symbol_exists( "fts_set" "fts.h" HAVE_FTS )
+		check_symbol_exists( "fts_set" "sys/types.h;sys/stat.h;fts.h" HAVE_FTS )
 		if ( NOT HAVE_FTS )
 			include ( FindPkgConfig )
 			pkg_check_modules( MUSL_FTS musl-fts )
@@ -343,7 +343,7 @@ else()
 			# If we're compiling with a custom GCC on the Mac (which we know since g++-4.2 doesn't support C++11) statically link libgcc.
 			set( ALL_C_FLAGS "-static-libgcc" )
 		endif()
-	elseif( NOT MINGW )
+	elseif( NOT MINGW AND NOT HAIKU )
 		# Generic GCC/Clang requires position independent executable to be enabled explicitly
 		set( ALL_C_FLAGS "${ALL_C_FLAGS} -fPIE" )
 		set( CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -pie" )
diff --git a/source/core/gameconfigfile.cpp b/source/core/gameconfigfile.cpp
index c99c6bc..5686e6b 100644
--- a/source/core/gameconfigfile.cpp
+++ b/source/core/gameconfigfile.cpp
@@ -78,6 +78,10 @@ FGameConfigFile::FGameConfigFile ()
 		SetSection ("GameSearch.Directories", true);
 		SetValueForKey ("Path", ".", true);
 		SetValueForKey ("Path", "./*", true);
+		SetValueForKey ("Path", "/boot/home/config/non-packaged/data/raze/data", true);
+		SetValueForKey ("Path", "/boot/home/config/non-packaged/data/raze/blood", true);
+		SetValueForKey ("Path", "/boot/home/config/non-packaged/data/raze", true);
+		SetValueForKey ("Path", "/boot/system/data/raze", true);
 #ifdef __APPLE__
 		SetValueForKey ("Path", user_docs + "/*", true);
 		SetValueForKey ("Path", user_app_support + "/EDuke32", true);
@@ -132,6 +136,10 @@ FGameConfigFile::FGameConfigFile ()
 	if (!SetSection ("FileSearch.Directories"))
 	{
 		SetSection ("FileSearch.Directories", true);
+		SetValueForKey ("Path", "/boot/home/config/non-packaged/data/raze/data", true);
+		SetValueForKey ("Path", "/boot/home/config/non-packaged/data/raze/blood", true);
+		SetValueForKey ("Path", "/boot/home/config/non-packaged/data/raze", true);
+		SetValueForKey ("Path", "/boot/system/data/raze", true);
 #ifdef __APPLE__
 		SetValueForKey ("Path", user_docs, true);
 		SetValueForKey ("Path", user_app_support + "/" GAME_DIR, true);
@@ -163,6 +171,7 @@ FGameConfigFile::FGameConfigFile ()
 	if (!SetSection("SoundfontSearch.Directories"))
 	{
 		SetSection("SoundfontSearch.Directories", true);
+		SetValueForKey ("Path", "/boot/system/data/raze/soundfonts", true);
 #ifdef __APPLE__
 		SetValueForKey("Path", user_docs + "/soundfonts", true);
 		SetValueForKey("Path", user_app_support +  "/" GAME_DIR "/soundfonts", true);
-- 
2.48.1


From 79fa974b44c1598c172d5f05246e591fdfc86e94 Mon Sep 17 00:00:00 2001
From: Peppersawce <michaelpeppers89@yahoo.it>
Date: Thu, 3 Apr 2025 16:50:12 +0200
Subject: Do not use .config


diff --git a/source/common/platform/posix/unix/i_specialpaths.cpp b/source/common/platform/posix/unix/i_specialpaths.cpp
index 112e92e..fb4d4c7 100644
--- a/source/common/platform/posix/unix/i_specialpaths.cpp
+++ b/source/common/platform/posix/unix/i_specialpaths.cpp
@@ -112,7 +112,11 @@ FString M_GetAppDataPath(bool create)
 {
 	// Don't use GAME_DIR and such so that ZDoom and its child ports can
 	// share the node cache.
-	FString path = NicePath("$HOME/.config/" GAMENAMELOWERCASE);
+	#if defined(__HAIKU__)
+		FString path = NicePath("$HOME/config/settings/" GAMENAME);
+	#else
+		FString path = NicePath("$HOME/.config/" GAMENAMELOWERCASE);
+	#endif
 	if (create)
 	{
 		CreatePath(path.GetChars());
-- 
2.48.1
