SUMMARY="Doom source port that accurately reproduces the experience of Doom"
DESCRIPTION="Chocolate Doom is a source port of the game Doom, by id Software. \
The purpose of Chocolate Doom is to be as compatible as possible with the \
original DOS version of Doom."
HOMEPAGE="https://www.chocolate-doom.org/"
COPYRIGHT="1993-1996, Id Software, Inc
	1993-2008, Raven Software
	1996, Rogue Entertainment / Velocity, Inc.
	1996-2013, Free Software Foundation, Inc
	1999, Thomas A. Fine
	2002-2003, Marcel Telka
	2002-2010, The DOSBox Team
	2005-2014, Simon Howard
	2005-2014, Andrey Budko
	2006, Ben Ryves
	2008, GhostlyDeath
	2008, David Flater
	2010, James Haley, Samuel Villarreal
	2011, Team Eternity
	2014, Fabian Greffrath"
LICENSE="GNU GPL v2
	BSD (3-clause)"
REVISION="1"
SOURCE_URI="https://www.chocolate-doom.org/downloads/$portVersion/chocolate-doom-$portVersion.tar.gz"
CHECKSUM_SHA256="73aea623930c7d18a7a778eea391e1ddfbe90ad1ac40a91b380afca4b0e1dab8"
SOURCE_DIR="chocolate-doom-$portVersion"
ADDITIONAL_FILES="
	chocolate_doom.png
	chocolate_doom.rdef.in"

ARCHITECTURES="!x86_gcc2 ?x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

commandSuffix=$secondaryArchSuffix
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
	commandSuffix=
	commandBinDir=$prefix/bin
fi



PROVIDES="
	chocolate_doom$commandSuffix = $portVersion
	cmd:chocolate_doom$commandSuffix = $portVersion
	cmd:chocolate_doom_setup$commandSuffix = $portVersion
	cmd:chocolate_heretic_setup$commandSuffix = $portVersion
	cmd:chocolate_heretic$commandSuffix = $portVersion
	cmd:chocolate_hexen_setup$commandSuffix = $portVersion
	cmd:chocolate_hexen$commandSuffix = $portVersion
	cmd:chocolate_server$commandSuffix = $portVersion
	cmd:chocolate_setup$commandSuffix = $portVersion
	cmd:chocolate_strife_setup$commandSuffix = $portVersion
	cmd:chocolate_strife$commandSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libSDL2_2.0$secondaryArchSuffix
	lib:libSDL2_mixer_2.0$secondaryArchSuffix
	lib:libSDL2_net_2.0$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libsdl2$secondaryArchSuffix
	devel:libsdl2_mixer$secondaryArchSuffix
	devel:libsdl2_net$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:gcc$secondaryArchSuffix
	cmd:install
	cmd:ld$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	cmd:python
	cmd:sed
	"
	
defineDebugInfoPackage chocolate_doom \
	$commandBinDir/chocolate-doom$commandSuffix \
	$commandBinDir/chocolate-doom-setup$commandSuffix \
	$commandBinDir/chocolate-heretic-setup$commandSuffix \
	$commandBinDir/chocolate-heretic$commandSuffix \
	$commandBinDir/chocolate-hexen-setup$commandSuffix \
	$commandBinDir/chocolate-hexen$commandSuffix \
	$commandBinDir/chocolate-server$commandSuffix \
	$commandBinDir/chocolate-setup$commandSuffix \
	$commandBinDir/chocolate-strife-setup$commandSuffix \
	$commandBinDir/chocolate-strife$commandSuffix

BUILD ()
{
	runConfigure --omit-dirs binDir ./configure --bindir $commandBinDir
	make $jobArgs
}

INSTALL()
{
	# dir with compiled binaries
	cd src

	# Add Haiku resources before moving binaries to destination
	local APP_SIGNATURE="application/x-vnd.chocolatedoom"
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	sed \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		$portDir/additional-files/chocolate_doom.rdef.in > chocolate_doom.rdef

	addResourcesToBinaries chocolate_doom.rdef chocolate-doom

	install -d $commandBinDir
	install -t $commandBinDir \
		chocolate-doom \
		chocolate-doom-setup \
		chocolate-hexen \
		chocolate-hexen-setup \
		chocolate-heretic \
		chocolate-heretic-setup \
		chocolate-server \
		chocolate-setup \
		chocolate-strife-setup \
		chocolate-strife
}
