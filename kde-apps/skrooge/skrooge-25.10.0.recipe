SUMMARY="A powerful manager for personal finances"
DESCRIPTION="Skrooge is a personal finance manager powered by KDE that aims to be simple and \
intuitive. Skrooge allows you to keep track of your expenses and income, categorize them, and \
build reports of them.

Features:

* QIF, CSV, SKROOGE, KMYMONEY import/export
* Microsoft Money, OFX, QFX, MT940, GNUCASH, GRISBI, HOMEBANK and MONEY MANAGER EX import
* Advanced Graphical Reports
* Multiple tabs to help you organize your work
* Infinite undo/redo (even after the file was closed !)
* Instant filtering on transactions and reports
* Infinite category levels
* Mass update of transactions
* Scheduled transactions
* Track refund of your expenses
* Automatically process transactions based on search conditions
* Multiple currencies"
HOMEPAGE="https://skrooge.org/"
COPYRIGHT="2007-2025 Stephane MANKOWSKI & Guillaume DE BURE"
LICENSE="GNU GPL v3"
REVISION="2"
SOURCE_URI="https://download.kde.org/stable/skrooge/skrooge-$portVersion.tar.xz"
CHECKSUM_SHA256="9040968b9feadab7813acf43aee6cecf956897702403b957cce2ed6e0c761e51"
SOURCE_DIR="skrooge-$portVersion"
ADDITIONAL_FILES="skrooge.rdef.in"

ARCHITECTURES="?all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

libVersion="$portVersion"
libVersionCompat="$libVersion compat >= ${libVersion%%.*}"

PROVIDES="
	skrooge$secondaryArchSuffix = $portVersion
	cmd:skrooge$secondaryArchSuffix = $portVersion
	cmd:skroogeconvert$secondaryArchSuffix = $portVersion
	lib:libskgbankgui$secondaryArchSuffix = $libVersionCompat
	lib:libskgbankmodeler$secondaryArchSuffix = $libVersionCompat
	lib:libskgbasegui$secondaryArchSuffix = $libVersionCompat
	lib:libskgbasemodeler$secondaryArchSuffix = $libVersionCompat
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libGL$secondaryArchSuffix
	# KF6
	lib:libKF6Bookmarks$secondaryArchSuffix
	lib:libKF6Codecs$secondaryArchSuffix
	lib:libKF6ColorScheme$secondaryArchSuffix
	lib:libKF6Completion$secondaryArchSuffix
	lib:libKF6ConfigCore$secondaryArchSuffix
	lib:libKF6ConfigGui$secondaryArchSuffix
	lib:libKF6ConfigWidgets$secondaryArchSuffix
	lib:libKF6CoreAddons$secondaryArchSuffix
	lib:libKF6DbusAddons$secondaryArchSuffix
	lib:libKF6GuiAddons$secondaryArchSuffix
	lib:libKF6I18n$secondaryArchSuffix
	lib:libKF6IconThemes$secondaryArchSuffix
	lib:libKF6ItemViews$secondaryArchSuffix
	lib:libKF6KIOCore$secondaryArchSuffix
	lib:libKF6JobWidgets$secondaryArchSuffix
	lib:libKF6Notifications$secondaryArchSuffix
	lib:libKF6NotifyConfig$secondaryArchSuffix
	lib:libKF6Parts$secondaryArchSuffix
	lib:libKF6Service$secondaryArchSuffix
	lib:libKF6Solid$secondaryArchSuffix
	lib:libKF6SonnetCore$secondaryArchSuffix
	lib:libKF6TextTemplate$secondaryArchSuffix
	lib:libKF6TextWidgets$secondaryArchSuffix
	lib:libKF6WidgetsAddons$secondaryArchSuffix
	lib:libKF6WindowSystem$secondaryArchSuffix
	lib:libKF6XmlGui$secondaryArchSuffix
	lib:libqca_Qt6$secondaryArchSuffix
	# Plasma6
	lib:libPlasmaActivities$secondaryArchSuffix
	# Qt6
	lib:libQt6Core$secondaryArchSuffix
	lib:libQt6Core5Compat$secondaryArchSuffix
	lib:libQt6Concurrent$secondaryArchSuffix
	lib:libQt6DBus$secondaryArchSuffix
	lib:libQt6Gui$secondaryArchSuffix
	lib:libQt6Network$secondaryArchSuffix
	lib:libQt6Qml$secondaryArchSuffix
	lib:libQt6Quick$secondaryArchSuffix
	lib:libQt6Sql$secondaryArchSuffix
	lib:libQt6Svg$secondaryArchSuffix
#	lib:libQt6Webengine$secondaryArchSuffix
	lib:libQt6Widgets$secondaryArchSuffix
	lib:libQt6Xml$secondaryArchSuffix
	lib:libsqlcipher$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libqca_qt6$secondaryArchSuffix
	devel:libsqlcipher$secondaryArchSuffix
	devel:libsqlite3$secondaryArchSuffix
	# KF6
	extra_cmake_modules$secondaryArchSuffix
	devel:libKF6Archive$secondaryArchSuffix
	devel:libKF6Attica$secondaryArchSuffix
	devel:libKF6Bookmarks$secondaryArchSuffix
	devel:libKF6Codecs$secondaryArchSuffix
	devel:libKF6Completion$secondaryArchSuffix
	devel:libKF6ConfigCore$secondaryArchSuffix
	devel:libKF6ConfigWidgets$secondaryArchSuffix
	devel:libKF6CoreAddons$secondaryArchSuffix
	devel:libKF6DbusAddons$secondaryArchSuffix
	devel:libKF6GuiAddons$secondaryArchSuffix
	devel:libKF6I18n$secondaryArchSuffix
	devel:libKF6IconThemes$secondaryArchSuffix
	devel:libKF6ItemViews$secondaryArchSuffix
	devel:libKF6JobWidgets$secondaryArchSuffix
	devel:libKF6KIOCore$secondaryArchSuffix
	devel:libKF6NewStuffCore$secondaryArchSuffix
	devel:libKF6Notifications$secondaryArchSuffix
	devel:libKF6NotifyConfig$secondaryArchSuffix
	devel:libKF6Package$secondaryArchSuffix
	devel:libKF6Parts$secondaryArchSuffix
	devel:libKF6Service$secondaryArchSuffix
	devel:libKF6Solid$secondaryArchSuffix
	devel:libKF6SonnetCore$secondaryArchSuffix
	devel:libKF6StatusNotifierItem$secondaryArchSuffix
	devel:libKF6TextTemplate$secondaryArchSuffix
	devel:libKF6TextWidgets$secondaryArchSuffix
	devel:libKF6Wallet$secondaryArchSuffix
	devel:libKF6WidgetsAddons$secondaryArchSuffix
	devel:libKF6WindowSystem$secondaryArchSuffix
	devel:libKF6XmlGui$secondaryArchSuffix
	# Plasma6
	devel:libPlasmaActivities$secondaryArchSuffix
	# Qt6
	devel:libQt6Core$secondaryArchSuffix
	devel:libQt6Core5Compat$secondaryArchSuffix
	devel:libQt6Svg$secondaryArchSuffix
#	devel:libQt6Webengine$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:g++$secondaryArchSuffix
	cmd:make
	cmd:msgfmt$secondaryArchSuffix
	cmd:msgmerge$secondaryArchSuffix
	cmd:pkg_config$secondaryArchSuffix
	"

TEST_REQUIRES="
	qt6_haikuplugins$secondaryArchSuffix
	"

BUILD()
{
	cmake -B build -S . -DCMAKE_BUILD_TYPE=Release \
		$cmakeDirArgs \
		-DSKG_DBUS=OFF \
		-DSKG_WEBENGINE=OFF \
		-DBUILD_TESTING=OFF \
		-Wno-dev

	make -C build $jobArgs
}

INSTALL()
{
	make -C build install

	# don't mess with shared_mime_info files
	rm -rf $dataDir/mime/{aliases,generic-icons,globs,globs2,icons,magic}
	rm -rf $dataDir/mime/{mime.cache,subclasses,treemagic,types,version,XMLnamespaces}
	# cleanup
	rm -rf $dataDir/{applications,config.kcfg,icons,knotifications6,knsrcfiles,metainfo}

	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	local APP_NAME="Skrooge"
	local LONG_INFO="$SUMMARY"
	local APP_SIGNATURE="application/x-vnd.kde-skrooge"
	sed \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@LONG_INFO@|$LONG_INFO|" \
		-e "s|@APP_NAME@|$APP_NAME|" \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		$portDir/additional-files/skrooge.rdef.in > skrooge.rdef

	addResourcesToBinaries skrooge.rdef $binDir/skrooge

	addAppDeskbarSymlink $binDir/skrooge Skrooge
}

TEST()
{
	# 17% tests passed, 59 tests failed out of 71
	ctest --test-dir build --output-on-failure
}
