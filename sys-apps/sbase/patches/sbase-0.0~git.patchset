From e4a2bf2c2093e6ab6ebf82a11d031604dbfe2306 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zolt=C3=A1n=20Mizsei?= <zmizsei@extrowerk.com>
Date: Mon, 11 Jul 2022 21:30:22 +0200
Subject: Fix build for ls.c


diff --git a/ls.c b/ls.c
index aa95fef..54d71c8 100644
--- a/ls.c
+++ b/ls.c
@@ -1,9 +1,11 @@
 /* See LICENSE file for copyright and license details. */
 #include <sys/stat.h>
 #include <sys/types.h>
+#ifndef __HAIKU__
 #ifndef major
 #include <sys/sysmacros.h>
 #endif
+#endif
 
 #include <dirent.h>
 #include <grp.h>
@@ -17,6 +19,15 @@
 #include "utf.h"
 #include "util.h"
 
+#ifdef __HAIKU__
+#include "limits.h"
+#define _SC_LOGIN_NAME_MAX _POSIX_LOGIN_NAME_MAX
+
+/* Replacement for major/minor. */
+#define	major(x) ((int)(0x00ff & ((x) >> 8)))
+#define	minor(x) ((int)(0xffff00ff & (x)))
+#endif
+
 struct entry {
 	char   *name;
 	mode_t  mode, tmode;
-- 
2.36.1


From 9f5273e5284b2f09335fed01c3be77b59cdd40a0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zolt=C3=A1n=20Mizsei?= <zmizsei@extrowerk.com>
Date: Mon, 11 Jul 2022 21:31:48 +0200
Subject: Link against -lbsd


diff --git a/config.mk b/config.mk
index 9fb18da..717abb0 100644
--- a/config.mk
+++ b/config.mk
@@ -13,4 +13,4 @@ RANLIB = ranlib
 # -lrt might be needed on some systems
 CPPFLAGS = -D_DEFAULT_SOURCE -D_BSD_SOURCE -D_XOPEN_SOURCE=700 -D_FILE_OFFSET_BITS=64
 CFLAGS   = -std=c99 -Wall -pedantic
-LDFLAGS  = -s
+LDFLAGS  = -s -lbsd
-- 
2.36.1


From 9971a7350372a05c6515a56312632324f5bb78bc Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zolt=C3=A1n=20Mizsei?= <zmizsei@extrowerk.com>
Date: Mon, 11 Jul 2022 21:39:41 +0200
Subject: Remove -predantic to fix build


diff --git a/config.mk b/config.mk
index 717abb0..7178e65 100644
--- a/config.mk
+++ b/config.mk
@@ -12,5 +12,5 @@ RANLIB = ranlib
 # for NetBSD add -D_NETBSD_SOURCE
 # -lrt might be needed on some systems
 CPPFLAGS = -D_DEFAULT_SOURCE -D_BSD_SOURCE -D_XOPEN_SOURCE=700 -D_FILE_OFFSET_BITS=64
-CFLAGS   = -std=c99 -Wall -pedantic
+CFLAGS   = -std=c99 -Wall
 LDFLAGS  = -s -lbsd
-- 
2.36.1


From 1e38f736dea8d6ac939b29666419d75f4fc56f6f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zolt=C3=A1n=20Mizsei?= <zmizsei@extrowerk.com>
Date: Mon, 11 Jul 2022 21:39:59 +0200
Subject: Fix logger.c build


diff --git a/logger.c b/logger.c
index 603da04..14f04f6 100644
--- a/logger.c
+++ b/logger.c
@@ -9,6 +9,7 @@
 
 #include "util.h"
 
+#ifndef __HAIKU__
 static int
 decodetable(CODE *table, char *name)
 {
@@ -36,6 +37,7 @@ decodepri(char *pri)
 	return (decodetable(facilitynames, fac) & LOG_FACMASK) |
 	       (decodetable(prioritynames, lev) & LOG_PRIMASK);
 }
+#endif
 
 static void
 usage(void)
@@ -54,9 +56,11 @@ main(int argc, char *argv[])
 	case 'i':
 		logflags |= LOG_PID;
 		break;
+#ifndef __HAIKU__
 	case 'p':
 		priority = decodepri(EARGF(usage()));
 		break;
+#endif
 	case 's':
 		logflags |= LOG_PERROR;
 		break;
-- 
2.36.1


From 25fc45c74c6e824c11e49c3000d6fadef226f744 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zolt=C3=A1n=20Mizsei?= <zmizsei@extrowerk.com>
Date: Mon, 11 Jul 2022 21:42:08 +0200
Subject: Fix build of mknod.c


diff --git a/mknod.c b/mknod.c
index a519ecb..f7c67b6 100644
--- a/mknod.c
+++ b/mknod.c
@@ -1,9 +1,11 @@
 /* See LICENSE file for copyright and license details. */
 #include <sys/stat.h>
 #include <sys/types.h>
+#ifndef __HAIKU__
 #ifndef makedev
 #include <sys/sysmacros.h>
 #endif
+#endif
 
 #include <fcntl.h>
 #include <stdio.h>
@@ -13,6 +15,13 @@
 
 #include "util.h"
 
+#ifdef __HAIKU__
+/* Replacement for major/minor. */
+#define	major(x) ((int)(0x00ff & ((x) >> 8)))
+#define	minor(x) ((int)(0xffff00ff & (x)))
+#define	makedev(maj,min) ((0xff00 & ((maj)<<8)) | (0xffff00ff & (min)))
+#endif
+
 static void
 usage(void)
 {
-- 
2.36.1


From 16713473e6b6be1f24181ce5f6582b85cdeef9f1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zolt=C3=A1n=20Mizsei?= <zmizsei@extrowerk.com>
Date: Mon, 11 Jul 2022 21:43:47 +0200
Subject: Fix tar.c build


diff --git a/tar.c b/tar.c
index d3a9f3b..b69b7f6 100644
--- a/tar.c
+++ b/tar.c
@@ -2,9 +2,11 @@
 #include <sys/stat.h>
 #include <sys/time.h>
 #include <sys/types.h>
+#ifndef __HAIKU__
 #ifndef major
 #include <sys/sysmacros.h>
 #endif
+#endif
 
 #include <errno.h>
 #include <fcntl.h>
@@ -19,6 +21,13 @@
 #include "fs.h"
 #include "util.h"
 
+#ifdef __HAIKU__
+/* Replacement for major/minor. */
+#define	major(x) ((int)(0x00ff & ((x) >> 8)))
+#define	minor(x) ((int)(0xffff00ff & (x)))
+#define	makedev(maj,min) ((0xff00 & ((maj)<<8)) | (0xffff00ff & (min)))
+#endif
+
 #define BLKSIZ 512
 
 enum Type {
-- 
2.36.1


From 93544561881e4d7d5e72eec0c67b24416db1fcb6 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zolt=C3=A1n=20Mizsei?= <zmizsei@extrowerk.com>
Date: Mon, 11 Jul 2022 21:43:59 +0200
Subject: Link against -lnetwork


diff --git a/config.mk b/config.mk
index 7178e65..794d47d 100644
--- a/config.mk
+++ b/config.mk
@@ -13,4 +13,4 @@ RANLIB = ranlib
 # -lrt might be needed on some systems
 CPPFLAGS = -D_DEFAULT_SOURCE -D_BSD_SOURCE -D_XOPEN_SOURCE=700 -D_FILE_OFFSET_BITS=64
 CFLAGS   = -std=c99 -Wall
-LDFLAGS  = -s -lbsd
+LDFLAGS  = -s -lbsd -lnetwork
-- 
2.36.1

