SUMMARY="The famous stream editor"
DESCRIPTION="Sed is a stream editor, i.e. it can be used to perform basic \
text transformations on an input stream (a file or input from a pipeline).
While in some ways similar to an editor which permits scripted edits (such as \
ed), sed works by making only one pass over the input(s), and is consequently \
more efficient. But it is sed's ability to filter text in a pipeline which \
particularly distinguishes it from other types of editors."
HOMEPAGE="https://www.gnu.org/software/sed/"
COPYRIGHT="1989-2018 Free Software Foundation, Inc."
LICENSE="GNU GPL v3"
REVISION="1"
SOURCE_URI="https://ftpmirror.gnu.org/sed/sed-$portVersion.tar.xz
	https://ftp.gnu.org/gnu/sed/sed-$portVersion.tar.xz"
CHECKSUM_SHA256="2885768cd0a29ff8d58a6280a270ff161f6a3deb5690b2be6c49f46d4c67bd6a"
PATCHES="sed-$portVersion.patchset"

ARCHITECTURES="!x86_gcc2 ?x86 ?x86_64 ?arm"
if [ "$targetArchitecture" = x86_gcc2 ]; then
SECONDARY_ARCHITECTURES="?x86"
fi

commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
	commandBinDir=$prefix/bin
fi

PROVIDES="
	sed$secondaryArchSuffix = $portVersion compat >= 4
	cmd:sed = $portVersion compat >= 4
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"
if [ -n "$secondaryArchSuffix" ]; then
CONFLICTS="
	sed
	"
fi

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:g++$secondaryArchSuffix
	cmd:grep
	cmd:ld$secondaryArchSuffix
	cmd:make
	"

TEST_REQUIRES="
	cmd:cmp
	"

defineDebugInfoPackage sed$secondaryArchSuffix \
	"$commandBinDir"/sed


BUILD()
{
	runConfigure --omit-dirs binDir ./configure --bindir="$commandBinDir" \
		--enable-regex-tests --without-included-regex \
		--disable-rpath --with-gnu-ld
	make $jobArgs
}

INSTALL()
{
	make install
}

TEST()
{
	# SKIP:	bug32082.sh, bug32271-2.sh, inplace-selinux.sh, invalid-mb-seq-UMR.sh, 
	#		newline-dfa-bug.sh, obinary.sh, regex-max-int.sh, 
	# FAIL:	misc.pl, debug.pl, panic-tests.sh, 
	#
	# TOTAL: 67
	# PASS:  57
	# SKIP:  7
	# XFAIL: 0
	# FAIL:  3
	# XPASS: 0
	# ERROR: 0

	make check
}
