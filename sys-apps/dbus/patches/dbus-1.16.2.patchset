From fbdec88a9078649585af82e354eb2f051dcc3a47 Mon Sep 17 00:00:00 2001
From: Jerome Duval <jerome.duval@gmail.com>
Date: Sat, 12 Dec 2020 14:44:55 +0100
Subject: Haiku: maximum 4096 fds


diff --git a/dbus/dbus-sysdeps-util-unix.c b/dbus/dbus-sysdeps-util-unix.c
index c1158c3..ef03b7b 100644
--- a/dbus/dbus-sysdeps-util-unix.c
+++ b/dbus/dbus-sysdeps-util-unix.c
@@ -418,7 +418,11 @@ _dbus_rlimit_save_fd_limit (DBusError *error)
 /* Enough fds that we shouldn't run out, even if several uids work
  * together to carry out a denial-of-service attack. This happens to be
  * the same number that systemd < 234 would normally use. */
+#ifdef __HAIKU__
+#define ENOUGH_FDS 4096
+#else
 #define ENOUGH_FDS 65536
+#endif
 
 dbus_bool_t
 _dbus_rlimit_raise_fd_limit (DBusError *error)
-- 
2.48.1


From 1fb71a4f2dbd932cc47fbfd159437d16aadcb51d Mon Sep 17 00:00:00 2001
From: Luc Schrijvers <begasus@gmail.com>
Date: Mon, 4 Aug 2025 13:19:46 +0200
Subject: Fix check for libnetwork


diff --git a/dbus/CMakeLists.txt b/dbus/CMakeLists.txt
index 04f9ca2..6e46500 100644
--- a/dbus/CMakeLists.txt
+++ b/dbus/CMakeLists.txt
@@ -259,8 +259,12 @@ endif()
 # for clock_getres() on e.g. GNU/Linux (but not Android)
 find_library(LIBRT rt)
 
-# for socket() on QNX
+# for socket() on QNX and HAIKU
+if(HAIKU)
+find_library(LIBSOCKET network)
+else()
 find_library(LIBSOCKET socket)
+endif()
 
 ### Client library
 add_library(dbus-1 SHARED
-- 
2.48.1


From ea5e184706b75f924a4d4c8da98a53b30c2e99f9 Mon Sep 17 00:00:00 2001
From: Luc Schrijvers <begasus@gmail.com>
Date: Thu, 7 Aug 2025 17:07:53 +0200
Subject: Fix documentation path


diff --git a/bus/CMakeLists.txt b/bus/CMakeLists.txt
index e464f60..4278fc0 100644
--- a/bus/CMakeLists.txt
+++ b/bus/CMakeLists.txt
@@ -160,11 +160,11 @@ endif()
 
 macro(install_example_in_file a)
     configure_file(${a}.in ${CMAKE_CURRENT_BINARY_DIR}/${a})
-    install(FILES ${CMAKE_CURRENT_BINARY_DIR}/${a} DESTINATION ${CMAKE_INSTALL_DATADIR}/doc/dbus/examples)
+    install(FILES ${CMAKE_CURRENT_BINARY_DIR}/${a} DESTINATION ${CMAKE_INSTALL_DOCDIR}/examples)
 endmacro()
 
 macro(install_example_file a)
-    install(FILES ${CMAKE_CURRENT_SOURCE_DIR}/${a} DESTINATION ${CMAKE_INSTALL_DATADIR}/doc/dbus/examples)
+    install(FILES ${CMAKE_CURRENT_SOURCE_DIR}/${a} DESTINATION ${CMAKE_INSTALL_DOCDIR}/examples)
 endmacro()
 
 install_example_in_file(example-session-disable-stats.conf)
diff --git a/doc/CMakeLists.txt b/doc/CMakeLists.txt
index 33910c1..60fca16 100644
--- a/doc/CMakeLists.txt
+++ b/doc/CMakeLists.txt
@@ -20,7 +20,7 @@ if(DBUS_ENABLE_DOXYGEN_DOCS)
         set(DBUS_GENERATE_MAN YES)
     endif()
     if(NOT DEFINED INSTALL_QCH_DIR)
-        set(INSTALL_QCH_DIR ${CMAKE_INSTALL_DATADIR}/doc/dbus)
+        set(INSTALL_QCH_DIR ${CMAKE_INSTALL_DOCDIR})
     endif()
     find_program(QHELPGENERATOR_EXECUTABLE NAMES qhelpgenerator qhelpgenerator-qt5)
     check_auto_option(ENABLE_QT_HELP "Qt help" QHELPGENERATOR_EXECUTABLE "qhelpgenerator")
@@ -52,7 +52,7 @@ if(DBUS_ENABLE_DOXYGEN_DOCS)
         DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/doxygen.stamp
     )
     add_dependencies(doc apidoc)
-    install(DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/api/html/ DESTINATION ${CMAKE_INSTALL_DATADIR}/doc/dbus/api/html)
+    install(DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/api/html/ DESTINATION ${CMAKE_INSTALL_DOCDIR}/api/html)
 endif()
 
 find_program(XSLTPROC_EXECUTABLE xsltproc)
@@ -76,7 +76,7 @@ if(DBUS_HAVE_XSLTPROC AND DBUS_ENABLE_DOXYGEN_DOCS)
         DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/dbus.devhelp2
     )
     add_dependencies(doc devhelp2)
-    install(FILES ${CMAKE_CURRENT_BINARY_DIR}/dbus.devhelp2 DESTINATION ${CMAKE_INSTALL_DATADIR}/doc/dbus)
+    install(FILES ${CMAKE_CURRENT_BINARY_DIR}/dbus.devhelp2 DESTINATION ${CMAKE_INSTALL_DOCDIR})
 endif()
 
 #
@@ -131,7 +131,7 @@ macro(add_docbook _target)
                 set(_outname "${_target}.${ARGS_MAN_CATEGORY}.html")
             endif()
             set(STYLESHEET "${DOCBOOKXSL_DIR}/html/docbook.xsl")
-            set(INSTALL_DIR ${CMAKE_INSTALL_DATADIR}/doc/dbus)
+            set(INSTALL_DIR ${CMAKE_INSTALL_DOCDIR})
         endif()
         set(_outfile ${CMAKE_CURRENT_BINARY_DIR}/${_outname})
         add_custom_command(
@@ -203,7 +203,7 @@ else()
     set(DBUS_APIDOC_LINK "")
 endif()
 configure_file(index.html.in ${CMAKE_CURRENT_BINARY_DIR}/index.html)
-install(FILES ${CMAKE_CURRENT_BINARY_DIR}/index.html DESTINATION ${CMAKE_INSTALL_DATADIR}/doc/dbus)
+install(FILES ${CMAKE_CURRENT_BINARY_DIR}/index.html DESTINATION ${CMAKE_INSTALL_DOCDIR})
 
 #
 # misc files
@@ -213,13 +213,13 @@ set(DTD_DATA
     diagram.svg
 )
 
-install(FILES ${DTD_DATA} DESTINATION ${CMAKE_INSTALL_DATADIR}/doc/dbus)
+install(FILES ${DTD_DATA} DESTINATION ${CMAKE_INSTALL_DOCDIR})
 
 set(DOC_DATA
     system-activation.txt
 )
 
-install(FILES ${DOC_DATA} DESTINATION ${CMAKE_INSTALL_DATADIR}/doc/dbus)
+install(FILES ${DOC_DATA} DESTINATION ${CMAKE_INSTALL_DOCDIR})
 
 set(DBUS_DTD_DIR "${CMAKE_INSTALL_DATADIR}/xml/dbus-1" CACHE STRING  "Directory for installing DTD files")
 set(DBUS_XML_CATALOG_DIR "${DBUS_DTD_DIR}" CACHE STRING  "Directory for installing XML catalog file")
diff --git a/tools/CMakeLists.txt b/tools/CMakeLists.txt
index 5caf5de..e4731d8 100644
--- a/tools/CMakeLists.txt
+++ b/tools/CMakeLists.txt
@@ -137,4 +137,4 @@ set(EXAMPLES_SCRIPTS
     GetAllMatchRules.py
 )
 
-install(FILES ${EXAMPLES_SCRIPTS} DESTINATION ${CMAKE_INSTALL_DATADIR}/doc/dbus/examples)
+install(FILES ${EXAMPLES_SCRIPTS} DESTINATION ${CMAKE_INSTALL_DOCDIR}/examples)
-- 
2.48.1

