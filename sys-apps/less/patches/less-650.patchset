From c256c64ff6cb14d4ff1a97d6d24e429836f602ef Mon Sep 17 00:00:00 2001
From: Jerome Duval <jerome.duval@gmail.com>
Date: Thu, 29 Jun 2017 17:06:55 +0200
Subject: import fix from previous version


diff --git a/cmdbuf.c b/cmdbuf.c
index 0539db9..77eb20b 100644
--- a/cmdbuf.c
+++ b/cmdbuf.c
@@ -1346,7 +1346,11 @@ static int mlist_size(struct mlist *ml)
  */
 static char * histfile_find(lbool must_exist)
 {
+#ifdef __HAIKU__
+	char home[B_PATH_NAME_LENGTH+B_FILE_NAME_LENGTH];
+#else
 	constant char *home = lgetenv("HOME");
+#endif
 	char *name = NULL;
 
 	/* Try in $XDG_STATE_HOME, then in $HOME/.local/state, then in $XDG_DATA_HOME, then in $HOME. */
@@ -1390,6 +1394,13 @@ static char * histfile_name(lbool must_exist)
 	if (strcmp(LESSHISTFILE, "") == 0 || strcmp(LESSHISTFILE, "-") == 0)
 		return (NULL);
 
+#ifdef __HAIKU__
+	{
+	dev_t volume = dev_for_path("/boot");
+	if (find_directory(B_USER_SETTINGS_DIRECTORY, volume, true, home, sizeof(home)) != B_OK)
+		return (NULL);
+	}
+#else
 	wname = NULL;
 	if (!must_exist)
 	{
@@ -1398,6 +1409,7 @@ static char * histfile_name(lbool must_exist)
 	}
 	if (wname == NULL)
 		wname = histfile_find(must_exist);
+#endif
 	return (wname);
 }
 
diff --git a/configure.ac b/configure.ac
index 4c14de0..feb4220 100644
--- a/configure.ac
+++ b/configure.ac
@@ -581,12 +581,19 @@ AH_TOP([
  * LESSHISTFILE is the filename of the history file
  * (in the HOME directory).
  */
+#ifdef __HAIKU__
+#define	LESSKEYFILE		"less"
+#define	LESSKEYFILE_SYS		SYSDIR "/sysless"
+#define	DEF_LESSKEYINFILE	"lesskey"
+#define	LESSKEYINFILE_SYS	SYSDIR "/syslesskey"
+#define LESSHISTFILE		"lesshst"
+#else
 #define	LESSKEYFILE		".less"
 #define	LESSKEYFILE_SYS		SYSDIR "/sysless"
 #define	DEF_LESSKEYINFILE	".lesskey"
 #define	LESSKEYINFILE_SYS	SYSDIR "/syslesskey"
 #define LESSHISTFILE		".lesshst"
-
+#endif
 
 /* Settings always true on Unix.  */
 
diff --git a/less.h b/less.h
index ae10844..6aeeecd 100644
--- a/less.h
+++ b/less.h
@@ -104,6 +104,11 @@ typedef unsigned long uintmax;
 #include <floss.h>
 #endif
 
+#ifdef __HAIKU__
+#include <FindDirectory.h>
+#include <StorageDefs.h>
+#endif
+
 #if MSDOS_COMPILER==WIN32C || OS2
 #include <io.h>
 #endif
-- 
2.42.1

