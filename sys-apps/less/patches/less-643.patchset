From efab72b306d779fe57c8e37c813b61c3851e02df Mon Sep 17 00:00:00 2001
From: Jerome Duval <jerome.duval@gmail.com>
Date: Thu, 29 Jun 2017 17:06:55 +0200
Subject: import fix from previous version


diff --git a/cmdbuf.c b/cmdbuf.c
index c813283..0677dea 100644
--- a/cmdbuf.c
+++ b/cmdbuf.c
@@ -1345,7 +1345,11 @@ static int mlist_size(struct mlist *ml)
  */
 static char * histfile_find(int must_exist)
 {
+#ifdef __HAIKU__
+	char home[B_PATH_NAME_LENGTH+B_FILE_NAME_LENGTH];
+#else
 	char *home = lgetenv("HOME");
+#endif
 	char *name = NULL;
 
 	/* Try in $XDG_STATE_HOME, then in $HOME/.local/state, then in $XDG_DATA_HOME, then in $HOME. */
@@ -1388,6 +1392,13 @@ static char * histfile_name(int must_exist)
 	if (strcmp(LESSHISTFILE, "") == 0 || strcmp(LESSHISTFILE, "-") == 0)
 		return (NULL);
 
+#ifdef __HAIKU__
+	{
+	dev_t volume = dev_for_path("/boot");
+	if (find_directory(B_USER_SETTINGS_DIRECTORY, volume, true, home, sizeof(home)) != B_OK)
+		return (NULL);
+	}
+#else
 	name = NULL;
 	if (!must_exist)
 	{
@@ -1396,6 +1407,7 @@ static char * histfile_name(int must_exist)
 	}
 	if (name == NULL)
 		name = histfile_find(must_exist);
+#endif
 	return (name);
 }
 
diff --git a/configure.ac b/configure.ac
index 37dc496..cf46bd4 100644
--- a/configure.ac
+++ b/configure.ac
@@ -582,12 +582,18 @@ AH_TOP([
  * LESSHISTFILE is the filename of the history file
  * (in the HOME directory).
  */
+#ifdef __HAIKU__
+# define	LESSKEYFILE		"less"
+# define	LESSKEYFILE_SYS		SYSDIR "/sysless"
+# define	DEF_LESSKEYINFILE	"lesskey"
+# define LESSHISTFILE		"lesshst"
+#else
 #define	LESSKEYFILE		".less"
 #define	LESSKEYFILE_SYS		SYSDIR "/sysless"
 #define	DEF_LESSKEYINFILE	".lesskey"
 #define	LESSKEYINFILE_SYS	SYSDIR "/syslesskey"
 #define LESSHISTFILE		".lesshst"
-
+#endif
 
 /* Settings always true on Unix.  */
 
diff --git a/less.h b/less.h
index 2ba8c35..080daaf 100644
--- a/less.h
+++ b/less.h
@@ -111,6 +111,11 @@ typedef unsigned long uintmax;
 #include <floss.h>
 #endif
 
+#ifdef __HAIKU__
+#include <FindDirectory.h>
+#include <StorageDefs.h>
+#endif
+
 #if MSDOS_COMPILER==WIN32C || OS2
 #include <io.h>
 #endif
-- 
2.42.1

