SUMMARY="Search tool that combines the usability of ag with the speed of grep"
DESCRIPTION="\
ripgrep (rg) recursively searches your current directory for a regex pattern.
By default, ripgrep will respect your .gitignore and automatically skip hidden
files/directories and binary files."
HOMEPAGE="https://github.com/BurntSushi/ripgrep"
COPYRIGHT="2015 Andrew Gallant"
LICENSE="MIT
	Unlicense"
REVISION="2"
SOURCE_URI="$HOMEPAGE/archive/$portVersion.tar.gz"
CHECKSUM_SHA256="0983861279936ada8bc7a6d5d663d590ad34eb44a44c75c2d6ccd0ab33490055"
SOURCE_FILENAME="ripgrep-$portVersion.tar.gz"

SOURCE_URI_2="https://static.crates.io/crates/aho-corasick/aho-corasick-0.7.4.crate"
CHECKSUM_SHA256_2="36b7aa1ccb7d7ea3f437cf025a2ab1c47cc6c1bc9fc84918ff449def12f5e282"

SOURCE_URI_3="https://static.crates.io/crates/atty/atty-0.2.13.crate"
CHECKSUM_SHA256_3="1803c647a3ec87095e7ae7acfca019e98de5ec9a7d01343f611cf3152ed71a90"

SOURCE_URI_4="https://static.crates.io/crates/base64/base64-0.10.1.crate"
CHECKSUM_SHA256_4="0b25d992356d2eb0ed82172f5248873db5560c4721f564b13cb5193bda5e668e"

SOURCE_URI_5="https://static.crates.io/crates/bitflags/bitflags-1.1.0.crate"
CHECKSUM_SHA256_5="3d155346769a6855b86399e9bc3814ab343cd3d62c7e985113d46a0ec3c281fd"

SOURCE_URI_6="https://static.crates.io/crates/bstr/bstr-0.2.6.crate"
CHECKSUM_SHA256_6="e0a692f1c740e7e821ca71a22cf99b9b2322dfa94d10f71443befb1797b3946a"

SOURCE_URI_7="https://static.crates.io/crates/bytecount/bytecount-0.5.1.crate"
CHECKSUM_SHA256_7="be0fdd54b507df8f22012890aadd099979befdba27713c767993f8380112ca7c"

SOURCE_URI_8="https://static.crates.io/crates/byteorder/byteorder-1.3.2.crate"
CHECKSUM_SHA256_8="a7c3dd8985a7111efc5c80b44e23ecdd8c007de8ade3b96595387e812b957cf5"

SOURCE_URI_9="https://static.crates.io/crates/c2-chacha/c2-chacha-0.2.2.crate"
CHECKSUM_SHA256_9="7d64d04786e0f528460fc884753cf8dddcc466be308f6026f8e355c41a0e4101"

SOURCE_URI_10="https://static.crates.io/crates/cc/cc-1.0.38.crate"
CHECKSUM_SHA256_10="ce400c638d48ee0e9ab75aef7997609ec57367ccfe1463f21bf53c3eca67bf46"

SOURCE_URI_11="https://static.crates.io/crates/cfg-if/cfg-if-0.1.9.crate"
CHECKSUM_SHA256_11="b486ce3ccf7ffd79fdeb678eac06a9e6c09fc88d33836340becb8fffe87c5e33"

SOURCE_URI_12="https://static.crates.io/crates/clap/clap-2.33.0.crate"
CHECKSUM_SHA256_12="5067f5bb2d80ef5d68b4c87db81601f0b75bca627bc2ef76b141d7b846a3c6d9"

SOURCE_URI_13="https://static.crates.io/crates/crossbeam-channel/crossbeam-channel-0.3.9.crate"
CHECKSUM_SHA256_13="c8ec7fcd21571dc78f96cc96243cab8d8f035247c3efd16c687be154c3fa9efa"

SOURCE_URI_14="https://static.crates.io/crates/crossbeam-utils/crossbeam-utils-0.6.6.crate"
CHECKSUM_SHA256_14="04973fa96e96579258a5091af6003abde64af786b860f18622b82e026cca60e6"

SOURCE_URI_15="https://static.crates.io/crates/encoding_rs/encoding_rs-0.8.17.crate"
CHECKSUM_SHA256_15="4155785c79f2f6701f185eb2e6b4caf0555ec03477cb4c70db67b465311620ed"

SOURCE_URI_16="https://static.crates.io/crates/encoding_rs_io/encoding_rs_io-0.1.6.crate"
CHECKSUM_SHA256_16="9619ee7a2bf4e777e020b95c1439abaf008f8ea8041b78a0552c4f1bcf4df32c"

SOURCE_URI_17="https://static.crates.io/crates/fnv/fnv-1.0.6.crate"
CHECKSUM_SHA256_17="2fad85553e09a6f881f739c29f0b00b0f01357c743266d478b68951ce23285f3"

SOURCE_URI_18="https://static.crates.io/crates/fs_extra/fs_extra-1.1.0.crate"
CHECKSUM_SHA256_18="5f2a4a2034423744d2cc7ca2068453168dcdb82c438419e639a26bd87839c674"

SOURCE_URI_19="https://static.crates.io/crates/getrandom/getrandom-0.1.7.crate"
CHECKSUM_SHA256_19="cd8e190892c840661957ba9f32dacfb3eb405e657f9f9f60485605f0bb37d6f8"

SOURCE_URI_20="https://static.crates.io/crates/glob/glob-0.3.0.crate"
CHECKSUM_SHA256_20="9b919933a397b79c37e33b77bb2aa3dc8eb6e165ad809e58ff75bc7db2e34574"

SOURCE_URI_21="https://static.crates.io/crates/itoa/itoa-0.4.4.crate"
CHECKSUM_SHA256_21="501266b7edd0174f8530248f87f99c88fbe60ca4ef3dd486835b8d8d53136f7f"

SOURCE_URI_22="https://static.crates.io/crates/jemalloc-sys/jemalloc-sys-0.3.2.crate"
CHECKSUM_SHA256_22="0d3b9f3f5c9b31aa0f5ed3260385ac205db665baa41d49bb8338008ae94ede45"

SOURCE_URI_23="https://static.crates.io/crates/jemallocator/jemallocator-0.3.2.crate"
CHECKSUM_SHA256_23="43ae63fcfc45e99ab3d1b29a46782ad679e98436c3169d15a167a1108a724b69"

SOURCE_URI_24="https://static.crates.io/crates/lazy_static/lazy_static-1.3.0.crate"
CHECKSUM_SHA256_24="bc5729f27f159ddd61f4df6228e827e86643d4d3e7c32183cb30a1c08f604a14"

SOURCE_URI_25="https://static.crates.io/crates/libc/libc-0.2.60.crate"
CHECKSUM_SHA256_25="d44e80633f007889c7eff624b709ab43c92d708caad982295768a7b13ca3b5eb"

SOURCE_URI_26="https://static.crates.io/crates/log/log-0.4.8.crate"
CHECKSUM_SHA256_26="14b6052be84e6b71ab17edffc2eeabf5c2c3ae1fdb464aae35ac50c67a44e1f7"

SOURCE_URI_27="https://static.crates.io/crates/memchr/memchr-2.2.1.crate"
CHECKSUM_SHA256_27="88579771288728879b57485cc7d6b07d648c9f0141eb955f8ab7f9d45394468e"

SOURCE_URI_28="https://static.crates.io/crates/memmap/memmap-0.7.0.crate"
CHECKSUM_SHA256_28="6585fd95e7bb50d6cc31e20d4cf9afb4e2ba16c5846fc76793f11218da9c475b"

SOURCE_URI_29="https://static.crates.io/crates/num_cpus/num_cpus-1.10.1.crate"
CHECKSUM_SHA256_29="bcef43580c035376c0705c42792c294b66974abbfd2789b511784023f71f3273"

SOURCE_URI_30="https://static.crates.io/crates/packed_simd/packed_simd-0.3.3.crate"
CHECKSUM_SHA256_30="a85ea9fc0d4ac0deb6fe7911d38786b32fc11119afd9e9d38b84ff691ce64220"

SOURCE_URI_31="https://static.crates.io/crates/pcre2/pcre2-0.2.1.crate"
CHECKSUM_SHA256_31="603da5e101220b9b306bf28e4f1f8703458ce2f64d2787b374e1a19494317180"

SOURCE_URI_32="https://static.crates.io/crates/pcre2-sys/pcre2-sys-0.2.2.crate"
CHECKSUM_SHA256_32="876c72d05059d23a84bd9fcdc3b1d31c50ea7fe00fe1522b4e68cd3608db8d5b"

SOURCE_URI_33="https://static.crates.io/crates/pkg-config/pkg-config-0.3.15.crate"
CHECKSUM_SHA256_33="a7c1d2cfa5a714db3b5f24f0915e74fcdf91d09d496ba61329705dda7774d2af"

SOURCE_URI_34="https://static.crates.io/crates/ppv-lite86/ppv-lite86-0.2.5.crate"
CHECKSUM_SHA256_34="e3cbf9f658cdb5000fcf6f362b8ea2ba154b9f146a61c7a20d647034c6b6561b"

SOURCE_URI_35="https://static.crates.io/crates/proc-macro2/proc-macro2-0.4.30.crate"
CHECKSUM_SHA256_35="cf3d2011ab5c909338f7887f4fc896d35932e29146c12c8d01da6b22a80ba759"

SOURCE_URI_36="https://static.crates.io/crates/quote/quote-0.6.13.crate"
CHECKSUM_SHA256_36="6ce23b6b870e8f94f81fb0a363d65d86675884b34a09043c81e5562f11c1f8e1"

SOURCE_URI_37="https://static.crates.io/crates/rand/rand-0.7.0.crate"
CHECKSUM_SHA256_37="d47eab0e83d9693d40f825f86948aa16eff6750ead4bdffc4ab95b8b3a7f052c"

SOURCE_URI_38="https://static.crates.io/crates/rand_chacha/rand_chacha-0.2.1.crate"
CHECKSUM_SHA256_38="03a2a90da8c7523f554344f921aa97283eadf6ac484a6d2a7d0212fa7f8d6853"

SOURCE_URI_39="https://static.crates.io/crates/rand_core/rand_core-0.5.0.crate"
CHECKSUM_SHA256_39="615e683324e75af5d43d8f7a39ffe3ee4a9dc42c5c701167a71dc59c3a493aca"

SOURCE_URI_40="https://static.crates.io/crates/rand_hc/rand_hc-0.2.0.crate"
CHECKSUM_SHA256_40="ca3129af7b92a17112d59ad498c6f81eaf463253766b90396d39ea7a39d6613c"

SOURCE_URI_41="https://static.crates.io/crates/redox_syscall/redox_syscall-0.1.56.crate"
CHECKSUM_SHA256_41="2439c63f3f6139d1b57529d16bc3b8bb855230c8efcc5d3a896c8bea7c3b1e84"

SOURCE_URI_42="https://static.crates.io/crates/regex/regex-1.2.0.crate"
CHECKSUM_SHA256_42="6b23da8dfd98a84bd7e08700190a5d9f7d2d38abd4369dd1dae651bc40bfd2cc"

SOURCE_URI_43="https://static.crates.io/crates/regex-automata/regex-automata-0.1.8.crate"
CHECKSUM_SHA256_43="92b73c2a1770c255c240eaa4ee600df1704a38dc3feaa6e949e7fcd4f8dc09f9"

SOURCE_URI_44="https://static.crates.io/crates/regex-syntax/regex-syntax-0.6.10.crate"
CHECKSUM_SHA256_44="cd5485bf1523a9ed51c4964273f22f63f24e31632adb5dad134f488f86a3875c"

SOURCE_URI_45="https://static.crates.io/crates/remove_dir_all/remove_dir_all-0.5.2.crate"
CHECKSUM_SHA256_45="4a83fa3702a688b9359eccba92d153ac33fd2e8462f9e0e3fdf155239ea7792e"

SOURCE_URI_46="https://static.crates.io/crates/ryu/ryu-1.0.0.crate"
CHECKSUM_SHA256_46="c92464b447c0ee8c4fb3824ecc8383b81717b9f1e74ba2e72540aef7b9f82997"

SOURCE_URI_47="https://static.crates.io/crates/same-file/same-file-1.0.5.crate"
CHECKSUM_SHA256_47="585e8ddcedc187886a30fa705c47985c3fa88d06624095856b36ca0b82ff4421"

SOURCE_URI_48="https://static.crates.io/crates/serde/serde-1.0.98.crate"
CHECKSUM_SHA256_48="7fe5626ac617da2f2d9c48af5515a21d5a480dbd151e01bb1c355e26a3e68113"

SOURCE_URI_49="https://static.crates.io/crates/serde_derive/serde_derive-1.0.98.crate"
CHECKSUM_SHA256_49="01e69e1b8a631f245467ee275b8c757b818653c6d704cdbcaeb56b56767b529c"

SOURCE_URI_50="https://static.crates.io/crates/serde_json/serde_json-1.0.40.crate"
CHECKSUM_SHA256_50="051c49229f282f7c6f3813f8286cc1e3323e8051823fce42c7ea80fe13521704"

SOURCE_URI_51="https://static.crates.io/crates/strsim/strsim-0.8.0.crate"
CHECKSUM_SHA256_51="8ea5119cdb4c55b55d432abb513a0429384878c15dde60cc77b1c99de1a95a6a"

SOURCE_URI_52="https://static.crates.io/crates/syn/syn-0.15.42.crate"
CHECKSUM_SHA256_52="eadc09306ca51a40555dd6fc2b415538e9e18bc9f870e47b1a524a79fe2dcf5e"

SOURCE_URI_53="https://static.crates.io/crates/tempfile/tempfile-3.1.0.crate"
CHECKSUM_SHA256_53="7a6e24d9338a0a5be79593e2fa15a648add6138caa803e2d5bc782c371732ca9"

SOURCE_URI_54="https://static.crates.io/crates/termcolor/termcolor-1.0.5.crate"
CHECKSUM_SHA256_54="96d6098003bde162e4277c70665bd87c326f5a0c3f3fbfb285787fa482d54e6e"

SOURCE_URI_55="https://static.crates.io/crates/textwrap/textwrap-0.11.0.crate"
CHECKSUM_SHA256_55="d326610f408c7a4eb6f51c37c330e496b08506c9457c9d34287ecc38809fb060"

SOURCE_URI_56="https://static.crates.io/crates/thread_local/thread_local-0.3.6.crate"
CHECKSUM_SHA256_56="c6b53e329000edc2b34dbe8545fd20e55a333362d0a321909685a19bd28c3f1b"

SOURCE_URI_57="https://static.crates.io/crates/ucd-util/ucd-util-0.1.5.crate"
CHECKSUM_SHA256_57="fa9b3b49edd3468c0e6565d85783f51af95212b6fa3986a5500954f00b460874"

SOURCE_URI_58="https://static.crates.io/crates/unicode-width/unicode-width-0.1.5.crate"
CHECKSUM_SHA256_58="882386231c45df4700b275c7ff55b6f3698780a650026380e72dabe76fa46526"

SOURCE_URI_59="https://static.crates.io/crates/unicode-xid/unicode-xid-0.1.0.crate"
CHECKSUM_SHA256_59="fc72304796d0818e357ead4e000d19c9c174ab23dc11093ac919054d20a6a7fc"

SOURCE_URI_60="https://static.crates.io/crates/utf8-ranges/utf8-ranges-1.0.3.crate"
CHECKSUM_SHA256_60="9d50aa7650df78abf942826607c62468ce18d9019673d4a2ebe1865dbb96ffde"

SOURCE_URI_61="https://static.crates.io/crates/walkdir/walkdir-2.2.9.crate"
CHECKSUM_SHA256_61="9658c94fa8b940eab2250bd5a457f9c48b748420d71293b165c8cdbe2f55f71e"

SOURCE_URI_62="https://static.crates.io/crates/winapi/winapi-0.3.7.crate"
CHECKSUM_SHA256_62="f10e386af2b13e47c89e7236a7a14a086791a2b88ebad6df9bf42040195cf770"

SOURCE_URI_63="https://static.crates.io/crates/winapi-i686-pc-windows-gnu/winapi-i686-pc-windows-gnu-0.4.0.crate"
CHECKSUM_SHA256_63="ac3b87c63620426dd9b991e5ce0329eff545bccbbb34f3be09ff6fb6ab51b7b6"

SOURCE_URI_64="https://static.crates.io/crates/winapi-util/winapi-util-0.1.2.crate"
CHECKSUM_SHA256_64="7168bab6e1daee33b4557efd0e95d5ca70a03706d39fa5f3fe7a236f584b03c9"

SOURCE_URI_65="https://static.crates.io/crates/winapi-x86_64-pc-windows-gnu/winapi-x86_64-pc-windows-gnu-0.4.0.crate"
CHECKSUM_SHA256_65="712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f"

SOURCE_URI_66="https://static.crates.io/crates/wincolor/wincolor-1.0.1.crate"
CHECKSUM_SHA256_66="561ed901ae465d6185fa7864d63fbd5720d0ef718366c9a4dc83cf6170d7e9ba"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
SECONDARY_ARCHITECTURES="x86"
commandBinDir=$prefix/bin
fi

PROVIDES="
	ripgrep$secondaryArchSuffix = $portVersion
	cmd:rg
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	lib:libxslt$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:a2x
	cmd:gcc$secondaryArchSuffix
	cmd:rustc$secondaryArchSuffix >= 1.39.0
	"

defineDebugInfoPackage ripgrep$secondaryArchSuffix \
	"$commandBinDir"/rg

BUILD()
{
	export CARGO_HOME=$sourceDir/../cargo
	vendor=$CARGO_HOME/haiku
	mkdir -p "$vendor"
	for i in $(seq 2 66); do
		eval "srcDir=\$sourceDir$i"
		eval "sha256sum=\$CHECKSUM_SHA256_$i"
		set -- "$srcDir"/*
		ln -sf "$1" "$vendor"
		cat <<-EOF >"$vendor/${1##*/}/.cargo-checksum.json"
		{
		  "package": "$sha256sum",
		  "files": {}
		}
		EOF
	done

	cat <<-EOF >"$CARGO_HOME"/config
	[source.haiku]
	directory = "$vendor"

	[source.crates-io]
	replace-with = "haiku"
	EOF

	cargo build --release --frozen --features pcre2
}

INSTALL()
{
	install -m 755 -d "$commandBinDir" "$docDir" "$manDir"/man1 \
		"$dataDir"/bash-completions/completions \
		"$dataDir"/zsh/site-functions

	install -m 755 target/release/rg "$commandBinDir"
	install -m 644 README.md "$docDir"
	install -m 644 target/release/build/ripgrep-*/out/rg.1 "$manDir"/man1

	install -m 644 target/release/build/ripgrep-*/out/rg.bash \
		"$dataDir"/bash-completions/completions/rg
	install -m 644 complete/_rg "$dataDir"/zsh/site-functions
}

TEST()
{
	export CARGO_HOME=$sourceDir/../cargo
	cargo test --release --frozen
}
