SUMMARY="A search tool that combines the usability of ag with the speed of grep"
DESCRIPTION="\
ripgrep (rg) recursively searches your current directory for a regex pattern.
By default, ripgrep will respect your .gitignore and automatically skip hidden
files/directories and binary files."
HOMEPAGE="https://github.com/BurntSushi/ripgrep"
COPYRIGHT="2015 Andrew Gallant"
LICENSE="MIT
	Unlicense"
REVISION="1"
SOURCE_URI="$HOMEPAGE/archive/$portVersion.tar.gz"
CHECKSUM_SHA256="845cbf47729809fe82fd1f938f7880a29c1cd5c71d83e0feb9429552e0568bf6"

SOURCE_URI_2="https://static.crates.io/crates/aho-corasick/aho-corasick-1.1.2.crate"
CHECKSUM_SHA256_2="b2969dcb958b36655471fc61f7e416fa76033bdd4bfed0678d8fee1e2d07a1f0"

SOURCE_URI_3="https://static.crates.io/crates/anyhow/anyhow-1.0.75.crate"
CHECKSUM_SHA256_3="a4668cab20f66d8d020e1fbc0ebe47217433c1b6c8f2040faf858554e394ace6"

SOURCE_URI_4="https://static.crates.io/crates/autocfg/autocfg-1.1.0.crate"
CHECKSUM_SHA256_4="d468802bab17cbc0cc575e9b053f41e72aa36bfa6b7f55e3529ffa43161b97fa"

SOURCE_URI_5="https://static.crates.io/crates/bstr/bstr-1.8.0.crate"
CHECKSUM_SHA256_5="542f33a8835a0884b006a0c3df3dadd99c0c3f296ed26c2fdc8028e01ad6230c"

SOURCE_URI_6="https://static.crates.io/crates/cc/cc-1.0.83.crate"
CHECKSUM_SHA256_6="f1174fb0b6ec23863f8b971027804a42614e347eafb0a95bf0b12cdae21fc4d0"

SOURCE_URI_7="https://static.crates.io/crates/cfg-if/cfg-if-1.0.0.crate"
CHECKSUM_SHA256_7="baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd"

SOURCE_URI_8="https://static.crates.io/crates/crossbeam-channel/crossbeam-channel-0.5.8.crate"
CHECKSUM_SHA256_8="a33c2bf77f2df06183c3aa30d1e96c0695a313d4f9c453cc3762a6db39f99200"

SOURCE_URI_9="https://static.crates.io/crates/crossbeam-deque/crossbeam-deque-0.8.3.crate"
CHECKSUM_SHA256_9="ce6fd6f855243022dcecf8702fef0c297d4338e226845fe067f6341ad9fa0cef"

SOURCE_URI_10="https://static.crates.io/crates/crossbeam-epoch/crossbeam-epoch-0.9.15.crate"
CHECKSUM_SHA256_10="ae211234986c545741a7dc064309f67ee1e5ad243d0e48335adc0484d960bcc7"

SOURCE_URI_11="https://static.crates.io/crates/crossbeam-utils/crossbeam-utils-0.8.16.crate"
CHECKSUM_SHA256_11="5a22b2d63d4d1dc0b7f1b6b2747dd0088008a9be28b6ddf0b1e7d335e3037294"

SOURCE_URI_12="https://static.crates.io/crates/encoding_rs/encoding_rs-0.8.33.crate"
CHECKSUM_SHA256_12="7268b386296a025e474d5140678f75d6de9493ae55a5d709eeb9dd08149945e1"

SOURCE_URI_13="https://static.crates.io/crates/encoding_rs_io/encoding_rs_io-0.1.7.crate"
CHECKSUM_SHA256_13="1cc3c5651fb62ab8aa3103998dade57efdd028544bd300516baa31840c252a83"

SOURCE_URI_14="https://static.crates.io/crates/glob/glob-0.3.1.crate"
CHECKSUM_SHA256_14="d2fabcfbdc87f4758337ca535fb41a6d701b65693ce38287d856d1674551ec9b"

SOURCE_URI_15="https://static.crates.io/crates/globset/globset-0.4.14.crate"
CHECKSUM_SHA256_15="57da3b9b5b85bd66f31093f8c408b90a74431672542466497dcbdfdc02034be1"

SOURCE_URI_16="https://static.crates.io/crates/grep/grep-0.2.13.crate"
CHECKSUM_SHA256_16="bd79f01019ef2fe3978232135f5a7237baca9a6c6ed4dbbe9e5a51234e2306c5"

SOURCE_URI_17="https://static.crates.io/crates/grep-cli/grep-cli-0.1.10.crate"
CHECKSUM_SHA256_17="ea40788c059ab8b622c4d074732750bfb3bd2912e2dd58eabc11798a4d5ad725"

SOURCE_URI_18="https://static.crates.io/crates/grep-matcher/grep-matcher-0.1.7.crate"
CHECKSUM_SHA256_18="47a3141a10a43acfedc7c98a60a834d7ba00dfe7bec9071cbfc19b55b292ac02"

SOURCE_URI_19="https://static.crates.io/crates/grep-pcre2/grep-pcre2-0.1.7.crate"
CHECKSUM_SHA256_19="0244d52219649ce2caefdb9b0092ab58b95c7156fa910f8edff960aa982a8bff"

SOURCE_URI_20="https://static.crates.io/crates/grep-printer/grep-printer-0.1.7.crate"
CHECKSUM_SHA256_20="e14551578f49da1f774b70da5bd1b8c20bbbead01620c426cb0a217536d95a6a"

SOURCE_URI_21="https://static.crates.io/crates/grep-regex/grep-regex-0.1.12.crate"
CHECKSUM_SHA256_21="f748bb135ca835da5cbc67ca0e6955f968db9c5df74ca4f56b18e1ddbc68230d"

SOURCE_URI_22="https://static.crates.io/crates/grep-searcher/grep-searcher-0.1.12.crate"
CHECKSUM_SHA256_22="fda02a2d9a8c9375ee678bfcba5919b31854c617b6b4f60edec7c9f1dceb84b9"

SOURCE_URI_23="https://static.crates.io/crates/ignore/ignore-0.4.21.crate"
CHECKSUM_SHA256_23="747ad1b4ae841a78e8aba0d63adbfbeaea26b517b63705d47856b73015d27060"

SOURCE_URI_24="https://static.crates.io/crates/itoa/itoa-1.0.9.crate"
CHECKSUM_SHA256_24="af150ab688ff2122fcef229be89cb50dd66af9e01a4ff320cc137eecc9bacc38"

SOURCE_URI_25="https://static.crates.io/crates/jemalloc-sys/jemalloc-sys-0.5.4+5.3.0-patched.crate"
CHECKSUM_SHA256_25="ac6c1946e1cea1788cbfde01c993b52a10e2da07f4bac608228d1bed20bfebf2"

SOURCE_URI_26="https://static.crates.io/crates/jemallocator/jemallocator-0.5.4.crate"
CHECKSUM_SHA256_26="a0de374a9f8e63150e6f5e8a60cc14c668226d7a347d8aee1a45766e3c4dd3bc"

SOURCE_URI_27="https://static.crates.io/crates/jobserver/jobserver-0.1.27.crate"
CHECKSUM_SHA256_27="8c37f63953c4c63420ed5fd3d6d398c719489b9f872b9fa683262f8edd363c7d"

SOURCE_URI_28="https://static.crates.io/crates/lexopt/lexopt-0.3.0.crate"
CHECKSUM_SHA256_28="baff4b617f7df3d896f97fe922b64817f6cd9a756bb81d40f8883f2f66dcb401"

SOURCE_URI_29="https://static.crates.io/crates/libc/libc-0.2.150.crate"
CHECKSUM_SHA256_29="89d92a4743f9a61002fae18374ed11e7973f530cb3a3255fb354818118b2203c"

SOURCE_URI_30="https://static.crates.io/crates/libm/libm-0.2.8.crate"
CHECKSUM_SHA256_30="4ec2a862134d2a7d32d7983ddcdd1c4923530833c9f2ea1a44fc5fa473989058"

SOURCE_URI_31="https://static.crates.io/crates/log/log-0.4.20.crate"
CHECKSUM_SHA256_31="b5e6163cb8c49088c2c36f57875e58ccd8c87c7427f7fbd50ea6710b2f3f2e8f"

SOURCE_URI_32="https://static.crates.io/crates/memchr/memchr-2.6.4.crate"
CHECKSUM_SHA256_32="f665ee40bc4a3c5590afb1e9677db74a508659dfd71e126420da8274909a0167"

SOURCE_URI_33="https://static.crates.io/crates/memmap2/memmap2-0.9.0.crate"
CHECKSUM_SHA256_33="deaba38d7abf1d4cca21cc89e932e542ba2b9258664d2a9ef0e61512039c9375"

SOURCE_URI_34="https://static.crates.io/crates/memoffset/memoffset-0.9.0.crate"
CHECKSUM_SHA256_34="5a634b1c61a95585bd15607c6ab0c4e5b226e695ff2800ba0cdccddf208c406c"

SOURCE_URI_35="https://static.crates.io/crates/num-traits/num-traits-0.2.17.crate"
CHECKSUM_SHA256_35="39e3200413f237f41ab11ad6d161bc7239c84dcb631773ccd7de3dfe4b5c267c"

SOURCE_URI_36="https://static.crates.io/crates/packed_simd/packed_simd-0.3.9.crate"
CHECKSUM_SHA256_36="1f9f08af0c877571712e2e3e686ad79efad9657dbf0f7c3c8ba943ff6c38932d"

SOURCE_URI_37="https://static.crates.io/crates/pcre2/pcre2-0.2.6.crate"
CHECKSUM_SHA256_37="4c9d53a8ea5fc3d3568d3de4bebc12606fd0eb8234c602576f1f1ee4880488a7"

SOURCE_URI_38="https://static.crates.io/crates/pcre2-sys/pcre2-sys-0.2.7.crate"
CHECKSUM_SHA256_38="8f8f5556f23cf2c0b481949fdfc19a7cd9b27ddcb00ef3477b0f4935cbdaedf2"

SOURCE_URI_39="https://static.crates.io/crates/pkg-config/pkg-config-0.3.27.crate"
CHECKSUM_SHA256_39="26072860ba924cbfa98ea39c8c19b4dd6a4a25423dbdf219c1eca91aa0cf6964"

SOURCE_URI_40="https://static.crates.io/crates/proc-macro2/proc-macro2-1.0.70.crate"
CHECKSUM_SHA256_40="39278fbbf5fb4f646ce651690877f89d1c5811a3d4acb27700c1cb3cdb78fd3b"

SOURCE_URI_41="https://static.crates.io/crates/quote/quote-1.0.33.crate"
CHECKSUM_SHA256_41="5267fca4496028628a95160fc423a33e8b2e6af8a5302579e322e4b520293cae"

SOURCE_URI_42="https://static.crates.io/crates/regex/regex-1.10.2.crate"
CHECKSUM_SHA256_42="380b951a9c5e80ddfd6136919eef32310721aa4aacd4889a8d39124b026ab343"

SOURCE_URI_43="https://static.crates.io/crates/regex-automata/regex-automata-0.4.3.crate"
CHECKSUM_SHA256_43="5f804c7828047e88b2d32e2d7fe5a105da8ee3264f01902f796c8e067dc2483f"

SOURCE_URI_44="https://static.crates.io/crates/regex-syntax/regex-syntax-0.8.2.crate"
CHECKSUM_SHA256_44="c08c74e62047bb2de4ff487b251e4a92e24f48745648451635cec7d591162d9f"

SOURCE_URI_45="https://static.crates.io/crates/ryu/ryu-1.0.15.crate"
CHECKSUM_SHA256_45="1ad4cc8da4ef723ed60bced201181d83791ad433213d8c24efffda1eec85d741"

SOURCE_URI_46="https://static.crates.io/crates/same-file/same-file-1.0.6.crate"
CHECKSUM_SHA256_46="93fc1dc3aaa9bfed95e02e6eadabb4baf7e3078b0bd1b4d7b6b0b68378900502"

SOURCE_URI_47="https://static.crates.io/crates/scopeguard/scopeguard-1.2.0.crate"
CHECKSUM_SHA256_47="94143f37725109f92c262ed2cf5e59bce7498c01bcc1502d7b9afe439a4e9f49"

SOURCE_URI_48="https://static.crates.io/crates/serde/serde-1.0.193.crate"
CHECKSUM_SHA256_48="25dd9975e68d0cb5aa1120c288333fc98731bd1dd12f561e468ea4728c042b89"

SOURCE_URI_49="https://static.crates.io/crates/serde_derive/serde_derive-1.0.193.crate"
CHECKSUM_SHA256_49="43576ca501357b9b071ac53cdc7da8ef0cbd9493d8df094cd821777ea6e894d3"

SOURCE_URI_50="https://static.crates.io/crates/serde_json/serde_json-1.0.108.crate"
CHECKSUM_SHA256_50="3d1c7e3eac408d115102c4c24ad393e0821bb3a5df4d506a80f85f7a742a526b"

SOURCE_URI_51="https://static.crates.io/crates/syn/syn-2.0.39.crate"
CHECKSUM_SHA256_51="23e78b90f2fcf45d3e842032ce32e3f2d1545ba6636271dcbf24fa306d87be7a"

SOURCE_URI_52="https://static.crates.io/crates/termcolor/termcolor-1.4.0.crate"
CHECKSUM_SHA256_52="ff1bc3d3f05aff0403e8ac0d92ced918ec05b666a43f83297ccef5bea8a3d449"

SOURCE_URI_53="https://static.crates.io/crates/textwrap/textwrap-0.16.0.crate"
CHECKSUM_SHA256_53="222a222a5bfe1bba4a77b45ec488a741b3cb8872e5e499451fd7d0129c9c7c3d"

SOURCE_URI_54="https://static.crates.io/crates/unicode-ident/unicode-ident-1.0.12.crate"
CHECKSUM_SHA256_54="3354b9ac3fae1ff6755cb6db53683adb661634f67557942dea4facebec0fee4b"

SOURCE_URI_55="https://static.crates.io/crates/walkdir/walkdir-2.4.0.crate"
CHECKSUM_SHA256_55="d71d857dc86794ca4c280d616f7da00d2dbfd8cd788846559a6813e6aa4b54ee"

SOURCE_URI_56="https://static.crates.io/crates/winapi/winapi-0.3.9.crate"
CHECKSUM_SHA256_56="5c839a674fcd7a98952e593242ea400abe93992746761e38641405d28b00f419"

SOURCE_URI_57="https://static.crates.io/crates/winapi-i686-pc-windows-gnu/winapi-i686-pc-windows-gnu-0.4.0.crate"
CHECKSUM_SHA256_57="ac3b87c63620426dd9b991e5ce0329eff545bccbbb34f3be09ff6fb6ab51b7b6"

SOURCE_URI_58="https://static.crates.io/crates/winapi-util/winapi-util-0.1.6.crate"
CHECKSUM_SHA256_58="f29e6f9198ba0d26b4c9f07dbe6f9ed633e1f3d5b8b414090084349e46a52596"

SOURCE_URI_59="https://static.crates.io/crates/winapi-x86_64-pc-windows-gnu/winapi-x86_64-pc-windows-gnu-0.4.0.crate"
CHECKSUM_SHA256_59="712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	ripgrep$secondaryArchSuffix = $portVersion
	cmd:rg
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:gcc$secondaryArchSuffix
	cmd:rustc$secondaryArchSuffix >= 1.39.0
	"

defineDebugInfoPackage ripgrep$secondaryArchSuffix \
	"$prefix"/bin/rg

BUILD()
{
	export CARGO_HOME=$sourceDir/../cargo
	vendor=$CARGO_HOME/haiku
	mkdir -p "$vendor"
	for i in $(seq 2 59); do
		eval "srcDir=\$sourceDir$i"
		eval "sha256sum=\$CHECKSUM_SHA256_$i"
		set -- "$srcDir"/*
		ln -sf "$1" "$vendor"
		cat <<-EOF >"$vendor/${1##*/}/.cargo-checksum.json"
		{
		  "package": "$sha256sum",
		  "files": {}
		}
		EOF
	done

	cat <<-EOF >"$CARGO_HOME"/config
	[source.haiku]
	directory = "$vendor"

	[source.crates-io]
	replace-with = "haiku"
	EOF

	cargo build --release --frozen --features pcre2
}

INSTALL()
{
	install -v -m 755 -d "$prefix"/bin "$docDir" "$manDir"/man1 \
		"$dataDir"/bash-completion/completions \
		"$dataDir"/zsh/site-functions

	install -v -m 755 ./target/release/rg "$prefix"/bin
	install -v -m 644 *.md "$docDir"

	./target/release/rg --generate man > "$manDir"/man1/rg.1

	./target/release/rg --generate complete-bash > \
		"$dataDir"/bash-completion/completions/rg

	./target/release/rg --generate complete-zsh > \
		"$dataDir"/zsh/site-functions/_rg
}

TEST()
{
	export CARGO_HOME=$sourceDir/../cargo
	cargo test --release --frozen --features pcre2
}
