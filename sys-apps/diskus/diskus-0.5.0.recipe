SUMMARY="A minimal, fast alternative to 'du -sb'"
DESCRIPTION="diskus is a very simple program that computes the total size of \
the current directory. It is a parallelized version of 'du -sb'. On the \
author's 8-core laptop, it is about nine times faster than 'du' for a cold disk \
cache and more than twice as fast on a warm disk cache."
HOMEPAGE="https://github.com/sharkdp/diskus"
COPYRIGHT="2018 diskus developers"
LICENSE="Apache v2
	MIT"
REVISION="1"
SOURCE_URI="$HOMEPAGE/archive/v$portVersion.tar.gz"
CHECKSUM_SHA256="90d785f3f24899a6adcc497846f29112812a887c8042d0657d6b258d5a5352bc"
SOURCE_FILENAME="diskus-$portVersion.tar.gz"
PATCHES="diskus-$portVersion.patch"

SOURCE_URI_2="https://static.crates.io/crates/ansi_term/ansi_term-0.11.0.crate"
CHECKSUM_SHA256_2="ee49baf6cb617b853aa8d93bf420db2383fab46d314482ca2803b40d5fde979b"

SOURCE_URI_3="https://static.crates.io/crates/arrayvec/arrayvec-0.4.8.crate"
CHECKSUM_SHA256_3="f405cc4c21cd8b784f6c8fc2adf9bc00f59558f0049b5ec21517f875963040cc"

SOURCE_URI_4="https://static.crates.io/crates/atty/atty-0.2.11.crate"
CHECKSUM_SHA256_4="9a7d5b8723950951411ee34d271d99dddcc2035a16ab25310ea2c8cfd4369652"

SOURCE_URI_5="https://static.crates.io/crates/bitflags/bitflags-1.0.4.crate"
CHECKSUM_SHA256_5="228047a76f468627ca71776ecdebd732a3423081fcf5125585bcd7c49886ce12"

SOURCE_URI_6="https://static.crates.io/crates/cfg-if/cfg-if-0.1.6.crate"
CHECKSUM_SHA256_6="082bb9b28e00d3c9d39cc03e64ce4cea0f1bb9b3fde493f0cbc008472d22bdf4"

SOURCE_URI_7="https://static.crates.io/crates/clap/clap-2.32.0.crate"
CHECKSUM_SHA256_7="b957d88f4b6a63b9d70d5f454ac8011819c6efa7727858f458ab71c756ce2d3e"

SOURCE_URI_8="https://static.crates.io/crates/cloudabi/cloudabi-0.0.3.crate"
CHECKSUM_SHA256_8="ddfc5b9aa5d4507acaf872de71051dfd0e309860e88966e1051e462a077aac4f"

SOURCE_URI_9="https://static.crates.io/crates/crossbeam-channel/crossbeam-channel-0.3.2.crate"
CHECKSUM_SHA256_9="0ac88e108fa40799b39c08eb2a93bedf4cc99a9e5577f08ddf6dd6134ae65bf0"

SOURCE_URI_10="https://static.crates.io/crates/crossbeam-deque/crossbeam-deque-0.2.0.crate"
CHECKSUM_SHA256_10="f739f8c5363aca78cfb059edf753d8f0d36908c348f3d8d1503f03d8b75d9cf3"

SOURCE_URI_11="https://static.crates.io/crates/crossbeam-epoch/crossbeam-epoch-0.3.1.crate"
CHECKSUM_SHA256_11="927121f5407de9956180ff5e936fe3cf4324279280001cd56b669d28ee7e9150"

SOURCE_URI_12="https://static.crates.io/crates/crossbeam-epoch/crossbeam-epoch-0.6.1.crate"
CHECKSUM_SHA256_12="2449aaa4ec7ef96e5fb24db16024b935df718e9ae1cec0a1e68feeca2efca7b8"

SOURCE_URI_13="https://static.crates.io/crates/crossbeam-utils/crossbeam-utils-0.2.2.crate"
CHECKSUM_SHA256_13="2760899e32a1d58d5abb31129f8fae5de75220bc2176e77ff7c627ae45c918d9"

SOURCE_URI_14="https://static.crates.io/crates/crossbeam-utils/crossbeam-utils-0.6.1.crate"
CHECKSUM_SHA256_14="c55913cc2799171a550e307918c0a360e8c16004820291bf3b638969b4a01816"

SOURCE_URI_15="https://static.crates.io/crates/either/either-1.5.0.crate"
CHECKSUM_SHA256_15="3be565ca5c557d7f59e7cfcf1844f9e3033650c929c6566f511e8005f205c1d0"

SOURCE_URI_16="https://static.crates.io/crates/fuchsia-zircon/fuchsia-zircon-0.3.3.crate"
CHECKSUM_SHA256_16="2e9763c69ebaae630ba35f74888db465e49e259ba1bc0eda7d06f4a067615d82"

SOURCE_URI_17="https://static.crates.io/crates/fuchsia-zircon-sys/fuchsia-zircon-sys-0.3.3.crate"
CHECKSUM_SHA256_17="3dcaa9ae7725d12cdb85b3ad99a434db70b468c09ded17e012d86b5c1010f7a7"

SOURCE_URI_18="https://static.crates.io/crates/humansize/humansize-1.1.0.crate"
CHECKSUM_SHA256_18="b6cab2627acfc432780848602f3f558f7e9dd427352224b0d9324025796d2a5e"

SOURCE_URI_19="https://static.crates.io/crates/kernel32-sys/kernel32-sys-0.2.2.crate"
CHECKSUM_SHA256_19="7507624b29483431c0ba2d82aece8ca6cdba9382bff4ddd0f7490560c056098d"

SOURCE_URI_20="https://static.crates.io/crates/lazy_static/lazy_static-1.2.0.crate"
CHECKSUM_SHA256_20="a374c89b9db55895453a74c1e38861d9deec0b01b405a82516e9d5de4820dea1"

SOURCE_URI_21="https://static.crates.io/crates/libc/libc-0.2.44.crate"
CHECKSUM_SHA256_21="10923947f84a519a45c8fefb7dd1b3e8c08747993381adee176d7a82b4195311"

SOURCE_URI_22="https://static.crates.io/crates/lock_api/lock_api-0.1.5.crate"
CHECKSUM_SHA256_22="62ebf1391f6acad60e5c8b43706dde4582df75c06698ab44511d15016bc2442c"

SOURCE_URI_23="https://static.crates.io/crates/memoffset/memoffset-0.2.1.crate"
CHECKSUM_SHA256_23="0f9dc261e2b62d7a622bf416ea3c5245cdd5d9a7fcc428c0d06804dfce1775b3"

SOURCE_URI_24="https://static.crates.io/crates/nodrop/nodrop-0.1.13.crate"
CHECKSUM_SHA256_24="2f9667ddcc6cc8a43afc9b7917599d7216aa09c463919ea32c59ed6cac8bc945"

SOURCE_URI_25="https://static.crates.io/crates/num_cpus/num_cpus-1.8.0.crate"
CHECKSUM_SHA256_25="c51a3322e4bca9d212ad9a158a02abc6934d005490c054a2778df73a70aa0a30"

SOURCE_URI_26="https://static.crates.io/crates/owning_ref/owning_ref-0.4.0.crate"
CHECKSUM_SHA256_26="49a4b8ea2179e6a2e27411d3bca09ca6dd630821cf6894c6c7c8467a8ee7ef13"

SOURCE_URI_27="https://static.crates.io/crates/parking_lot/parking_lot-0.6.4.crate"
CHECKSUM_SHA256_27="f0802bff09003b291ba756dc7e79313e51cc31667e94afbe847def490424cde5"

SOURCE_URI_28="https://static.crates.io/crates/parking_lot_core/parking_lot_core-0.3.1.crate"
CHECKSUM_SHA256_28="ad7f7e6ebdc79edff6fdcb87a55b620174f7a989e3eb31b65231f4af57f00b8c"

SOURCE_URI_29="https://static.crates.io/crates/rand/rand-0.5.5.crate"
CHECKSUM_SHA256_29="e464cd887e869cddcae8792a4ee31d23c7edd516700695608f5b98c67ee0131c"

SOURCE_URI_30="https://static.crates.io/crates/rand_core/rand_core-0.2.2.crate"
CHECKSUM_SHA256_30="1961a422c4d189dfb50ffa9320bf1f2a9bd54ecb92792fb9477f99a1045f3372"

SOURCE_URI_31="https://static.crates.io/crates/rand_core/rand_core-0.3.0.crate"
CHECKSUM_SHA256_31="0905b6b7079ec73b314d4c748701f6931eb79fd97c668caa3f1899b22b32c6db"

SOURCE_URI_32="https://static.crates.io/crates/rayon/rayon-1.0.3.crate"
CHECKSUM_SHA256_32="373814f27745b2686b350dd261bfd24576a6fb0e2c5919b3a2b6005f820b0473"

SOURCE_URI_33="https://static.crates.io/crates/rayon-core/rayon-core-1.4.1.crate"
CHECKSUM_SHA256_33="b055d1e92aba6877574d8fe604a63c8b5df60f60e5982bf7ccbb1338ea527356"

SOURCE_URI_34="https://static.crates.io/crates/redox_syscall/redox_syscall-0.1.42.crate"
CHECKSUM_SHA256_34="cf8fb82a4d1c9b28f1c26c574a5b541f5ffb4315f6c9a791fa47b6a04438fe93"

SOURCE_URI_35="https://static.crates.io/crates/redox_termios/redox_termios-0.1.1.crate"
CHECKSUM_SHA256_35="7e891cfe48e9100a70a3b6eb652fef28920c117d366339687bd5576160db0f76"

SOURCE_URI_36="https://static.crates.io/crates/rustc_version/rustc_version-0.2.3.crate"
CHECKSUM_SHA256_36="138e3e0acb6c9fb258b19b67cb8abd63c00679d2851805ea151465464fe9030a"

SOURCE_URI_37="https://static.crates.io/crates/scopeguard/scopeguard-0.3.3.crate"
CHECKSUM_SHA256_37="94258f53601af11e6a49f722422f6e3425c52b06245a5cf9bc09908b174f5e27"

SOURCE_URI_38="https://static.crates.io/crates/semver/semver-0.9.0.crate"
CHECKSUM_SHA256_38="1d7eb9ef2c18661902cc47e535f9bc51b78acd254da71d375c2f6720d9a40403"

SOURCE_URI_39="https://static.crates.io/crates/semver-parser/semver-parser-0.7.0.crate"
CHECKSUM_SHA256_39="388a1df253eca08550bef6c72392cfe7c30914bf41df5269b68cbd6ff8f570a3"

SOURCE_URI_40="https://static.crates.io/crates/smallvec/smallvec-0.6.6.crate"
CHECKSUM_SHA256_40="622df2d454c29a4d89b30dc3b27b42d7d90d6b9e587dbf8f67652eb7514da484"

SOURCE_URI_41="https://static.crates.io/crates/stable_deref_trait/stable_deref_trait-1.1.1.crate"
CHECKSUM_SHA256_41="dba1a27d3efae4351c8051072d619e3ade2820635c3958d826bfea39d59b54c8"

SOURCE_URI_42="https://static.crates.io/crates/strsim/strsim-0.7.0.crate"
CHECKSUM_SHA256_42="bb4f380125926a99e52bc279241539c018323fab05ad6368b56f93d9369ff550"

SOURCE_URI_43="https://static.crates.io/crates/term_size/term_size-0.3.1.crate"
CHECKSUM_SHA256_43="9e5b9a66db815dcfd2da92db471106457082577c3c278d4138ab3e3b4e189327"

SOURCE_URI_44="https://static.crates.io/crates/termion/termion-1.5.1.crate"
CHECKSUM_SHA256_44="689a3bdfaab439fd92bc87df5c4c78417d3cbe537487274e9b0b2dce76e92096"

SOURCE_URI_45="https://static.crates.io/crates/textwrap/textwrap-0.10.0.crate"
CHECKSUM_SHA256_45="307686869c93e71f94da64286f9a9524c0f308a9e1c87a583de8e9c9039ad3f6"

SOURCE_URI_46="https://static.crates.io/crates/unicode-width/unicode-width-0.1.5.crate"
CHECKSUM_SHA256_46="882386231c45df4700b275c7ff55b6f3698780a650026380e72dabe76fa46526"

SOURCE_URI_47="https://static.crates.io/crates/unreachable/unreachable-1.0.0.crate"
CHECKSUM_SHA256_47="382810877fe448991dfc7f0dd6e3ae5d58088fd0ea5e35189655f84e6814fa56"

SOURCE_URI_48="https://static.crates.io/crates/vec_map/vec_map-0.8.1.crate"
CHECKSUM_SHA256_48="05c78687fb1a80548ae3250346c3db86a80a7cdd77bda190189f2d0a0987c81a"

SOURCE_URI_49="https://static.crates.io/crates/void/void-1.0.2.crate"
CHECKSUM_SHA256_49="6a02e4885ed3bc0f2de90ea6dd45ebcbb66dacffe03547fadbb0eeae2770887d"

SOURCE_URI_50="https://static.crates.io/crates/winapi/winapi-0.2.8.crate"
CHECKSUM_SHA256_50="167dc9d6949a9b857f3451275e911c3f44255842c1f7a76f33c55103a909087a"

SOURCE_URI_51="https://static.crates.io/crates/winapi/winapi-0.3.6.crate"
CHECKSUM_SHA256_51="92c1eb33641e276cfa214a0522acad57be5c56b10cb348b3c5117db75f3ac4b0"

SOURCE_URI_52="https://static.crates.io/crates/winapi-build/winapi-build-0.1.1.crate"
CHECKSUM_SHA256_52="2d315eee3b34aca4797b2da6b13ed88266e6d612562a0c46390af8299fc699bc"

SOURCE_URI_53="https://static.crates.io/crates/winapi-i686-pc-windows-gnu/winapi-i686-pc-windows-gnu-0.4.0.crate"
CHECKSUM_SHA256_53="ac3b87c63620426dd9b991e5ce0329eff545bccbbb34f3be09ff6fb6ab51b7b6"

SOURCE_URI_54="https://static.crates.io/crates/winapi-x86_64-pc-windows-gnu/winapi-x86_64-pc-windows-gnu-0.4.0.crate"
CHECKSUM_SHA256_54="712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f"

ARCHITECTURES="!x86_gcc2 ?x86 x86_64"
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
SECONDARY_ARCHITECTURES="x86"
commandBinDir=$prefix/bin
fi

PROVIDES="
	diskus$secondaryArchSuffix = $portVersion
	cmd:diskus
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:cargo$secondaryArchSuffix
	cmd:gcc$secondaryArchSuffix
	"

defineDebugInfoPackage diskus$secondaryArchSuffix \
	$commandBinDir/diskus

BUILD()
{
	export CARGO_HOME=$sourceDir/../cargo
	CARGO_VENDOR=$CARGO_HOME/haiku
	mkdir -p $CARGO_VENDOR
	for i in {2..54}; do
		eval temp=\$sourceDir$i
		eval shasum=\$CHECKSUM_SHA256_$i
		pkg=$(basename $temp/*)
		cp -r $temp/$pkg $CARGO_VENDOR
		cat <<- EOF > $CARGO_VENDOR/$pkg/.cargo-checksum.json
		{
			"package": "$shasum",
			"files": {}
		}
		EOF
	done

	cat <<- EOF > $CARGO_HOME/config
	[source.haiku]
	directory = "$CARGO_VENDOR"

	[source.crates-io]
	replace-with = "haiku"
	EOF

	cargo build --release
}

INSTALL()
{
	install -D -m755 -t $commandBinDir target/release/diskus
	install -D -m644 -t $docDir README.md
}

TEST()
{
	cargo test --release
}
