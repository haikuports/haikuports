SUMMARY="A minimal, fast alternative to 'du -sb'"
DESCRIPTION="diskus is a very simple program that computes the total size of \
the current directory. It is a parallelized version of 'du -sb'. On the \
author's 8-core laptop, it is about nine times faster than 'du' for a cold disk \
cache and more than twice as fast on a warm disk cache."
HOMEPAGE="https://github.com/sharkdp/diskus"
COPYRIGHT="2018 diskus developers"
LICENSE="Apache v2
	MIT"
REVISION="1"
SOURCE_URI="$HOMEPAGE/archive/v$portVersion.tar.gz"
CHECKSUM_SHA256="e465dc9d4304c835108be522852dc3aea27f0233167433408a8d26f423c4d6ee"
SOURCE_FILENAME="diskus-$portVersion.tar.gz"
PATCHES="diskus-$portVersion.patch"

SOURCE_URI_2="https://static.crates.io/crates/ansi_term/ansi_term-0.11.0.crate"
CHECKSUM_SHA256_2="ee49baf6cb617b853aa8d93bf420db2383fab46d314482ca2803b40d5fde979b"

SOURCE_URI_3="https://static.crates.io/crates/arrayvec/arrayvec-0.4.7.crate"
CHECKSUM_SHA256_3="a1e964f9e24d588183fcb43503abda40d288c8657dfc27311516ce2f05675aef"

SOURCE_URI_4="https://static.crates.io/crates/atty/atty-0.2.11.crate"
CHECKSUM_SHA256_4="9a7d5b8723950951411ee34d271d99dddcc2035a16ab25310ea2c8cfd4369652"

SOURCE_URI_5="https://static.crates.io/crates/bitflags/bitflags-1.0.4.crate"
CHECKSUM_SHA256_5="228047a76f468627ca71776ecdebd732a3423081fcf5125585bcd7c49886ce12"

SOURCE_URI_6="https://static.crates.io/crates/cfg-if/cfg-if-0.1.6.crate"
CHECKSUM_SHA256_6="082bb9b28e00d3c9d39cc03e64ce4cea0f1bb9b3fde493f0cbc008472d22bdf4"

SOURCE_URI_7="https://static.crates.io/crates/clap/clap-2.32.0.crate"
CHECKSUM_SHA256_7="b957d88f4b6a63b9d70d5f454ac8011819c6efa7727858f458ab71c756ce2d3e"

SOURCE_URI_8="https://static.crates.io/crates/cloudabi/cloudabi-0.0.3.crate"
CHECKSUM_SHA256_8="ddfc5b9aa5d4507acaf872de71051dfd0e309860e88966e1051e462a077aac4f"

SOURCE_URI_9="https://static.crates.io/crates/crossbeam-channel/crossbeam-channel-0.3.0.crate"
CHECKSUM_SHA256_9="548dfc2fa4933009668d4a51f9ef074b8af8f2d6a6410225d76d6b1c3c56ca6f"

SOURCE_URI_10="https://static.crates.io/crates/crossbeam-deque/crossbeam-deque-0.2.0.crate"
CHECKSUM_SHA256_10="f739f8c5363aca78cfb059edf753d8f0d36908c348f3d8d1503f03d8b75d9cf3"

SOURCE_URI_11="https://static.crates.io/crates/crossbeam-epoch/crossbeam-epoch-0.3.1.crate"
CHECKSUM_SHA256_11="927121f5407de9956180ff5e936fe3cf4324279280001cd56b669d28ee7e9150"

SOURCE_URI_12="https://static.crates.io/crates/crossbeam-epoch/crossbeam-epoch-0.6.0.crate"
CHECKSUM_SHA256_12="9c90f1474584f38e270b5b613e898c8c328aa4f3dea85e0a27ac2e642f009416"

SOURCE_URI_13="https://static.crates.io/crates/crossbeam-utils/crossbeam-utils-0.2.2.crate"
CHECKSUM_SHA256_13="2760899e32a1d58d5abb31129f8fae5de75220bc2176e77ff7c627ae45c918d9"

SOURCE_URI_14="https://static.crates.io/crates/crossbeam-utils/crossbeam-utils-0.5.0.crate"
CHECKSUM_SHA256_14="677d453a17e8bd2b913fa38e8b9cf04bcdbb5be790aa294f2389661d72036015"

SOURCE_URI_15="https://static.crates.io/crates/either/either-1.5.0.crate"
CHECKSUM_SHA256_15="3be565ca5c557d7f59e7cfcf1844f9e3033650c929c6566f511e8005f205c1d0"

SOURCE_URI_16="https://static.crates.io/crates/fuchsia-zircon/fuchsia-zircon-0.3.3.crate"
CHECKSUM_SHA256_16="2e9763c69ebaae630ba35f74888db465e49e259ba1bc0eda7d06f4a067615d82"

SOURCE_URI_17="https://static.crates.io/crates/fuchsia-zircon-sys/fuchsia-zircon-sys-0.3.3.crate"
CHECKSUM_SHA256_17="3dcaa9ae7725d12cdb85b3ad99a434db70b468c09ded17e012d86b5c1010f7a7"

SOURCE_URI_18="https://static.crates.io/crates/humansize/humansize-1.1.0.crate"
CHECKSUM_SHA256_18="b6cab2627acfc432780848602f3f558f7e9dd427352224b0d9324025796d2a5e"

SOURCE_URI_19="https://static.crates.io/crates/kernel32-sys/kernel32-sys-0.2.2.crate"
CHECKSUM_SHA256_19="7507624b29483431c0ba2d82aece8ca6cdba9382bff4ddd0f7490560c056098d"

SOURCE_URI_20="https://static.crates.io/crates/lazy_static/lazy_static-1.1.0.crate"
CHECKSUM_SHA256_20="ca488b89a5657b0a2ecd45b95609b3e848cf1755da332a0da46e2b2b1cb371a7"

SOURCE_URI_21="https://static.crates.io/crates/libc/libc-0.2.43.crate"
CHECKSUM_SHA256_21="76e3a3ef172f1a0b9a9ff0dd1491ae5e6c948b94479a3021819ba7d860c8645d"

SOURCE_URI_22="https://static.crates.io/crates/lock_api/lock_api-0.1.4.crate"
CHECKSUM_SHA256_22="775751a3e69bde4df9b38dd00a1b5d6ac13791e4223d4a0506577f0dd27cfb7a"

SOURCE_URI_23="https://static.crates.io/crates/memoffset/memoffset-0.2.1.crate"
CHECKSUM_SHA256_23="0f9dc261e2b62d7a622bf416ea3c5245cdd5d9a7fcc428c0d06804dfce1775b3"

SOURCE_URI_24="https://static.crates.io/crates/nodrop/nodrop-0.1.12.crate"
CHECKSUM_SHA256_24="9a2228dca57108069a5262f2ed8bd2e82496d2e074a06d1ccc7ce1687b6ae0a2"

SOURCE_URI_25="https://static.crates.io/crates/num_cpus/num_cpus-1.8.0.crate"
CHECKSUM_SHA256_25="c51a3322e4bca9d212ad9a158a02abc6934d005490c054a2778df73a70aa0a30"

SOURCE_URI_26="https://static.crates.io/crates/owning_ref/owning_ref-0.3.3.crate"
CHECKSUM_SHA256_26="cdf84f41639e037b484f93433aa3897863b561ed65c6e59c7073d7c561710f37"

SOURCE_URI_27="https://static.crates.io/crates/parking_lot/parking_lot-0.6.4.crate"
CHECKSUM_SHA256_27="f0802bff09003b291ba756dc7e79313e51cc31667e94afbe847def490424cde5"

SOURCE_URI_28="https://static.crates.io/crates/parking_lot_core/parking_lot_core-0.3.1.crate"
CHECKSUM_SHA256_28="ad7f7e6ebdc79edff6fdcb87a55b620174f7a989e3eb31b65231f4af57f00b8c"

SOURCE_URI_29="https://static.crates.io/crates/rand/rand-0.5.5.crate"
CHECKSUM_SHA256_29="e464cd887e869cddcae8792a4ee31d23c7edd516700695608f5b98c67ee0131c"

SOURCE_URI_30="https://static.crates.io/crates/rand_core/rand_core-0.2.2.crate"
CHECKSUM_SHA256_30="1961a422c4d189dfb50ffa9320bf1f2a9bd54ecb92792fb9477f99a1045f3372"

SOURCE_URI_31="https://static.crates.io/crates/rand_core/rand_core-0.3.0.crate"
CHECKSUM_SHA256_31="0905b6b7079ec73b314d4c748701f6931eb79fd97c668caa3f1899b22b32c6db"

SOURCE_URI_32="https://static.crates.io/crates/rayon/rayon-1.0.3.crate"
CHECKSUM_SHA256_32="373814f27745b2686b350dd261bfd24576a6fb0e2c5919b3a2b6005f820b0473"

SOURCE_URI_33="https://static.crates.io/crates/rayon-core/rayon-core-1.4.1.crate"
CHECKSUM_SHA256_33="b055d1e92aba6877574d8fe604a63c8b5df60f60e5982bf7ccbb1338ea527356"

SOURCE_URI_34="https://static.crates.io/crates/redox_syscall/redox_syscall-0.1.40.crate"
CHECKSUM_SHA256_34="c214e91d3ecf43e9a4e41e578973adeb14b474f2bee858742d127af75a0112b1"

SOURCE_URI_35="https://static.crates.io/crates/redox_termios/redox_termios-0.1.1.crate"
CHECKSUM_SHA256_35="7e891cfe48e9100a70a3b6eb652fef28920c117d366339687bd5576160db0f76"

SOURCE_URI_36="https://static.crates.io/crates/rustc_version/rustc_version-0.2.3.crate"
CHECKSUM_SHA256_36="138e3e0acb6c9fb258b19b67cb8abd63c00679d2851805ea151465464fe9030a"

SOURCE_URI_37="https://static.crates.io/crates/scopeguard/scopeguard-0.3.3.crate"
CHECKSUM_SHA256_37="94258f53601af11e6a49f722422f6e3425c52b06245a5cf9bc09908b174f5e27"

SOURCE_URI_38="https://static.crates.io/crates/semver/semver-0.9.0.crate"
CHECKSUM_SHA256_38="1d7eb9ef2c18661902cc47e535f9bc51b78acd254da71d375c2f6720d9a40403"

SOURCE_URI_39="https://static.crates.io/crates/semver-parser/semver-parser-0.7.0.crate"
CHECKSUM_SHA256_39="388a1df253eca08550bef6c72392cfe7c30914bf41df5269b68cbd6ff8f570a3"

SOURCE_URI_40="https://static.crates.io/crates/smallvec/smallvec-0.6.5.crate"
CHECKSUM_SHA256_40="153ffa32fd170e9944f7e0838edf824a754ec4c1fc64746fcc9fe1f8fa602e5d"

SOURCE_URI_41="https://static.crates.io/crates/stable_deref_trait/stable_deref_trait-1.1.1.crate"
CHECKSUM_SHA256_41="dba1a27d3efae4351c8051072d619e3ade2820635c3958d826bfea39d59b54c8"

SOURCE_URI_42="https://static.crates.io/crates/strsim/strsim-0.7.0.crate"
CHECKSUM_SHA256_42="bb4f380125926a99e52bc279241539c018323fab05ad6368b56f93d9369ff550"

SOURCE_URI_43="https://static.crates.io/crates/term_size/term_size-0.3.1.crate"
CHECKSUM_SHA256_43="9e5b9a66db815dcfd2da92db471106457082577c3c278d4138ab3e3b4e189327"

SOURCE_URI_44="https://static.crates.io/crates/termion/termion-1.5.1.crate"
CHECKSUM_SHA256_44="689a3bdfaab439fd92bc87df5c4c78417d3cbe537487274e9b0b2dce76e92096"

SOURCE_URI_45="https://static.crates.io/crates/textwrap/textwrap-0.10.0.crate"
CHECKSUM_SHA256_45="307686869c93e71f94da64286f9a9524c0f308a9e1c87a583de8e9c9039ad3f6"

SOURCE_URI_46="https://static.crates.io/crates/unicode-width/unicode-width-0.1.5.crate"
CHECKSUM_SHA256_46="882386231c45df4700b275c7ff55b6f3698780a650026380e72dabe76fa46526"

SOURCE_URI_47="https://static.crates.io/crates/unreachable/unreachable-1.0.0.crate"
CHECKSUM_SHA256_47="382810877fe448991dfc7f0dd6e3ae5d58088fd0ea5e35189655f84e6814fa56"

SOURCE_URI_48="https://static.crates.io/crates/vec_map/vec_map-0.8.1.crate"
CHECKSUM_SHA256_48="05c78687fb1a80548ae3250346c3db86a80a7cdd77bda190189f2d0a0987c81a"

SOURCE_URI_49="https://static.crates.io/crates/version_check/version_check-0.1.5.crate"
CHECKSUM_SHA256_49="914b1a6776c4c929a602fafd8bc742e06365d4bcbe48c30f9cca5824f70dc9dd"

SOURCE_URI_50="https://static.crates.io/crates/void/void-1.0.2.crate"
CHECKSUM_SHA256_50="6a02e4885ed3bc0f2de90ea6dd45ebcbb66dacffe03547fadbb0eeae2770887d"

SOURCE_URI_51="https://static.crates.io/crates/winapi/winapi-0.2.8.crate"
CHECKSUM_SHA256_51="167dc9d6949a9b857f3451275e911c3f44255842c1f7a76f33c55103a909087a"

SOURCE_URI_52="https://static.crates.io/crates/winapi/winapi-0.3.6.crate"
CHECKSUM_SHA256_52="92c1eb33641e276cfa214a0522acad57be5c56b10cb348b3c5117db75f3ac4b0"

SOURCE_URI_53="https://static.crates.io/crates/winapi-build/winapi-build-0.1.1.crate"
CHECKSUM_SHA256_53="2d315eee3b34aca4797b2da6b13ed88266e6d612562a0c46390af8299fc699bc"

SOURCE_URI_54="https://static.crates.io/crates/winapi-i686-pc-windows-gnu/winapi-i686-pc-windows-gnu-0.4.0.crate"
CHECKSUM_SHA256_54="ac3b87c63620426dd9b991e5ce0329eff545bccbbb34f3be09ff6fb6ab51b7b6"

SOURCE_URI_55="https://static.crates.io/crates/winapi-x86_64-pc-windows-gnu/winapi-x86_64-pc-windows-gnu-0.4.0.crate"
CHECKSUM_SHA256_55="712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f"

ARCHITECTURES="!x86_gcc2 ?x86 x86_64"
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
SECONDARY_ARCHITECTURES="x86"
commandBinDir=$prefix/bin
fi

PROVIDES="
	diskus$secondaryArchSuffix = $portVersion
	cmd:diskus
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:cargo$secondaryArchSuffix
	cmd:gcc$secondaryArchSuffix
	"

defineDebugInfoPackage diskus$secondaryArchSuffix \
	$commandBinDir/diskus

BUILD()
{
	export CARGO_HOME=$sourceDir/../cargo
	CARGO_VENDOR=$CARGO_HOME/haiku
	mkdir -p $CARGO_VENDOR
	for i in {2..55}; do
		eval temp=\$sourceDir$i
		eval shasum=\$CHECKSUM_SHA256_$i
		pkg=$(basename $temp/*)
		cp -r $temp/$pkg $CARGO_VENDOR
		cat <<- EOF > $CARGO_VENDOR/$pkg/.cargo-checksum.json
		{
			"package": "$shasum",
			"files": {}
		}
		EOF
	done

	cat <<- EOF > $CARGO_HOME/config
	[source.haiku]
	directory = "$CARGO_VENDOR"

	[source.crates-io]
	replace-with = "haiku"
	EOF

	cargo build --release
}

INSTALL()
{
	install -D -m755 -t $commandBinDir target/release/diskus
	install -D -m644 -t $docDir README.md
}
