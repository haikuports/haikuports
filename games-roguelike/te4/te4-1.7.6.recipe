SUMMARY="Tales of Maj'Eyal: Age of Ascendancy"
DESCRIPTION="Tales of Maj’Eyal (ToME) is a free, open source roguelike RPG, featuring tactical \
turn-based combat and advanced character building. Play as one of many unique races and classes \
in the lore-filled world of Eyal, exploring random dungeons, facing challenging battles, and \
developing characters with your own tailored mix of abilities and powers.  With a modern graphical \
and customisable interface, intuitive mouse control, streamlined mechanics and deep, challenging combat, \
Tales of Maj’Eyal offers engaging roguelike gameplay for the 21st century."
HOMEPAGE="https://te4.org/"
COPYRIGHT="2009-2023 Darkgod (Nicolas Casalini)"
LICENSE="GNU GPL v3"
REVISION="1"
SOURCE_URI="https://te4.org/dl/t-engine/t-engine4-src-$portVersion.tar.bz2"
CHECKSUM_SHA256="989dea00803f8cdcade024f4647d480bb1ac0d437c254292c07549c272a4680c"
SOURCE_DIR="t-engine4-src-$portVersion"
PATCHES="te4-$portVersion.patchset"
ADDITIONAL_FILES="t-engine.rdef.in"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURE="x86"

PROVIDES="
	te4$secondaryArchSuffix = $portVersion
	cmd:t_engine = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libgl$secondaryArchSuffix
	lib:libglu$secondaryArchSuffix
	lib:libopenal$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
	lib:libSDL2_2.0$secondaryArchSuffix
	lib:libSDL2_ttf_2.0$secondaryArchSuffix
	lib:libSDL2_image_2.0$secondaryArchSuffix
	lib:libvorbisfile$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libgl$secondaryArchSuffix
	devel:libglu$secondaryArchSuffix
	devel:libopenal$secondaryArchSuffix
	devel:libpng16$secondaryArchSuffix
	devel:libSDL2_2.0$secondaryArchSuffix
	devel:libSDL2_ttf_2.0$secondaryArchSuffix
	devel:libSDL2_image_2.0$secondaryArchSuffix
	devel:libvorbisfile$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:clang$secondaryArchSuffix
	cmd:gcc$secondaryArchSuffix
	cmd:make
	cmd:premake4$secondaryArchSuffix
	"

defineDebugInfoPackage te4$secondaryArchSuffix \
	$prefix/bin/t-engine

BUILD()
{
	# LuaVM used: --lua=default standard. Not specified: LuaJIT (doesn't compile)
	premake4 --lua=default --os=haiku gmake

	# Builds: config=release makes a release build. Not specified: debug build
	make $jobArgs
}

INSTALL()
{
	mkdir -p $prefix/bin $dataDir/t-engine
	cp t-engine $prefix/bin
	cp -r bootstrap game $dataDir/t-engine

	# Generate the rdef
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	sed \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		$portDir/additional-files/t-engine.rdef.in > t-engine.rdef

	addResourcesToBinaries t-engine.rdef $prefix/bin/t-engine
	addAppDeskbarSymlink $prefix/bin/t-engine "Tales of Maj'Eyal"
}

