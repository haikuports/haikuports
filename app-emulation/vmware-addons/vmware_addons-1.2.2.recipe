SUMMARY="Tools for using Haiku in a VMware virtual machine"
DESCRIPTION="VMware add-ons are a set of tools to enhance interaction \
between Haiku, running in a virtual machine, and the host operating system. \
It is like the official VMware tools on Windows or Linux.

It currently provides:
 * Clipboard sharing between Haiku and the host OS.
 * Mouse sharing: the mouse can seamlessly enter and leave the VM window.
 * Disk compacting: starts the VMware \"shrink\" process, which reduces the \
size of \"auto-expanding\" virtual disks attached to the virtual machine. \
The free space on disks is cleaned up previously, in order to get better \
results.
 * Graphics driver for VMware: you can choose your preferred resolution \
using Screen preflet in Haiku.
 * Graphics driver for VirtualBox: change grapchics card in VM setting \
to VMSVGA and video memory size to 64 MB to get higher resolutions working."
 * Shared folders: folders from the host OS can be mounted in Haiku:
   mount -t vmwfs ~/Shared

HOMEPAGE="https://github.com/HaikuArchives/VMwareAddons"
COPYRIGHT="1999 Be, Inc.
	2007 Haiku, Inc.
	2009 Vincent Duvert"
LICENSE="MIT"
REVISION="2"
srcGitRev="7781fdc08c327709801054afa1c30709b9bcae60"
SOURCE_URI="https://github.com/HaikuArchives/VMwareAddons/archive/$srcGitRev.tar.gz"
CHECKSUM_SHA256="d55e2c32cc3f42e43c3c4b333d8d25b438bab3ce87d0a9a6e96c2d0ac0f559a5"
SOURCE_FILENAME="VMwareAddons-$srcGitRev.tar.gz"
SOURCE_DIR="VMwareAddons-$srcGitRev"

ARCHITECTURES="x86-64 x86_gcc2 x86"
SECONDARY_ARCHITECTURES="x86_gcc2 x86"

PROVIDES="
	vmware_addons$secondaryArchSuffix = $portVersion
	cmd:run_backdoor$secondaryArchSuffix = $portVersion
	cmd:vmware_tray$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	makefile_engine
	cmd:gcc$secondaryArchSuffix
	cmd:make
	"

BUILD()
{
	make -C vmware_fs $jobArgs OBJ_DIR=objects
	make -C vmware_mouse $jobArgs OBJ_DIR=objects
	make -C vmware_tray $jobArgs OBJ_DIR=objects
	make -C vmware_video/accelerant $jobArgs OBJ_DIR=objects
	make -C vmware_video/kernel $jobArgs OBJ_DIR=objects
	cd enhanced_backdoor
	make
}

INSTALL()
{
	mkdir -p $prefix/add-ons/kernel/file_systems
	cp vmware_fs/objects/vmwfs $prefix/add-ons/kernel/file_systems

	mkdir -p $prefix/add-ons/input_server/filters
	cp vmware_mouse/objects/vmware_mouse $prefix/add-ons/input_server/filters

	mkdir -p $binDir
	cp vmware_tray/objects/vmware_tray $binDir
	cp enhanced_backdoor/run_backdoor $binDir

	mkdir -p $prefix/add-ons/accelerants
	cp vmware_video/accelerant/objects/vmware.accelerant $prefix/add-ons/accelerants

	mkdir -p $prefix/add-ons/kernel/drivers/bin
	cp vmware_video/kernel/objects/vmware $prefix/add-ons/kernel/drivers/bin

	mkdir -p $prefix/add-ons/kernel/drivers/dev/graphics
	cd $prefix/add-ons/kernel/drivers/dev/graphics
	ln -s ../../bin/vmware .

	# Add a symlink to the Desktop applets directory in Deskbar
	desktopAppletsDir="$dataDir/deskbar/menu/Desktop applets"
	mkdir -p "$desktopAppletsDir"
	ln -r -s $binDir/vmware_tray "$desktopAppletsDir/VMware add-ons"
}
