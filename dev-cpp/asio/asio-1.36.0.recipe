SUMMARY="Asynchronous Network Library"
DESCRIPTION="Asio is a cross-platform C++ library for network and low-level I/O programming \
that provides developers with a consistent asynchronous model using a modern C++ approach"
HOMEPAGE="https://github.com/chriskohlhoff/asio/"
COPYRIGHT="2003-2025 Christopher M. Kohlhoff"
LICENSE="Boost v1.0"
REVISION="1"
ASIO_VERSION=`echo $portVersion | sed 's/\./-/g'`
SOURCE_URI="https://github.com/chriskohlhoff/asio/archive/refs/tags/asio-$ASIO_VERSION.tar.gz"
CHECKSUM_SHA256="0310a76b27e1854f09f696b30de57dc490b5e1b17faed1eb8c9a2891f956e52b"
SOURCE_DIR="asio-asio-$ASIO_VERSION"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	asio$secondaryArchSuffix
	devel:libasio$secondaryArchSuffix
	"
REQUIRES="
	haiku$secondaryArchSuffix
	devel:libboost_coroutine$secondaryArchSuffix
	devel:libboost_regex$secondaryArchSuffix
#	devel:libssl$secondaryArchSuffix >= 3
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libboost_coroutine$secondaryArchSuffix >= 1.88.0
	devel:libboost_regex$secondaryArchSuffix >= 1.88.0
#	devel:libssl$secondaryArchSuffix >= 3
	"
BUILD_PREREQUIRES="
	autoconf_archive
	cmd:aclocal
	cmd:autoconf
	cmd:automake
	cmd:gcc$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	export CXXFLAGS="-D_DEFAULT_SOURCE -O2"
	export LIBS="-lbsd"
	cd asio
	autoupdate
	aclocal
	autoconf
	automake --add-missing
	runConfigure ./configure
	make $jobArgs
}

INSTALL()
{
	cd asio
	make install $jobArgs

	fixPkgconfig
}

TEST()
{
	# examples:
	# ============================================================================
	# Testsuite summary for asio 1.36.0
	# ============================================================================
	# TOTAL: 171
	# PASS:  171
	# SKIP:  0
	# XFAIL: 0
	# FAIL:  0
	# XPASS: 0
	# ERROR: 0
	# ============================================================================

	# unit tests:
	# ============================================================================
	# Testsuite summary for asio 1.36.0
	# ============================================================================
	# TOTAL: 170
	# PASS:  167
	# SKIP:  0
	# XFAIL: 0
	# FAIL:  3
	# XPASS: 0
	# ERROR: 0
	# ============================================================================
	# FAIL: unit/ip/multicast
	# FAIL: unit/ip/v6_only
	# FAIL: unit/socket_base

	cd asio
	make check $jobArgs
}
