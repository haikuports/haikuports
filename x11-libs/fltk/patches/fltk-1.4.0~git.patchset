From 1fa24656d02f2cc2723e1f350c044097cad14d75 Mon Sep 17 00:00:00 2001
From: Begasus <begasus@gmail.com>
Date: Sun, 30 Jul 2023 17:55:17 +0000
Subject: Fix crash


diff --git a/src/drivers/Xlib/Fl_Xlib_Graphics_Driver_image.cxx b/src/drivers/Xlib/Fl_Xlib_Graphics_Driver_image.cxx
index 78c08af..35da102 100644
--- a/src/drivers/Xlib/Fl_Xlib_Graphics_Driver_image.cxx
+++ b/src/drivers/Xlib/Fl_Xlib_Graphics_Driver_image.cxx
@@ -874,6 +874,7 @@ void Fl_Xlib_Graphics_Driver::draw_fixed(Fl_Pixmap *pxm, int X, int Y, int W, in
     // make X use the bitmap as a mask:
     XSetClipMask(fl_display, gc_, *Fl_Graphics_Driver::mask(pxm));
     XSetClipOrigin(fl_display, gc_, X-cx, Y-cy);
+#ifndef __HAIKU__
     if (clip_region()) {
       // At this point, XYWH is the bounding box of the intersection between
       // the current clip region and the (portion of the) pixmap we have to draw.
@@ -895,7 +896,9 @@ void Fl_Xlib_Graphics_Driver::draw_fixed(Fl_Pixmap *pxm, int X, int Y, int W, in
         XCopyArea(fl_display, *Fl_Graphics_Driver::id(pxm), fl_window, gc_, cx + (X1 - X), cy + (Y1 - Y), W1, H1, X1, Y1);
       }
       XDestroyRegion(r);
-    } else {
+    } else
+#endif
+    {
       XCopyArea(fl_display, *Fl_Graphics_Driver::id(pxm), fl_window, gc_, cx, cy, W, H, X, Y);
     }
     // put the old clip region back
-- 
2.37.3


From 92642d009c08a3b60a1705d48d85e987a5ba6567 Mon Sep 17 00:00:00 2001
From: Begasus <begasus@gmail.com>
Date: Sun, 30 Jul 2023 18:01:30 +0000
Subject: Fix config path


diff --git a/src/drivers/Unix/Fl_Unix_System_Driver.cxx b/src/drivers/Unix/Fl_Unix_System_Driver.cxx
index 1efe01b..e0e869a 100644
--- a/src/drivers/Unix/Fl_Unix_System_Driver.cxx
+++ b/src/drivers/Unix/Fl_Unix_System_Driver.cxx
@@ -468,7 +468,11 @@ char *Fl_Unix_System_Driver::preference_rootnode(Fl_Preferences * /*prefs*/,
       strlcpy(filename, home, FL_PATH_MAX);
       if (filename[strlen(filename) - 1] != '/')
         strlcat(filename, "/", FL_PATH_MAX);
-      strlcat(filename, ".fltk/", FL_PATH_MAX);
+      #if (defined(__HAIKU__))
+        strlcat(filename, "config/settings/fltk/", FL_PATH_MAX);
+      #else
+        strlcat(filename, ".fltk/", FL_PATH_MAX);
+      #endif
       break;
     case Fl_Preferences::SYSTEM:
       strcpy(filename, "/etc/fltk/");
-- 
2.37.3

