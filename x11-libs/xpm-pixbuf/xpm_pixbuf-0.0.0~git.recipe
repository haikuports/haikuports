SUMMARY="Utilities for rendering XPM icons to a GdkPixbuf (devel branch)"
DESCRIPTION="A very stripped down and rearranged version of the old xpm pixbuf loader, providing \
a single function (hopefully) suitable for the likes of Dia to port away from \
gdk_pixbuf_new_from_xpm_data"
HOMEPAGE="https://gitlab.gnome.org/ZanderBrown/xpm-pixbuf/"
COPYRIGHT="2024 Zander Brown"
LICENSE="GNU LGPL v2.1"
REVISION="2"
srcGitRev="d290a0c846687b22d2a8c5aaec83a6689f30e1c3"
SOURCE_URI="https://gitlab.gnome.org/ZanderBrown/xpm-pixbuf/-/archive/$srcGitRev.tar.gz"
CHECKSUM_SHA256="f45615a60b7d1948f27a44f4d4347405c12fcf71684ed64bcb7b1c10b189b706"
SOURCE_FILENAME="xpm-pixbuf-$srcGitRev.tar.gz"
SOURCE_DIR="xpm-pixbuf-$srcGitRev"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	xpm_pixbuf$secondaryArchSuffix = $portVersion
	lib:libxpm_pixbuf$secondaryArchSuffix = 0
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libgdk_pixbuf_2.0$secondaryArchSuffix
	lib:libglib_2.0$secondaryArchSuffix
	lib:libgobject_2.0$secondaryArchSuffix
	"

PROVIDES_devel="
	xpm_pixbuf${secondaryArchSuffix}_devel = $portVersion
	devel:libxpm_pixbuf$secondaryArchSuffix = 0
	"
REQUIRES_devel="
	xpm_pixbuf$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libgdk_pixbuf_2.0$secondaryArchSuffix
	devel:libglib_2.0$secondaryArchSuffix
	devel:libgobject_2.0$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:meson
	cmd:ninja
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	meson setup build \
		--buildtype=release \
		-Ddefault_library=shared \
		--prefix=$prefix \
		--libdir=$libDir

	ninja -C build $jobArgs
}

INSTALL()
{
	ninja -C build install

	prepareInstalledDevelLib \
		libxpm-pixbuf
	fixPkgconfig

	packageEntries devel \
		"$developDir"
}
