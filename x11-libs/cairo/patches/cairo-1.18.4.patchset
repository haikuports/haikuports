From 3d8d925c4bb5af8d01eaf5b52b1282f3f8195e79 Mon Sep 17 00:00:00 2001
From: Begasus <begasus@gmail.com>
Date: Sun, 24 Sep 2023 15:41:34 +0200
Subject: Xlib: Do not attempt to use shm.


diff --git a/src/cairo-xlib-surface-shm.c b/src/cairo-xlib-surface-shm.c
index 85a0369..6c0a7da 100644
--- a/src/cairo-xlib-surface-shm.c
+++ b/src/cairo-xlib-surface-shm.c
@@ -37,12 +37,12 @@
 
 #include "cairoint.h"
 
-#if !CAIRO_HAS_XLIB_XCB_FUNCTIONS
+#if 1
 
 #include "cairo-xlib-private.h"
 #include "cairo-xlib-surface-private.h"
 
-#if !HAVE_X11_EXTENSIONS_XSHM_H || !(HAVE_X11_EXTENSIONS_SHMPROTO_H || HAVE_X11_EXTENSIONS_SHMSTR_H)
+#if 1
 void _cairo_xlib_display_init_shm (cairo_xlib_display_t *display)
 {
     display->shm = NULL;
diff --git a/src/cairo-xlib-surface.c b/src/cairo-xlib-surface.c
index fac2911..259eea8 100644
--- a/src/cairo-xlib-surface.c
+++ b/src/cairo-xlib-surface.c
@@ -79,7 +79,9 @@
 
 #include <X11/extensions/XShm.h>
 #include <sys/ipc.h>
+#ifndef __HAIKU__
 #include <sys/shm.h>
+#endif
 
 #define DEBUG 0
 
-- 
2.51.0


From 587e812c45c75309525f378f2130f2ec8abc7878 Mon Sep 17 00:00:00 2001
From: Begasus <begasus@gmail.com>
Date: Sun, 24 Sep 2023 16:57:05 +0200
Subject: Fix linking and building the tests


diff --git a/meson.build b/meson.build
index cc13180..2b688f1 100644
--- a/meson.build
+++ b/meson.build
@@ -44,7 +44,7 @@ cflags = []
 if cc.get_id() != 'msvc'
   cflags += [
     '-Wmissing-declarations',
-    '-Werror-implicit-function-declaration',
+    '-Wno-error-implicit-function-declaration',
     '-Wpointer-arith',
     '-Wwrite-strings',
     '-Wsign-compare',
@@ -484,6 +484,14 @@ if host_machine.system() == 'darwin' and not get_option('quartz').disabled()
   endif
 endif
 
+if host_machine.system() == 'haiku'
+  haiku_extra_deps = [
+    cc.find_library('network'),
+    cc.find_library('gnu')
+  ]
+  deps += haiku_extra_deps
+endif
+
 if host_machine.system() == 'windows'
   add_languages('cpp', native: false)
 
-- 
2.51.0


From a9cf1735bebd329fb5b7aaaa6d49d438dba05a9d Mon Sep 17 00:00:00 2001
From: Luc Schrijvers <begasus@gmail.com>
Date: Wed, 26 Nov 2025 13:19:05 +0100
Subject: Fix for mismatching cpu_set_t and CPU_ISSET


diff --git a/perf/cairo-perf-micro.c b/perf/cairo-perf-micro.c
index 618272e..323521d 100644
--- a/perf/cairo-perf-micro.c
+++ b/perf/cairo-perf-micro.c
@@ -52,6 +52,11 @@
 #define CAIRO_PERF_ITERATION_MS_DEFAULT		2000
 #define CAIRO_PERF_ITERATION_MS_FAST		5
 
+#ifdef __HAIKU__
+#define cpu_set_t cpuset_t
+#define CPU_ISSET CPUSET_ISSET
+#endif
+
 typedef struct _cairo_perf_case {
     CAIRO_PERF_RUN_DECL (*run);
     cairo_bool_t (*enabled) (cairo_perf_t *perf);
-- 
2.51.0

