From 707d1d23dfdcc2a62366efb8bc6d2945ae05b53b Mon Sep 17 00:00:00 2001
From: Jerome Duval <jerome.duval@gmail.com>
Date: Thu, 26 Oct 2017 14:53:57 +0200
Subject: Haiku patch


diff --git a/configure.ac b/configure.ac
index 4e6f028..a9e3549 100644
--- a/configure.ac
+++ b/configure.ac
@@ -91,8 +91,8 @@ XCBPROTO_XCBPYTHONDIR=`$PKG_CONFIG --variable=pythondir xcb-proto`
 AC_MSG_RESULT($XCBPROTO_XCBPYTHONDIR)
 AC_SUBST(XCBPROTO_XCBPYTHONDIR)
 
-AC_SEARCH_LIBS(getaddrinfo, socket)
-AC_SEARCH_LIBS(connect, socket)
+AC_SEARCH_LIBS(getaddrinfo, [network socket])
+AC_SEARCH_LIBS(connect, [network socket])
 
 # Find support for sending a message from a socket
 AC_SEARCH_LIBS(sendmsg, socket, [have_sendmsg="yes"], [have_sendmsg="no"])
diff --git a/src/xcb_util.c b/src/xcb_util.c
index 5124d14..d2946d4 100644
--- a/src/xcb_util.c
+++ b/src/xcb_util.c
@@ -472,7 +472,7 @@ static int _xcb_open_unix(char *protocol, const char *file)
     strcpy(addr.sun_path, file);
     addr.sun_family = AF_UNIX;
 #ifdef HAVE_SOCKADDR_SUN_LEN
-    addr.sun_len = SUN_LEN(&addr);
+    addr.sun_len = sizeof(&addr);
 #endif
     fd = _xcb_socket(AF_UNIX, SOCK_STREAM, 0);
     if(fd == -1)
-- 
2.48.1

