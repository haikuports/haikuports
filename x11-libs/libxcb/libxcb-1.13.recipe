SUMMARY="X.Org's C Bindings library"
DESCRIPTION="XCB provides application binary interface compatibility with \
both Xlib and XCB, providing an incremental porting path. XCB uses \
the protocol layer of Xlib, but replaces the Xlib transport layer with \
XCB, and provides access to the underlying XCB connection for direct use \
of XCB.
XCB allows an application to open a single connection to the Xdisplay server \
and use both XCB and Xlib, possibly through a mixture of libraries designed \
for one or the other."
HOMEPAGE="https://xcb.freedesktop.org/"
COPYRIGHT="2001-2006 Bart Massey, Jamey Sharp, and Josh Triplett"
LICENSE="MIT (no promotion)"
REVISION="1"
SOURCE_URI="https://xcb.freedesktop.org/dist/libxcb-$portVersion.tar.gz"
CHECKSUM_SHA256="0bb3cfd46dbd90066bf4d7de3cad73ec1024c7325a4a0cbf5f4a0d4fa91155fb"
PATCHES="libxcb-$portVersion.patchset"

ARCHITECTURES="x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86_gcc2 x86"

libVersionXcb="1.1.0"
libVersionCompatXcb="$libVersionXcb compat >= ${libVersionXcb%%.*}"
libVersionSync="1.0.0"
libVersionCompatSync="$libVersionSync compat >= ${libVersionSync%%.*}"
libVersionRandr="0.1.0"
libVersionCompatRandr="$libVersionRandr compat >= ${libVersionRandr%%.*}"
libVersion="0.0.0"
libVersionCompat="$libVersion compat >= ${libVersion%%.*}"

PROVIDES="
	libxcb$secondaryArchSuffix = $portVersion
	lib:libxcb$secondaryArchSuffix = $libVersionCompatXcb
	lib:libxcb_composite$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_damage$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_dpms$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_dri2$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_dri3$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_glx$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_present$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_randr$secondaryArchSuffix = $libVersionCompatRandr
	lib:libxcb_record$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_render$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_res$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_screensaver$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_shape$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_shm$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_sync$secondaryArchSuffix = $libVersionCompatSync
	lib:libxcb_xf86dri$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_xfixes$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_xinerama$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_xinput$secondaryArchSuffix = $libVersionCompatRandr
	lib:libxcb_xkb$secondaryArchSuffix = $libVersionCompatSync
	lib:libxcb_xtest$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_xv$secondaryArchSuffix = $libVersionCompat
	lib:libxcb_xvmc$secondaryArchSuffix = $libVersionCompat
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libxslt$secondaryArchSuffix
	lib:libxau$secondaryArchSuffix
	"

PROVIDES_devel="
	libxcb${secondaryArchSuffix}_devel = $portVersion
	devel:libxcb$secondaryArchSuffix = $libVersionCompatXcb
	devel:libxcb_composite$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_damage$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_dpms$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_dri2$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_dri3$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_glx$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_present$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_randr$secondaryArchSuffix = $libVersionCompatRandr
	devel:libxcb_record$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_render$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_res$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_screensaver$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_shape$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_shm$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_sync$secondaryArchSuffix = $libVersionCompatSync
	devel:libxcb_xf86dri$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_xfixes$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_xinerama$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_xinput$secondaryArchSuffix = $libVersionCompatRandr
	devel:libxcb_xkb$secondaryArchSuffix = $libVersionCompatSync
	devel:libxcb_xtest$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_xv$secondaryArchSuffix = $libVersionCompat
	devel:libxcb_xvmc$secondaryArchSuffix = $libVersionCompat
	"
REQUIRES_devel="
	libxcb$secondaryArchSuffix == $portVersion base
	devel:libxslt$secondaryArchSuffix
	devel:libxau$secondaryArchSuffix
	devel:libpthread_stubs$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libxslt$secondaryArchSuffix
	devel:xcb_proto$secondaryArchSuffix >= 1.13
	devel:libpthread_stubs$secondaryArchSuffix
	devel:libxau$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	devel:util_macros$secondaryArchSuffix
	cmd:autoconf
	cmd:doxygen
	cmd:libtoolize$secondaryArchSuffix
	cmd:aclocal
	cmd:make
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:pkg_config$secondaryArchSuffix
	cmd:python
	"

BUILD()
{
	libtoolize --force --copy --install
	./autogen.sh -V
	runConfigure ./configure
	make $jobArgs
}

INSTALL()
{
	make install

	# remove libtool library files
	rm $libDir/libxcb*.la

	prepareInstalledDevelLibs libxcb \
		libxcb-composite \
		libxcb-damage \
		libxcb-dpms \
		libxcb-dri2 \
		libxcb-dri3 \
		libxcb-glx \
		libxcb-present \
		libxcb-randr \
		libxcb-record \
		libxcb-render \
		libxcb-res \
		libxcb-screensaver \
		libxcb-shape \
		libxcb-shm \
		libxcb-sync \
		libxcb-xf86dri \
		libxcb-xfixes \
		libxcb-xinerama \
		libxcb-xinput \
		libxcb-xkb \
		libxcb-xtest \
		libxcb-xv \
		libxcb-xvmc
	fixPkgconfig

	if [ -n "$secondaryArchSuffix" ]; then
		rm -rf $documentationDir
	fi

	# devel package
	packageEntries devel \
		$developDir
}

TEST()
{
	make check
}
