From caf324a2c5cd342184d7c48a5bb2652b9f0f80ef Mon Sep 17 00:00:00 2001
From: Jerome Duval <jerome.duval@gmail.com>
Date: Sun, 6 Aug 2017 22:27:54 +0200
Subject: Haiku patch


diff --git a/Makefile b/Makefile
index ac3034c..05782a5 100644
--- a/Makefile
+++ b/Makefile
@@ -108,7 +108,7 @@ clean:
 #------------------------------------------------------------------------------
 # make install is validated only for Linux, OSX, Hurd and some BSD targets
 #------------------------------------------------------------------------------
-ifneq (,$(filter $(shell uname),Linux Darwin GNU/kFreeBSD GNU FreeBSD DragonFly NetBSD MSYS_NT))
+ifneq (,$(filter $(shell uname),Linux Darwin GNU/kFreeBSD GNU FreeBSD DragonFly NetBSD MSYS_NT Haiku))
 
 HOST_OS = POSIX
 CMAKE_PARAMS = -DZSTD_BUILD_CONTRIB:BOOL=ON -DZSTD_BUILD_STATIC:BOOL=ON -DZSTD_BUILD_TESTS:BOOL=ON -DZSTD_ZLIB_SUPPORT:BOOL=ON -DZSTD_LZMA_SUPPORT:BOOL=ON
diff --git a/lib/Makefile b/lib/Makefile
index 5845cf1..51fd4bd 100644
--- a/lib/Makefile
+++ b/lib/Makefile
@@ -113,7 +113,7 @@ clean:
 #-----------------------------------------------------------------------------
 # make install is validated only for Linux, OSX, BSD, Hurd and Solaris targets
 #-----------------------------------------------------------------------------
-ifneq (,$(filter $(shell uname),Linux Darwin GNU/kFreeBSD GNU OpenBSD FreeBSD NetBSD DragonFly SunOS))
+ifneq (,$(filter $(shell uname),Linux Darwin GNU/kFreeBSD GNU OpenBSD FreeBSD NetBSD DragonFly SunOS Haiku))
 
 ifneq (,$(filter $(shell uname),SunOS))
 INSTALL ?= ginstall
diff --git a/programs/Makefile b/programs/Makefile
index 8b080d4..a316848 100644
--- a/programs/Makefile
+++ b/programs/Makefile
@@ -241,7 +241,7 @@ preview-man: clean-man man
 #-----------------------------------------------------------------------------
 # make install is validated only for Linux, OSX, BSD, Hurd and Solaris targets
 #-----------------------------------------------------------------------------
-ifneq (,$(filter $(shell uname),Linux Darwin GNU/kFreeBSD GNU OpenBSD FreeBSD NetBSD DragonFly SunOS))
+ifneq (,$(filter $(shell uname),Linux Darwin GNU/kFreeBSD GNU OpenBSD FreeBSD NetBSD DragonFly SunOS Haiku))
 
 ifneq (,$(filter $(shell uname),SunOS))
 INSTALL ?= ginstall
@@ -253,7 +253,7 @@ PREFIX  ?= /usr/local
 DESTDIR ?=
 BINDIR  ?= $(PREFIX)/bin
 
-ifneq (,$(filter $(shell uname),OpenBSD FreeBSD NetBSD DragonFly SunOS))
+ifneq (,$(filter $(shell uname),OpenBSD FreeBSD NetBSD DragonFly SunOS Haiku))
 MANDIR  ?= $(PREFIX)/man/man1
 else
 MANDIR  ?= $(PREFIX)/share/man/man1
diff --git a/programs/platform.h b/programs/platform.h
index 74412cd..bd4b319 100644
--- a/programs/platform.h
+++ b/programs/platform.h
@@ -71,9 +71,10 @@ extern "C" {
 *  PLATFORM_POSIX_VERSION >= 1 is equal to found _POSIX_VERSION
 ***************************************************************/
 #if !defined(_WIN32) && (defined(__unix__) || defined(__unix) || (defined(__APPLE__) && defined(__MACH__)) /* UNIX-like OS */ \
-   || defined(__midipix__) || defined(__VMS))
+   || defined(__midipix__) || defined(__VMS) || defined(__HAIKU__))
 #  if (defined(__APPLE__) && defined(__MACH__)) || defined(__SVR4) || defined(_AIX) || defined(__hpux) /* POSIX.1â€“2001 (SUSv3) conformant */ \
-     || defined(__DragonFly__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__)  /* BSD distros */
+     || defined(__DragonFly__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__)  /* BSD distros */ \
+     || defined(__HAIKU__)
 #    define PLATFORM_POSIX_VERSION 200112L
 #  else
 #    if defined(__linux__) || defined(__linux)
diff --git a/programs/util.h b/programs/util.h
index dd971e0..429585c 100644
--- a/programs/util.h
+++ b/programs/util.h
@@ -66,7 +66,7 @@ extern "C" {
 #  include <unistd.h>
 #  include <sys/resource.h> /* setpriority */
 #  include <time.h>         /* clock_t, nanosleep, clock, CLOCKS_PER_SEC */
-#  if defined(PRIO_PROCESS)
+#  if defined(PRIO_PROCESS) && !defined(__HAIKU__)
 #    define SET_REALTIME_PRIORITY setpriority(PRIO_PROCESS, 0, -20)
 #  else
 #    define SET_REALTIME_PRIORITY /* disabled */
-- 
2.13.1

