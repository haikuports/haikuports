SUMMARY="Free general-purpose data compression software"
DESCRIPTION="XZ Utils are free general-purpose data compression tools with \
a high compression ratio. They are the successors to LZMA Utils."
HOMEPAGE="http://tukaani.org/xz/"
COPYRIGHT="2005-2015 Lasse Collin"
LICENSE="GNU LGPL v2.1
	GNU GPL v2
	GNU GPL v3"
REVISION="2"
SOURCE_URI="http://tukaani.org/xz/xz-$portVersion.tar.bz2"
CHECKSUM_SHA256="6ff5f57a4b9167155e35e6da8b529de69270efb2b4cf3fbabf41a4ee793840b5"
SOURCE_DIR="xz-$portVersion"
ADDITIONAL_FILES="xz_utils-expander-rules"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

# On x86_gcc2 we don't want to install the commands in bin/<arch>/, but in bin/.
commandSuffix=$secondaryArchSuffix
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
	commandSuffix=
	commandBinDir=$prefix/bin
fi

PROVIDES="
	xz_utils$secondaryArchSuffix = $portVersion compat >= 5
	cmd:lzcat$commandSuffix = $portVersion compat >= 5
	cmd:lzcmp$commandSuffix = $portVersion compat >= 5
	cmd:lzdiff$commandSuffix = $portVersion compat >= 5
	cmd:lzegrep$commandSuffix = $portVersion compat >= 5
	cmd:lzfgrep$commandSuffix = $portVersion compat >= 5
	cmd:lzgrep$commandSuffix = $portVersion compat >= 5
	cmd:lzless$commandSuffix = $portVersion compat >= 5
	cmd:lzma$commandSuffix = $portVersion compat >= 5
	cmd:lzmadec$commandSuffix = $portVersion compat >= 5
	cmd:lzmainfo$commandSuffix = $portVersion compat >= 5
	cmd:lzmore$commandSuffix = $portVersion compat >= 5
	cmd:unlzma$commandSuffix = $portVersion compat >= 5
	cmd:unxz$commandSuffix = $portVersion compat >= 5
	cmd:xz$commandSuffix = $portVersion compat >= 5
	cmd:xzcat$commandSuffix = $portVersion compat >= 5
	cmd:xzcmp$commandSuffix = $portVersion compat >= 5
	cmd:xzdec$commandSuffix = $portVersion compat >= 5
	cmd:xzdiff$commandSuffix = $portVersion compat >= 5
	cmd:xzegrep$commandSuffix = $portVersion compat >= 5
	cmd:xzfgrep$commandSuffix = $portVersion compat >= 5
	cmd:xzgrep$commandSuffix = $portVersion compat >= 5
	cmd:xzless$commandSuffix = $portVersion compat >= 5
	cmd:xzmore$commandSuffix = $portVersion compat >= 5
	lib:liblzma$secondaryArchSuffix = $portVersion compat >= 5
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

PROVIDES_devel="
	xz_utils${secondaryArchSuffix}_devel = $portVersion compat >= 5
	devel:liblzma$secondaryArchSuffix = $portVersion compat >= 5
	"
REQUIRES_devel="
	haiku${secondaryArchSuffix}_devel
	xz_utils$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	"

BUILD()
{
	touch po/t-cs.gmo
	runConfigure --omit-dirs binDir ./configure --bindir=$commandBinDir
	make $jobArgs
}

INSTALL()
{
	make install

	# remove libtool file
	rm -f $libDir/liblzma.la

	fixPkgconfig

	expanderRulesDir=$dataDir/expander/rules
	mkdir -p $expanderRulesDir
	cp "$portDir/additional-files/xz_utils-expander-rules" \
		"$expanderRulesDir/xz_utils"

	prepareInstalledDevelLibs liblzma
	packageEntries devel \
		$developDir
}

TEST()
{
	make check
}
