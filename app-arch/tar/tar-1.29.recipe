SUMMARY="Saves and restores files to/from a tape or disk archive"
DESCRIPTION="The Tar program provides the ability to create tar archives, as \
well as various other kinds of manipulation. For example, you can use Tar on \
previously created archives to extract files, to store additional files, or \
to update or list files which were already stored.

Initially, tar archives were used to store files conveniently on magnetic \
tape. The name \"Tar\" comes from this use; it stands for tape archiver. Despite \
the utility's name, Tar can direct its output to available devices, files, or \
other programs (using pipes), it can even access remote devices or files (as \
archives)."
HOMEPAGE="https://www.gnu.org/software/tar/"
COPYRIGHT="1990-2016 Free Software Foundation, Inc."
LICENSE="GNU GPL v3"
REVISION="2"
SOURCE_URI="http://ftpmirror.gnu.org/tar/tar-$portVersion.tar.bz2"
CHECKSUM_SHA256="236b11190c0a3a6885bdb8d61424f2b36a5872869aa3f7f695dea4b4843ae2f2"
PATCHES="tar-$portVersion.patchset"

ARCHITECTURES="x86_gcc2 x86 x86_64 arm"

PROVIDES="
	tar = $portVersion compat >= 1
	cmd:tar = $portVersion compat >= 1
	"
REQUIRES="
	haiku
	"

BUILD_REQUIRES="
	haiku_devel
	"
BUILD_PREREQUIRES="
	cmd:automake
	cmd:autoreconf
	cmd:find
	cmd:gcc
	cmd:ld
	cmd:make
	cmd:sed
	"

if [ "$recipeAction" = TEST ]; then
	BUILD_PREREQUIRES="$BUILD_PREREQUIRES
		cmd:compress
		cmd:gzip
		cmd:bzip2
		"
	if [ "$effectiveTargetArchitecture" != x86_gcc2 ]; then
		BUILD_PREREQUIRES="$BUILD_PREREQUIRES
			cmd:lzip
			cmd:lzma
			cmd:xz
			"
	fi
fi

defineDebugInfoPackage tar $binDir/tar

BUILD()
{
	runConfigure ./configure \
		--disable-nls \
		--disable-gcc-warnings \
		LDFLAGS="-lnetwork" CFLAGS="-D_BSD_SOURCE" \
		FORCE_UNSAFE_CONFIGURE=1
	make $jobArgs
}

INSTALL()
{
	make install

	rm $libDir/charset.alias
}

TEST()
{
	make check
}
