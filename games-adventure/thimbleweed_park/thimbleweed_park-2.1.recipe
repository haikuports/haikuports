SUMMARY="Based on engge2 reimplementation"
DESCRIPTION="engge2 is an adventure game engine able to run 'Thimbleweed Park'.
It's an open source remake of 'Thimbleweed Park'\'s engine.

Original game files are required (ThimbleweedPark.ggpack1, ThimbleweedPark.ggpack2)"
HOMEPAGE="https://github.com/scemino/engge2"
COPYRIGHT="2022 scemino"
LICENSE="MIT"
REVISION="1"
SOURCE_URI="https://github.com/scemino/engge2/archive/refs/tags/v$portVersion.tar.gz"
CHECKSUM_SHA256="8cf1f6d703a27675c747920d0aaf2c4d5df8edb1cee6a0a3d4e1eb1d7252e162"
SOURCE_DIR="engge2-$portVersion"
PATCHES="thimbleweed_park-$portVersion.patchset"
ADDITIONAL_FILES="thimbleweed_park.rdef.in
	thimbleweed_park.hvif
	thimbleweed_park.sh"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	thimbleweed_park$secondaryArchSuffix = $portVersion
	app:ThimbleweedPark = $portVersion
	cmd:engge2
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libSDL2_2.0$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libSDL2_2.0$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:gcc
	cmd:nimble
	cmd:pkg_config
	"

BUILD()
{
	nimble build -y -d:release --dynlibOverride:libSDL2 \
		--passL="`pkg-config --libs-only-L sdl2 | cut -c 3-`/libSDL2.so"
}

INSTALL()
{
	mkdir -p $binDir $appsDir
	cp engge2 $binDir/engge2
	
	local APP_SIGNATURE="application/x-vnd.thimbleweed-park"
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local LONG_INFO="$SUMMARY"
	sed \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@LONG_INFO@|$LONG_INFO|" \
		$portDir/additional-files/thimbleweed_park.rdef.in > $sourceDir/thimbleweed_park.rdef

	addResourcesToBinaries  $sourceDir/thimbleweed_park.rdef \
		$binDir/engge2
	
	cp $portDir/additional-files/thimbleweed_park.sh "$appsDir/Thimbleweed Park"
	chmod +x "$appsDir/Thimbleweed Park"
	addattr -t icon -f $portDir/additional-files/thimbleweed_park.hvif \
 		"BEOS:ICON" "$appsDir/Thimbleweed Park"
	addAppDeskbarSymlink "$appsDir/Thimbleweed Park" "Thimbleweed Park"
}
