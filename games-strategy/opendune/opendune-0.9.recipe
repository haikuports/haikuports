SUMMARY="Open-source clone of Dune II: The Battle for Arrakis"
DESCRIPTION="Lorem ipsum dolor sic amet"
HOMEPAGE="http://www.opendune.org/"
COPYRIGHT="2009-2018 OpenDUNE Developers"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://github.com/OpenDUNE/OpenDUNE/archive/$portVersion.tar.gz"
CHECKSUM_SHA256="8d5ed67669df1f17a44c097d9b6bee4e0623ce2a37f11938ce9cd77de546d06c"
SOURCE_FILENAME="OpenDUNE-$portVersion.tar.gz"
SOURCE_DIR="OpenDUNE-$portVersion"
PATCHES="opendune-$portVersion.patchset"
#ADDITIONAL_FILES="opendune.rdef"

ARCHITECTURES="!x86_gcc2 x86_64 ?x86"
SECONDARY_ARCHITECTURES="x86"

GLOBAL_WRITABLE_FILES="
	settings/opendune directory keep-old
	"

PROVIDES="
	opendune$secondaryArchSuffix = $portVersion
	app:OpenDUNE = $portVersion
	"
	
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libsdl$secondaryArchSuffix
	lib:libsdl_image$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libsdl$secondaryArchSuffix
	devel:libsdl_image$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:awk$secondaryArchSuffix
	cmd:pkg_config
	cmd:git
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:make
	cmd:which
	"

BUILD()
{
	_dune2_data_dir=$(finddir B_USER_SETTINGS_DIRECTORY)/opendune/data

	export CFLAGS="-mmmx -DDUNE_DATA_DIR='\\\"${_dune2_data_dir}\\\"' $CFLAGS"

	./configure \
		--disable-assert \
		--binary-name="OpenDune" \
		--prefix-dir="" \
		--binary-dir=$appsDir/OpenDUNE \
		--data-dir="$settingsDir/opendune/data" \
		--install-dir=""
	
	make $jobsArg V=1
}

INSTALL(){

	mkdir -p $appsDir/OpenDUNE
	mkdir -p $settingsDir/opendune
	
	make install
	
	cp $sourceDir/bin/opendune.ini.sample $settingsDir/opendune/opendune.ini
	cp $sourceDir/bin/data/*.* $settingsDir/opendune/data

	addAppDeskbarSymlink $appsDir/OpenDUNE OpenDUNE
}

#INSTALL()
#{

	#cp $sourceDir/bin/opendune $appsDir/OpenDUNE
	#cp $sourceDir/bin/opendune.ini.sample $settingsDir/OpenDUNE/opendune.ini
	#addResourcesToBinaries $portDir/additional-files/opendune.rdef $appsDir/OpenDUNE
	#addAppDeskbarSymlink $appsDir/OpenDUNE OpenDUNE
#}
