From 4c7ae2125c620c0a2b1bb24596866fdf44b5900b Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Sat, 24 Mar 2018 16:00:20 +0100
Subject: Haiku doesn't have nice


diff --git a/include/ntp_machine.h b/include/ntp_machine.h
index c5e7248..df9d871 100644
--- a/include/ntp_machine.h
+++ b/include/ntp_machine.h
@@ -283,6 +283,10 @@ extern char *strdup(const char *);
 # endif
 #endif
 
+#if defined __HAIKU__
+# define HAVE_NO_NICE
+#endif
+
 #if !defined(HAVE_ATT_NICE) \
 	&& !defined(HAVE_BSD_NICE) \
 	&& !defined(HAVE_NO_NICE)
-- 
2.19.1


From f5240400c9b3b1b7cd2ff3f0ba37200934aea575 Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Wed, 10 Oct 2018 13:23:52 +0200
Subject: Haiku doesn't have adjtime


diff --git a/libntp/systime.c b/libntp/systime.c
index 8e70897..2414410 100644
--- a/libntp/systime.c
+++ b/libntp/systime.c
@@ -354,7 +354,7 @@ adj_systime(
 		sys_residual = -sys_residual;
 	}
 	if (adjtv.tv_sec != 0 || adjtv.tv_usec != 0) {
-		if (adjtime(&adjtv, &oadjtv) < 0) {
+		if (gettimeofday(&adjtv, &oadjtv) < 0) {
 			msyslog(LOG_ERR, "adj_systime: %m");
 			if (enable_panic_check && allow_panic) {
 				msyslog(LOG_ERR, "adj_systime: allow_panic is TRUE!");
diff --git a/ntpdate/ntpdate.c b/ntpdate/ntpdate.c
index 14cf22b..6bac948 100644
--- a/ntpdate/ntpdate.c
+++ b/ntpdate/ntpdate.c
@@ -2042,7 +2042,7 @@ l_adj_systime(
 	}
 
 	if (adjtv.tv_usec != 0 && !debug) {
-		if (adjtime(&adjtv, &oadjtv) < 0) {
+		if (gettimeofday(&adjtv, &oadjtv) < 0) {
 			msyslog(LOG_ERR, "Can't adjust the time of day: %m");
 			exit(1);
 		}
-- 
2.19.1


From 71fc68ccb1af7452c9c58a7720759ff0cdd5f554 Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Wed, 10 Oct 2018 13:25:58 +0200
Subject: Haiku doesn't have a.out.h


diff --git a/util/tickadj.c b/util/tickadj.c
index d54e9e6..3f9d65c 100644
--- a/util/tickadj.c
+++ b/util/tickadj.c
@@ -182,7 +182,7 @@ main(
 #else /* not NLIST_STRUCT */ /* was defined(SYS_AUX3) || defined(SYS_AUX2) */
 # include <sys/resource.h>
 # include <sys/file.h>
-# include <a.out.h>
+//# include <a.out.h>
 # ifdef HAVE_SYS_VAR_H
 #  include <sys/var.h>
 # endif
-- 
2.19.1


From 6414f2f64f6f4174ee2cfa1e277598bd9926e63e Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Wed, 10 Oct 2018 16:04:24 +0200
Subject: fix sntp build


diff --git a/sntp/main.c b/sntp/main.c
index 098a696..0f08d16 100644
--- a/sntp/main.c
+++ b/sntp/main.c
@@ -8,6 +8,10 @@
 # include <event2/thread.h>
 #endif
 
+#ifdef HAVE_SYSEXITS_H
+#include <sysexits.h>
+#endif
+
 #include "main.h"
 #include "ntp_libopts.h"
 #include "kod_management.h"
@@ -120,6 +124,18 @@ void dec_pending_ntp(const char *, sockaddr_u *);
 int  libevent_version_ok(void);
 int  gettimeofday_cached(struct event_base *b, struct timeval *tv);
 
+// The source doesn't want to pickup sysexits.h, so we redefine the needed stuff here
+#if defined(__HAIKU__)
+#ifndef EX_SOFTWARE
+#define EX_SOFTWARE	70
+#endif
+#ifndef EX_OK
+#define EX_OK		0
+#endif
+#ifndef EX_USAGE
+#define EX_USAGE	64
+#endif
+#endif // __HAIKU__
 
 /*
  * The actual main function.
-- 
2.19.1

