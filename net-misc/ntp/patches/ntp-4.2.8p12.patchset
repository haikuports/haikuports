From e2a18b4ab2923f0cdeab1492c17069a291019815 Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Thu, 11 Oct 2018 10:02:06 +0200
Subject: Haiku doesn't have nice()


diff --git a/include/ntp_machine.h b/include/ntp_machine.h
index c5e7248..df9d871 100644
--- a/include/ntp_machine.h
+++ b/include/ntp_machine.h
@@ -283,6 +283,10 @@ extern char *strdup(const char *);
 # endif
 #endif
 
+#if defined __HAIKU__
+# define HAVE_NO_NICE
+#endif
+
 #if !defined(HAVE_ATT_NICE) \
 	&& !defined(HAVE_BSD_NICE) \
 	&& !defined(HAVE_NO_NICE)
-- 
2.19.1


From 7904a22f610dc1877ee049ebb728b22a7503de05 Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Thu, 11 Oct 2018 10:05:14 +0200
Subject: Haiku doesn't have adjtim()


diff --git a/libntp/systime.c b/libntp/systime.c
index 8e70897..5b7fa13 100644
--- a/libntp/systime.c
+++ b/libntp/systime.c
@@ -354,7 +354,7 @@ adj_systime(
 		sys_residual = -sys_residual;
 	}
 	if (adjtv.tv_sec != 0 || adjtv.tv_usec != 0) {
-		if (adjtime(&adjtv, &oadjtv) < 0) {
+		if (set_real_time_clock(&adjtv, &oadjtv) < 0) {
 			msyslog(LOG_ERR, "adj_systime: %m");
 			if (enable_panic_check && allow_panic) {
 				msyslog(LOG_ERR, "adj_systime: allow_panic is TRUE!");
diff --git a/ntpdate/ntpdate.c b/ntpdate/ntpdate.c
index 03d9552..fd51f9c 100644
--- a/ntpdate/ntpdate.c
+++ b/ntpdate/ntpdate.c
@@ -2042,7 +2042,7 @@ l_adj_systime(
 		/* A time correction needs to be applied. */
 #if !defined SYS_WINNT && !defined SYS_CYGWIN32
 		/* Slew the time on systems that support this. */
-		if (adjtime(&adjtv, &oadjtv) < 0) {
+		if (set_real_time_clock(&adjtv, &oadjtv) < 0) {
 			msyslog(LOG_ERR, "Can't adjust the time of day: %m");
 			exit(1);
 		}
-- 
2.19.1


From 0447ddc684c56ae115c4a4efdfb9673727648ce7 Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Thu, 11 Oct 2018 10:07:24 +0200
Subject: Haiku doesn't have the header a.out.h


diff --git a/util/tickadj.c b/util/tickadj.c
index d54e9e6..a81d5bc 100644
--- a/util/tickadj.c
+++ b/util/tickadj.c
@@ -182,7 +182,7 @@ main(
 #else /* not NLIST_STRUCT */ /* was defined(SYS_AUX3) || defined(SYS_AUX2) */
 # include <sys/resource.h>
 # include <sys/file.h>
-# include <a.out.h>
+// # include <a.out.h>
 # ifdef HAVE_SYS_VAR_H
 #  include <sys/var.h>
 # endif
-- 
2.19.1


From 218ac468fa6ddf68dc2885a79cc752c2a3829a2e Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Thu, 11 Oct 2018 10:11:07 +0200
Subject: Fix sntp build


diff --git a/sntp/main.c b/sntp/main.c
index f0a7650..71ff830 100644
--- a/sntp/main.c
+++ b/sntp/main.c
@@ -8,6 +8,10 @@
 # include <event2/thread.h>
 #endif
 
+#ifdef HAVE_SYSEXITS_H
+#include <sysexits.h>
+#endif
+
 #include "main.h"
 #include "ntp_libopts.h"
 #include "kod_management.h"
@@ -120,6 +124,18 @@ void dec_pending_ntp(const char *, sockaddr_u *);
 int  libevent_version_ok(void);
 int  gettimeofday_cached(struct event_base *b, struct timeval *tv);
 
+// The source doesn't want to pickup sysexits.h
+#if defined(__HAIKU__)
+#ifndef EX_SOFTWARE
+#define EX_SOFTWARE	70
+#endif
+#ifndef EX_OK
+#define EX_OK		0
+#endif
+#ifndef EX_USAGE
+#define EX_USAGE	64
+#endif
+#endif // __HAIKU__
 
 /*
  * The actual main function.
-- 
2.19.1

