SUMMARY="An open source MQTT broker"
DESCRIPTION="An open source MQTT brokerz"
HOMEPAGE="http://mosquitto.org"
COPYRIGHT="2020 Eclipse Foundation."
LICENSE="EDL"
REVISION="1"
SOURCE_URI="https://mosquitto.org/files/source/mosquitto-$portVersion.tar.gz"
CHECKSUM_SHA256="412979b2db0a0020bd02fa64f0a0de9e7000b84462586e32b67f29bb1f6c1685"
PATCHES="mosquitto-$portVersion.patchset"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

libVersion="$portVersion"
libVersionCompat="$libVersion compat >= ${libVersion%.*}"
portVersionCompat="$portVersion compat >= ${portVersion%%.*}"

PROVIDES="
	mosquitto$secondaryArchSuffix = $portVersion
	cmd:mosquitto$secondaryArchSuffix = $portVersion
	cmd:mosquitto_passwd$secondaryArchSuffix = $portVersion
	cmd:mosquitto_pub$secondaryArchSuffix = $portVersion
	cmd:mosquitto_rr$secondaryArchSuffix = $portVersion
	cmd:mosquitto_sub$secondaryArchSuffix = $portVersion
	lib:libmosquitto$secondaryArchSuffix = $libVersionCompat
	lib:libmosquittopp$secondaryArchSuffix = $libVersionCompat
	"

REQUIRES="
	haiku$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	"

PROVIDES_devel="
	mosquitto${secondaryArchSuffix}_devel = $portVersionCompat
	devel:libmosquitto$secondaryArchSuffix = $libVersionCompat
	"

REQUIRES_devel="
	mosquitto$secondaryArchSuffix == $portVersion base
	"

CONFLICTS_devel="
	mosquitto${secondaryArchSuffix}_devel
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	docbook_xml_dtd
	docbook_xsl_stylesheets
	devel:libssl$secondaryArchSuffix
	"

BUILD_PREREQUIRES="
	cmd:gcc$secondaryArchPrefix
	cmd:make
	cmd:sed
	cmd:xsltproc
	cmd:pkg_config$secondaryArchPrefix
	"

BUILD()
{
	make 
}

INSTALL()
{
	mkdir -p $binDir
	mkdir -p $docDir
	#prefix=$prefix incdir=$includeDir mandir=$manDir make install
	DESTDIR=$installDestDir incdir=$includeDir mandir=$manDir make install
	cp src/mosquitto $binDir
	cp src/mosquitto_passwd $binDir

	# devel package
	packageEntries devel \
		$developDir

}
