From 18750ed57e012910ea9b923010b117e73b7a79a1 Mon Sep 17 00:00:00 2001
From: Jessica Hamilton <jessica.l.hamilton@gmail.com>
Date: Sun, 24 May 2015 20:20:28 +1200
Subject: Haiku support


diff --git a/m4/kpse-socket-libs.m4 b/m4/kpse-socket-libs.m4
index c768b95..c291884 100644
--- a/m4/kpse-socket-libs.m4
+++ b/m4/kpse-socket-libs.m4
@@ -20,7 +20,7 @@ AC_DEFUN([KPSE_CHECK_SOCKET_LIBS],
 [AC_REQUIRE([KPSE_CHECK_WIN32])
 AS_IF([test "x$kpse_cv_have_win32" = xno],
       [kpse_save_LIBS=$LIBS
-       AC_SEARCH_LIBS([connect], [socket nsl])
+       AC_SEARCH_LIBS([connect], [socket nsl network])
        LIBS=$kpse_save_LIBS],
       [AC_CHECK_LIB([wsock32], [main],
                     [ac_cv_search_connect=-lwsock32],
diff --git a/texk/dviljk/config.h b/texk/dviljk/config.h
index a92d247..3d9bd99 100644
--- a/texk/dviljk/config.h
+++ b/texk/dviljk/config.h
@@ -10,6 +10,8 @@
 #define unix
 #elif defined (__NetBSD__)
 #define unix
+#elif defined (__HAIKU__)
+#define unix
 #endif
 #endif
 
diff --git a/texk/dvipdfm-x/configure.ac b/texk/dvipdfm-x/configure.ac
index 2114317..43727ad 100644
--- a/texk/dvipdfm-x/configure.ac
+++ b/texk/dvipdfm-x/configure.ac
@@ -50,6 +50,7 @@ AC_CHECK_SIZEOF([int])
 AC_CHECK_SIZEOF([long])
 
 AC_SEARCH_LIBS([pow], [m])
+AC_SEARCH_LIBS([getpass], [bsd])
 
 KPSE_KPATHSEA_FLAGS
 KPSE_ZLIB_FLAGS
diff --git a/texk/web2c/configure.ac b/texk/web2c/configure.ac
index acd2014..a5aee3b 100644
--- a/texk/web2c/configure.ac
+++ b/texk/web2c/configure.ac
@@ -22,7 +22,7 @@ dnl
 m4_include([../../version.ac])[] dnl define tex_live_version
 AC_INIT([Web2C], tex_live_version(), [tex-k@tug.org])
 AC_PREREQ([2.65])
-dnl 
+dnl
 dnl We don't use (for example) tex/tex.web because people who only want
 dnl to build part of the distribution may not have any given program.
 dnl Even cpascal.h isn't guaranteed, but then nothing is, really ...
@@ -108,9 +108,9 @@ KPSE_LUA52_DEFINES
 KPSE_LUAJIT_DEFINES
 LIBS=$kpse_save_LIBS
 if test "x$kpse_cv_have_win32" = xno; then
-  AC_SEARCH_LIBS([gethostbyname], [nsl])
-  AC_SEARCH_LIBS([hstrerror], [resolv])
-  AC_SEARCH_LIBS([inet_aton], [resolv])
+  AC_SEARCH_LIBS([gethostbyname], [nsl network])
+  AC_SEARCH_LIBS([hstrerror], [resolv bind])
+  AC_SEARCH_LIBS([inet_aton], [resolv bind])
   LIBS=$kpse_save_LIBS
   AC_SEARCH_LIBS([nanosleep], [rt])
   LIBS=$kpse_save_LIBS
-- 
2.26.0


From a44382c99b305b1b7b51ef309ec3229ad4ee01ab Mon Sep 17 00:00:00 2001
From: Jessica Hamilton <jessica.l.hamilton@gmail.com>
Date: Tue, 2 Jun 2015 09:30:45 +1200
Subject: Don't use the /nonesuch idiom on Haiku.


diff --git a/texk/kpathsea/cnf-to-paths.awk b/texk/kpathsea/cnf-to-paths.awk
index 939f54d..431062f 100644
--- a/texk/kpathsea/cnf-to-paths.awk
+++ b/texk/kpathsea/cnf-to-paths.awk
@@ -43,12 +43,9 @@
     # Replace all semicolons with colons in the SELFAUTO paths we're keeping.
     # (The path-splitting code should be changed to understand both.)
     gsub(/;/, ":", val);
-  } else if (val ~ /^\//) {
-    # If the value starts with /, presume we're compiling with changes
-    # made for a distro, and keep it.  Likewise switch to :.
-    gsub(/;/, ":", val);
   } else {
-    val = "/nonesuch";
+    # Just hard-code it on Haiku; it never does the right thing otherwise
+    gsub(/;/, ":", val);
   }
   
   print "#ifndef DEFAULT_" ident;
-- 
2.19.1

