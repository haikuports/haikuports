SUMMARY="A comprehensive TeX system"
DESCRIPTION="TeX Live is an easy way to get up and running with the TeX \
document production system. It provides a comprehensive TeX system. It \
includes all the major TeX-related programs, macro packages, and fonts that \
are free software, including support for many languages around the world."
HOMEPAGE="http://tug.org/texlive/"
COPYRIGHT="1996 by collaboration between the TeX user groups."
LICENSE="GNU GPL v2"
REVISION="1"
fullVersion=20200406
SOURCE_URI="ftp://tug.org/historic/systems/texlive/$portVersion/texlive-$fullVersion-source.tar.xz"
SOURCE_URI_2="ftp://tug.org/historic/systems/texlive/$portVersion/texlive-$fullVersion-texmf.tar.xz"
SOURCE_URI_3="ftp://tug.org/historic/systems/texlive/$portVersion/install-tl-unx.tar.gz"
SOURCE_URI_4="ftp://tug.org/historic/systems/texlive/$portVersion/texlive-$fullVersion-tlpdb-full.tar.gz"
CHECKSUM_SHA256="e32f3d08cbbbcf21d8d3f96f2143b64a1f5e4cb01b06b761d6249c8785249078"
CHECKSUM_SHA256_2="0aa97e583ecfd488e1dc60ff049fec073c1e22dfe7de30a3e4e8c851bb875a95"
CHECKSUM_SHA256_3="7c90a50e55533d57170cbc7c0370a010019946eb18570282948e1af6f809382d"
CHECKSUM_SHA256_4="2990a8d275506c297b2239a1b4c5d9a9ec0d18cf12ff9a6a33924cf2e3838ed4"
SOURCE_DIR="texlive-$fullVersion-source"
SOURCE_DIR_2="texlive-$fullVersion-texmf"
SOURCE_DIR_3="install-tl-$fullVersion"
SOURCE_DIR_4=""
PATCHES="texlive-$portVersion.patchset"
# ADDITIONAL_FILES="tlutils.pm.patch"

ARCHITECTURES="x86 !x86_gcc2 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	texlive$secondaryArchSuffix = $portVersion compat >= 2020
	cmd:a2ping
	cmd:a5toa4
	cmd:adhocfilelist
	cmd:afm2afm
	cmd:afm2pl
	cmd:afm2tfm
	cmd:aleph
	cmd:allcm
	cmd:allec
	cmd:allneeded
	cmd:arara
	cmd:arlatex
	cmd:authorindex
	cmd:autoinst
	cmd:autosp
	cmd:axohelp
	cmd:bbl2bib
	cmd:bbox
	cmd:bg5+latex
	cmd:bg5+pdflatex
	cmd:bg5conv
	cmd:bg5latex
	cmd:bg5pdflatex
	cmd:bib2gls
	cmd:bibdoiadd
	cmd:bibexport
	cmd:bibmradd
	cmd:bibtex
	cmd:bibtex8
	cmd:bibtexu
	cmd:biburl2doi
	cmd:bibzbladd
	cmd:bundledoc
	cmd:cachepic
	cmd:cef5conv
	cmd:cef5latex
	cmd:cef5pdflatex
	cmd:cefconv
	cmd:ceflatex
	cmd:cefpdflatex
	cmd:cefsconv
	cmd:cefslatex
	cmd:cefspdflatex
	cmd:cfftot1
	cmd:checkcites
	cmd:checklistings
	cmd:chkdvifont
	cmd:chklref
	cmd:chktex
	cmd:chkweb
	cmd:cjk_gs_integrate
	cmd:cllualatex
	cmd:cluttex
	cmd:clxelatex
	cmd:context
	cmd:contextjit
	cmd:convbkmk
	cmd:convertgls2bib
	cmd:ctan_o_mat
	cmd:ctanbib
	cmd:ctangle
	cmd:ctanify
	cmd:ctanupload
	cmd:ctie
	cmd:ctwill
	cmd:ctwill_refsort
	cmd:ctwill_twinx
	cmd:cweave
	cmd:de_macro
	cmd:depythontex
	cmd:detex
	cmd:devnag
	cmd:deweb
	cmd:diadia
	cmd:disdvi
	cmd:dosepsbin
	cmd:dt2dv
	cmd:dtxgen
	cmd:dv2dt
	cmd:dvi2fax
	cmd:dvi2tty
	cmd:dviasm
	cmd:dvibook
	cmd:dviconcat
	cmd:dvicopy
	cmd:dvidvi
	cmd:dvigif
	cmd:dvihp
	cmd:dviinfox
	cmd:dvilj
	cmd:dvilj2p
	cmd:dvilj4
	cmd:dvilj4l
	cmd:dvilj6
	cmd:dvipdfm
	cmd:dvipdfmx
	cmd:dvipdft
	cmd:dvipng
	cmd:dvipos
	cmd:dvips
	cmd:dvired
	cmd:dviselect
	cmd:dvisvgm
	cmd:dvitodvi
	cmd:dvitomp
	cmd:dvitype
	cmd:e2pall
	cmd:ebb
	cmd:ebong
	cmd:epsffit
	cmd:epspdf
	cmd:epspdftk
	cmd:epstopdf
	cmd:eptex
	cmd:euptex
	cmd:exceltex
	cmd:extconv
	cmd:extractbb
	cmd:extractres
	cmd:fig4latex
	cmd:findhyph
	cmd:fmtutil_sys
	cmd:fmtutil_user
	cmd:fmtutil
	cmd:fontinst
	cmd:fragmaster
	cmd:gbklatex
	cmd:gbkpdflatex
	cmd:getmapdl
	cmd:gftodvi
	cmd:gftopk
	cmd:gftype
	cmd:gregorio
	cmd:gsftopk
	cmd:hbf2gf
	cmd:ht
	cmd:htcontext
	cmd:htlatex
	cmd:htmex
	cmd:httex
	cmd:httexi
	cmd:htxelatex
	cmd:htxetex
	cmd:includeres
	cmd:inimf
	cmd:initex
	cmd:installfont_tl
	cmd:jamo_normalize
	cmd:jfmutil
	cmd:kanji_config_updmap_sys
	cmd:kanji_config_updmap_user
	cmd:kanji_config_updmap
	cmd:kanji_fontmap_creator
	cmd:ketcindy
	cmd:komkindex
	cmd:kpseaccess
	cmd:kpsepath
	cmd:kpsereadlink
	cmd:kpsestat
	cmd:kpsetool
	cmd:kpsewhere
	cmd:kpsewhich
	cmd:kpsexpand
	cmd:l3build
	cmd:lacheck
	cmd:latex_git_log
	cmd:latex_papersize
	cmd:latex2man
	cmd:latex2nemeth
	cmd:latexdef
	cmd:latexdiff_vc
	cmd:latexdiff
	cmd:latexfileversion
	cmd:latexindent
	cmd:latexmk
	cmd:latexpand
	cmd:latexrevise
	cmd:lily_glyph_commands
	cmd:lily_image_commands
	cmd:lily_rebuild_pdfs
	cmd:listbib
	cmd:listings_ext.sh
	cmd:ltx2crossrefxml
	cmd:ltxfileinfo
	cmd:ltximg
	cmd:luahbtex
	cmd:luajithbtex
	cmd:luajittex
	cmd:luaotfload_tool
	cmd:luatools
	cmd:lwarpmk
	cmd:m_tx
	cmd:mag
	cmd:makeglossaries_lite
	cmd:makeglossaries
	cmd:makeindex
	cmd:makejvf
	cmd:match_parens
	cmd:mathspic
	cmd:mendex
	cmd:mex
	cmd:mf_nowin
	cmd:mf
	cmd:mf2pt1
	cmd:mflua_nowin
	cmd:mflua
	cmd:mfluajit_nowin
	cmd:mfluajit
	cmd:mfplain
	cmd:mft
	cmd:mk4ht
	cmd:mkgrkindex
	cmd:mkindex
	cmd:mkjobtexmf
	cmd:mkocp
	cmd:mkofm
	cmd:mkpic
	cmd:mkt1font
	cmd:mktexfmt
	cmd:mktexlsr
	cmd:mktexmf
	cmd:mktexpk
	cmd:mktextfm
	cmd:mmafm
	cmd:mmpfb
	cmd:mpost
	cmd:mptopdf
	cmd:msxlint
	cmd:mtxrun
	cmd:mtxrunjit
	cmd:multibibliography
	cmd:musixflx
	cmd:musixtex
	cmd:odvicopy
	cmd:odvitype
	cmd:ofm2opl
	cmd:omfonts
	cmd:opl2ofm
	cmd:ot2kpx
	cmd:otangle
	cmd:otfinfo
	cmd:otftotfm
	cmd:otp2ocp
	cmd:outocp
	cmd:ovf2ovp
	cmd:ovp2ovf
	cmd:pamphletangler
	cmd:patgen
	cmd:pbibtex
	cmd:pdfannotextractor
	cmd:pdfatfi
	cmd:pdfbook2
	cmd:pdfcrop
	cmd:pdfjam
	cmd:pdflatexpicscale
	cmd:pdftex_quiet
	cmd:pdftex
	cmd:pdftosrc
	cmd:pdfxup
	cmd:pdvitomp
	cmd:pdvitype
	cmd:pedigree
	cmd:perltex
	cmd:pfarrei
	cmd:pfb2pfa
	cmd:pk2bm
	cmd:pkfix_helper
	cmd:pkfix
	cmd:pktogf
	cmd:pktype
	cmd:pltotf
	cmd:pmpost
	cmd:pmxab
	cmd:pmxchords
	cmd:pn2pdf
	cmd:pooltype
	cmd:ppltotf
	cmd:prepmx
	cmd:ps2eps
	cmd:ps2frag
	cmd:ps2pk
	cmd:ps4pdf
	cmd:psbook
	cmd:psjoin
	cmd:pslatex
	cmd:psnup
	cmd:psresize
	cmd:psselect
	cmd:pst2pdf
	cmd:pstops
	cmd:ptex
	cmd:ptex2pdf
	cmd:ptftopl
	cmd:purifyeps
	cmd:pygmentex
	cmd:pythontex
	cmd:r_mpost
	cmd:r_pmpost
	cmd:r_upmpost
	cmd:repstopdf
	cmd:rpdfcrop
	cmd:rubibtex
	cmd:rubikrotation
	cmd:rumakeindex
	cmd:rungs
	cmd:scor2prt
	cmd:simpdftex
	cmd:sjisconv
	cmd:sjislatex
	cmd:sjispdflatex
	cmd:splitindex
	cmd:srcredact
	cmd:sty2dtx
	cmd:svn_multi
	cmd:synctex
	cmd:t1dotlessj
	cmd:t1lint
	cmd:t1rawafm
	cmd:t1reencode
	cmd:t1testpage
	cmd:t4ht
	cmd:tangle
	cmd:tex
	cmd:tex2aspc
	cmd:tex4ebook
	cmd:tex4ht
	cmd:texconfig_dialog
	cmd:texconfig_sys
	cmd:texconfig
	cmd:texcount
	cmd:texdef
	cmd:texdiff
	cmd:texdirflatten
	cmd:texdoc
	cmd:texdoctk
	cmd:texexec
	cmd:texfot
	cmd:texhash
	cmd:texlinks
	cmd:texliveonfly
	cmd:texloganalyser
	cmd:texlua
	cmd:texluac
	cmd:texluajit
	cmd:texluajitc
	cmd:texmfstart
	cmd:texosquery_jre5
	cmd:texosquery_jre8
	cmd:texosquery
	cmd:texplate
	cmd:tftopl
	cmd:thumbpdf
	cmd:tie
	cmd:tlcockpit
	cmd:tlmgr
	cmd:tlshell
	cmd:tpic2pdftex
	cmd:ttf2afm
	cmd:ttf2kotexfont
	cmd:ttf2pk
	cmd:ttf2tfm
	cmd:ttfdump
	cmd:ttftotype42
	cmd:typeoutfileinfo
	cmd:ulqda
	cmd:upbibtex
	cmd:updmap_sys
	cmd:updmap_user
	cmd:updmap
	cmd:updvitomp
	cmd:updvitype
	cmd:upmendex
	cmd:upmpost
	cmd:uppltotf
	cmd:uptex
	cmd:uptftopl
	cmd:urlbst
	cmd:vftovp
	cmd:vlna
	cmd:vpe
	cmd:vpl2ovp
	cmd:vpl2vpl
	cmd:vptovf
	cmd:weave
	cmd:wofm2opl
	cmd:wopl2ofm
	cmd:wordcount
	cmd:wovf2ovp
	cmd:wovp2ovf
	cmd:xdvipdfmx
	cmd:xetex
	cmd:xhlatex
	cmd:xindex
	cmd:yplan
	lib:libkpathsea$secondaryArchSuffix
	lib:libptexenc$secondaryArchSuffix
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libpixman_1$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	lib:libfreetype$secondaryArchSuffix
	lib:libcairo$secondaryArchSuffix
	lib:libgobject_2.0$secondaryArchSuffix
	lib:libpoppler$secondaryArchSuffix
	lib:libzzip_0$secondaryArchSuffix
	lib:libgraphite2$secondaryArchSuffix
	lib:libTECkit$secondaryArchSuffix
	lib:libharfbuzz$secondaryArchSuffix
	lib:libpaper$secondaryArchSuffix
	lib:libgd$secondaryArchSuffix
	lib:libgmp$secondaryArchSuffix
	lib:libmpfr$secondaryArchSuffix
	icu$secondaryArchSuffix
	"

PROVIDES_devel="
	texlive${secondaryArchSuffix}_devel = $portVersion
	devel:libkpathsea$secondaryArchSuffix = $portVersion
	devel:libptexenc$secondaryArchSuffix = $portVersion
	"
REQUIRES_devel="
	texlive$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libpixman_1$secondaryArchSuffix
	devel:libpng16$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	devel:libfreetype$secondaryArchSuffix
	devel:libcairo$secondaryArchSuffix
	devel:libgobject_2.0$secondaryArchSuffix
	devel:libpoppler$secondaryArchSuffix
	devel:libzzip$secondaryArchSuffix
	devel:libgraphite2$secondaryArchSuffix
	devel:libTECkit$secondaryArchSuffix
	devel:libharfbuzz$secondaryArchSuffix
	devel:libpaper$secondaryArchSuffix
	devel:libgd$secondaryArchSuffix
	devel:libgmp$secondaryArchSuffix
	devel:libmpfr$secondaryArchSuffix
	icu${secondaryArchSuffix}_devel
	cmd:makeinfo
	"
BUILD_PREREQUIRES="
	cmd:pkg_config$secondaryArchSuffix
	cmd:gcc$secondaryArchSuffix
	cmd:g++$secondaryArchSuffix
	cmd:make
	cmd:gawk
	cmd:autoconf
	cmd:automake
	cmd:find
	cmd:freetype_config$secondaryArchSuffix
	"

GLOBAL_WRITABLE_FILES="
	settings/texlive/ls-R auto-merge
	var/texlive/ls-R auto-merge
	var/texlive/tex/generic/config/language.dat auto-merge
	var/texlive/tex/generic/config/language.dat.lua auto-merge
	var/texlive/tex/generic/config/language.def auto-merge
	var/texlive/web2c/fmtutil.cnf auto-merge
	"

fetchTexLiveInstaller()
{
       # Link our binaries to bin/{i386,x86_64}-haiku

	if [ $targetArchitecture = x86_gcc2 ] || [ $targetArchitecture = x86 ]; then
		if [ ! -e bin/i386-haiku ] ; then
			mkdir -p bin
			ln -s $prefix/bin bin/i386-haiku
		fi

	elif [ $targetArchitecture = x86_64 ]; then
		if [ ! -e bin/x86_64-haiku ] ; then
			mkdir -p bin
			ln -s $prefix/bin bin/x86_64-haiku
		fi
	fi

	rm -v tlpkg/texlive.tlpdb
	ln -sv $sourceDir4/texlive.tlpdb tlpkg/
}

### Variables that TeX Live uses to control where files go
# This is the parent directory of our several trees, i.e.,
# /usr/local/texlive/YYYY in the original TeX Live distribution.
#
# All trees must be organized according to the TeX Directory Structure
# (http://tug.org/tds), or files may not be found.
#
# Redistributors will probably want $SELFAUTODIR/share, i.e., /usr/share.
# Kpathsea sets SELFAUTOLOC (the directory with the binary),
# SELFAUTODIR (its parent), and SELFAUTOPARENT (its grandparent).
#
###		TEXMFROOT = $SELFAUTOPARENT
#
# The main tree of distributed packages and programs:
#
###		TEXMFDIST = $TEXMFROOT/texmf-dist
#
# We used to have a separate /texmf tree with some core programs and files.
# Keep the variable name.
#
###		TEXMFMAIN = $TEXMFDIST
#
# Local additions to the distribution trees.
#
###		TEXMFLOCAL = $SELFAUTOGRANDPARENT/texmf-local
#
# TEXMFSYSVAR, where *-sys store cached runtime data.
#
###		TEXMFSYSVAR = $TEXMFROOT/texmf-var
#
# TEXMFSYSCONFIG, where *-sys store configuration data.
#
###		TEXMFSYSCONFIG = $TEXMFROOT/texmf-config
#
# Per-user texmf tree(s) -- organized per the TDS, as usual.  To define
# more than one per-user tree, set this to a list of directories in
# braces, as described above.  (This used to be HOMETEXMF.)  ~ expands
# to #USERPROFILE# on Windows, $HOME otherwise.
#
###		TEXMFHOME = ~/texmf
#
# TEXMFVAR, where texconfig/updmap/fmtutil store cached runtime data.
#
###		TEXMFVAR = ~/.texlive2014/texmf-var
#
# TEXMFCONFIG, where texconfig/updmap/fmtutil store configuration data.
#
###		TEXMFCONFIG = ~/.texlive2014/texmf-config
#
# List all the texmf trees. For an explanation of what they are, see the
# TeX Live manual.
#
# For texconfig to work properly, TEXMFCONFIG and TEXMFVAR should be named
# explicitly and before all other trees.
#
# TEXMFLOCAL precedes TEXMFDIST because locally-installed versions
# should take precedence over distribution files -- although it is
# generally a source of confusion to have different versions of a
# package installed, whatever the trees, so try to avoid it.
#
###		TEXMF = {$TEXMFCONFIG,$TEXMFVAR,$TEXMFHOME,!!$TEXMFSYSCONFIG,!!$TEXMFSYSVAR,!!$TEXMFLOCAL,!!$TEXMFDIST}
#
# Where to look for ls-R files.  There need not be an ls-R in the
# directories in this path, but if there is one, Kpathsea will use it.
# By default, this is only the !! elements of TEXMF, so that mktexlsr
# does not create ls-R files in the non-!! elements -- because if an
# ls-R is present, it will be used, and the disk will not be searched.
# This is arguably a bug in kpathsea.
#
###		TEXMFDBS = {!!$TEXMFSYSCONFIG,!!$TEXMFSYSVAR,!!$TEXMFLOCAL,!!$TEXMFDIST}
#
# The system trees.  These are the trees that are shared by all users.
# If a tree appears in this list, the mktex* scripts will use
# VARTEXFONTS for generated files, if the original tree isn't writable;
# otherwise the current working directory is used.
#
###		SYSTEXMF = $TEXMFSYSVAR;$TEXMFLOCAL;$TEXMFDIST
#
# First writable tree here is used by Lua(La)TeX for the font cache.
# LuaLaTeX uses the value here, while ConTeXt uses the same variable but
# from texmfcnf.lua; therefore the two values should be kept in sync.
# (As should everything else in texmf.cnf <-> texmfcnf.lua.)
#
###		TEXMFCACHE = $TEXMFSYSVAR;$TEXMFVAR
#
# Where generated fonts may be written.  This tree is used when the sources
# were found in a system tree and either that tree wasn't writable, or the
# varfonts feature was enabled in MT_FEATURES in mktex.cnf.
#
###		VARTEXFONTS = $TEXMFVAR/fonts
#
# On some systems, there will be a system tree which contains all the font
# files that may be created as well as the formats.  For example
#   TEXMFVAR = /var/lib/texmf
# is used in many distros.  In this case, set VARTEXFONTS like this
#VARTEXFONTS = $TEXMFVAR/fonts
# and do not mention it in TEXMFDBS (but _do_ mention TEXMFVAR).
#
# Remove $VARTEXFONTS from TEXMFDBS if the VARTEXFONTS directory is below
# one of the TEXMF directories (avoids overlapping ls-R files).
fixKSearchPaths()
{
	TEXMFCNF=$sourceDir/texk/kpathsea/texmf.cnf
	sed -i -e "s@TEXMFROOT =.*@TEXMFROOT = $dataDir/texlive@" $TEXMFCNF
	sed -i -e "s@TEXMFDIST =.*@TEXMFDIST = $dataDir/texlive/texmf-dist@" $TEXMFCNF
	sed -i -e "s@TEXMFMAIN =.*@TEXMFMAIN = $dataDir/texlive/texmf-dist@" $TEXMFCNF
	sed -i -e "s@TEXMFLOCAL =.*@TEXMFLOCAL = /boot/system/non-packaged/data/texmf-dist@" $TEXMFCNF
	sed -i -e "s@TEXMFSYSVAR =.*@TEXMFSYSVAR = $sharedStateDir/texlive@" $TEXMFCNF
	sed -i -e "s@TEXMFSYSCONFIG =.*@TEXMFSYSCONFIG = $sysconfDir/texlive@" $TEXMFCNF
	sed -i -e "s@TEXMFHOME =.*@TEXMFHOME = /boot/home/config/settings/texmf-dist@" $TEXMFCNF
	sed -i -e "s@TEXMFVAR =.*@TEXMFVAR = /boot/home/config/var/texmf@" $TEXMFCNF
	sed -i -e "s@TEXMFCONFIG =.*@TEXMFCONFIG = /boot/home/config/settings/texmf/config@" $TEXMFCNF
	sed -i -e "s@VARTEXFONTS =.*@VARTEXFONTS = /boot/home/config/settings/texmf/fonts@" $TEXMFCNF
	# rename current TEXMFCNF; easier than writing a more complex sed script!
	sed -i -e "s@^TEXMFCNF@IGNOREDTEXMFCNF@" $TEXMFCNF
	# redefine TEXMFCNF: {$SELFAUTOLOC,$SELFAUTODIR,$SELFAUTOPARENT}{,{/share,}/texmf{-local,}/web2c}
	sed -i -e "s@%TEXMFCNF.*@TEXMFCNF={$dataDir/texlive/texmf-dist/web2c,/boot/system/non-packaged/data/texmf-dist/web2c,/boot/home/config/settings/texmf-dist/web2c}@" $TEXMFCNF
}

PATCH()
{
	# disable the install-bin-links target
	sed -i -e 's/!WIN32/WIN32/g' am/bin_links.am

	pushd texk/web2c/pdftexdir
	cp -v pdftoepdf-poppler0.68.0.cc pdftoepdf.cc
	cp -v pdftosrc-newpoppler.cc pdftosrc.cc
	popd

	./reautoconf

	# may need to run this super early to ensure everything gets the right value...
	fixKSearchPaths
}

BUILD()
{
	mkdir -p ../build && cd ../build

	if [ $targetArchitecture = x86_gcc2 ] || [ $targetArchitecture = x86 ]; then
		HOST=i586-pc-haiku
	elif [ $targetArchitecture = x86_64 ]; then
		HOST=x86_64-unknown-haiku
	fi

	runConfigure --omit-buildspec --omit-dirs "binDir sbinDir" \
		$sourceDir/configure \
		--bindir=$prefix/bin --sbindir=$prefix/bin \
		--disable-native-texlive-build \
		--enable-shared --disable-static \
		--with-banner-add="/Haiku" --with-editor='lpe +%d "%s"' \
		--with-system-harfbauzz \
		--with-system-icu \
		--with-system-graphite2 \
		--with-system-zziplib \
		--with-system-poppler \
		--with-system-mpfr \
		--with-system-gmp \
		--with-system-cairo \
		--with-system-pixman \
		--with-system-gd \
		--with-system-freetype2 \
		--with-system-libpng \
		--with-system-libpaper \
		--with-system-zlib \
		--with-system-libgs \
		--with-system-harfbuzz \
		--with-system-xpdf \
		--with-system-teckit \
		--without-x \
		--disable-t1utils \
		--build=$HOST --host=$HOST

	# and make the damn thing!
	make all $jobArgs
}

INSTALL()
{
	cd ../build
	make install-strip
	# make texlinks creates broken symlinks :( see comment in BUILD()
	make texlinks

	# and install the actual distribution...
	cd $sourceDir3
	fetchTexLiveInstaller
	export TEXLIVE_INSTALL_PREFIX=$dataDir/texlive
	export TEXLIVE_INSTALL_TEXMFSYSVAR=$sharedStateDir/texlive
	export TEXLIVE_INSTALL_TEXMFSYSCONFIG=$sysconfDir/texlive
	export TEXLIVE_INSTALL_TEXMFLOCAL=/boot/system/non-packaged/data/texmf-dist
	export TEXLIVE_INSTALL_TEXMFVAR=/boot/home/config/var/texmf
	export TEXLIVE_INSTALL_TEXMFCONFIG=/boot/home/config/settings/texmf/config
	export TEXLIVE_INSTALL_TEXMFHOME=/boot/home/config/settings
	# hmm, need to work-around /boot/system/non-packaged not existing....
	# the texfm local tree should probably be done with a post-install script, perhaps
	sed -i -e 's/make_local_skeleton \".*//' install-tl
	mkdir -pv $dataDir/texlive
	cp -rv $sourceDir2/texmf-dist $dataDir/texlive
	# run the TeX Live installer, and specify all our paths, once more, to be sure... ;-)
	export PATH=bin/i386-haiku:bin/x86_64-haiku:$prefix/bin:$PATH
	if [ $targetArchitecture = x86_gcc2 ] || [ $targetArchitecture = x86 ]; then
		customBinDir=bin/i386-haiku/
	elif [ $targetArchitecture = x86_64 ]; then
		customBinDir=bin/x86_64-haiku/
	fi
	install-tl --in-place <<< $"D
1
$dataDir/texlive
2
/boot/system/non-packaged/data/texlive/texmf-dist
3
$sharedStateDir/texlive
4
$sysconfDir/texlive
5
/boot/home/config/var/texmf
6
/boot/home/config/settings/texmf/config
7
/boot/home/config/settings/texmf-dist
R
I
"
	# somewhere along the way, a texmf.cnf gets created with ALL the wrong paths...
	# replace it with the known working version
	cp -f $dataDir/texmf-dist/web2c/texmf.cnf $dataDir/texlive/texmf-dist/web2c/texmf.cnf

	# some reason, this doesn't get created, which we need
	if [ ! -e $prefix/bin/mktexfmt ] ; then
		ln -s $prefix/bin/fmtutil $prefix/bin/mktexfmt
	fi

	# remove the documents directory; it's too big for package create to handle!
	# see https://dev.haiku-os.org/ticket/12116
	#rm -rf $dataDir/texlive/texmf-dist/doc

	# remove useless libtool files
	rm -f $libDir/*.la

	prepareInstalledDevelLibs libkpathsea libptexenc

	# devel package
	packageEntries devel \
		$developDir

	exit 1
}

TEST()
{
	make check
}
