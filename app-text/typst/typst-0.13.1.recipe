SUMMARY="A typesetting system markup language"
DESCRIPTION="Typst is a new markup-based typesetting system that is designed to be as powerful \
as LaTeX while being much easier to learn and use. \
Typst has:
- Built-in makrup for the most common formatting task
- Flexible functions for everything else
- A tightly integrated scripting system
- Math typesetting, bibliography management, and more
- Fast compile times thanks to incremental compilation
- Friendly error messages in case something goes wrong"
HOMEPAGE="https://github.com/typst/typst"
COPYRIGHT="2022 Laurenz MÃ¤dje and Martin Haug."
LICENSE="Apache v2"
REVISION="1"; updateRevisionVariables 
SOURCE_URI="$HOMEPAGE/archive/v$portVersion.tar.gz"
CHECKSUM_SHA256="2ffd8443668bc0adb59e9893f7904fd9f64dce8799a1930569f56a91305e8b71"
PATCHES="typst-$portVersion.patchset"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

# On x86_gcc2 we don't want to install the commands in bin/<arch>/, but in bin/.
commandSuffix=$secondaryArchSuffix
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
	commandSuffix=
	commandBinDir=$prefix/bin
fi

PROVIDES="
	typst$secondaryArchSuffix = $portVersion
	cmd:typst = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libssl$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:rustc
	cmd:cargo
	cmd:cc$secondaryArchSuffix
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	cargo build --release $jobArgs
}

INSTALL()
{
	install -m 755 target/release/typst "$commandBinDir"
}

TEST()
{
	cargo test --release $jobArgs
}
