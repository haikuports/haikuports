SUMMARY="A simple, Unicode-aware word processor that runs on the console"
DESCRIPTION="WordGrinder is designed to get out of your way and let you write; \
it does very little, but what it does it does it well. It supports basic \
paragraph styles, basic character styles, basic screen markup, a menu \
interface that means you don't have to remember complex key sequences, HTML \
import and export, and some other useful features."
HOMEPAGE="http://cowlark.com/wordgrinder/"
COPYRIGHT="2007-2017 David Given"
LICENSE="MIT"
REVISION="1"
SOURCE_URI="https://github.com/davidgiven/wordgrinder/archive/$portVersion.tar.gz"
CHECKSUM_SHA256="54085af7963e1f67342bc0b1b20d1ccc75494f2e23d401b601cf3089acea747c"
PATCHES=wordgrinder-$portVersion.patchset

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

commandBinDir=$binDir
commandSuffix=$secondaryArchSuffix
if [ "$targetArchitecture" = x86_gcc2 ]
then
	commandBinDir=$prefix/bin
	commandSuffix=
fi

PROVIDES="
	wordgrinder$secondaryArchSuffix = $portVersion
	cmd:wordgrinder$commandSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
#	lib:libfreetype$secondaryArchSuffix
	lib:liblua$secondaryArchSuffix >= 5.3
	lib:libncurses$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
#	devel:libfreetype$secondaryArchSuffix
	devel:liblua$secondaryArchSuffix >= 5.3
	devel:libncurses$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cc$secondaryArchSuffix
	cmd:make
	cmd:ninja
	cmd:pkg_config$secondaryArchSuffix
	"

if [ -n "$secondaryArchSuffix" ]; then
SUMMARY_dictionaries="Built-in dictionaries for WordGrinder"
ARCHITECTURES_dictionaries="any"
PROVIDES_dictionaries="
	wordgrinder_dictionaries = $portVersion
	"
REQUIRES_dictionaries="
	wordgrinder == $portVersion base
	"
SUPPLEMENTS_dictionaries="
	wordgrinder
	"
fi

defineDebugInfoPackage wordgrinder$secondaryArchSuffix \
	$commandBinDir/wordgrinder

PATCH()
{
	sed -i -e "s|/etc/dictionaries-common/words|$dataDir/wordgrinder/dictionaries/|;" \
		src/lua/addons/spillchocker.lua
}

BUILD()
{
	make PREFIX=$prefix BINDIR=$commandBinDir DOCDIR=$docDir \
		MANDIR=$manDir HOME="`finddir B_USER_DIRECTORY`" \
		LUA_PACKAGE=lua
}

INSTALL()
{
	make install PREFIX=$prefix BINDIR=$commandBinDir DOCDIR=$docDir \
		MANDIR=$manDir HOME="`finddir B_USER_DIRECTORY`" \
		LUA_PACKAGE=lua
	mv $docDir/wordgrinder/README.wg $docDir
	rmdir $docDir/wordgrinder
if [ -n "$secondaryArchSuffix" ]; then
	install -d $dataDir/wordgrinder/dictionaries
	install -t $dataDir/wordgrinder/dictionaries extras/*.dictionaries
	packageEntries dictionaries \
		$dataDir
fi

}
