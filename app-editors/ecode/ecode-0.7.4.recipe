SUMMARY="Lightweight multi-platform code editor"
DESCRIPTION="ecode is a lightweight multi-platform code editor designed for modern hardware with \
a focus on responsiveness and performance. It has been developed with the hardware-accelerated \
eepp GUI, which provides the core technology for the editor. The project comes as the first \
serious project using the eepp GUI, and it's currently being developed to improve the eepp GUI \
library as part of one of its main objectives."
HOMEPAGE="https://github.com/SpartanJ/eepp"
COPYRIGHT="2022-2026 MartÃ­n Lucas Golini"
LICENSE="MIT"
REVISION="1"
# eepVersion="2.9.1" keep around for nex version replacing srcGitRev
srcGitRev="96c08c529b8086d4e9e04ed605a14cc871e6bf51"
SOURCE_URI="https://github.com/SpartanJ/eepp/archive/$srcGitRev.tar.gz"
CHECKSUM_SHA256="eb44544511beb79da144fcbc444af12b2d55d989122dde5aa9f1bca70eefc36c"
SOURCE_FILENAME="eepp-$portVersion-$srcGitRev.tar.gz"
SOURCE_DIR="eepp-$srcGitRev"
# SOIL2
srcGitRev_2="e9ae69d4aadaefcca0a7c0ca43bfcee0d4c09b79"
SOURCE_URI_2="https://github.com/SpartanJ/soil2/archive/$srcGitRev_2.tar.gz"
CHECKSUM_SHA256_2="320786c2c28a9b25adf322d0d4b37f30dd3cc19addda5b5a84e2c0c7b32ca716"
SOURCE_FILENAME_2="SOIL2-$srcGitRev_2.tar.gz"
SOURCE_DIR_2="SOIL2-$srcGitRev_2"
# efsw
srcGitRev_3="04d17474f132910430320a885c3bb8c151d17672"
SOURCE_URI_3="https://github.com/SpartanJ/efsw/archive/$srcGitRev_3.tar.gz"
CHECKSUM_SHA256_3="a56b47e530401b9700f3c0eee2acf34a4e86f556111716d8437039033e791e0b"
SOURCE_FILENAME_3="efsw-$srcGitRev_3.tar.gz"
SOURCE_DIR_3="efsw-$srcGitRev_3"
# premake-cmake
srcGitRev_4="8e02bb91a4d0f29d7540de7357574cf3b7c454f9"
SOURCE_URI_4="https://github.com/Jarod42/premake-cmake/archive/$srcGitRev_4.tar.gz"
CHECKSUM_SHA256_4="0ca5cf35a93776a0aaae885fe0ddd327206135d84aba2aa3a90756de585b6945"
SOURCE_FILENAME_4="premake-cmake-$srcGitRev_4.tar.gz"
SOURCE_DIR_4="premake-cmake-$srcGitRev_4"
# premake-ninja
srcGitRev_5="3d214bf1fd7d2c867cdf02b4ab50fb921fdd1155"
SOURCE_URI_5="https://github.com/jimon/premake-ninja/archive/$srcGitRev_5.tar.gz"
CHECKSUM_SHA256_5="566cd44772a6e28e880cd5c63554d1877407edc59bea1d7daad79ea1c7949f47"
SOURCE_FILENAME_5="premake-ninja-$srcGitRev_5.tar.gz"
SOURCE_DIR_5="premake-ninja-$srcGitRev_5"
ADDITIONAL_FILES="ecode.rdef.in"

ARCHITECTURES="?all x86_64"

PROVIDES="
	ecode = $portVersion
	cmd:ecode = $portVersion
	"
REQUIRES="
	haiku
	lib:libGL
	lib:libSDL2_2.0
	"

BUILD_REQUIRES="
	haiku_devel
	devel:libGL
	devel:libSDL2_2.0
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:gcc
	cmd:make
	cmd:premake5
	"

BUILD()
{
	cp -r $sourceDir2/* src/thirdparty/SOIL2
	cp -r $sourceDir3/* src/thirdparty/efsw
	cp -r $sourceDir4/* premake/premake-cmake
	cp -r $sourceDir5/* premake/premake-ninja
	cd projects/haiku/ecode
	./build.app.sh
}

INSTALL()
{
	mkdir -p $appsDir/ecode
	cp -rf ./projects/haiku/ecode/ecode.app/* $appsDir/ecode
	rm -f $appsDir/ecode/lib/libSDL2*
	rm -f $appsDir/ecode/ecode.png

	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	local APP_NAME="ecode"
	local LONG_INFO="$SUMMARY"
	local APP_SIGNATURE="application/x-vnd.ecode"
	sed \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@LONG_INFO@|$LONG_INFO|" \
		-e "s|@APP_NAME@|$APP_NAME|" \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		$portDir/additional-files/ecode.rdef.in > ecode.rdef

	addResourcesToBinaries ecode.rdef $appsDir/ecode/ecode

	addAppDeskbarSymlink $appsDir/ecode/ecode ecode
}
