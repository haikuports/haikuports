From eec5d5d08bb359fdb918ae92aa11de33b4e0d932 Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Sun, 12 Nov 2017 14:57:47 +0100
Subject: add support for Haiku


diff --git a/makedefs b/makedefs
index 7bfe82c..f8c97b5 100644
--- a/makedefs
+++ b/makedefs
@@ -344,6 +344,9 @@ case "$SYSTEM.$RELEASE" in
 		;;
    BSD/OS.4*)	SYSTYPE=BSDI4
 		;;
+   Haiku*) 		SYSTYPE=HAIKU
+   		SYSLIBS="-lnetwork -ldb-6"
+   		;;
  OSF1.V[3-5].*)	SYSTYPE=OSF1
 		# Use the native compiler by default
 		: ${CC=cc}
diff --git a/src/util/sys_defs.h b/src/util/sys_defs.h
index 3f570c4..bf9c9a1 100644
--- a/src/util/sys_defs.h
+++ b/src/util/sys_defs.h
@@ -36,7 +36,7 @@
     || defined(NETBSD1) || defined(NETBSD2) || defined(NETBSD3) \
     || defined(NETBSD4) || defined(NETBSD5) || defined(NETBSD6) \
     || defined(NETBSD7) \
-    || defined(EKKOBSD1) || defined(DRAGONFLY)
+    || defined(EKKOBSD1) || defined(DRAGONFLY) || defined(HAIKU)
 #define SUPPORTED
 #include <sys/param.h>
 #define UINT32_TYPE	unsigned int
@@ -62,7 +62,7 @@
 #endif
 #define GETTIMEOFDAY(t)	gettimeofday(t,(struct timezone *) 0)
 #define ROOT_PATH	"/bin:/usr/bin:/sbin:/usr/sbin"
-#if (defined(__NetBSD_Version__) && __NetBSD_Version__ > 299000900)
+#if (defined(__NetBSD_Version__) && __NetBSD_Version__ > 299000900) || defined(HAIKU)
 #define USE_STATVFS
 #define STATVFS_IN_SYS_STATVFS_H
 #else
@@ -1250,6 +1250,18 @@ extern int h_errno;
 #define DEF_SMTP_CACHE_DEMAND	0
 #endif
 
+#ifdef HAIKU
+#define SUPPORTED
+#include <sys/socket.h>
+#include <sys/sockio.h>
+#define SOCKADDR_SIZE	socklen_t
+#define SOCKOPT_SIZE	socklen_t
+#define _PATH_BSHELL	"/bin/sh"
+#define _PATH_DEFPATH ""
+#define _PATH_MAILDIR	"/var/spool/mail"
+#undef HAS_ST_GEN
+#endif
+
  /*
   * We're not going to try to guess like configure does.
   */
-- 
2.7.0


From 5f8439b25b3a494b6ee33962f06b027403cc1361 Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Sun, 12 Nov 2017 15:11:22 +0100
Subject: don't use hard links


diff --git a/Makefile.in b/Makefile.in
index 04efd1a..cfdab44 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -50,7 +50,7 @@ update printfck tests root_tests:
 update: $(META) $(LIBEXEC)
 
 libexec/post-install: conf/post-install
-	rm -f $@ && ln -f $? $@
+	rm -f $@ && ln -s $? $@
 
 # Censor out build directory information.
 
@@ -82,22 +82,22 @@ meta/postfix-files: conf/postfix-files conf/makedefs.out Makefile
 	esac > $@
 
 libexec/postfix-script: conf/postfix-script
-	rm -f $@ && ln -f $? $@
+	rm -f $@ && ln -s $? $@
 
 libexec/postfix-tls-script: conf/postfix-tls-script
-	rm -f $@ && ln -f $? $@
+	rm -f $@ && ln -s $? $@
 
 libexec/postfix-wrapper: conf/postfix-wrapper
-	rm -f $@ && ln -f $? $@
+	rm -f $@ && ln -s $? $@
 
 meta/main.cf.proto: conf/main.cf
-	rm -f $@ && ln -f $? $@
+	rm -f $@ && ln -s $? $@
 
 meta/master.cf.proto: conf/master.cf
-	rm -f $@ && ln -f $? $@
+	rm -f $@ && ln -s $? $@
 
 libexec/postmulti-script: conf/postmulti-script
-	rm -f $@ && ln -f $? $@
+	rm -f $@ && ln -s $? $@
 
 meta/dynamicmaps.cf: conf/dynamicmaps.cf Makefile
 	rm -f $@ && $(EXPAND) conf/dynamicmaps.cf | $(AWK) ' \
-- 
2.7.0


From 1c8fd5dc0065ef47633099125cd3a9a6768d7470 Mon Sep 17 00:00:00 2001
From: begasus <begasus@gmail.com>
Date: Sun, 12 Nov 2017 15:43:04 +0100
Subject: define _BSD_SOURCE


diff --git a/src/postqueue/postqueue.c b/src/postqueue/postqueue.c
index 29f0a9c..9042609 100644
--- a/src/postqueue/postqueue.c
+++ b/src/postqueue/postqueue.c
@@ -236,6 +236,7 @@
 #include <string.h>
 #include <stdlib.h>
 #include <signal.h>
+#define _BSD_SOURCE
 #include <sysexits.h>
 #include <errno.h>
 
diff --git a/src/postqueue/showq_compat.c b/src/postqueue/showq_compat.c
index c533288..d763a7d 100644
--- a/src/postqueue/showq_compat.c
+++ b/src/postqueue/showq_compat.c
@@ -35,6 +35,7 @@
 #include <unistd.h>
 #include <time.h>
 #include <string.h>
+#define _BSD_SOURCE
 #include <sysexits.h>
 
 /* Utility library. */
diff --git a/src/postqueue/showq_json.c b/src/postqueue/showq_json.c
index 407d441..1464106 100644
--- a/src/postqueue/showq_json.c
+++ b/src/postqueue/showq_json.c
@@ -32,6 +32,7 @@
 #include <stdlib.h>
 #include <unistd.h>
 #include <string.h>
+#define _BSD_SOURCE
 #include <sysexits.h>
 #include <ctype.h>
 
diff --git a/src/sendmail/sendmail.c b/src/sendmail/sendmail.c
index 340281b..5012b08 100644
--- a/src/sendmail/sendmail.c
+++ b/src/sendmail/sendmail.c
@@ -451,6 +451,7 @@
 #include <errno.h>
 #include <ctype.h>
 #include <stdarg.h>
+#define _BSD_SOURCE
 #include <sysexits.h>
 
 /* Utility library. */
-- 
2.7.0

