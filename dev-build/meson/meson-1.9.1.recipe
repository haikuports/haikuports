SUMMARY="A High productivity build system"
DESCRIPTION="MesonÂ® is a project to create the best possible next-generation \
build system."
HOMEPAGE="https://mesonbuild.com/"
COPYRIGHT="2013-2025 The Meson development team"
LICENSE="Apache v2"
REVISION="2"
SOURCE_URI="https://github.com/mesonbuild/meson/releases/download/$portVersion/meson-$portVersion.tar.gz"
CHECKSUM_SHA256="4e076606f2afff7881d195574bddcd8d89286f35a17b4977a216f535dc0c74ac"
PATCHES="meson-$portVersion.patchset"

pythonVersion=3.10
pythonPackage=python${pythonVersion//.}

ARCHITECTURES="any"

PROVIDES="
	meson = $portVersion
	cmd:meson = $portVersion
	cmd:mesonconf = $portVersion
	cmd:mesonintrospect = $portVersion
	cmd:mesontest = $portVersion
	cmd:wraptool = $portVersion
	"
REQUIRES="
	haiku
	cmd:ninja >= 1.6
	cmd:python$pythonVersion
	"

BUILD_REQUIRES="
	haiku_devel
	build_$pythonPackage
	installer_$pythonPackage
	setuptools_$pythonPackage
	wheel_$pythonPackage
	"
BUILD_PREREQUIRES="
	cmd:python$pythonVersion
	"

TEST_REQUIRES="
	cmd:clang
	cmd:g_ir_scanner
	cmd:gcc
	cmd:ninja >= 1.6
	cmd:pkg_config
	devel:libglib_2.0
	"

BUILD()
{
	python$pythonVersion -m build --wheel --skip-dependency-check --no-isolation
}


INSTALL()
{
	python$pythonVersion -m installer --p $prefix dist/$portName-$portVersion-py3-none-any.whl

	mkdir -p $docDir
	mv $prefix/share/man $manDir

	# install shell completions
	mkdir -p $dataDir/bash-completion/completions
	mkdir -p $dataDir/zsh/site-functions
	cp data/shell-completions/bash/meson $dataDir/bash-completion/completions/meson
	cp data/shell-completions/zsh/_meson $dataDir/zsh/site-functions/_meson

	# cleanup
	rm -rf $prefix/share
	rm -rf $docDir
	rm -rf $libDir/python3.1
}

TEST()
{
	MESON_PRINT_TEST_OUTPUT=1 LC_CTYPE=en_US.UTF-8 ./run_tests.py
}
