SUMMARY="Free/Libre Action Roleplaying Engine"
DESCRIPTION="Flare is an open source, 2D action RPG licensed under the GPL3 license. Its game play \
can be likened to the games in the Diablo series.

While the core engine is written in C++ with SDL2, there is an easy to use modding interface, \
by using it, itâ€™s possible to create entirely new games. On the Flare website's Mods page, \
you can find games made by the Flare team, as well a few select community projects.

This package includes the Flare engine along with Fantasycore, Alpha demo and other basic mods. \
More mods can be installed through other packages or by putting them manually in \
'non-packaged/data/flare/mods'."
HOMEPAGE="https://flarerpg.org/"
COPYRIGHT="2010-2022 Clint Bellanger"
LICENSE="GNU GPL v3"
REVISION="1"
portVersion="`echo "$portVersion" | cut -b1-4`"
SOURCE_URI="https://github.com/flareteam/flare-engine/archive/v$portVersion/flare-engine-v$portVersion.tar.gz"
CHECKSUM_SHA256="2c1bafeaa5ac26c10449bfcb7151b06e8a22547aa7364d2a39bbcb135aa50a09"
SOURCE_DIR="flare-engine-$portVersion"
SOURCE_URI_2="https://github.com/flareteam/flare-game/archive/v$portVersion/flare-game-v$portVersion.tar.gz"
CHECKSUM_SHA256_2="65758462070aa88842084f8ee69083d8226e93cfbf83481663276d8307494b8e"
SOURCE_DIR_2="flare-game-$portVersion"
srcGitRev_poly=b8ececd9c2fffd4e69ac0c69e147c7de337b328b
SOURCE_URI_3="https://github.com/makrohn/polymorphable/archive/$srcGitRev_poly.zip"
CHECKSUM_SHA256_3="0f09a70e6dba6be70ff175fc8874baea31dd487a671897b7895948e17bad4339"
SOURCE_FILENAME_3="polymorphable-$srcGitRev_poly.zip"
SOURCE_DIR_3="polymorphable-$srcGitRev_poly"
srcGitRev_nonamemod=d85a6f86d11a3744b8cc97cc75c44c8c6dfc07b1
SOURCE_URI_4="https://github.com/igorko/flare-mod-noname/archive/$srcGitRev_nonamemod.zip"
CHECKSUM_SHA256_4="08c5d4fb2acd117641276356c7d8320b1c37ffa15e3514285576b62beca1fd31"
SOURCE_FILENAME_4="flare-mod-noname-$srcGitRev_nonamemod.zip"
SOURCE_DIR_4="flare-mod-noname-$srcGitRev_nonamemod"
ADDITIONAL_FILES="flare.rdef.in"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	flare$secondaryArchSuffix = $portVersion
	app:Flare = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libsdl2_2.0$secondaryArchSuffix
	lib:libsdl2_image_2.0$secondaryArchSuffix
	lib:libsdl2_mixer_2.0$secondaryArchSuffix
	lib:libsdl2_ttf_2.0$secondaryArchSuffix
	"

SUMMARY_empyrean="${SUMMARY} - Empyrean Campaign"
DESCRIPTION_empyrean="The Empyrean campaign is the official campaign for Flare, the Free/Libre Action Roleplaying Engine."

ARCHITECTURES_empyrean="any"

PROVIDES_empyrean="
	flare_empyrean = $portVersion
	"
REQUIRES_empyrean="
	haiku$secondaryArchSuffix
	flare$secondaryArchSuffix
	"

SUMMARY_minicore="${SUMMARY} - Minicore mods"
DESCRIPTION_minicore="Set of Flare mods for smaller displays and handhelds."

ARCHITECTURES_minicore="any"

PROVIDES_minicore="
	flare_minicore = $portVersion
	"
REQUIRES_minicore="
	haiku$secondaryArchSuffix
	flare$secondaryArchSuffix
	"

SUMMARY_polymorphable="${SUMMARY} - Laurelia's Polymorphable Citizen"
DESCRIPTION_polymorphable="Originally created for the 2012 Liberated Pixel Cup, this game is based upon \
Clint Bellanger's FLARE engine. Our goal is to create a game which draws upon several \
different classics in the genre, with a heavy emphasis on a polymorphable main character.

Laurelia's Polymorphable Citizen (or just Polymorphable for short) is an action-rpg \
based on the Flare engine. We're aiming a little more towards an 8-bit adventure classic \
feel, only with more RPG aspects (ie. attribute choices on level up!)

The core mechanic in Polymorphable is using different talismans to polymorph into different \
forms so you can reach different areas. Imagine being blocked by a pit, so you transform \
into a bat to fly across. Or perhaps there's a wall of fire in front of you, so you turn \
into ghost form to phase right through."
COPYRIGHT_polymorphable="Thane Brimhall & Matthew Krohn"

ARCHITECTURES_polymorphable="any"

PROVIDES_polymorphable="
	flare_polymorphable
	"
REQUIRES_polymorphable="
	haiku$secondaryArchSuffix
	flare$secondaryArchSuffix
	"

SUMMARY_nonamemod="${SUMMARY} - Noname mod"
DESCRIPTION_nonamemod="This is an as yet nameless mod for Clint Bellangers Flare engine. The basic goals are \
to create a small game which will work on the v1 flare engine, which can be completed with an \
achievable scope, which shows off some of the newer engine features and shows off some of the \
previously unused flare art from opengameart.org."
COPYRIGHT_nonamemod="The Flare community"

ARCHITECTURES_nonamemod="any"

PROVIDES_nonamemod="
	flare_nonamemod
	"
REQUIRES_nonamemod="
	haiku$secondaryArchSuffix
	flare$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libsdl2_2.0$secondaryArchSuffix
	devel:libsdl2_image_2.0$secondaryArchSuffix
	devel:libsdl2_mixer_2.0$secondaryArchSuffix
	devel:libsdl2_ttf_2.0$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	mkdir -p build && cd build

	cmake .. -DCMAKE_BUILD_TYPE=Release -Wno-dev \
		-DSDL2_INCLUDE_DIR=/system/$relativeIncludeDir/SDL2 \
		-DSDL2_IMAGE_INCLUDE_DIR=/system/$relativeIncludeDir/SDL2 \
		-DSDL2_MIXER_INCLUDE_DIR=/system/$relativeIncludeDir/SDL2 \
		-DSDL2_TTF_INCLUDE_DIR=/system/$relativeIncludeDir/SDL2

	make $jobArgs
}

INSTALL()
{
	mkdir -p $appsDir $dataDir/flare
	cp build/flare $appsDir/Flare
	cp -r mods $sourceDir2/mods $sourceDir3/mods $dataDir/flare
	cp -r $sourceDir4/new_game_mod $dataDir/flare/mods

	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	sed \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		$portDir/additional-files/flare.rdef.in > $sourceDir/flare.rdef

	packageEntries empyrean $dataDir/flare/mods/empyrean_campaign

	packageEntries minicore \
		$dataDir/flare/mods/gcw0_defaults \
		$dataDir/flare/mods/minicore \
		$dataDir/flare/mods/minicore_alpha

	packageEntries polymorphable $dataDir/flare/mods/polymorphable

	packageEntries nonamemod $dataDir/flare/mods/new_game_mod

	addResourcesToBinaries  $sourceDir/flare.rdef $appsDir/Flare
	addAppDeskbarSymlink $appsDir/Flare
}
