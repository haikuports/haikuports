SUMMARY="...a powerful, fast and reliable backup & sync tool"
DESCRIPTION="an application that backs-up and/or synchronizes any directories with the power of rsync.\
It is simple to use, fast (transfers over only changes made and not all data),\
safe (keeps your data safe by checking all declared directories before proceeding in any data manipulation ),\
reliable and fully customizable."
COPYRIGHT="2008-2017	Loukas Avgeriou	"
LICENSE="GNU GPL v3"
REVISION="1"
HOMEPAGE="http://luckybackup.sourceforge.net"
SOURCE_URI="https://sourceforge.net/projects/luckybackup/files/0.4.9/source/luckybackup-0.4.9.tar.gz"
CHECKSUM_SHA256="c161e98a11de5ad0a32a8e060e3fd45695a93ea3adf0581764a6b5d32e8da23b"
SOURCE_DIR="luckybackup"
SOURCE_FILENAME="luckybackup-$portVersion.tar.gz"
SOURCE_DIR="luckybackup-$portVersion"
ADDITIONAL_FILES="luckybackup.rdef.in"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	luckybackup$secondaryArchSuffix = $portVersion
	app:LuckyBackup = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libQt5Core$secondaryArchSuffix
	lib:libQt5Gui$secondaryArchSuffix
	lib:libQt5Network$secondaryArchSuffix
	lib:libQt5WebKit$secondaryArchSuffix
	lib:libQt5Widgets$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	lib:librsync
	lib:libssl
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libQt5Core$secondaryArchSuffix
	devel:libQt5Gui$secondaryArchSuffix
	devel:libQt5Network$secondaryArchSuffix
	devel:libQt5WebKit$secondaryArchSuffix
	devel:libQt5Widgets$secondaryArchSuffix
	devel:libQt5Svg$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	devel:librsync
	devel:libssl
	"
BUILD_PREREQUIRES="
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	cmd:qmake$secondaryArchSuffix >= 5
	cmd:tar
	"

BUILD()
{
	qmake
	make $jobArgs
}

INSTALL()
{
	#create directories
	mkdir -p $appsDir/LuckyBackup/{manual,translations}
	#install
	install -T ./luckybackup "$appsDir"/LuckyBackup/LuckyBackup

	# copy manpages
	mkdir -p $manDir/man8
	cp -r ./manpage/*.8 $manDir/man8/

	# copy html documentation
	cp -r ./manual/* $appsDir/LuckyBackup/manual/
	# copy translation
	cp -rd ./translations/*.qm $appsDir/LuckyBackup/translations/

	local APP_SIGNATURE="application/x-vnd.LuckyBackup"
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	local LONG_INFO="$SUMMARY"
	sed \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@LONG_INFO@|$LONG_INFO|" \
		"$portDir"/additional-files/luckybackup.rdef.in > luckybackup.rdef

	addResourcesToBinaries luckybackup.rdef "$appsDir"/LuckyBackup/LuckyBackup
	addAppDeskbarSymlink "$appsDir"/LuckyBackup/LuckyBackup
}
