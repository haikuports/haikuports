SUMMARY="A free Qt-based implementation of a ModBus master application"
DESCRIPTION="A graphical user interface allows easy communication with ModBus R>
 TCP slaves. QModMaster also includes a bus monitor for examining all traffic o>
 QModMaster is based on libmodbus  for modbus  \
 communication and on QsLog for logging.
 Supports Haiku, Windows and Linux.

-Features
     ModBus RTU/TCP Master
     Monitor Bus activity [Raw Data and PDU details]
"
COPYRIGHT="2012-2020 Elbar"
HOMEPAGE="https://sourceforge.net/projects/qmodmaster/"
LICENSE="GNU GPL v3"
REVISION="1"
SOURCE_URI="https://download.sourceforge.net/qmodmaster/qModMaster-code-0.5.2-3>
CHECKSUM_SHA256="61e0d60abb6e2ae1347843e96bb5e31f61604857f4097765aea3ffd31a3dcc>
SOURCE_FILENAME="qModMaster-code-$portVersion.zip"
SOURCE_DIR="qModMaster-code-$portVersion"
ADDITIONAL_FILES="qmodmaster.rdef.in"

ARCHITECTURES="?x86_gcc2 x86 x86_64"
if [ "$targetArchitecture" = x86_gcc2 ]; then
        SECONDARY_ARCHITECTURES="x86"
fi

PROVIDES="
        qmodmaster$secondaryArchSuffix = $portVersion
        app:QModMaster = $portVersion
        "
REQUIRES="
        haiku$secondaryArchSuffix
        lib:libGL$secondaryArchSuffix
        lib:libQt5Core$secondaryArchSuffix
        lib:libQt5Gui$secondaryArchSuffix
        lib:libQt5Network$secondaryArchSuffix
        lib:libQt5Xml$secondaryArchSuffix
        lib:libz$secondaryArchSuffix
        "
BUILD_REQUIRES="
        haiku${secondaryArchSuffix}_devel
        devel:libQt5Core$secondaryArchSuffix
        devel:libQt5Gui$secondaryArchSuffix
        devel:libQt5Network$secondaryArchSuffix
        devel:libQt5Xml$secondaryArchSuffix
        devel:libz$secondaryArchSuffix
        "
BUILD_PREREQUIRES="
        cmd:gcc$secondaryArchSuffix
        cmd:ld$secondaryArchSuffix
        cmd:lrelease$secondaryArchSuffix >= 5
        cmd:make
        cmd:pkg_config$secondaryArchSuffix
        cmd:qmake$secondaryArchSuffix >= 5
        cmd:unzip
        "
BUILD()
{
        qmake
        make $jobArgs
}

INSTALL()
{
        mkdir -p $appsDir/QModmaster
        install -d $appsDir/QModmaster
        install -T ./qModMaster $appsDir//QModmaster/QModMaster
        cp -rf Docs  $appsDir/QModmaster/
        cp -rf ManModbus  $appsDir/QModmaster/

        local APP_SIGNATURE="application/x-vnd.qmodmaster"
        local MAJOR="`echo "$portVersion" | cut -d. -f1`"
        local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
        local MINOR="`echo "$portVersion" | cut -d. -f3`"
        local LONG_INFO="$SUMMARY"
        sed \
                -e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
                -e "s|@MAJOR@|$MAJOR|" \
                -e "s|@MIDDLE@|$MIDDLE|" \
                -e "s|@MINOR@|$MINOR|" \
                -e "s|@LONG_INFO@|$LONG_INFO|" \
                "$portDir"/additional-files/qmodmaster.rdef.in > qmodmaster.rdef

        addResourcesToBinaries qmodmaster.rdef $appsDir/QModMaster
        addAppDeskbarSymlink $appsDir/QModMaster
}
