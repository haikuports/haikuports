From 9af6586c1350885230759eae8547712549b37819 Mon Sep 17 00:00:00 2001
From: Massimiliano Gubinelli <m.gubinelli@gmail.com>
Date: Fri, 20 Mar 2020 22:23:38 +0000
Subject: compilation fix


diff --git a/libguile/posix.c b/libguile/posix.c
index 2ecd8ae..fdaaad9 100644
--- a/libguile/posix.c
+++ b/libguile/posix.c
@@ -421,9 +421,9 @@ SCM_DEFINE (scm_getgrgid, "getgr", 0, 1, 0,
 	  return SCM_BOOL_F;
 	}
     }
-  else if (scm_is_integer (name))
+  else if (scm_is_integer (name)) {
     SCM_SYSCALL (entry = getgrgid (scm_to_int (name)));
-  else
+  } else
     STRING_SYSCALL (name, c_name,
 		    entry = getgrnam (c_name));
   if (!entry)
@@ -1236,14 +1236,14 @@ SCM_DEFINE (scm_utime, "utime", 1, 2, 0,
   int rv;
   struct utimbuf utm_tmp;
 
-  if (SCM_UNBNDP (actime))
+  if (SCM_UNBNDP (actime)) {
     SCM_SYSCALL (time (&utm_tmp.actime));
-  else
+  } else
     utm_tmp.actime = SCM_NUM2ULONG (2, actime);
 
-  if (SCM_UNBNDP (modtime))
+  if (SCM_UNBNDP (modtime)) {
     SCM_SYSCALL (time (&utm_tmp.modtime));
-  else
+  } else
     utm_tmp.modtime = SCM_NUM2ULONG (3, modtime);
 
   STRING_SYSCALL (pathname, c_pathname,
-- 
2.24.1


From afce25de1391d24cfada423a6a70953f23ef56d9 Mon Sep 17 00:00:00 2001
From: Massimiliano Gubinelli <m.gubinelli@gmail.com>
Date: Fri, 20 Mar 2020 23:38:42 +0000
Subject: hack


diff --git a/libguile/fports.c b/libguile/fports.c
index 007ee3f..8b043e3 100644
--- a/libguile/fports.c
+++ b/libguile/fports.c
@@ -595,7 +595,7 @@ fport_fill_input (SCM port)
   scm_t_fport *fp = SCM_FSTREAM (port);
 
 #ifndef __MINGW32__
-  fport_wait_for_input (port);
+  //fport_wait_for_input (port);
 #endif /* !__MINGW32__ */
   SCM_SYSCALL (count = read (fp->fdes, pt->read_buf, pt->read_buf_size));
   if (count == -1)
-- 
2.24.1


From 6b09fbfaa64a20c118b87da7d553af0d30e7335d Mon Sep 17 00:00:00 2001
From: Massimiliano Gubinelli <m.gubinelli@gmail.com>
Date: Sat, 21 Mar 2020 19:00:10 +0000
Subject: improvements


diff --git a/libguile/fports.c b/libguile/fports.c
index 8b043e3..179c58d 100644
--- a/libguile/fports.c
+++ b/libguile/fports.c
@@ -594,8 +594,8 @@ fport_fill_input (SCM port)
   scm_t_port *pt = SCM_PTAB_ENTRY (port);
   scm_t_fport *fp = SCM_FSTREAM (port);
 
-#ifndef __MINGW32__
-  //fport_wait_for_input (port);
+#if !defined(__MINGW32__) && !defined(__HAIKU__)
+  fport_wait_for_input (port);
 #endif /* !__MINGW32__ */
   SCM_SYSCALL (count = read (fp->fdes, pt->read_buf, pt->read_buf_size));
   if (count == -1)
-- 
2.24.1

