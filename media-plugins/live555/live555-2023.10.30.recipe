SUMMARY="C++ libraries for multimedia streaming"
DESCRIPTION="live555 forms a set of C++ libraries for multimedia streaming \
using open standard protocols. The library can be used to build streaming \
applications using various audio and video codecs."
HOMEPAGE="http://www.live555.com/liveMedia/"
COPYRIGHT="Live Networks, Inc."
LICENSE="GNU GPL v3
	GNU LGPL v3"
REVISION="1"
SOURCE_URI="http://www.live555.com/liveMedia/public/live.$portVersion.tar.gz"
CHECKSUM_SHA256="f51e5f2d6ae01bc09616b5dc39464e28b2adfb3832f46fa2a0b021c5ab4ec0eb"
SOURCE_DIR="live"
PATCHES="live555-$portVersion.patchset"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	live555$secondaryArchSuffix = $portVersion
	cmd:live555HLSProxy
	cmd:live555MediaServer
	cmd:live555ProxyServer
	cmd:mikeyparse
	cmd:MPEG2TransportStreamIndexer
	cmd:openRTSP
	cmd:playSIP
	cmd:registerRTSPStream
	cmd:sapWatch
	cmd:testAMRAudioStreamer
	cmd:testDVVideoStreamer
	cmd:testH264VideoStreamer
	cmd:testH264VideoToHLSSegments
	cmd:testH264VideoToTransportStream
	cmd:testH265VideoStreamer
	cmd:testH265VideoToTransportStream
	cmd:testMKVSplitter
	cmd:testMKVStreamer
	cmd:testMP3Receiver
	cmd:testMP3Streamer
	cmd:testMPEG1or2AudioVideoStreamer
	cmd:testMPEG1or2ProgramToTransportStream
	cmd:testMPEG1or2Splitter
	cmd:testMPEG1or2VideoReceiver
	cmd:testMPEG1or2VideoStreamer
	cmd:testMPEG2TransportReceiver
	cmd:testMPEG2TransportStreamer
	cmd:testMPEG2TransportStreamSplitter
	cmd:testMPEG2TransportStreamTrickPlay
	cmd:testMPEG4VideoStreamer
	cmd:testOggStreamer
	cmd:testOnDemandRTSPServer
	cmd:testRelay
	cmd:testReplicator
	cmd:testRTSPClient
	cmd:testWAVAudioStreamer
	cmd:vobStreamer
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libcrypto$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	"

PROVIDES_devel="
	live555${secondaryArchSuffix}_devel = $portVersion
	devel:libBasicUsageEnvironment$secondaryArchSuffix = $portVersion
	devel:libgroupsock$secondaryArchSuffix = $portVersion
	devel:libliveMedia$secondaryArchSuffix = $portVersion
	devel:libUsageEnvironment$secondaryArchSuffix = $portVersion
	"
REQUIRES_devel="
	live555$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libcrypto$secondaryArchSuffix
	devel:libssl$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:ar
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:make
	"

BUILD()
{
	./genMakefiles haiku
	make $jobArgs
}

INSTALL()
{
	make install PREFIX=$prefix \
		INCLUDEDIR=$includeDir \
		LIBDIR=$developLibDir

	mkdir -p $includeDir

	mkdir -p $developLibDir/pkgconfig
	cat > $developLibDir/pkgconfig/live555.pc << EOF
prefix=${prefix}
exec_prefix=${prefix}
libdir=${libDir}
includedir=${includeDir}

Name: live555
Description: multimedia RTSP streaming library
Version: $portVersion
Libs: -L${developLibDir} -lliveMedia -lgroupsock -lBasicUsageEnvironment -lUsageEnvironment
Cflags: -I${includeDir}/liveMedia -I${includeDir}/groupsock -I${includeDir}/BasicUsageEnvironment -I${includeDir}/UsageEnvironment
EOF

	# devel package
	packageEntries devel \
		$developDir
}
