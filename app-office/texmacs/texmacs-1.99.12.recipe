SUMMARY="A scientific editing platform designed to create beautiful technical documents"
DESCRIPTION="TeXmacs provides a unified and user friendly framework for editing \
structured documents with different types of content: text, mathematics, graphics, \
interactive content, slides, etc.\
Its rendering engine uses high-quality typesetting algorithms so as to produce \
professionally looking documents, which can either be printed out or presented from \
a laptop."
HOMEPAGE="http://www.texmacs.org"
COPYRIGHT="Free Software Foundation"
LICENSE="GNU GPL v3"
REVISION="1"
SOURCE_URI="https://github.com/mgubi/texmacs/archive/texmacs-$portVersion-haiku-qt5.tar.gz"
CHECKSUM_SHA256="607fa4db4676b78780f7af086feec2e2332dc18a371d79fa50d640de6db10b43"
ADDITIONAL_FILES="texmacs.rdef.in"
SOURCE_DIR="texmacs-texmacs-$portVersion-haiku-qt5/src"
PATCHES="texmacs-$portVersion.patchset"
ARCHITECTURES="?x86_gcc2 ?x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	texmacs$secondaryArchSuffix = $portVersion
	app:TeXmacs
	cmd:fig2ps$secondaryArchSuffix
	"

REQUIRES="
	haiku$secondaryArchSuffix
	lib:libiconv$secondaryArchSuffix
	lib:libQt5Concurrent$secondaryArchSuffix
	lib:libQt5Core$secondaryArchSuffix
	lib:libQt5Gui$secondaryArchSuffix
	lib:libQt5Svg$secondaryArchSuffix
	lib:libQt5Widgets$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	lib:libguile$secondaryArchSuffix
	lib:libfreetype$secondaryArchSuffix
	lib:libgmp$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
	lib:libltdl$secondaryArchSuffix
	lib:libGL$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libiconv$secondaryArchSuffix
	devel:libQt5Concurrent$secondaryArchSuffix
	devel:libQt5Core$secondaryArchSuffix
	devel:libQt5Gui$secondaryArchSuffix
	devel:libQt5Svg$secondaryArchSuffix
	devel:libQt5Widgets$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	devel:libguile$secondaryArchSuffix
	devel:libfreetype$secondaryArchSuffix
	devel:libgmp$secondaryArchSuffix
	devel:libltdl$secondaryArchSuffix
	"

BUILD_PREREQUIRES="
	cmd:bc
	cmd:autoconf
	cmd:automake
	cmd:find
	cmd:gcc$secondaryArchSuffix
	cmd:gettext$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	cmd:python2.7
	cmd:sed
	"

BUILD()
{
#	./autogen.sh
	runConfigure ./configure
	make $jobArgs
}

INSTALL()
{
	make install

	rm $binDir/texmacs

	mkdir $appsDir
	mv $libDir/TeXmacs/bin/texmacs.bin $appsDir/TeXmacs

	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	local INTERNAL="0"
	sed \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@INTERNAL@|$INTERNAL|" \
		$portDir/additional-files/texmacs.rdef.in > texmacs.rdef

	addResourcesToBinaries texmacs.rdef \
		$appsDir/TeXmacs

	addAppDeskbarSymlink $appsDir/TeXmacs
}
