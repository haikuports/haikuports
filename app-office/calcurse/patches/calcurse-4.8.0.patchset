From be7e7bc4d56fd3e86611800b8771d733ff8835cc Mon Sep 17 00:00:00 2001
From: Begasus <begasus@gmail.com>
Date: Wed, 17 May 2023 15:08:43 +0200
Subject: Fix version


diff --git a/configure.ac b/configure.ac
index e7594c5..f3924a9 100644
--- a/configure.ac
+++ b/configure.ac
@@ -3,7 +3,7 @@
 #-------------------------------------------------------------------------------
 AC_PREREQ(2.59)
 AC_INIT([calcurse],
-        m4_esyscmd([build-aux/git-version-gen .version]),
+        m4_esyscmd_s([cat .version]),
         [bugs@calcurse.org])
 AM_INIT_AUTOMAKE
 #m4_ifdef([AM_SILENT_RULES],[AM_SILENT_RULES([yes])])
-- 
2.37.3


From ac1bac201c3961ccb90fab2f6a4a86ec6b3b532f Mon Sep 17 00:00:00 2001
From: Begasus <begasus@gmail.com>
Date: Wed, 17 May 2023 15:13:23 +0200
Subject: Revert check for libncurses (no need for autoconf-archive)


diff --git a/configure.ac b/configure.ac
index f3924a9..4fc1874 100644
--- a/configure.ac
+++ b/configure.ac
@@ -30,12 +30,27 @@ AC_CHECK_HEADERS([ctype.h getopt.h locale.h math.h signal.h stdio.h stdlib.h   \
 #-------------------------------------------------------------------------------
 #                                                         Checks for system libs
 #-------------------------------------------------------------------------------
-AX_WITH_CURSES
-if test "x$ax_cv_ncursesw" != xyes && test "x$ax_cv_ncurses" != xyes; then
-  AC_MSG_ERROR(Either ncurses or ncursesw library is required to build calcurse!)
-fi
-
-LIBS="$LIBS $CURSES_LIBS"
+AC_CHECK_FUNC(initscr,,
+[
+  available_ncurses="none"
+  for lib in ncursesw ncurses
+  do
+    AC_CHECK_LIB($lib, initscr,
+                 [available_ncurses="$lib"; break])
+  done
+  if test "$available_ncurses" = none; then
+    AC_MSG_ERROR(Either ncurses or ncursesw library is required to build calcurse!)
+  elif test "$available_ncurses" = ncursesw; then
+    AC_CHECK_HEADERS([ncursesw/ncurses.h],,
+                     [AC_CHECK_HEADERS([ncurses.h],,
+                                       AC_MSG_ERROR([Missing ncursesw header file]))])
+  else
+    AC_CHECK_HEADERS([ncurses/ncurses.h],,
+                     [AC_CHECK_HEADERS([ncurses.h],,
+                                       AC_MSG_ERROR([Missing ncurses header file]))])
+  fi
+  LIBS="$LIBS -l$available_ncurses"
+])
 
 AC_CHECK_HEADERS([pthread.h], [
     AC_CHECK_LIB(pthread, pthread_create, [
-- 
2.37.3

