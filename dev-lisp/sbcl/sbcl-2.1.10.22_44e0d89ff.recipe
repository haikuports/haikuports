SUMMARY="A high performance Common Lisp compiler"
DESCRIPTION="Steel Bank Common Lisp (SBCL) is a high performance Common \
Lisp compiler. It is open source / free software, with a permissive license. \
In addition to the compiler and runtime system for ANSI Common Lisp, it \
provides an interactive environment including a debugger, a statistical \
profiler, a code coverage tool, and many other extensions."
HOMEPAGE="https://sbcl.org"
COPYRIGHT="2002 Gerd Moellmann"
LICENSE="BSD (2-clause)"
REVISION="1"
SOURCE_URI="git://github.com/sbcl/sbcl.git"
CHECKSUM_SHA256="9cfd324f2a1eac2635188b945d10df428d1941c6"
PATCHES="sbcl-2.1.11.patchset"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

libVersion="$portVersion"
libVersionCompat="$libVersion compat >= ${libVersion%.*}"
portVersionCompat="$portVersion compat >= ${portVersion%%.*}"

PROVIDES="
	sbcl$secondaryArchSuffix = $portVersion
	cmd:sbcl$secondaryArchSuffix = $portVersion
	"

REQUIRES="
	haiku$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
        java:environment >= 11
	devel:libssl$secondaryArchSuffix
	"

BUILD_PREREQUIRES="
        java:environment == 11
	cmd:gcc$secondaryArchPrefix
	cmd:make
	cmd:find
	cmd:git
	cmd:sed
	cmd:java
	cmd:abcl
	cmd:xargs
	cmd:pkg_config$secondaryArchPrefix
	"

BUILD()
{
        source /system/data/profile.d/openjdk11.sh
        export JAVA_HOME=$JDK11_HOME
echo ';;; This file is auto-generated using generate-version.sh. Every time
;;; you re-run make.sh, this file will be overwritten if you are
;;; working from a Git checkout.
"2.1.10.22-44e0d89ff-WIP"' > version.lisp-expr
	sh make.sh abcl
}

INSTALL()
{
	INSTALL_ROOT=$prefix sh install.sh
}

