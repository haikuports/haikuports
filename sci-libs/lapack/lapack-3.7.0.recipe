SUMMARY="Numerical linear algebra"
DESCRIPTION="A library of Fortran 90 with subroutines for solving \
the most commonly occurring problems in numerical linear algebra."
HOMEPAGE="http://www.netlib.org/lapack/"
COPYRIGHT="1992-2016 The LAPACK Project"
LICENSE="BSD (3-clause)"
REVISION="1"
SOURCE_URI="https://github.com/Reference-LAPACK/lapack/archive/v$portVersion.tar.gz"
CHECKSUM_SHA256="9c40b5e4970f27c5f6911cb0a28aa26b6c83f17418b69f8e5a116bb983ca8557"
SOURCE_DIR="lapack-$portVersion"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="!x86_gcc2 x86"

PROVIDES="
	lapack$secondaryArchSuffix = $portVersion
	lib:libopenblas$secondaryArchSuffix = $portVersion compat >= 0
	lib:libopenblasp_r${portVersion}$secondaryArchSuffix = $portVersion compat >= 0
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

PROVIDES_devel="
	lapack${secondaryArchSuffix}_devel = $portVersion
	devel:libopenblas$secondaryArchSuffix = $portVersion compat >= 0
	devel:libopenblasp_r${portVersion}$secondaryArchSuffix = $portVersion compat >= 0
	"
REQUIRES_devel="
	lapack$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:gfortran
	cmd:g++$secondaryArchSuffix
	cmd:make
	cmd:perl
	"

BUILD()
{
	# DYNAMIC_ARCH is x86 only
	# PPC & others should specify TARGET=
#	make MAKE_NB_JOBS=${jobArgs#-j} NO_LAPACKE=1 NO_AFFINITY=1 NO_WARMUP=1 \
#		NUM_THREADS=64 \
#		DYNAMIC_ARCH=1
	mkdir build-haiku
	cd build-haiku

	cmake .. \
		-DCMAKE_INSTALL_PREFIX=$prefix \
		-DLAPACKE:BOOL=ON \
		-DLAPACKE_WITH_TMG:BOOL=ON \
		-DCBLAS:BOOL=ON

	make $jobArgs
}

INSTALL()
{
#	make install PREFIX=$prefix \
#		 OPENBLAS_LIBRARY_DIR=$libDir \
#		 OPENBLAS_INCLUDE_DIR=$includeDir

	make install

	prepareInstalledDevelLibs libopenblas libopenblasp-r$portVersion

	packageEntries devel \
		$developDir \
		$libDir/cmake
}
