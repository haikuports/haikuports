SUMMARY="World Coordinate System library for astronomical FITS images"
DESCRIPTION=". WCSTools is a package of programs and a library of utility \
subroutines for setting and using the world coordinate systems (WCS) in the \
headers of the most common astronomical image formats, FITS and IRAF .imh, \
to relate image pixels to sky coordinates. "
HOMEPAGE="https://heasarc.gsfc.nasa.gov/fitsio/CCfits"
COPYRIGHT="1996-2020 Jessica Mink - Smithsonian Astrophysical Observatory
	1995-2020 Mark Calabretta - Australia Telescope National Facility, CSIRO"
LICENSE="GNU GPL v2
	GNU LGPL v2.1"
REVISION="1"
SOURCE_URI="http://tdc-www.harvard.edu/software/wcstools/wcstools-$portVersion.tar.gz"
CHECKSUM_SHA256="b2f9be55fdec29f0c640028a9986771bfd6ab3d2f633953e4c7cc3b410e5fe9c"
PATCHES="wcstools-$portVersion.patchset"
ADDITIONAL_FILES="
	configure.ac
	Makefile.am
	Makefile.libwcs.am
	wcstools.pc.in
	"

ARCHITECTURES="?x86_gcc2 x86_64 ?arm ?ppc ?sparc"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	wcstools$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

PROVIDES_devel="
	wcstools${secondaryArchSuffix}_devel = $portVersion
	devel:libwcstools$secondaryArchSuffix = $portVersion
	"
REQUIRES_devel="
	wcstools$secondaryArchSuffix == $portVersion base
	haiku$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:aclocal
	cmd:autoconf
	cmd:autoheader
	cmd:automake
	cmd:awk
	cmd:gcc$secondaryArchSuffix
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	cmd:sed
	"

TEST_REQUIRES="
	cmd:test
	"

PATCH()
{
	sed -i \
		-e 's/getdate/wcsgetdate/' \
		-e 's/crlf/wcscrlf/' \
		-e 's/remap/wcsremap/' \
		-e "s/3.... Programs/${portVersion} Programs/" \
		wcstools
}

BUILD()
{
	for f in "$portDir"/additional-files/{configure.ac,wcstools.pc.in,Makefile.am}; do
		cp ${f} .
	done
	cp "$portDir"/additional-files/Makefile.libwcs.am libwcs/Makefile.am

	#if [ "$effectiveTargetArchitecture" != x86_gcc2 ]; then
	#	export CXXFLAGS="-Wno-catch-value"
	#fi
	mkdir -p m4

	libtoolize --force --copy --install
	aclocal --force --install
	autoheader --force
	autoconf --force
	automake --add-missing --force-missing

	runConfigure ./configure
	make $jobArgs

}

INSTALL()
{
	make install

	rm -f $libDir/libwcstools.la*

	prepareInstalledDevelLib libwcstools
	fixPkgconfig

	# copy pdf documentation
	#mkdir -p $developDocDir
	#cp -rd *.pdf $developDocDir

	# copy html documentation
	#cp -rd html $developDocDir/

	# devel package
	packageEntries devel $developDir
}

TEST()
{
	make check $jobArgs
	cookbook 1>/dev/null

	declare -a testfiles=("atestfil" "btestfil" "ctestfil")
	for i in "${testfiles[@]}"
	do
		test -f ${i}.fit
	done
}
