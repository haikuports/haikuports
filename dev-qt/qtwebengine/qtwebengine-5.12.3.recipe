SUMMARY="Qt WebEngine rendering library for dynamic web content"
DESCRIPTION="Qt WebEngine provides functionality for rendering regions of dynamic web content. \
The functionality in Qt WebEngine is divided into the following modules: \
* QtWebEngineCore: Provides public API shared by both QtWebEngine and QtWebEngineWidgets \
* QtWebEngine: Provides QML types for rendering web content within a QML application \
* QtWebEngineWidgets: Provides a web browser engine as well as C++ classes to render \
and interact with web content"

HOMEPAGE="https://www.qt.io"
COPYRIGHT="2015-2019 The Qt Company Ltd."
LICENSE="GNU LGPL v3"
REVISION="1"
SOURCE_URI="https://download.qt.io/official_releases/qt/5.12/5.12.3/submodules/qtwebengine-everywhere-src-5.12.3.tar.xz"
CHECKSUM_SHA256="5bb49ead71b851db4dc56f8fd97e0db72a268b22104129a06bac201d55d3b8fe"
SOURCE_DIR="qtwebengine-everywhere-src-5.12.3"
PATCHES="qtwebengine-5.12.3.patchset"

ARCHITECTURES="!x86_gcc2 ?x86 ?x86_64"
SECONDARY_ARCHITECTURES="?x86"

PROVIDES="
	qtwebengine$secondaryArchSuffix = $portVersion compat >= 5
	lib:libQt5WebEngine$secondaryArchSuffix = $portVersion compat >= 5
	lib:libQt5WebEngineCore$secondaryArchSuffix = $portVersion compat >= 5
	lib:libQt5WebEngineWidgets$secondaryArchSuffix = $portVersion compat >= 5
	cmd:qwebengine_convert_dict$secondaryArchSuffix = $portVersion compat >= 5

	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libavcodec$secondaryArchSuffix
	lib:libdbus_1$secondaryArchSuffix
	lib:libfreetype$secondaryArchSuffix
	lib:libfontconfig$secondaryArchSuffix
	lib:libGL$secondaryArchSuffix
	lib:libEGL$secondaryArchSuffix
	lib:libglu$secondaryArchSuffix
	lib:libglib_2.0$secondaryArchSuffix
	lib:libharfbuzz$secondaryArchSuffix
	lib:libharfbuzz_icu$secondaryArchSuffix
	lib:libhunspell$secondaryArchSuffix
	lib:libhyphen$secondaryArchSuffix
	lib:libicudata$secondaryArchSuffix
	lib:libicui18n$secondaryArchSuffix
	lib:libicuuc$secondaryArchSuffix
	lib:libjpeg$secondaryArchSuffix
	lib:libjsoncpp$secondaryArchSuffix
	lib:libnss3$secondaryArchSuffix
	lib:libopus$secondaryArchSuffix
	lib:liborc_0.4$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
	lib:libprotobuf$secondaryArchSuffix
	lib:libre2$secondaryArchSuffix
	lib:libvpx$secondaryArchSuffix
	lib:libQt5Core$secondaryArchSuffix
	lib:libQt5Gui$secondaryArchSuffix
	lib:libQt5Multimedia$secondaryArchSuffix
	lib:libQt5MultimediaWidgets$secondaryArchSuffix
	lib:libQt5Network$secondaryArchSuffix
	lib:libQt5Positioning$secondaryArchSuffix
	lib:libQt5PrintSupport$secondaryArchSuffix
	lib:libQt5Qml$secondaryArchSuffix
	lib:libQt5Quick$secondaryArchSuffix
	lib:libQt5Sensors$secondaryArchSuffix
	lib:libQt5WebChannel$secondaryArchSuffix
	lib:libQt5Widgets$secondaryArchSuffix
	lib:libsnappy$secondaryArchSuffix
	lib:libsqlite3$secondaryArchSuffix
	lib:libsrtp$secondaryArchSuffix
	lib:libwebp$secondaryArchSuffix
	lib:libxml2$secondaryArchSuffix
	lib:libxslt$secondaryArchSuffix
	lib:libyasm$secondaryArchSuffix
	lib:libxcomposite$secondaryArchSuffix
	lib:libxcursor$secondaryArchSuffix
	lib:libxi$secondaryArchSuffix
	lib:libXrandr$secondaryArchSuffix
	lib:libxtst$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

PROVIDES_devel="
	qtwebengine${secondaryArchSuffix}_devel = $portVersion compat >= 5
	devel:libQt5WebEngine$secondaryArchSuffix = $portVersion compat >= 5
	devel:libQt5WebEngineCore$secondaryArchSuffix = $portVersion compat >= 5
	devel:libQt5WebEngineWidgets$secondaryArchSuffix = $portVersion compat >= 5
	"

REQUIRES_devel="
	haiku$secondaryArchSuffix
	qtwebengine$secondaryArchSuffix == $portVersion base
	devel:libQt5Gui$secondaryArchSuffix
	devel:libQt5Core$secondaryArchSuffix
	devel:libQt5Network$secondaryArchSuffix
	devel:libQt5Widgets$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libavcodec$secondaryArchSuffix
	devel:libgcc$secondaryArchSuffix
	devel:libcrypto$secondaryArchSuffix
	devel:libdbus_1$secondaryArchSuffix
	devel:libegl$secondaryArchSuffix
	devel:libfontconfig$secondaryArchSuffix
	devel:libfreetype$secondaryArchSuffix
	devel:libGL$secondaryArchSuffix
	devel:libEGL$secondaryArchSuffix
	devel:libglu$secondaryArchSuffix
	devel:libglib_2.0$secondaryArchSuffix
	devel:libharfbuzz$secondaryArchSuffix
	devel:libharfbuzz_icu$secondaryArchSuffix
	devel:libhunspell$secondaryArchSuffix
	devel:libhyphen$secondaryArchSuffix
	devel:libicuuc$secondaryArchSuffix
	devel:libintl$secondaryArchSuffix
	devel:liblcms2$secondaryArchSuffix
	devel:libjsoncpp$secondaryArchSuffix
	devel:libjpeg$secondaryArchSuffix
	devel:libnss3$secondaryArchSuffix
	devel:libopus$secondaryArchSuffix
	devel:liborc_0.4$secondaryArchSuffix
	devel:libpcre2_16$secondaryArchSuffix
	devel:libpng$secondaryArchSuffix
	devel:libprotobuf$secondaryArchSuffix
	devel:libQt5Gui$secondaryArchSuffix
	devel:libQt5Core$secondaryArchSuffix
	devel:libQt5Network$secondaryArchSuffix
	devel:libQt5Widgets$secondaryArchSuffix
	devel:libQt5Quick$secondaryArchSuffix
	devel:libQt5Qml$secondaryArchSuffix
	devel:libQt5Multimedia$secondaryArchSuffix
	devel:libQt5Positioning$secondaryArchSuffix
	devel:libQt5Sensors$secondaryArchSuffix
	devel:libQt5WebChannel$secondaryArchSuffix
	devel:libQt5PrintSupport$secondaryArchSuffix
	devel:libQt5MultimediaWidgets$secondaryArchSuffix
	devel:libre2$secondaryArchSuffix
	devel:libsnappy$secondaryArchSuffix
	devel:libsqlite3$secondaryArchSuffix
	devel:libsrtp$secondaryArchSuffix
	devel:libssl$secondaryArchSuffix
	devel:libvpx$secondaryArchSuffix
	devel:libwebp$secondaryArchSuffix
	devel:libxml2$secondaryArchSuffix
	devel:libxslt$secondaryArchSuffix
	devel:libyasm$secondaryArchSuffix
	devel:libxcomposite$secondaryArchSuffix
	devel:libxcursor$secondaryArchSuffix
	devel:libxi$secondaryArchSuffix
	devel:libXrandr$secondaryArchSuffix
	devel:libxtst$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:bison
	cmd:clang
	cmd:find
	cmd:flex
	cmd:as$secondaryArchSuffix
	cmd:gcc$secondaryArchSuffix
	cmd:g++$secondaryArchSuffix
	cmd:gperf
	cmd:ld$secondaryArchSuffix
	cmd:make
	cmd:ninja
	cmd:perl
	cmd:pkg_config$secondaryArchSuffix
	cmd:python2
	cmd:sed
	"

BUILD()
{
	cd $sourceDir
	mkdir -p build && cd build

	qmake ..

	make $jobArgs
}


INSTALL()
{
	cd build
	make install

	mkdir -p $dataDir/Qt5
	mv -f $libDir/qml $dataDir/Qt5
	mv -f $prefix/mkspecs $dataDir/Qt5

	fixPkgconfig

	prepareInstalledDevelLibs libQt5WebEngine libQt5WebEngineCore libQt5WebEngineWidgets

	cd $libDir
	for i in lib*.so.5.*;do
		ln -fs $i $(echo $i | cut -f1,2 -d.)
	done

	packageEntries devel \
		$developDir \
		$libDir/cmake \
		$dataDir/Qt5/mkspecs
}
