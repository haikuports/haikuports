From bf2600d18ee7697fb03cf23a9d3a31bf73b0b07d Mon Sep 17 00:00:00 2001
From: Khaled <khallbal@gmail.com>
Date: Thu, 26 Mar 2020 14:32:27 +0100
Subject: Disable utmp.h/utmpx.h stuff, missing in haiku


diff --git a/lib/kpty.cpp b/lib/kpty.cpp
index 542bde3..e66d437 100644
--- a/lib/kpty.cpp
+++ b/lib/kpty.cpp
@@ -94,7 +94,7 @@ extern "C" {
 # include <utempter.h>
 }
 #else
-# include <utmp.h>
+//# include <utmp.h>
 # ifdef HAVE_UTMPX
 #  include <utmpx.h>
 # endif
@@ -130,7 +130,7 @@ extern "C" {
 #if defined (__FreeBSD__) || defined(__FreeBSD_kernel__) || defined (__NetBSD__) || defined (__OpenBSD__) || defined (__bsdi__) || defined(__APPLE__) || defined (__DragonFly__)
 # define _tcgetattr(fd, ttmode) ioctl(fd, TIOCGETA, (char *)ttmode)
 #else
-# if defined(_HPUX_SOURCE) || defined(__Lynx__) || defined (__CYGWIN__) || defined(__GNU__)
+# if defined(_HPUX_SOURCE) || defined(__Lynx__) || defined (__CYGWIN__) || defined(__GNU__) || defined(__HAIKU__)
 #  define _tcgetattr(fd, ttmode) tcgetattr(fd, ttmode)
 # else
 #  define _tcgetattr(fd, ttmode) ioctl(fd, TCGETS, (char *)ttmode)
@@ -140,7 +140,7 @@ extern "C" {
 #if defined (__FreeBSD__) || defined(__FreeBSD_kernel__) || defined (__NetBSD__) || defined (__OpenBSD__) || defined (__bsdi__) || defined(__APPLE__) || defined (__DragonFly__)
 # define _tcsetattr(fd, ttmode) ioctl(fd, TIOCSETA, (char *)ttmode)
 #else
-# if defined(_HPUX_SOURCE) || defined(__CYGWIN__) || defined(__GNU__)
+# if defined(_HPUX_SOURCE) || defined(__CYGWIN__) || defined(__GNU__) || defined(__HAIKU__)
 #  define _tcsetattr(fd, ttmode) tcsetattr(fd, TCSANOW, ttmode)
 # else
 #  define _tcsetattr(fd, ttmode) ioctl(fd, TCSETS, (char *)ttmode)
@@ -500,6 +500,7 @@ void KPty::setCTty()
 
 void KPty::login(const char * user, const char * remotehost)
 {
+#ifndef __HAIKU__
 #ifdef HAVE_UTEMPTER
     Q_D(KPty);
 
@@ -582,6 +583,7 @@ void KPty::login(const char * user, const char * remotehost)
 #  endif
 # endif
 #endif
+#endif // #ifndef __HAIKU__
 }
 
 void KPty::logout()
@@ -612,6 +614,7 @@ void KPty::logout()
     ::logout(str_ptr);
 #  endif
 # else
+#ifndef __HAIKU__
 #  ifdef HAVE_UTMPX
     struct utmpx l_struct, *ut;
 #  else
@@ -655,6 +658,7 @@ endutent();
 #  endif
 # endif
 #endif
+#endif // #ifndef __HAIKU__
 }
 
 // XXX Supposedly, tc[gs]etattr do not work with the master on Solaris.
-- 
2.24.1


From 95217064337e8b65188647434999744dafe37749 Mon Sep 17 00:00:00 2001
From: Khaled <khallbal@gmail.com>
Date: Thu, 26 Mar 2020 14:43:21 +0100
Subject: Fix paths for haiku


diff --git a/lib/qtermwidget.cpp b/lib/qtermwidget.cpp
index 5c3e56f..a7555c6 100644
--- a/lib/qtermwidget.cpp
+++ b/lib/qtermwidget.cpp
@@ -260,10 +260,17 @@ void QTermWidget::init(int startnow)
     // First check $XDG_DATA_DIRS. This follows the implementation in libqtxdg
     QString d = QFile::decodeName(qgetenv("XDG_DATA_DIRS"));
     QStringList dirs = d.split(QLatin1Char(':'), QString::SkipEmptyParts);
+#ifdef Q_OS_HAIKU
+	if (dirs.isEmpty()) {
+		dirs.append(QString::fromLatin1("/boot/system/non-packaged/data"));
+		dirs.append(QString::fromLatin1("/boot/system/data"));
+	}
+#else
     if (dirs.isEmpty()) {
         dirs.append(QString::fromLatin1("/usr/local/share"));
         dirs.append(QString::fromLatin1("/usr/share"));
     }
+#endif
     dirs.append(QFile::decodeName(TRANSLATIONS_DIR));
 
     m_translator = new QTranslator(this);
-- 
2.24.1

