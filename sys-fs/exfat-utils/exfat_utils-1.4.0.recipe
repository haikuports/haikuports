SUMMARY="Group of exFAT utilities (alternative to \"exfatprogs\")"
DESCRIPTION="The \"exfat\" project aims to provide a full featured exFAT file system \
implementation for Unix'like systems.

It consists of a FUSE module (fuse-exfat) and a set of utilities (exfat-utils).

This package contains the \"exfat-utils\" commands."
HOMEPAGE="https://github.com/relan/exfat"
COPYRIGHT="2011-2023 Andrew Nayenko"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://github.com/relan/exfat/releases/download/v$portVersion/exfat-utils-$portVersion.tar.gz"
CHECKSUM_SHA256="241575fa93104406a47e79e53e4d907bae69886f11621f70a45276c62b75bf69"
SOURCE_DIR="exfat-utils-$portVersion"
PATCHES="$portBaseName-$portVersion.patchset"

ARCHITECTURES="?all !x86_gcc2"
SECONDARY_ARCHITECTURES="?x86"

commandSuffix=$secondaryArchSuffix
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
	commandSuffix=
	commandBinDir=$prefix/bin
fi

PROVIDES="
	$portName = $portVersion
	cmd:exfatattrib$commandSuffix = $portVersion
	cmd:dumpexfat$commandSuffix = $portVersion
	cmd:exfatfsck$commandSuffix = $portVersion
	cmd:fsck.exfat$commandSuffix = $portVersion
	cmd:exfatlabel$commandSuffix = $portVersion
	cmd:mkexfatfs$commandSuffix = $portVersion
	cmd:mkfs.exfat$commandSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

CONFLICTS="
	exfatprogs$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:gcc$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	export CFLAGS="-O2 -DB_USE_POSITIVE_POSIX_ERRORS"
	export LIBS="-lposix_error_mapper"
	runConfigure ./configure
	make $jobArgs
}

INSTALL()
{
	make $jobArgs install
}
