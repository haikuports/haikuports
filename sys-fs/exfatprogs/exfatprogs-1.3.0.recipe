SUMMARY="Standard EXFAT filesystem utilities"
DESCRIPTION="Various tools to manage EXFAT filesystems (resize, etc)"
HOMEPAGE="https://github.com/exfatprogs/exfatprogs/"
COPYRIGHT="2025 Haodong Xia
	2019-2021 Namjae Jeon
	2021 LG Electronics
	2020 Hyunchul Lee"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://github.com/exfatprogs/exfatprogs/archive/$portVersion/exfatprogs-$portVersion.tar.gz"
CHECKSUM_SHA256="4f9707d8af3479d661a4a3c095c219d417c20785d9dc4d048b61c6023288f7d2"
PATCHES="exfatprogs-$portVersion.patchset"

ARCHITECTURES="ALL !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

commandSuffix=$secondaryArchSuffix
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
	commandSuffix=
	commandBinDir=$prefix/bin
fi

PROVIDES="
	exfatprogs$secondaryArchSuffix = $portVersion
	cmd:defrag.exfat
	cmd:dump.exfat
	cmd:exfat2img
	cmd:exfatlabel
	cmd:fsck.exfat
	cmd:mkfs.exfat
	cmd:tune.exfat
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:aclocal
	cmd:autoconf
	cmd:automake
	cmd:gcc$secondaryArchSuffix
	cmd:gettext
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	"

PATCH()
{
	sed -i -e 's/-ENOMEM/ENOMEM/g' */*.c
}

BUILD()
{
	./autogen.sh
	runConfigure --omit-dirs "binDir sbinDir" ./configure \
		--bindir="$commandBinDir" \
		--sbindir="$commandBinDir"
	make $jobArgs
}

INSTALL()
{
	make install
}

TEST()
{
	make check
}
