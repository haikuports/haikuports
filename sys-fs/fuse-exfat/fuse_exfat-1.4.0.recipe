SUMMARY="FUSE/UserlandFS exFAT file system module"
DESCRIPTION="The \"exfat\" project aims to provide a full featured exFAT file system \
implementation for Unix'like systems.

It consists of a FUSE module (fuse-exfat) and a set of utilities (exfat-utils).

This package contains the \"fuse-exfat\" module (with write support) for use with \
Haiku's UserlandFS.

Usage examples:

> mkdir /exFAT-mount
> mount -t userlandfs -o \"fuse-exfat ~/foobar.exfat /exFAT-mount\" /exFAT-mount

To mount an exFAT volume \"image\", or:

> mount -t userlandfs -o \"fuse-exfat /dev/disk/usb/0/0/0 /exFAT-mount\" /exFAT-mount

To mount an exFAT formatted USB pendrive."
HOMEPAGE="https://github.com/relan/exfat"
COPYRIGHT="2011-2023 Andrew Nayenko"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://github.com/relan/exfat/releases/download/v$portVersion/fuse-exfat-$portVersion.tar.gz"
CHECKSUM_SHA256="a1cfedc55e0e7a12c184605aa0f0bf44b24a3fb272449b20b2c8bbe6edb3001e"
SOURCE_DIR="fuse-exfat-$portVersion"

PATCHES="$portBaseName-$portVersion.patchset"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	$portName = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	userland_fs
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	userland_fs
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:gcc$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	export CFLAGS="-O2 -DB_USE_POSITIVE_POSIX_ERRORS -D_FILE_OFFSET_BITS=64"
	export LIBS="-lposix_error_mapper"
	runConfigure ./configure
	make $jobArgs
}


INSTALL()
{
	mkdir -p $prefix/add-ons/userlandfs
	cp fuse/mount.exfat-fuse $prefix/add-ons/userlandfs/fuse-exfat
}
