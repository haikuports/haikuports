SUMMARY="The popular cross-plattform media player"
DESCRIPTION="VLC is a free and open source cross-platform multimedia player \
and framework that plays most multimedia files as well as DVDs, Audio CDs, \
VCDs, and various streaming protocols."
HOMEPAGE="https://www.videolan.org/vlc/"
COPYRIGHT="1998-2015 VideoLAN"
LICENSE="GNU GPL v2"
REVISION="4"
SOURCE_URI="https://download.videolan.org/pub/videolan/vlc/$portVersion/vlc-$portVersion.tar.xz"
CHECKSUM_SHA256="543d9d7e378ec0fa1ee2e7f7f5acf8c456c7d0ecc32037171523197ef3cf1fcb"
PATCHES="vlc-$portVersion.patch"
ADDITIONAL_FILES="vlc.rdef"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	vlc$secondaryArchSuffix = $portVersion
	cmd:vlc_wrapper$secondaryArchSuffix
	cmd:vlc$secondaryArchSuffix
	cmd:cvlc$secondaryArchSuffix
	cmd:nvlc$secondaryArchSuffix
	cmd:qvlc$secondaryArchSuffix
	cmd:rvlc$secondaryArchSuffix
	lib:libvlc$secondaryArchSuffix
	lib:libvlccore$secondaryArchSuffix
	"
REQUIRES="
	haiku${secondaryArchSuffix}
	libqt4${secondaryArchSuffix} >= 4.8
	lib:liba52$secondaryArchSuffix
	lib:libass$secondaryArchSuffix
	lib:libavcodec$secondaryArchSuffix
	lib:libavformat$secondaryArchSuffix
	lib:libavutil$secondaryArchSuffix
	lib:libbluray$secondaryArchSuffix
	lib:libbz2$secondaryArchSuffix
	lib:libcaca$secondaryArchSuffix
	lib:libcrypto$secondaryArchSuffix
	lib:libdca$secondaryArchSuffix
#	lib:libdevice$secondaryArchSuffix
	lib:libdvbpsi$secondaryArchSuffix
	lib:libdvdnav$secondaryArchSuffix
	lib:libdvdread$secondaryArchSuffix
	lib:libebml$secondaryArchSuffix
	lib:libenca$secondaryArchSuffix
	lib:libfaad$secondaryArchSuffix
	lib:libflac$secondaryArchSuffix
#	lib:libfluidsynth$secondaryArchSuffix
	lib:libfontconfig$secondaryArchSuffix
	lib:libfreetype$secondaryArchSuffix
	lib:libfribidi$secondaryArchSuffix
	lib:libgcrypt$secondaryArchSuffix
	lib:libgl$secondaryArchSuffix
#	lib:libgnutls$secondaryArchSuffix
	lib:libgpg_error$secondaryArchSuffix
	lib:libharfbuzz$secondaryArchSuffix
	lib:libiconv$secondaryArchSuffix
	lib:libintl$secondaryArchSuffix
	lib:libixml$secondaryArchSuffix
	lib:libjpeg$secondaryArchSuffix
	lib:libmad$secondaryArchSuffix
	lib:libmatroska$secondaryArchSuffix
	lib:libmodplug$secondaryArchSuffix
	lib:libmpcdec$secondaryArchSuffix
	lib:libmpeg2$secondaryArchSuffix
#	lib:libmtp$secondaryArchSuffix
	lib:libncursesw$secondaryArchSuffix
	lib:libogg$secondaryArchSuffix
	lib:libopus$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
	lib:libpostproc$secondaryArchSuffix
	lib:libsamplerate$secondaryArchSuffix
#	lib:libschroedinger$secondaryArchSuffix
	lib:libsdl_1.2$secondaryArchSuffix
	lib:libsdl_image_1.2$secondaryArchSuffix
#	lib:libsmbclient$secondaryArchSuffix
	lib:libspeex$secondaryArchSuffix
#	lib:libspeexdsp$secondaryArchSuffix
	lib:libssh2$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	lib:libswscale$secondaryArchSuffix >= 3
	lib:libtag$secondaryArchSuffix
	lib:libtheoradec$secondaryArchSuffix
	lib:libtheoraenc$secondaryArchSuffix
	lib:libthreadutil$secondaryArchSuffix
	lib:libtwolame$secondaryArchSuffix
	lib:libupnp$secondaryArchSuffix
	lib:libvorbis$secondaryArchSuffix
	lib:libvorbisenc$secondaryArchSuffix
	lib:libvpx$secondaryArchSuffix
	lib:libx264$secondaryArchSuffix
	lib:libx265$secondaryArchSuffix
	lib:libxml2$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	libqt4${secondaryArchSuffix}_devel >= 4.8
	devel:liba52$secondaryArchSuffix
	devel:libass$secondaryArchSuffix
	devel:libbluray$secondaryArchSuffix
	devel:libcaca$secondaryArchSuffix
	devel:libcddb$secondaryArchSuffix
	devel:libdca$secondaryArchSuffix
	devel:libdvbpsi$secondaryArchSuffix
	devel:libdvdcss$secondaryArchSuffix
	devel:libdvdnav$secondaryArchSuffix
	devel:libdvdread$secondaryArchSuffix
	devel:libebml$secondaryArchSuffix
	devel:libenca$secondaryArchSuffix
	devel:libfaad$secondaryArchSuffix
	devel:libflac$secondaryArchSuffix
#	devel:libfluidsynth$secondaryArchSuffix
	devel:libfontconfig$secondaryArchSuffix
	devel:libfreetype$secondaryArchSuffix
	devel:libfribidi$secondaryArchSuffix
	devel:libgcrypt$secondaryArchSuffix
	devel:libgl$secondaryArchSuffix
#	devel:libgnutls$secondaryArchSuffix
	devel:libgpg_error$secondaryArchSuffix
	devel:libharfbuzz$secondaryArchSuffix
	devel:libiconv$secondaryArchSuffix
	devel:libjpeg$secondaryArchSuffix
	devel:libmad$secondaryArchSuffix
	devel:libmatroska$secondaryArchSuffix
	devel:libmodplug$secondaryArchSuffix
	devel:libmpcdec$secondaryArchSuffix
	devel:libmpeg2$secondaryArchSuffix
#	devel:libmtp$secondaryArchSuffix
	devel:libogg$secondaryArchSuffix
	devel:libopus$secondaryArchSuffix
	devel:libpng$secondaryArchSuffix
	devel:libpthread_stubs$secondaryArchSuffix
	devel:libsamplerate$secondaryArchSuffix
#	devel:libschroedinger$secondaryArchSuffix
	devel:libsdl_1.2$secondaryArchSuffix
	devel:libsdl_image_1.2$secondaryArchSuffix
#	devel:libsmbclient$secondaryArchSuffix
	devel:libspeex$secondaryArchSuffix
	devel:libssh2$secondaryArchSuffix
	devel:libssl$secondaryArchSuffix
	devel:libswscale$secondaryArchSuffix >= 3
	devel:libtag$secondaryArchSuffix
	devel:libtheora$secondaryArchSuffix
	devel:libtwolame$secondaryArchSuffix
	devel:libupnp$secondaryArchSuffix
	devel:libvorbis$secondaryArchSuffix
	devel:libvpx$secondaryArchSuffix
	devel:libx264$secondaryArchSuffix
	devel:libx265$secondaryArchSuffix
	devel:libxcb$secondaryArchSuffix
	devel:libxml2$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:aclocal
	cmd:autoreconf
	cmd:g++${secondaryArchSuffix}
	cmd:gettext$secondaryArchSuffix
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	cmd:xargs
	"

BUILD()
{
	bootstrap
	runConfigure ./configure --disable-rpath --disable-lua --disable-xcb \
	--with-default-font=/system/data/fonts/ttfonts/DejaVuSans.ttf \
	--with-default-font-family=Sans \
	--with-default-monospace-font-family=Monospace --disable-update-check \
	--disable-dependency-tracking --enable-run-as-root
	#--bindir=$appsDir/VLC --libdir=$appsDir/VLC/lib

	make $jobArgs
}

INSTALL()
{
	make install-strip

	rm -rf $dataDir/{applications,icons,kde4,vlc}

	# Punt useless libtool's .la files
	find $libDir -name '*.la' -delete

	local APP_SIGNATURE="application/x-vnd.vlc"
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	sed \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		$portDir/additional-files/vlc.rdef > vlc.rdef

	addResourcesToBinaries vlc.rdef $binDir/vlc
	addAppDeskbarSymlink $binDir/vlc "VLC media player"

#	prepareInstalledDevelLibs libvlc libvlccore

#	packageEntries devel \
#		$developDir
}

TEST()
{
	make check
}
