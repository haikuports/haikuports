SUMMARY="Gaming frontend for your multi-platform collection"
DESCRIPTION="ES-DE (EmulationStation Desktop Edition) is a frontend for browsing and launching games from your \
multi-platform collection. It comes preconfigured for use with a large selection \
of emulators and game engines."
HOMEPAGE="https://es-de.org"
COPYRIGHT="2024 Northwestern Software AB"
LICENSE="MIT"
REVISION="1"
srcGitRev="a59b8016be3ccaab0a678a552128d06b32e7dc01"
SOURCE_URI="https://gitlab.com/es-de/emulationstation-de/-/archive/$srcGitRev/emulationstation-de-$srcGitRev.tar.gz"
CHECKSUM_SHA256="492abe6b9e32158a177acf42ce212f15775eeb7f7f6171cd2ffd5c2c6c7686b4"
SOURCE_FILENAME="emulationstation-de-$portVersion-$srcGitRev.tar.gz"
SOURCE_DIR="emulationstation-de-$srcGitRev"
ADDITIONAL_FILES="es-de.rdef.in"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
        es_de = $portVersion
        app:es_de = $portVersion
        "

REQUIRES="
        haiku$secondaryArchSuffix
        lib:libGL$secondaryArchSuffix
        lib:libavcodec$secondaryArchSuffix
        lib:libavformat$secondaryArchSuffix
        lib:libavutil$secondaryArchSuffix
        lib:libcurl$secondaryArchSuffix
        lib:libfreeimage$secondaryArchSuffix
        lib:libfreetype$secondaryArchSuffix
        lib:libharfbuzz$secondaryArchSuffix
        lib:libgit2$secondaryArchSuffix
        lib:libicuuc$secondaryArchSuffix
        lib:libintl$secondaryArchSuffix
        lib:libpoppler$secondaryArchSuffix
        lib:libpugixml$secondaryArchSuffix
        lib:libSDL2_2.0$secondaryArchSuffix
        "

BUILD_REQUIRES="
        haiku${secondaryArchSuffix}_devel
        devel:libGL$secondaryArchSuffix
        devel:libavcodec$secondaryArchSuffix
        devel:libavformat$secondaryArchSuffix
        devel:libavutil$secondaryArchSuffix
        devel:libcurl$secondaryArchSuffix
        devel:libfreeimage$secondaryArchSuffix
        devel:libfreetype$secondaryArchSuffix
        devel:libharfbuzz$secondaryArchSuffix
        devel:libgit2$secondaryArchSuffix >= 1.5
        devel:libicuuc$secondaryArchSuffix
        devel:libintl$secondaryArchSuffix
        devel:libpoppler$secondaryArchSuffix
        devel:libpugixml$secondaryArchSuffix
        devel:libSDL2_2.0$secondaryArchSuffix
        "

BUILD_PREREQUIRES="
        cmd:cmake
        cmd:g++$secondaryArchSuffix
        cmd:ld$secondaryArchSuffix
        cmd:make
        cmd:msgfmt$secondaryArchSuffix
        cmd:pkg_config$secondaryArchSuffix
        "

BUILD()
{
        cmake -DCMAKE_INSTALL_PREFIX=$prefix -DCMAKE_BUILD_TYPE=Release .
        make $jobArgs
}

INSTALL()
{
        make install

        local APP_SIGNATURE="application/x-vnd.ES-DE"
        local MAJOR="`echo "$portVersion" | cut -d. -f1`"
        local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
        local MINOR="`echo "$portVersion" | cut -d. -f3`"
        sed \
                -e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
                -e "s|@MAJOR@|$MAJOR|" \
                -e "s|@MIDDLE@|$MIDDLE|" \
                -e "s|@MINOR@|$MINOR|" \
                $portDir/additional-files/es-de.rdef.in > es-de.rdef

        addResourcesToBinaries es-de.rdef \
                "$appsDir"/es-de

        addAppDeskbarSymlink "$appsDir"/es-de "ES-DE"
}
