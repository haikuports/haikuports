SUMMARY="The TMZ file compressor/decompressor"
DESCRIPTION="The TMZ file compressor/decompressor for Haiku operating system \
is a free utility that compress & decompress files and folders in a tar/bzip2 \
compatible format that saves BFS(Haiku) specific attributes. \
It is written in Python with the Haiku-PyAPI wrapper which brings Haiku APIs \
to python3. This app can use the default tar libraries to compress/decompress \
files, or split the process in two steps, improving speed but consuming more \
resources. It's up to you configure the program behavior. \
The code is released under MIT license."
HOMEPAGE="https://github.com/tmtfx/HTPBZ2"
COPYRIGHT="2024 Fabio Tomat (TmTFx)"
LICENSE="MIT"
REVISION="1"
SOURCE_URI="https://github.com/tmtfx/HTPBZ2/archive/refs/tags/v$portVersion.tar.gz"
CHECKSUM_SHA256="b1d5ab280550578743cd8cd77ee9b8941783d95733e35c5c4a3e2a9fefe85f9a"
SOURCE_DIR="HTPBZ2-$portVersion"

ARCHITECTURES="any"
DISABLE_SOURCE_PACKAGE="yes"

PROVIDES="
	htmz = $portVersion
	app:HTMZ = $portVersion
	cmd:HTMZ.py = $portVersion
	cmd:DecompressTMZ
	"
REQUIRES="
	haiku
	haiku_pyapi_python310
	"

INSTALL()
{
	mkdir -p $appsDir/HTPBZ2 $binDir
	cp HTMZ.py $appsDir/HTPBZ2
	ln -sfn $appsDir/HTPBZ2/HTMZ.py $binDir/HTMZ.py
	ln -sfn $appsDir/HTPBZ2/HTMZ.py $appsDir/HTPBZ2/HTMZ
	addAppDeskbarSymlink $appsDir/HTPBZ2/HTMZ
	[ $targetArchitecture = x86_64 ] && TARGET_LAUNCHER=DecompressTMZ.zip
	[ $targetArchitecture = x86 ] && TARGET_LAUNCHER=DecompressTMZx86.zip
	unzip $TARGET_LAUNCHER
	if [ -e DecompressTMZ ]; then
		mv DecompressTMZ/DecompressTMZ $binDir/
		rm -rf DecompressTMZ
	fi
	if [ -e DecompressTMZx86 ]; then
		mv DecompressTMZx86/DecompressTMZ $binDir/
		rm -rf DecompressTMZx86
	fi
	unzip x-tmz.zip
	if [ -e x-tmz ]; then
		mkdir -p $dataDir/mime_db/application/
		mv x-tmz/x-tmz $dataDir/mime_db/application/
		rm -rf x-tmz
	fi
}
