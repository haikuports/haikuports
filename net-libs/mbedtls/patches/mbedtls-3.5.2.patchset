From 0a0555efa8cfd64e4ef7d3ff853487ca78b9c558 Mon Sep 17 00:00:00 2001
From: lizzie <lizzie@eden-emu.dev>
Date: Wed, 22 Oct 2025 23:56:27 +0000
Subject: [PATCH] Haiku fix

---
 library/platform_util.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/library/platform_util.c b/library/platform_util.c
index 1f15260..45fabaf 100644
--- a/library/platform_util.c
+++ b/library/platform_util.c
@@ -246,7 +246,7 @@ extern inline void mbedtls_put_unaligned_uint64(void *p, uint64_t x);
     (defined(__APPLE__) && defined(__MACH__)))
 #include <unistd.h>
 #endif /* !_WIN32 && (unix || __unix || __unix__ || (__APPLE__ && __MACH__)) */
-#if (defined(_POSIX_VERSION) && _POSIX_VERSION >= 199309L)
+#if defined(__HAIKU__) || (defined(_POSIX_VERSION) && _POSIX_VERSION >= 199309L)
 mbedtls_ms_time_t mbedtls_ms_time(void)
 {
     int ret;
@@ -280,6 +280,9 @@ mbedtls_ms_time_t mbedtls_ms_time(void)
     return current_ms;
 }
 #else
-#error "No mbedtls_ms_time available"
+mbedtls_ms_time_t mbedtls_ms_time(void)
+{
+    return time(NULL) * 1000;
+}
 #endif
 #endif /* MBEDTLS_HAVE_TIME && !MBEDTLS_PLATFORM_MS_TIME_ALT */
-- 
2.51.0

