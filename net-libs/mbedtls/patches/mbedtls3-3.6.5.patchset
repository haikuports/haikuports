From 026d5bec5ae378c85fe48b9e690d3c0dc2b88c56 Mon Sep 17 00:00:00 2001
From: lizzie <lizzie@eden-emu.dev>
Date: Thu, 23 Oct 2025 07:17:04 +0000
Subject: [PATCH] haikuos fix for missing time() implementation

---
 library/platform_util.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/library/platform_util.c b/library/platform_util.c
index 19ef07a..f6cb311 100644
--- a/library/platform_util.c
+++ b/library/platform_util.c
@@ -258,6 +258,9 @@ mbedtls_ms_time_t mbedtls_ms_time(void)
     return current_ms;
 }
 #else
-#error "No mbedtls_ms_time available"
+mbedtls_ms_time_t mbedtls_ms_time(void)
+{
+    return time(NULL) * 1000;
+}
 #endif
 #endif /* MBEDTLS_HAVE_TIME && !MBEDTLS_PLATFORM_MS_TIME_ALT */
-- 
2.51.0

From 337e4bd036d45cd16cb38555fe98e4449e7d88fc Mon Sep 17 00:00:00 2001
From: Luc Schrijvers <begasus@gmail.com>
Date: Thu, 23 Oct 2025 08:49:36 +0000
Subject: [PATCH 2/2] Using a hardcoded path like 'include' for headers path
 doesn't follow GNUInstallDirs method.

---
 3rdparty/everest/CMakeLists.txt | 2 +-
 3rdparty/p256-m/CMakeLists.txt  | 2 +-
 include/CMakeLists.txt          | 4 ++--
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/3rdparty/everest/CMakeLists.txt b/3rdparty/everest/CMakeLists.txt
index e0e5ade..f105c89 100644
--- a/3rdparty/everest/CMakeLists.txt
+++ b/3rdparty/everest/CMakeLists.txt
@@ -29,7 +29,7 @@ endif()
 if(INSTALL_MBEDTLS_HEADERS)
 
   install(DIRECTORY include/everest
-    DESTINATION include
+    DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}
     FILE_PERMISSIONS OWNER_READ OWNER_WRITE GROUP_READ WORLD_READ
     DIRECTORY_PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE
     FILES_MATCHING PATTERN "*.h")
diff --git a/3rdparty/p256-m/CMakeLists.txt b/3rdparty/p256-m/CMakeLists.txt
index 2ef0d48..884002e 100644
--- a/3rdparty/p256-m/CMakeLists.txt
+++ b/3rdparty/p256-m/CMakeLists.txt
@@ -27,7 +27,7 @@ endif()
 if(INSTALL_MBEDTLS_HEADERS)
 
   install(DIRECTORY :${CMAKE_CURRENT_SOURCE_DIR}
-    DESTINATION include
+    DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}
     FILE_PERMISSIONS OWNER_READ OWNER_WRITE GROUP_READ WORLD_READ
     DIRECTORY_PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE
     FILES_MATCHING PATTERN "*.h")
diff --git a/include/CMakeLists.txt b/include/CMakeLists.txt
index e11e271..2df6661 100644
--- a/include/CMakeLists.txt
+++ b/include/CMakeLists.txt
@@ -6,11 +6,11 @@ if(INSTALL_MBEDTLS_HEADERS)
     file(GLOB psa_headers "psa/*.h")
 
     install(FILES ${headers}
-        DESTINATION include/mbedtls
+        DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/mbedtls
         PERMISSIONS OWNER_READ OWNER_WRITE GROUP_READ WORLD_READ)
 
     install(FILES ${psa_headers}
-        DESTINATION include/psa
+        DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/psa
         PERMISSIONS OWNER_READ OWNER_WRITE GROUP_READ WORLD_READ)
 
 endif(INSTALL_MBEDTLS_HEADERS)
-- 
2.51.0

