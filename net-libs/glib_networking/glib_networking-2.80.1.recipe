SUMMARY="Network-related giomodules for GLib"
DESCRIPTION="This package contains various network related extensions for the GIO library."
HOMEPAGE="https://www.gtk.org/"
COPYRIGHT="1995-1997  Peter Mattis, Spencer Kimball and Josh MacDonald
	1991-2003 Free Software Foundation, Inc.
	1997-2006 University of Cambridge.
	1998-2001, 2003-2010 Red Hat, Inc.
	2007-2009 Nokia Corporation
	2008, 2010 Oracle and/or its affiliates, Inc. All rights
	2008-2010 Codethink Limited
	2008-2010 Collabora Ltd.
	1995-2010 Several others"
LICENSE="GNU LGPL v2"
REVISION="1"
SOURCE_URI="http://ftp.gnome.org/pub/gnome/sources/glib-networking/${portVersion%.*}/glib-networking-$portVersion.tar.xz"
CHECKSUM_SHA256="b80e2874157cd55071f1b6710fa0b911d5ac5de106a9ee2a4c9c7bee61782f8e"
SOURCE_DIR="glib-networking-$portVersion"
PATCHES="glib_networking-$portVersion.patchset"

ARCHITECTURES="ALL !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

libVersion="$portVersion"
libVersionCompat="$libVersion compat >= ${libVersion%%.*}"

PROVIDES="
	glib_networking$secondaryArchSuffix = $portVersion compat >= 2
	lib:libglib_networking_2.0$secondaryArchSuffix = $libVersionCompat
	"
REQUIRES="
	haiku$secondaryArchSuffix
	ca_root_certificates
	gsettings_desktop_schemas$secondaryArchSuffix
	lib:libcrypto$secondaryArchSuffix
	lib:libgio_2.0$secondaryArchSuffix
	lib:libglib_2.0$secondaryArchSuffix
	lib:libgobject_2.0$secondaryArchSuffix
	lib:libproxy$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	ca_root_certificates
	gsettings_desktop_schemas$secondaryArchSuffix
	devel:libcrypto$secondaryArchSuffix >= 3
	devel:libgio_2.0$secondaryArchSuffix
	devel:libglib_2.0$secondaryArchSuffix
	devel:libgmodule_2.0$secondaryArchSuffix
	devel:libgobject_2.0$secondaryArchSuffix
	devel:libproxy$secondaryArchSuffix
	devel:libssl$secondaryArchSuffix >= 3
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:gio_querymodules
	cmd:meson
	cmd:msgfmt$secondaryArchSuffix
	cmd:ninja
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	sed -e '/meson.add_install_script/ s/^#*/#/' -i meson.build

	CFLAGS="-D_BSD_SOURCE" \
	LDFLAGS="-lbsd -lgnu -lnetwork" meson build \
		--buildtype=release \
		--prefix=$prefix \
		--bindir=$binDir \
		--datadir=$dataDir \
		--includedir=$includeDir \
		--libdir=$libDir \
		--localedir=$dataDir/locale \
		-Dopenssl=enabled \
		-Dgnutls=disabled

	ninja $jobArgs -C build
}

INSTALL()
{
	ninja -C build install

	 # cleanup
	 rm -rf $dataDir/dbus-1
	 rm -rf $libDir/systemd
}

TEST()
{
	unset meson
	meson test -C build --print-errorlogs
}
