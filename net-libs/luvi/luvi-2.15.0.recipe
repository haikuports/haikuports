SUMMARY="A project in-between luv and luvit"
DESCRIPTION="luvi is a project in-between luv and luvit.
The goal of this is to make building luvit and derivatives much easier."
HOMEPAGE="https://github.com/luvit/luvi"
COPYRIGHT="2012 The Luvit Authors
	Portions of this software were based on Node.js, \
	Joyent, Inc. and other Node contributors.
	"
LICENSE="Apache v2"
REVISION="1"
SOURCE_URI="https://github.com/luvit/luvi/releases/download/v$portVersion/luvi-source.tar.gz"
CHECKSUM_SHA256="91f40fb6421888c2ee403de80248250c234f3bfb6dd1edbbc9188a89e4b9708a"
SOURCE_FILENAME="luvi-$portVersion.tar.gz"
SOURCE_DIR=""
ADDITIONAL_FILES="luajit-2.1.patchset"

ARCHITECTURES="all !x86_gcc2"
if [ "$targetArchitecture" = x86_gcc2 ]; then
SECONDARY_ARCHITECTURES="?x86" # luv has this, and official Windows build of luvi supports 32 bit, so assuming that it works
fi

PROVIDES="
	luvi = $portVersion
	cmd:luvi
	"
REQUIRES="
	haiku
	"

BUILD_REQUIRES="
	haiku_devel
	"
BUILD_PREREQUIRES="
	cmd:gcc
	cmd:ld
	cmd:make
	cmd:install
	cmd:cmake
	cmd:perl
	cmd:git
	"
	
BUILD()
{ 
	# patch luajit (copied from hp/dev-lang/luajit)
	owd=$(pwd)
	cd deps/luv/deps/luajit
	git config --global --add safe.directory /sources
	git apply /additional-files/luajit-2.1.patchset
	cd $owd
	# build
	make regular
	make $jobArgs
}

INSTALL()
{
	mkdir -p $binDir
	install -m 0755 build/luvi $binDir
}

TEST()
{
	make test
}
